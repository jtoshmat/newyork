(new R9.logger).time("combined");(function(f,b){f.createComponentClass("common.layout.CountryPicker",{dropdown:null,options:{currentLocale:"",baseUrl:"",currentCurrency:""},init:function(){},addEventHandlers:function(){var d=this;this.element.find("[data-locale]").hover(function(a){a=b(a.target).attr("data-locale");var c=b(this).find("[data-locale\x3d%s]".format(a));c.length&&c.addClass("hover");c=b(this).parent();c.is("[data-locale]")&&!c.is("[data-locale\x3d%s]".format(a))&&d.element.find("[data-locale]").removeClass("hover")},
function(a){d.element.find("[data-locale]").removeClass("hover");b(this).parent().is("[data-locale]")&&(a=b(this).parent().attr("data-locale"),a=b(this).parent().find("[data-locale\x3d%s]".format(a)),a.length&&a.addClass("hover"))});this.element.delegate("a","click keypress",function(a){a.preventDefault();if(!a.keyCode||a.keyCode==f.globals.keyCodes.RETURN){var c=b(a.target).attr("data-locale"),e=!1;d.options.currentCurrency&&(e=(e=b(a.target).attr("data-currency"))&&e!==d.options.currentCurrency);
if(c!==d.options.currentLocale||e)f.Analytics.api.trackEvent("countrylangpicker/change/"+c),e=b.proxy(function(){var c=b(a.target).attr("data-href")||b(this).attr("href");window.location=c},this),d.options.baseUrl?d.makeRedirect(d.options.baseUrl,c,e):e()}});b(".Common-Layout-CountryPicker-Trigger.DropDown").on("click",function(a){a.preventDefault();b(this).hasClass("open")&&f.Analytics.api.trackEvent("countrylangpicker/open")})},makeRedirect:function(d,a,c){f.globals.isSeo?c():b.ajax({url:d+"/k/run/isp/setcc",
dataType:"jsonp",data:{cc:a},complete:function(){c()}})}})})(window.R9,window.jq||window.jQuery);(function(e,b){e.createComponentClass("common.layout.CurrencyPicker",{dialog:null,options:{anonymousOnly:!1},init:function(){this.dialog=this.getChildElement("dialog").dialog({}).getWidget()},scrollTopBeforeReload:function(){b(window).on("beforeunload",function(){b(window).scrollTop(0)})},saveCurrency:function(a,c){var d=this;b.ajax({type:"POST",url:"/k/ident/currency",data:{currency:a,posted:!0,save:c},dataType:"text",success:function(){d.scrollTopBeforeReload();location.reload()},cache:!1})},getAllCurrenciesBottomHeight:function(){var a=
b(".all-currencies").last(),c=a.height(),d=a.find("[class*\x3dcolumn]").map(function(){return b(this).height()}).get(),d=Math.max.apply(null,d),a=a.scrollTop();return d-c-a},handleFade:function(){var a=b(".all-currencies_fade"),c=this.getAllCurrenciesBottomHeight();0>=c?a.hide():5>=c?a.height(25):(a.show(),a.height(40))},getCurrencySelectionText:function(a){var b=a.find("[class*\x3dsymbol]").text();a=a.find("[class*\x3dcurrencyname]").text();return b+" "+a},addEventHandlers:function(){var a=this;
b(".currency-tooltip-item",this.element).on("click keypress",function(c){if(!c.keyCode||c.keyCode==e.globals.keyCodes.RETURN){a.getChildElement("dropdown").getWidget().close();var d=b(this).data("cur");c=b(".saveToProfile",a.dialog.element);var f=b(".visitOnly",a.dialog.element),g=a.getCurrencySelectionText(b(this));b(".currency_holder",a.dialog.element).html(g);if(a.options.anonymousOnly)a.saveCurrency(d,!1);else if(a.dialog.open(),f.on("click",function(){a.saveCurrency(d,!1)}),a.options.isLoggedIn)c.on("click",
function(){a.saveCurrency(d,!0)});else c.on("click",function(){e.authentication.showSignup({onclose:b.noop,success:function(){a.saveCurrency(d,!0)}})})}});0<b(".all-currencies").length&&(b(".all-currencies").on("scroll",function(b){a.handleFade()}),b(window).on("resize",function(b){a.handleFade()}))}})})(window.R9,window.jq||window.jQuery);(function(h,f){h.createWidgetClass("dropdown.DropdownDialog",{element:null,elementNode:null,content:null,placeholder:null,label:null,value:null,icon:null,isOpen:!1,leftOffset:0,ajaxLoadFailed:!1,eventSuffix:null,openDisabled:!1,subValue:null,animationDuration:200,options:{autoOpen:!1,alignment:null,direction:"down",isPopover:!1,showIcon:!0,matchWidth:!1,isFixedWidth:!1,repositionWithStyle:!1,scrollOffset:157,fixedPositionOffset:45,loadWithAjaxOnInit:!1,ajaxUrl:"",ajaxData:{},iconClass:"",contentClass:"",
triggerClass:"",content:null,onInit:null,onOpen:null,onClose:null,text:"",placeholder:"",topOffset:0,leftOffset:0,removeZIndex:!1,flippable:!0,delayShowDropdown:f.noop,showDropdownDelay:200,hasSubValue:!1,animateClose:null,expandTo:null,forceTriggerWidth:!1,useCover:!1,closeEvent:null,stopClickPropagation:!1,checkIsOutsideScreen:!1,tooltipIcon:"",tooltipText:"",showModalBp:-1},init:function(){!this.options.alignment&&this.element&&this.element.data("alignment")&&(this.options.alignment=this.element.data("alignment"));
!this.options.expandTo&&this.element&&this.element.data("expandto")&&(this.options.expandTo=this.element.data("expandto"));this.options.alignment||(this.options.alignment="left");this.eventSuffix=".DropdownDialog."+this.id();this.options.autoOpen&&this.open();if(this.options.onInit)this.options.onInit(this);this.createContent();this.elementNode=this.element[0];this.createTrigger();this.popoverArrow=this.getChildElement("popover-arrow");this.options.loadWithAjaxOnInit&&this.options.ajaxUrl&&this.loadAjax();
this.options.alignment||(this.options.alignment="left");this.options.useCover&&(this.cover=this.getChildElement("cover"),this.coverInner=this.getChildElement("cover-inner"));if(this.options.tooltipIcon){var a=this.getChildElement("tooltip");a.toolTip({content:a.data("message"),extraClass:"halfWidth"})}},closeOnBodyClick:function(a){this.isOpen&&(!this.content||!this.content[0]||this.content[0]!==a.target&&1>this.content.find(a.target).length)&&this.close()},addEventHandlers:function(){var a=this,
b;b=this.options.triggerClass?f("."+a.options.triggerClass):f(a.element);var c=this.closeOnBodyClick.bind(this),d=["authentication.showLogin","trips.menu.open","afterclick.dialog.opened","common.dropdown.closeAll"];this.options.closeEvent&&d.push(this.options.closeEvent);this.subscribe(d,this.close.bind(this,null,!0));var e="click.dialog"+this.eventSuffix,g=f("body");this.registerEvent("click"+this.eventSuffix,b,function(b){a.options.stopClickPropagation&&b.stopPropagation();g.off(e,c);a.toggleContent();
a.isOpen&&setTimeout(function(){g.on(e,c)},10)});if(this.isOpen)g.on(e,c);this.registerEvent("keydown",function(b){if(13===b.which||32===b.which)a.element.trigger("click"),b.preventDefault(),b.stopImmediatePropagation(),b.stopPropagation()})},bindOpenDialogEvents:function(){var a=this;f(document).on("keydown"+this.eventSuffix,function(b){27===b.which&&a.close(b,null,!0)});f(window).on("resize"+this.eventSuffix,function(){a.isOpen&&a.reposition(!0)});f(document).on("scroll"+this.eventSuffix,function(){a.isOpen&&
a.reposition(!0)});f(".viewport").on("scroll"+this.eventSuffix,function(){a.isOpen&&a.reposition(!0)});var b=function(){a.element.is(":visible")&&(h.Common.Utils.Browsers.isIE(11)||setTimeout(function(){a.reposition(!0)},25))};this.registerEvent("click",this.content.find(".close"),this.close.bind(this));this.registerEvent("mouseup touchend",this.content,b);this.subscribe("horizon.dropdownDialog.reposition",b)},destroy:function(){this.base();this.removeOpenDialogEvents()},removeOpenDialogEvents:function(){f(".viewport").off("scroll"+
this.eventSuffix);f(window).off("resize"+this.eventSuffix);f(document).off("scroll"+this.eventSuffix).off("keydown"+this.eventSuffix);f(document.body).off("click"+this.eventSuffix).off("click.dialog"+this.eventSuffix)},createContent:function(){this.content=this.options.content?f(this.options.content):f("#"+this.element.attr("id")+"_content");this.options.isFixedWidth&&this.content.css("width",this.getTriggerWidth()+"px");this.content.hasClass("open")&&(this.isOpen=!0)},createTrigger:function(){this.element.hasClass("open")&&
(this.isOpen=!0);this.label=this.element.find(".label");this.label.length||(this.label=f("\x3cdiv\x3e",{"class":"label"}),this.element.prepend(this.label));this.placeholder=this.element.find(".placeholder");this.placeholder.length||(this.placeholder=f("\x3cdiv\x3e",{"class":"placeholder",text:this.options.placeholder}),this.element.append(this.placeholder));this.options.showIcon&&(this.icon=this.element.find(".icon"),this.icon.length||(this.icon=f("\x3cdiv\x3e",{"class":"icon "+this.options.iconClass}),
this.element.append(this.icon)));this.options.hasSubValue&&(this.value=this.label.find(".value"),this.value.length||(this.value=f("\x3cdiv\x3e",{"class":"value"}),this.label.prepend(this.value)),this.subValue=this.label.find(".subValue"),this.subValue.length||(this.subValue=f("\x3cdiv\x3e",{"class":"subValue"}),this.label.prepend(this.subValue)));if(this.options.text)this[this.options.hasSubValue?"updateValue":"updateLabel"](this.options.text);else if(!this.options.hasSubValue){var a=this.label.html();
a&&a.trim()&&this.updateLabel(a.trim())}},open:function(){if(!this.openDisabled){this.isOpen=!0;var a=this,b="body";if("function"===typeof this.options.delayShowDropdown&&this.options.delayShowDropdown()&&!this.showDropdownTimeout)this.showDropdownTimeout=setTimeout(this.open.bind(this),this.options.showDropdownDelay);else{null!==this.showDropdownTimeout&&(clearTimeout(this.showDropdownTimeout),this.showDropdownTimeout=null);this.bindOpenDialogEvents();this.options.container&&""!==this.options.container&&
(b=this.options.container,f(a.options.container).off("scroll."+a.id()).on("scroll."+a.id(),function(){a.isOpen&&a.repositionWithJS()}));this.options.isPopover&&this.popoverArrow.show();this.content.appendTo(b);if(this.options.onOpen)this.options.onOpen(this);this.repositionWithJS();this.element.attr("aria-pressed")&&this.element.attr("aria-pressed",!0);a.element.addClass("open");a.content.addClass("open");this.content.attr("aria-expanded",!0);this.element.attr("aria-expanded",!0);this.content.data("owner",
this.element.attr("id"));h.events.publish("DropdownDialog.open",{id:a.id()});this.toggleCover(!0);this.setupTabKeyHandling();this.styleForModal(!0)}}},setupTabKeyHandling:function(){var a=this,b=this.getFocusableElements();b.length&&(a.content.off("keydown","**"),setTimeout(function(){f(b[0]).focus();a.content.on("mouseover","a, [tabindex]",function(){a.content.find(":focus").trigger("blur")});a.content.on("keydown",function(c){b=a.getFocusableElements();var d=c.target,e=b.get(0)===d,d=b.get(b.length-
1)===d;9===c.which&&(1===b.length||e&&c.shiftKey||d&&!c.shiftKey)&&(a.toggleContent(),a.element.focus())})},25))},getFocusableElements:function(){return this.content.find(":input:visible,[tabindex]:visible, a[href]:visible").not("[tabindex\x3d-1],[disabled]")},_close:function(a,b,c){var d=this.isOpen,e=this;this.isOpen=!1;this.options.isPopover&&this.popoverArrow.hide();this.element.removeClass("open");this.content.removeClass("open");this.toggleCover(!1);e.element.after(e.content);c&&setTimeout(function(){e.element.focus()},
1);if(this.options.onClose)this.options.onClose(d,this,a);h.events.publish("DropdownDialog.close",{id:e.id(),silent:!!b});this.element.attr("aria-pressed")&&this.element.attr("aria-pressed",!1);this.content.attr("aria-expanded",!1);this.element.attr("aria-expanded",!1);this.styleForModal(!1)},close:function(a,b,c){if(!c||"object"!==typeof c||c.avoidElementId!==this.id()){this.options.repositionWithStyle&&this.resetPosition();this.removeOpenDialogEvents();if(this.options.animateClose){var d=this;this.animateClose(function(){d._close(a,
b,c)})}else this.isOpen&&this._close(a,b,c);null!=a&&a.stopPropagation()}},toggleContent:function(){this.isOpen?this.close(null,null,!0):this.open()},updateLabel:function(a,b,c){b&&(a+=(c||"")+b);this.label.html(a);"0"==a+""||a?this.element.addClass("hasValue"):this.element.removeClass("hasValue")},updateValue:function(a){a=a||"";this.value.html(a);"0"==a+""||a?this.element.addClass("hasValue"):this.element.removeClass("hasValue")},hasValue:function(){return this.element.hasClass("hasValue")},resetPosition:function(){this.content.css({position:"absolute"})},
reposition:function(a){if(this.options.repositionWithStyle){var b;window.scrollY>this.options.scrollOffset?(b={position:"fixed",top:this.options.fixedPositionOffset+"px"},this.content.css(b)):(b={position:"absolute"},this.content.css(b),this.repositionWithJS(a))}else this.repositionWithJS(a)},repositionForNonModal:function(){var a=this.showInModal();if(this.modalActive()&&a)return!1;this.styleForModal(a);return!a&&!this.modalActive()},repositionWithJS:function(a){if(this.repositionForNonModal()){var b=
this.options.direction,c=this.options.alignment,d=this.element.offset(),e=f(this.options.container),g=f("#"+this.options.expandTo),k=g.length&&g.is(":visible"),h=k?g.offset():null;a=a||!1;if(e.length)var l=e.offset(),d={top:d.top-l.top+e.scrollTop(),left:d.left-l.left};else e=f(window);l=d.top+this.element.outerHeight();0===this.element.width()&&0!==this.element.position().top&&(l+=window.scrollY);this.shouldFlipDirection(b)&&(b=this.getReversedDirection(b));this.shouldFlipAlignment(c)&&(c=this.getReversedDirection(c));
this.updateAnimationClass(b,c);this.content.toggleClass("noAnimation",a);"up"===b?(this.content.addClass("up"),l=d.top-this.content.outerHeight()):this.content.removeClass("up");if("left"===b||"right"===b)l="up"===this.options.alignment?d.top-this.element.outerHeight()/2:"down"===this.options.alignment?d.top-this.content.outerHeight()+this.element.outerHeight():d.top+this.element.outerHeight()/2-this.content.outerHeight()/2;a={top:Math.floor(l)+"px"};k?"right"===c?a.right=Math.floor(e.width()-g.width()-
h.left)+"px":a.left=Math.floor(h.left)+"px":"left"===b?a.right=Math.floor(e.width()-d.left)+"px":"right"===b?a.left=Math.floor(d.left+this.element.width())+"px":"right"===c||"window-center-desktop"===c?"window-center-desktop"==c&&768<=window.innerWidth?(a.right="",a.left=Math.floor(window.innerWidth/2-this.content.outerWidth()/2)+"px"):(a.left="",b=this.getTriggerWidth(),38>b&&!this.options.forceTriggerWidth&&(b=38),a.right=Math.floor(e.width()-(d.left+b))+"px"):a.left="center"===c?Math.floor(d.left-
this.content.outerWidth()/2)+this.getTriggerWidth()/2+"px":"window-center"===c?Math.floor(window.innerWidth/2-this.content.outerWidth()/2)+"px":Math.floor(d.left)+"px";this.options.topOffset&&0!==this.options.topOffset&&(a.marginTop=this.options.topOffset+"px");this.options.leftOffset&&0!==this.options.leftOffset&&(a.right?a.right=parseInt(a.right.replace("px",""))-this.options.leftOffset+"px":a.left&&(a.left=parseInt(a.left.replace("px",""))+this.options.leftOffset+"px"));this.leftOffset&&(a.marginLeft=
this.leftOffset+"px");this.options.isPopover&&"right"===c&&(a.left=Math.floor(d.left+this.getTriggerWidth()+22)+"px",a.top=Math.floor(l-45)+"px");c=this.options.isFixedWidth?"width":"minWidth";this.options.matchWidth?a[c]=this.getTriggerWidth()+"px":k?a[c]=g.outerWidth()+"px":a.minWidth="";this.options.removeZIndex||(a.zIndex=this.element.zIndex()+9999);this.options.checkIsOutsideScreen&&(g=this.content.outerWidth(),e=e.outerWidth(),k=!1,g>=e?k=!0:(c=parseInt(a.left,10),d=parseInt(a.right,10),c&&
c+g>=e?k=!0:d&&d+g>=e&&(k=!0)),k&&(a.left="0px",a.right="auto",a.maxWidth=e+"px"));this.content.css(a)}},styleForModal:function(a){a&&this.showInModal()?(this.content.css({top:0,left:0,right:0,maxWidth:"100%",minHeight:"100vh"}),this.content.addClass("modal"),this.content.toggleClass("noAnimation",!0),f("body").addClass("modal-open")):(this.content.removeClass("modal"),f("body").removeClass("modal-open"))},modalActive:function(){return this.content.hasClass("modal")},shouldFlipDirection:function(a){if(this.options.flippable){var b=
f(window).scrollTop(),c=b+f(window).outerHeight(),d=this.content.outerHeight(),e=this.element.offset().top,c=e+this.element.outerHeight()+d>c,b=e-d<b;if("down"===a)return c&&!b;if("up"===a)return b&&!c}return!1},shouldFlipAlignment:function(a){if(this.options.flippable){var b=f(window).width(),c=this.content.width(),d=this.element.offset().left,e=this.element.width(),e=0>=d+("left"===a?0:e)-c,b=d+("left"===a?c:0)>=b;if("left"===a)return!e&&b;if("right"===a)return e&&!b}return!1},getReversedDirection:function(a){switch(a){case "down":return"up";
case "up":return"down";case "left":return"right";case "right":return"left";case "bottom":return"top";case "top":return"bottom";case "center":return"center"}return a},updateAnimationClass:function(a,b){a=this.getDirectionClass(a,b);this.content.hasClass(a)||this.content.removeClass(function(a,b){return(b.match(/\banimate-\S+/g)||[]).join(" ")}).addClass(a).removeAttr("style")},getDirectionClass:function(a,b){var c;"left"===a||"right"===a?(c="down"===b?"top":"bottom",a="center"===a?"right":this.getReversedDirection(a)):
(c="down"===a?"top":"bottom",a="center"===b?"right":b);return"animate-"+c+"-"+a},loadAjax:function(){var a=this;return h.ajax.execute(this.options.ajaxUrl,{data:this.options.ajaxData,customUpdate:function(b){b.innerHTML&&""!==b.innerHTML?a.content.html(b.innerHTML):(a.element.remove(),a.content.remove(),a.ajaxLoadFailed=!0);return!0}})},getTriggerWidth:function(){var a=this.elementNode.getBoundingClientRect();return a?a.right-a.left:this.element.outerWidth()},animateClose:function(a){var b=this,c=
this.content.attr("class");(c=c&&c.match(/\banimate-\S+/))&&c.length&&(this.content.removeClass(c[0]),window.setTimeout(function(){b.content.addClass(c[0]+" close-animation")},1),window.setTimeout(function(){a();b.content.removeClass("close-animation")},this.animationDuration))},toggleCover:function(a){this.options.useCover&&(a?this.coverInner.css("transform","scale("+(this.cover.outerWidth()+2)/this.element.outerWidth()+", 1.333)"):this.coverInner.css("transform","scale(1)"))},showInModal:function(){return 0<
this.options.showModalBp&&f(window).outerWidth()<this.options.showModalBp&&this.content.hasClass("open")}})})(window.R9,window.jQuery);(new R9.logger).timeEnd("combined");