(new R9.logger).time("combined");(function(c,e,f){var g=c.config.getBoolean("ui.horizon.results.searchPoll.includePollNumberInQuery",!0),h={trains:"trains/results/TrainsSearchPoll",flights:"flights/results/FlightSearchPoll",hotels:"hotels/results/HotelSearchPoll",packages:"packages/results/PackageSearchPoll",cars:"cars/results/CarSearchPoll",deals:"deals/results/DealSearchPoll",cruises:"cruises/results/CruiseSearchPoll",rentals:"rentals/results/RentalSearchPoll",activities:"activities/results/ActivitiesSearchPoll",cityhotels:"hotels/cityhotels/CityHotelsPoll",
restaurants:"restaurants/results/RestaurantSearchPoll"},k={trains:"trains/results/TrainsResultDetails",flights:"flights/results/FlightResultDetails",hotels:"hotels/results/HotelResultDetails",packages:"packages/results/PackageResultDetails",rentals:"rentals/results/HotelResultDetails",activities:"activities/results/ActivitiesResultDetails"};c.publish("base.results.AjaxSearchPoll",f.extend({searchUrl:null,detailsUrl:null,options:{vertical:null,searchId:null,appendTo:null},pollNumber:0,searchId:null,
constructor:function(a){this.options=e.extend({},this.options,a);if(!a.vertical)throw"AjaxSearchPoll requires a vertical to be properly initialized";this.searchId=this.options.searchId;this.searchUrl=h[this.options.vertical];this.detailsUrl=k[this.options.vertical];"cityhotels"===this.options.vertical&&this.options.citycode&&(this.searchUrl+="?citycode\x3d"+this.options.citycode)},fetchResults:function(a,b){a=e.extend({data:e.extend({searchId:this.searchId,poll:!0,pollNumber:this.pollNumber},a||{}),
appendTo:this.options.appendTo,replace:!1,logServerErrors:c.config.getBoolean("ui.ajax.logServerErrors.searchPoll",!1),enforceCaptcha:c.config.getBoolean("ui.ajax.enforceCaptcha.searchPoll",!0)},b||{});c.config.getBoolean("ui.ssajax.last.action.abort",!1)&&(a.data.ajaxts=(new Date).getTime());b=this.searchUrl;g&&(b+="?p\x3d"+this.pollNumber);this.searchId=a.data.searchId;this.pollNumber++;return c.ajax.execute(b,a)},fetchDetails:function(a,b){b={data:{resultId:a,searchId:this.searchId},appendTo:b,
enforceCaptcha:c.config.getBoolean("ui.ajax.enforceCaptcha.inlineDetails",!0)};if(null===b.searchId)throw"Cannot request result details for %s: No searchId tied to this instance of AjaxSaerchPoll.".format(a);return c.ajax.execute(this.detailsUrl,b)}}));c.publish("resultsMetaData",{PROPERTIES:"code selected minPrice count displayValue displayOrder resetState defaultSelectedState dynamicFilteredStatus ignoreOnly hideOnly href noSelect disabled cssClass showAllState noPrice pluralDisplayValue minDuration minDurationValue meta".split(" "),
publish:function(a){a.hasOwnProperty("filtersData")&&this.remapFilters(a.filtersData);c.events.publish("search.poll.response",a)},remapFilters:function(a){for(var b=Object.keys(a),c=0;c<b.length;c++){var d=a[b[c]];d.valueMap||d.headingValueMap?this.remapValueSetFilter(d):(d.legValues||d.legHeadingValues)&&this.remapPerLegValueSetFilter(d)}},remapValueSetFilter:function(a){if(a.valueMap)Object.values(a.valueMap).forEach(this.remapValueData.bind(this));else if(a.headingValueMap)for(var b in a.headingValueMap)Object.values(a.headingValueMap[b]).forEach(this.remapValueData.bind(this))},
remapPerLegValueSetFilter:function(a){if(a.legValues)Object.values(a.legValues).forEach(this.remapValueSetFilter.bind(this));else if(a.legHeadingValues)for(var b=0;b<a.legHeadingValues.length;b++)Object.values(a.legHeadingValues[b]).forEach(this.remapValueSetFilter.bind(this))},remapValueData:function(a){for(var b=a.rawState?a.rawState.split(";"):[],c=0;c<b.length;c++){var d=b[c];d.length&&(a[this.PROPERTIES[c]]=this.castValue(this.PROPERTIES[c],d))}if(a.hasOwnProperty("dynamicFilteredStatus")){a.filtered=
!1;a.partiallyFiltered=!1;switch(a.dynamicFilteredStatus){case 1:a.filtered=!0;break;case 2:a.partiallyFiltered=!0}delete a.dynamicFilteredStatus}a.hasOwnProperty("noPrice")&&a.noPrice&&(a[a.noPrice]=!0,delete a.noPrice);delete a.rawState},castValue:function(a,b){switch(a){case "code":case "displayValue":case "minPrice":case "pluralDisplayValue":case "cssClass":case "minDuration":case "href":case "noPrice":return b;case "selected":case "count":case "displayOrder":case "showAllState":case "resetState":case "defaultSelectedState":case "minDurationValue":case "dynamicFilteredStatus":return parseInt(b);
case "ignoreOnly":case "hideOnly":case "noSelect":case "disabled":return"1"===b;default:return b}}})})(R9,jQuery,base2.Base);(function(f,b){function m(a){for(var b=[],e=0,c=Object.keys(a);e<c.length;e++)b.push([c[e],a[c[e]]||0].join("\x3d"));return b.join("\x26")}function k(){b.utils.performance.clearMarks(["search_start","first_result","first_phase_complete","polling_complete","first_result_rendered"])}function n(a){switch(a){case "hotels":return b.question.ask("hotels.results.locationId")||0;case "rentals":return b.question.ask("rentals.rp.searchform.citycode")||0;case "flights":a=b.question.ask("flights.rp.searchform");
var d=1,e=[a.origincode,a.destinationcode];if(a.isMulticity)for(a=b.question.ask("flights.rp.searchform.multicity");a.hasOwnProperty("destinationcode"+d);)e.push(a["destinationcode"+d]),d++;return e.map(g).join(",");case "trains":return(a=b.question.ask("trains.fd.searchform"))?[a.origincode,a.destinationcode].join():0;default:return 0}}function g(a){return 1<=a.indexOf("/")?a.split("/")[0]:a}var h=f.performance||f.msPerformance||f.webkitPerformance||f.mozPerformance;b.events.subscribe("resultspage.streaming.done",
function(a){if(b.utils.performance.enabled)if(a.error)k();else{if(h&&h.timing&&h.navigation)if(a=b.utils.performance.getMarkTime("search_start"),!a||0>=a)a=null;else{var d=document&&document.location&&document.location.href,e=b.globals.vertical,c;b:{switch(b.globals.vertical){case "flights":c=b.question.ask("flights.rp.searchform");var g=c.oneway,p="exact"!==c.depart_date_flex||"exact"!==c.return_date_flex,l=c.nearby_destination||c.nearby_origin;if(c.isMulticity){c="mc"+(l?"nearby":"");break b}c=
(g?"ow":"rt")+(p?"flex":"")+(l?"nearby":"");break b;case "hotels":c=b.question.ask("hotels.results.searchType");break b}c=void 0}a={u:d,vertical:e,pageId:"results",subPageId:c,ut_locid:n(b.globals.vertical),ut_search_first_poll_start:a,ut_search_first_result:b.utils.performance.getMarkTime("first_result")-a,ut_search_first_result_rendered:b.utils.performance.getMarkTime("first_result_rendered")-a,ut_search_first_phase_complete:b.utils.performance.getMarkTime("first_phase_complete")?b.utils.performance.getMarkTime("first_phase_complete")-
a:b.utils.performance.getMarkTime("first_result")-a,ut_search_polling_complete:b.utils.performance.getMarkTime("polling_complete")-a}}else a=void 0;k();a&&(d=new f.XMLHttpRequest,d.open("POST","/s/run/perf",!0),d.setRequestHeader("X-Requested-With","XMLHttpRequest"),d.setRequestHeader("Content-type","application/x-www-form-urlencoded"),d.send(m(a)))}})})(window,R9);(function(e,c){var h=e.config.getBoolean("ui.horizon.rails.fuzzyComparisons",!0);e.createComponentClass("base.results.Rail",{options:{pinnable:!0,sticky:!1,debug:!1,debounceDelay:5,handleHorizontalScroll:!0,repositionTimeout:200,removeTopPaddingWhenFixed:!1,fixedTopPosition:0,preventDynamicPositioning:!1,defaultRailWidth:300},prevScroll:0,upScroll:!1,stickTop:!1,stickBottom:!1,originalNode:null,staticPosition:0,pinnedContentHeight:0,enabled:!0,isFullScreenMapV3:!1,init:c.noop,addEventHandlers:c.noop,
inlineComponentsReady:function(){var a=this;a.originalNode=a.element.get(0);this.bindWindowEvents();this.element.hasClass("dual-view-v3")&&(this.isFullScreenMapV3=!0);this.options.pinnable&&this.subscribe("resultspage.streaming.done moreFilters.toggle filterTab.changed filter.overflow.toggle displayad.loaded textad.loaded pinnedContent.heightChanged horizon.filters.opened resultspage.requestResults.completed horizon.filters.FiltersDialog.itemToggled".split(" "),function(){a.onScroll()});this.subscribe("pinnedContent.enable",
function(b){a.enabled=b});this.subscribe(["pinnableBar.pinnedChange","pinnedContent.heightChanged"],function(){a.setPinnedContentHeight()});this.subscribe("pinnedContent.reset",function(){a.resetPosition()});this.subscribe("rail.update.preventDynamicPositioning",this.updatePreventDynamicPositioning.bind(this))},onScroll:function(){!1!==this.enabled&&(this.isRailAttached()?this.handleScroll():this.unbindWindowEvents())},handleScroll:function(){var a=this.getWindowScroll(),b=this.getParentScroll();
this.upScroll=this.prevScroll>a;this.prevScroll=a;(a=this.getPositionCSS(a,b,this.isElementTallerThanScreen()))&&this.element.css(a)},unbindWindowEvents:function(){c(window).off("scroll.pinrails-"+this.id());c(window).off("resize.pinrails-"+this.id())},bindWindowEvents:function(){var a;this.options.pinnable&&(0<this.options.repositionTimeout&&this.element.css("transition","transform %sms ease-in-out".format(this.options.repositionTimeout)),a=0<this.options.debounceDelay?e.Common.Utils.debounce(this.onScroll.bind(this),
this.options.debounceDelay):this.onScroll.bind(this),this.registerEvent("scroll.pinrails-"+this.id(),c(window),a),this.registerEvent("resize.pinrails-"+this.id(),c(window),a))},testBottom:function(a,b){return b?a<this.getParentHeight()-this.getWindowHeight():a+this.getElementHeight()<this.getParentHeight()},testTop:function(a,b){return a>this.getParentTop()-this.pinnedContentHeight-this.options.fixedTopPosition},isElementTallerThanScreen:function(){return this.getElementHeight()>this.getWindowHeight()},
calculateScrollPosition:function(a,b){return!b||this.upScroll&&this.fuzzyCompare(this.getElementTop()-this.getParentTop()-this.pinnedContentHeight,a)?{position:"top"}:!this.upScroll&&this.fuzzyCompare(a+this.getWindowHeight(),this.getElementBottom()-this.getParentTop())?{position:"bottom"}:{translate:this.staticPosition}},fuzzyCompare:function(a,b){if(!h)return a>=b;a-=b;return 0<a||1>=Math.abs(a)},resetPosition:function(){var a=c.extend(!0,{},{position:"relative",top:"auto",bottom:"auto"},this.makeTransformCSS("translate(0,0)"));
this.element.css(a)},getPositionCSS:function(a,b,f){if(!this.isRailSticky()&&!this.isFullScreenMapV3){var g=0,d={position:"relative",top:"auto",bottom:"auto","padding-top":""};a=this.testTop(a,f);var e=this.testBottom(b,f);this.staticPosition=this.getElementTop()-this.getParentTop();if(a&&e)if(b=this.calculateScrollPosition(b,f),b.translate&&(g=b.translate),b.position){if(this.options.preventDynamicPositioning)return;"top"===b.position?(d={position:"fixed",top:this.options.fixedTopPosition,bottom:"auto",
width:this.getParentWidth()},this.options.removeTopPaddingWhenFixed&&(d["padding-top"]=0),g=this.pinnedContentHeight):(d={position:"fixed",bottom:0,top:"auto",width:this.getParentWidth()},g=0)}else d=c.extend({},d);else g=a?this.getParentHeight()-this.getElementHeight():0,d=c.extend({},d);b="translateY(%spx)".format(Math.max(0,g));this.options.handleHorizontalScroll&&"fixed"===d.position&&(f=this.getLeftScroll(),0<f&&(b="translate(-%spx, %spx)".format(f,g)));return c.extend({},d,this.makeTransformCSS(b))}},
getParentWidth:function(){return this.element.parent().width()},makeTransformCSS:function(a){return{msTransform:a,transform:a}},destroy:function(){this.unbindWindowEvents();this.base()},isRailAttached:function(){return this.element&&c.contains(window.document,this.originalNode)},isRailSticky:function(){var a=this.element.css("position");return"sticky"===a||"-webkit-sticky"===a},getElementHeight:function(){return Math.round(this.element.outerHeight())},getElementBottom:function(){return this.getElementTop()+
this.getElementHeight()},getElementTop:function(){return Math.round(this.element.offset().top)},getWindowHeight:function(){return Math.round(c(window).outerHeight())},getWindowScroll:function(){return Math.round(c(window).scrollTop())},getParentHeight:function(){return Math.round(this.element.parent().outerHeight())},getParentTop:function(){return Math.round(this.element.parent().offset().top)},getLeftScroll:function(){return Math.round(c(window).scrollLeft())},getParentBottom:function(){return this.getParentTop()+
this.getParentHeight()},getParentScroll:function(){return this.getWindowScroll()-this.getParentTop()},setPinnedContentHeight:function(){var a=e.question.ask("pinnedContent.height");null!==a?this.pinnedContentHeight=a:0!==this.pinnedContentHeight&&(this.pinnedContentHeight=0)},updatePreventDynamicPositioning:function(a){a&&a.hasOwnProperty("preventDynamicPositioning")&&(this.options.preventDynamicPositioning=a.preventDynamicPositioning)}})})(R9,jQuery);var _slicedToArray=function(){return function(c,d){if(Array.isArray(c))return c;if(Symbol.iterator in Object(c)){var a=[],b=!0,f=!1,g=void 0;try{for(var e=c[Symbol.iterator](),h;!(b=(h=e.next()).done)&&(a.push(h.value),!d||a.length!==d);b=!0);}catch(k){f=!0,g=k}finally{try{if(!b&&e["return"])e["return"]()}finally{if(f)throw g;}}return a}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}();
(function(c,d){c.createComponentClass("base.results.ResultsListHeader",{searchId:null,activeSortMode:{sortType:null,ascending:null},overriddenSortMode:null,options:{sortType:"rank_a",sortUnrolled:!1,quickLinkSort:!1},init:function(){var a=this;this.activeSortMode=this.getSortDataFromString(this.options.sortType);this.answer("resultsHeader.sortMode",function(){return a.activeSortMode})},addEventHandlers:function(){var a=this;this.subscribe("resultsHeader.changed",function(b){return a.onChange(b)});
this.subscribe("resultspage.sortMode.changed",function(b){return a.onChange(b)});this.subscribe("resultsHeader.sortType.set",this.setSortType.bind(this));this.subscribe("resultsHeader.sortType.force",this.forceSortType.bind(this));this.subscribe("resultsHeader.sortType.resetForced",this.resetForcedSortType.bind(this))},onChange:function(a){a.sort?this.activeSortMode=a.sort:a.sortCode&&(this.activeSortMode=this.getSortDataFromString(a.sortCode))},setSortType:function(a){(a=this.processSortParams(a))&&
(a.sortCode!==this.getStringFromSortData(this.activeSortMode)||a.reviewType||a.forceChange)&&(a.isForcedSort||(this.overriddenSortMode=null),this.pushSortUpdates(a))},processSortParams:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(a.reviewType)a.sortCode="userrating";else if(!a.sortCode)return this.log.console('missing data sent in "resultsHeader.sortType.set" event.\n                Please publish an object with at least a sortCode or a reviewType property.'),null;
a.sort=this.getSortDataFromString(a.sortCode);"customTicket"===a.sort.sortType&&(a.customTicket=!0);return a},pushSortUpdates:function(a){this.logSortTypeChange(a);c.events.publish("resultsHeader.changed",a)},forceSortType:function(a){if(this.getStringFromSortData(this.activeSortMode)!==a.sortCode){var b=this.activeSortMode;a=d.extend({},a,{isForcedSort:!0});c.events.publish("resultsHeader.sortType.set",a);this.overriddenSortMode=b}},resetForcedSortType:function(){if(this.overriddenSortMode){var a=
{sortCode:this.getStringFromSortData(this.overriddenSortMode)};c.events.publish("resultsHeader.sortType.set",a)}},getSortDataFromString:function(a){a=a.split("_");a=_slicedToArray(a,2);var b=a[1];return{sortType:a[0],ascending:b?"a"===b:null}},getStringFromSortData:function(a){var b=a.sortType;a=a.ascending;return"undefined"===typeof a||null===a?b:b+"_"+(a?"a":"b")},logSortTypeChange:function(a){a.sort&&a.sort.sortType&&a.sort.ascending&&c.Analytics.api.trackEvent({category:"Sort",action:a.sort.sortType,
label:this.generateSortLoggingLabel(a.sort.sortType,a.sort.ascending)})},generateSortLoggingLabel:function(a,b){return a+"_"+(b?"ascending":"descending")}})})(window.R9,window.jq||window.jQuery);(function(c,e){var l=/attempt=([0-9]+)/,m=/lastms=([0-9]{13})/;c.createComponentClass("base.results.ResultsPage",{searchRunner:null,searchId:null,priceType:null,searchStartParams:null,vertical:null,urlSearchStartSupported:!1,loggingPrefix:"resultspage",poll:{pollingId:null,sent:0,activeRequest:null,ended:!1,nextPollTimeoutId:null,firstPhaseCompleted:!1,consecutiveEmptyResponses:0,lastPollTotalCount:-1,started:null,usingPreservedFilters:!1,reason:"POLL"},filterState:null,urlFilterState:null,filtersData:null,
useUrlFilterState:!0,resultsList:e(),listBody:e(),listCol:null,progressBar:null,paginator:null,viewState:null,leftRail:null,rightRail:null,backToTop:null,clientTimeoutId:null,idleTimeoutId:null,secondPhaseTimeoutId:null,frenchWarning:null,ariaResultMsgWidget:null,ajaxAppendTo:null,preserveFilters:!1,preservedFilters:null,adsHelper:null,lastLimitedDateMs:null,lastLimitedMinMS:18E5,options:{infinite:!1,button:!1,startSearchImmediately:!1,searchParams:null,ajaxParams:null,poll:!0,pageNumber:1,searchId:null,
completed:!1,sortMode:null,quickLinkType:null,ascending:null,priceType:null,centerPointLat:null,centerPointLong:null,urlFilterState:null,pollingTimeout:16E3,exponentialBackoffDelay:!1,pollDelay:250,maxPollDelay:5E3,pollingId:null,windowScroll:"",persistWindowScroll:!1,filtersData:null,quickLinkData:null,useTwoPhasePolling:!1,visible:!1,useBuzz:!1,fastCover:!1,showExpiredResultsMessage:!0,secondPhaseWait:null,secondPhaseTimeout:null,idleExpireMinutes:120,enforceIdleTimeout:!0,showFilteredButSimilar:!1,
scrollTopOnFilterChange:!1,defaultSortType:null,useUrlSortMode:!1,msg:{expired_search:"",filters_removed:""},ariaMsg:{resultsLoading:"",resultsReady:"",noResultsFound:""},nonClearablePreservedFilters:[],forceLoadingTreatmentSkip:!1,placeholderDelay:0,defaultPaddingLeft:30,watchedResultId:"",animateInlineSearch:!0},init:function(){this.appendResults=this.options.infinite||this.options.button;this.filterState={};this.viewState={openDetails:{}};this.leftRail=this.getChildElement("leftRail");this.rightRail=
this.getChildElement("rightRail");this.backToTop=this.getChildElement("backToTop");this.resultsList=this.getChildElement("list");this.listBody=this.element.find(".listBody");this.listCol=this.getChildElement("listCol");this.resultsListCover=this.listBody.find(".resultsListCover");this.loadingMessage=this.element.find(".loadingMessage");this.progressBar=this.getChildElement("progress");this.frenchWarning=this.getChildElement("frenchWarning");this.searchId=this.options.searchId;this.priceType=this.options.priceType;
this.poll.pollingId=this.options.pollingId;this.urlFilterState=this.options.urlFilterState;this.searchStartParams=this.options.searchStartParams||{};this.ariaResultMsgWidget=this.getChildElement("aria-result-msg").getWidget();c.events.publish("paginator.hide");this.options.filtersData&&c.resultsMetaData.remapFilters(this.options.filtersData)},addEventHandlers:function(a){var b=this,d=null,h=function(){null!==d&&clearTimeout(d);d=setTimeout(function(){c.action.execute("common/utils/history/UserStateUpdateAction",
{storageType:"viewState",searchId:b.searchId,key:"openDetails",value:JSON.stringify(b.viewState.openDetails)})},1E3)};this.subscribe(["searchform.submit","multilocale.search.submit"],this.startSearchFromSearchForm.bind(this));a=this.onFilterStateChange.bind(this);a.priority=0;this.subscribe("filters.changed",a);a=this.preprocessResponse.bind(this);a.priority=0;this.subscribe("search.poll.response",a);this.subscribe("resultspage.filters.sync",this.syncFilterState.bind(this));this.subscribe("paginator.change",
this.onPaginatorChange.bind(this));this.subscribe("resultsHeader.changed",this.onResultsListHeaderChange.bind(this));this.subscribe("resultspage.view.setvisible",this.setVisible.bind(this));this.subscribe("resultspage.results.refresh",this.refreshResults.bind(this));this.subscribe("resultspage.transition.remove",this.removeTransitionClass.bind(this));this.subscribe(["result.details.opened","result.details.tab.changed"],function(a){b.viewState.openDetails[a.resultId]=a.activeTab||"overview";h()});
this.subscribe("result.details.closed",function(a){delete b.viewState.openDetails[a.resultId];h()});this.subscribe(["results.expired","user.refresh.expired"],this.reloadExpiredResults.bind(this));this.subscribe("resultspage.showLowest",function(){c.events.publish("filters.reset",{type:"showAll"});c.events.publish("resultsHeader.sortType.set",{sortCode:"price_a"})});this.subscribe("ads.request",function(a){b.getAdsHelper().onSetupAdsRequest(a)});this.subscribe("results.quickLinkType.setDefault",function(a){a.hasOwnProperty("quickLinkType")&&
(b.options.quickLinkType=a.quickLinkType)});this.answer("resultspage.filterState.is",function(a){return a&&b.filterState?b.filterState[a]:b.filterState});this.answer("resultspage.filterData.get",function(){return b.filtersData?b.filtersData:b.options.filtersData});this.answer("resultspage.priceType.get",function(){return b.priceType});this.answer("resultspage.sortMode.get",function(){return b.options.sortMode});this.answer("resultspage.searchFailed",function(){return b.listBody.hasClass("failed")});
this.answer("resultspage.urlFilterState.get",function(){return b.urlFilterState});this.answer("resultspage.leftMargin",this.getPageContainerLeftMargin.bind(this));this.answer("resultspage.poll.ended",function(){return b.poll.ended});this.appendResults&&(this.backToTop.click(function(){e(window).scrollTop(0).trigger("scroll");c.Analytics.api.trackEvent({subPageId:"ResultsPage",category:"backToTop",action:"click"})}),this.subscribe("resultspage.pageNumber.changed",function(){var a=e(window).scrollTop();
e(window).unbind("scroll.backToTop").bind("scroll.backToTop",function(){var c=e(this).scrollTop();c>2*e(this).height()&&a>c?b.backToTop.addClass("visible"):b.backToTop.removeClass("visible");a=c})}));this.subscribe("results.leftRail.toggleCollapsed",this.toggleLeftRailCollapsed.bind(this));e(window.document).on("mouseleave.horizonResult",function(){c.events.publish("document.mouseLeave")});e(window).on("keydown.landmark_nav",function(a){var c=a.which,d=a.shiftKey,h=a.altKey,f=a.metaKey;a=a.ctrlKey;
if(9===c&&h&&f||9===c&&h&&a)if(a=e("*:focus"),c=e("[role\x3dform],[role\x3dsearch],[role\x3dmain]"),h=d?-1:c.length,f=d?c.length-1:0,d=d?-1:1,a.length){var n=a.closest("[role\x3dform],[role\x3dsearch],[role\x3dmain]");n.length?(a=e(n[0]).index("[role\x3dform],[role\x3dsearch],[role\x3dmain]"),d=a+d,d===h&&(d=f),c[d].focus()):(d=b.nextInDOM("[role\x3dform],[role\x3dsearch],[role\x3dmain]",a))&&null!=d&&d.focus()}else c[0].focus()})},nextInDOM:function(a,b){for(b=this.getNext(b);0!=b.length;){var c=
this.searchFor(a,b);if(null!=c)return c;b=this.getNext(b)}return null},getNext:function(a){return 0<a.next().length?a.next():this.getNext(a.parent())},searchFor:function(a,b){if(b.is(a))return b;var c=null;b.children().each(function(){c=searchFor(a,e(this));if(null!=c)return!1});return c},inlineComponentsReady:function(){c.config.getBoolean("ui.rp.alwaysReqAdSetup",!0)&&c.events.publish("resultspage.adinfo.empty");this.options.visible&&c.events.publish("resultspage.view.setvisible",!0);if(this.options.searchId){c.utils.performance.setEnabled(this.shouldTrackStreamingPerformance());
this.setupStreaming(this.options.searchId,this.options.completed);if(this.options.windowScroll&&0<this.options.windowScroll.length&&this.options.persistWindowScroll){var a=this.options.windowScroll.split(";");e(window).scrollTop(a[0]);e(window).scrollLeft(a[1])}null!==this.options.quickLinkData&&c.events.publish("resultspage.quickLinkData.changed",this.options.quickLinkData)}else this.options.startSearchImmediately&&this.startSearch(this.options.searchParams,this.options.ajaxParams)},setVisible:function(a){(this.options.visible=
a)?this.element.addClass("ResultsVisible"):this.element.removeClass("ResultsVisible");this.setColumnsVisible(a,400)},setupStreaming:function(a,b){this.searchId=this.options.searchId;this.searchRunner=new c.base.results.AjaxSearchPoll({searchId:a,vertical:this.vertical,appendTo:this.ajaxAppendTo?this.ajaxAppendTo:this.resultsList,replace:!this.appendResults});c.events.publish("resultspage.searchId.changed",{searchId:this.searchId});window.SearchID=this.searchId;null!==this.options.filtersData&&(this.filtersData=
this.options.filtersData,c.events.publish("resultspage.filtersData.changed",this.filtersData));b&&this.getAdsHelper().requiresAdsPoll()&&(b=!1);this.logSmartyInteractions();b&&c.config.getBoolean("ui.horizon.resultspage.%s.handleCompleted".format(this.vertical||"base"),!1)?this.endPolling():(c.events.publish("resultspage.streaming.start"),this.listBody.addClass("streaming-in-progress"),this.resultsReason="init",this.poll.reason="POLL",this.getResults(),this.startedStreaming())},logSmartyInteractions:function(){c.config.getBoolean("ui.smarty.r9LogOptions",
!0)&&this.searchId&&c.events.publish("smartylogger.log.searchId",this.searchId)},startSearchFromSearchForm:function(a){this.resultsReason="searchform.submit";if(a.tab!==this.vertical)c.Analytics.api.trackEvent("resultspage/search/vertical-mismatch"),window.location.href=a.url;else{if(a.searchFormFilterState){var b="";Object.keys(a.searchFormFilterState).each(function(c){b&&(b+=";");b+=c+"\x3d"+a.searchFormFilterState[c]});this.urlFilterState=b;this.useUrlFilterState=!0}else this.urlFilterState=null;
this.useUrlFilterState?this.clearPreservedFilters():(this.preserveFilters=a.preserveFilters)?this.setPreservedFilterState(a):this.preservedFilters=null;delete a.searchFormFilterState;this.options.visible&&this.options.animateInlineSearch&&this.bounceResults();this.startSearch(a)}},startSearch:function(a){this.ariaResultMsgWidget.activateLoadMessage(this.options.ariaMsg.resultsLoading);this.resultsList.attr("aria-busy",!0);if(a.url&&c.authentication.needsRefresh)window.location="/"===a.url[0]?a.url:
"/"+a.url;else{c.events.publish("search.startSearch",a);c.events.publish("resultspage.streaming.start",a);this.resultsList.removeClass("hidden");this.searchRunner=new c.base.results.AjaxSearchPoll({vertical:this.vertical,appendTo:this.ajaxAppendTo?this.ajaxAppendTo:this.resultsList});this.searchId&&this.cleanupExistingSearch();this.poll.sent=0;this.poll.ended=!this.options.poll;this.poll.pollingId=""+Math.floor(65536*Math.random())+1;this.poll.lastPollTotalCount=-1;this.poll.consecutiveEmptyResponses=
0;this.preservedFilters&&Object.keys(this.preservedFilters).length&&(this.poll.usingPreservedFilters=!0);this.options.pageNumber=1;var b=e.extend(this.options.searchParams,a);this.getAdsHelper().setAdRequestSearchOptions(b,this.resultsReason);this.searchStartParams=b;c.utils.performance.setEnabled(this.shouldTrackStreamingPerformance());c.utils.performance.clearMarks(["search_start","first_result","first_phase_complete","polling_complete","first_result_rendered"]);this.getResults(0,b);this.skipLoadingTreatment()||
this.addTransitionClass(a)}},cleanupExistingSearch:function(){this.poll.activeRequest&&this.poll.activeRequest.abort();c.events.publish("resultspage.cleanup",this.searchId);this.stopIdleTimeout();this.destroyOldResults();this.resultsList.find("#searchResultsList").html("");this.listBody.removeClass("failed").attr("aria-hidden",!1);this.searchId=null;this.poll.pollingId=null;this.preserveFilters||(this.filterState={});this.priceType=null;c.events.publish("paginator.hide");this.poll.firstPhaseCompleted=
!1;this.poll.lastPollTotalCount=-1;this.poll.consecutiveEmptyResponses=0;this.poll.reason=null;this.poll.usingPreservedFilters=!1;this.options.filtersData=null;this.options.completed=!1;this.searchStartParams={};this.lastLimitedDateMs=null;!this.preservedFilters&&this.options.defaultSortType&&this.resetSortTypeForNewSearch(this.options.defaultSortType);this.options.watchedResultId=null},resetSortTypeForNewSearch:function(a){this.options.sortMode=null;c.events.publish("resultsHeader.sortType.set",
{sortCode:a})},destroyOldResults:function(a){c.ComponentManager.remove(this.resultsList.find("#searchResultsList"),!1);a=this.element.find("#savedResultsListContainer");a.length&&c.ComponentManager.remove(a,!1)},destroyBuzzResults:function(){},beforeAppendNewResults:function(){},beforeUpdateDOM:function(a,b){a=e(a.parsedContent);if(b)return this.beforeAppendNewResults();0===a.length&&c.config.getBoolean("ui.horizon.rp.skipEmptyPoll",!0)||(!this.poll.ended&&a.find(".Base-Results-HorizonResult").length&&
c.utils.performance.mark("first_result"),this.doCustomUpdate({append:b})&&c.base.results.ResultsPageDOMUtils.mergeOpenResults(this.listBody,a),this.destroyOldResults(a))},publishAfterUpdateDOMEvent:function(){},getResults:function(a,b,d,h){var f=this,g=e.extend(this.getFetchResultsOpts(b&&b.fetchOpsParams),b);a=void 0!==a?a:this.options.pollDelay;var k={beforeScript:function(){f.beforeUpdateDOM(this.response,g.append)},replace:!g.append,afterUpdateDOM:function(){f.publishAfterUpdateDOMEvent();f.poll.ended&&
f.removeTransitionClass();if(g.append&&c.config.getBoolean("ui.resultspage.aria.focusOnPaginate",!0)){var a=f.resultsList.find("#"+f.options.searchId+"-"+f.options.pageNumber).children("[tabbable]").eq(0);a.length&&a.get(0).focus()}"function"===typeof h&&h()}};b=b||{};this.preservedFilters&&Object.keys(this.preservedFilters).length&&(g.filterState=JSON.stringify(this.preservedFilters));this.doCustomUpdate(g)&&(k=e.extend(k,{customUpdate:f.updateDOM.bind(this)}));k=this.addCustomPollAjaxParams(k);
d&&(g.isSecondPhase=!1);this.poll.activeRequest&&this.poll.activeRequest.abort();b.resetFilters&&(g=e.extend({},g,{useViewStateFilterState:!1}));b=function(){c.utils.performance.mark("search_start");f.poll.sent++;var a=f.searchRunner.fetchResults(g,k);a.then(function(){f.checkSearchExpired.bind(f);delete f.poll.activeRequest}).fail(function(a){var b=e.extend({type:"ajax"},a||{});a.type&&(b.ajaxErrorType=a.type);f.handleError(b)});f.poll.activeRequest=a;c.events.publish("resultspage.requestResults")};
clearTimeout(this.poll.nextPollTimeoutId);0<a||c.config.getBoolean("ui.horizon.resultspage.pollTimeout.always",!1)?this.poll.nextPollTimeoutId=setTimeout(b,a):b()},checkSearchExpired:function(a,b){b&&202===b.status&&(this.endPolling(),c.events.publish("search.expired"))},doCustomUpdate:function(a){return!1},addCustomPollAjaxParams:function(a){return a},endPolling:function(a,b,d){this.poll.ended||(c.utils.performance.mark("polling_complete"),this.poll.ended=!0,this.log.console("Ended polling"),this.removeTransitionClass(),
this.listBody.removeClass("streaming-in-progress"),this.stopClientTimeout(),this.stopSecondPhaseTimeout(),c.events.publish("resultspage.streaming.done",{searchId:this.searchId,reason:a,error:b}),a&&(b&&"object"===typeof b&&b.type&&(a+="/"+b.type),c.Analytics.api.trackEvent({category:"ResultsPage",action:"search_finished",label:a})),this.ariaResultMsgWidget.deactivateLoadMessage(this.options.ariaMsg.resultsReady),this.resultsList.attr("aria-busy",!1),this.useUrlFilterState=!1)},clearPreservedFilters:function(){this.preservedFilters=
null;this.preserveFilters=!1},handleError:function(a){if(!a||"object"!==typeof a||0!==a.status&&!a.aborted){if("object"===typeof a){var b=a.message||a.status;if(a.searchExpired&&!a.avoidReload){this.reloadExpiredResults();return}"ajax"===a.type?this.log.error("RP ajax error:"+(b?" ("+b+")":""),a):"limitreload"===a.type&&c.config.getBoolean("ui.rp.limitReloadError",!1)?this.log.error(a.message,a):c.Analytics.api.trackEvent({category:this.loggingPrefix,action:"error",label:a.type,value:b})}this.endPolling("error",
a);this.resultsList.addClass("hidden");c.events.publish("paginator.hide");this.removeTransitionClass();this.listBody.addClass("failed").attr("aria-hidden",!0);c.events.publish("search.searchFailed",a);a&&"noresults"===a.type&&a.response&&a.response.filtersData&&(a=Object.keys(a.response.filtersData),0<a.length&&(a.forEach(function(a){c.events.publish("filter.show",{name:a})}),c.events.publish("resultspage.filterList.show")))}},getFetchResultsOpts:function(a){a=e.extend(a||{},{applyFilters:!0,filterState:null,
useViewStateFilterState:this.useUrlFilterState,pageNumber:this.options.pageNumber,watchedResultId:this.options.watchedResultId});a.append=1<this.options.pageNumber&&this.appendResults;null!==this.poll.pollingId&&(a.pollingId=this.poll.pollingId);null!==this.options.sortMode&&(a.sortMode=this.options.sortMode,null!==this.options.ascending&&(a.ascending=this.options.ascending));null!==this.priceType&&(a.priceType=this.priceType);this.useUrlFilterState&&this.urlFilterState?a.filterState=this.urlFilterState:
this.filterState&&0<Object.keys(this.filterState).length&&(a.filterState=JSON.stringify(this.filterState));this.changingFilter&&(a.changingFilter=JSON.stringify(this.changingFilter),this.changingFilter=null);if(this.options.persistWindowScroll&&this.poll.ended&&(!this.appendResults||1===this.options.pageNumber)){var b=e(window).scrollTop().toFixed(),c=e(window).scrollLeft().toFixed();a.windowScroll=""+(0<b?b:0)+";"+(0<c?c:0)}!this.poll.ended&&-1<this.poll.lastPollTotalCount&&(a.lastPollTotalCount=
this.poll.lastPollTotalCount);a.requestReason="string"===typeof this.poll.reason?this.poll.reason:"POLL";this.options.phoenixRising&&(a.phoenixRising=!0);a.isSecondPhase=this.poll.firstPhaseCompleted;this.getAdsHelper().setAdRequestSearchOptions(a,this.resultsReason);a.openDetails=this.viewState.openDetails;return a},setupNewlyCreatedSearch:function(a){this.searchRunner.searchId=this.searchId=a.searchId;this.log.console("setting up searchId",this.searchId);c.events.publish("resultspage.searchId.changed",
{searchId:this.searchId});window.SearchID=this.searchId;"pageTitle"in a&&(document.title=a.pageTitle);"viewState"in a&&"priceType"in a.viewState&&(this.priceType=a.viewState.priceType,c.events.publish("resultspage.priceType.changed",{priceType:this.priceType}));this.logSmartyInteractions();this.options.pollingTimeout=a.uiTimeout;this.startedStreaming()},firstResultsRendered:function(a){},isFirstResults:function(a,b){return a&&b&&0<b.totalCount&&0>this.poll.lastPollTotalCount},preprocessResponse:function(a){if(this.searchId||
"searchId"in a){var b=this.options.poll&&!this.poll.ended,d=this.isFirstResults(b,a);if(a&&(!this.poll.firstPhaseCompleted||!a.secondPhaseWait||a.completed||a.error)){this.log.console("received response",a);!this.searchId&&"searchId"in a&&"string"===typeof a.searchId&&this.setupNewlyCreatedSearch(a);d&&(c.events.publish("resultspage.streaming.firstResults"),this.firstResultsRendered(a));this.options.completed=a.completed;if(a.error){b={type:"server",message:a.errorMessage,searchExpired:a.searchExpired};
a.searchStartError&&(b={type:"query",userDisplayMessage:a.queryErrors.reduce(function(a,b){return a+"\x3c/br\x3e"+b})});this.handleError(b);return}var h="isCustomTicket"in a&&a.isCustomTicket;if("filtersData"in a){this.filtersData=a.filtersData;var e=function(){this.log.time("filterUpdate");c.events.publish("resultspage.filtersData.changed",a.filtersData);c.events.publish("%s.resultspage.filtersData.changed.done".format(this.vertical),a.filtersData);this.log.timeEnd("filterUpdate")}.bind(this);b&&
d&&c.config.getBoolean("ui.horizon.resultspage.delayFilterPaint",!0)?setTimeout(e,c.config.getInt("ui.horizon.resultspage.delayFilterPaint.time",100)):e()}"urlFilterState"in a&&!this.useUrlFilterState&&(this.urlFilterState=a.urlFilterState,this.options.useUrlFilterState&&!h&&this.updateUrlFilterState(a.urlFilterState));"quickLinkData"in a&&c.events.publish("resultspage.quickLinkData.changed",a.quickLinkData);"sortMode"in a&&(this.options.useUrlSortMode&&!h&&this.updateUrlSortState(a.sortMode),c.events.publish("resultspage.sortMode.changed",
{customTicket:h,sortCode:a.sortMode}));"taxesEstimated"in a&&c.events.publish("resultspage.taxesEstimated.changed",{taxesEstimated:a.taxesEstimated});"priceType"in a.viewState&&c.events.publish("resultspage.priceType.changed",{priceType:a.viewState.priceType});"warnDestinationCC"in a&&c.events.publish("resultspage.warnDestinationCC.changed",{warnDestinationCC:a.warnDestinationCC});"swindle"in a&&c.Common&&c.Common.SwindlePublisher&&c.Common.SwindlePublisher.publish(a.swindle);a.ads&&(this.resultsReason=
null,this.getAdsHelper().updateAds(a.ads));if(a.completed){if(0===a.totalCount&&0===a.filteredCount){this.handleError({type:"noresults",message:"Finished search but failed to find results",response:a});this.ariaResultMsgWidget.deactivateLoadMessage(this.options.ariaMsg.noResultsFound);return}this.endPolling("completed",null,a);b=this.options.poll&&!this.poll.ended}if(this.checkFilteredCount(a)||a.error)this.removeTransitionClass(),a.allResultsWereFiltered&&!this.options.showFilteredButSimilar&&this.listBody.addClass("failed").attr("aria-hidden",
!0);this.setFirstPhaseCompleted(a);(a.completed||0<a.filteredCount&&0<a.totalCount)&&c.events.publish("resultspage.results.count.changed",{filtered:a.filteredCount,total:a.totalCount});c.events.publish("paginator.update",{pageNumber:a.pageNumber,pageCount:a.pageCount});c.events.publish("resultspage.refreshed",{streaming:!a.completed});this.didReceiveResults(a);this.poll.ended&&c.events.publish("paginator.getmoreresults.completed")}b&&this.setupNextPollRequest(a,d);this.updateCubaWarning(a);this.resultsList.removeClass("hidden")}},
checkFilteredCount:function(a){return 0<a.filteredCount||a.allResultsWereFiltered},setupNextPollRequest:function(a,b){"totalCount"in a&&0<a.totalCount&&a.totalCount!==this.poll.lastPollTotalCount?(this.poll.consecutiveEmptyResponses=0,this.poll.lastPollTotalCount=a.totalCount):this.poll.consecutiveEmptyResponses++;var c=this.options.pollDelay;!a.cached&&this.options.exponentialBackoffDelay&&(c=this.options.pollDelay+1E3*Math.log(this.poll.consecutiveEmptyResponses+1));a=Math.min(c,this.options.maxPollDelay);
this.poll.firstPhaseCompleted&&0<=this.options.secondPhaseWait&&(a=this.options.secondPhaseWait);b&&(a=0);this.poll.reason="POLL";this.getResults(a)},setFirstPhaseCompleted:function(a){this.poll.firstPhaseCompleted!==a.firstPhaseCompleted&&(this.poll.firstPhaseCompleted=a.firstPhaseCompleted,this.poll.firstPhaseCompleted&&(c.events.publish("resultspage.streaming.firstPhase.done"),this.startSecondPhaseTimeout(),c.utils.performance.mark("first_phase_complete")))},syncState:function(a,b){null===b.state?
delete a[b.name]:b.name&&(a[b.name]=b.state)},syncFilterState:function(a){this.syncState(this.filterState,a);this.preserveFilters&&a.syncPreservedState&&this.syncPreservedFilters(a)},syncPreservedFilters:function(a){this.syncState(this.preservedFilters,a)},setPageNumber:function(a){this.options.pageNumber!==a&&(this.options.pageNumber=a,c.events.publish("resultspage.pageNumber.changed",a),c.action.execute("common/utils/history/UserStateUpdateAction",{storageType:"viewState",searchId:self.searchId,
key:"pageNumber",value:a.toString()}))},onFilterStateChange:function(a){this.useUrlFilterState=!1;this.resultsList.removeClass("hidden");this.syncFilterState(a);this.preserveFilters&&!a.syncPreservedState&&this.syncPreservedFilters(a);a.name&&a.changeData&&(this.changingFilter=e.extend({name:a.name},a.changeData));a.skipPageReset||this.setPageNumber(1);this.resultsReason="filters.changed";this.poll.reason="FILTER";a.reset&&(this.poll.reason+=".RESET");this.refreshResults(a)},onPaginatorChange:function(a){a.append||
e(window).scrollTop(0).trigger("scroll");c.Analytics.api.trackEvent("page/"+a.pageNumber);this.setPageNumber(a.pageNumber);this.resultsReason="paginator.change";this.poll.reason="PAGINATE";this.refreshResults({append:a.append})},onResultsListHeaderChange:function(a){a.rpIgnore||(void 0!==a.sort?(this.options.sortMode=a.sort.sortType,this.options.ascending=a.sort.ascending,this.poll.reason="SORT",c.Analytics.api.trackEvent(this.loggingPrefix+"/sort/"+(a.sort.ascending?"":"-")+a.sort.sortType)):void 0!==
a.priceType?(this.priceType=this.options.priceType=a.priceType,this.poll.reason="PRICETYPE",c.Analytics.api.trackEvent(this.loggingPrefix+"/priceType/"+a.priceType)):this.poll.reason="SORT",void 0!==a.reviewType&&(this.options.reviewType=a.reviewType,c.Analytics.api.trackEvent(this.loggingPrefix+"/reviewType/"+a.reviewType)),void 0!==a.quickLinkType&&(this.options.quickLinkType=a.quickLinkType,c.Analytics.api.trackEvent(this.loggingPrefix+"/quickLinkType/"+a.quickLinkType)),this.updateFrenchWarning(),
this.setPageNumber(1),this.resultsReason="resultsHeader.changed",this.refreshResults())},updateFrenchWarning:function(){this.frenchWarning&&this.frenchWarning.toggleClass("hidden",this.options.defaultSortType&&-1===this.options.defaultSortType.indexOf(this.options.sortMode))},updateCubaWarning:function(a){var b=this.getChildElement("cubaWarning"),c=this.getChildElement("cubaWarningWrapper");a.hasOwnProperty("cubanQuery")&&a.cubanQuery?(b.addClass("visible"),c.addClass("visible").attr("aria-hidden",
!1)):b.hasClass("visible")&&(c.removeClass("visible","aria-hidden",!0),b.addClass("visible"))},addTransitionClass:function(a){if(!this.options.forceLoadingTreatmentSkip||!this.skipLoadingTreatment()){var b=[];this.options.blurTransition&&(b.push("blur"),this.resultsList.addClass("blur"));this.options.spinnerTransition&&b.push("loading");this.options.fastCover?(this.resultsListCover.addClass(b.join(" ")),a&&a.overlayTop&&this.resultsListCover.css("top",a.overlayTop-this.listBody.position().top)):this.listBody.addClass(b.join(" "))}},
removeTransitionClass:function(){this.options.blurTransition&&this.resultsList.removeClass("blur");this.resultsListCover.removeClass("loading blur").css("top",null);this.listBody.removeClass("loading blur");this.loadingMessage.addClass("hidden")},refreshResults:function(a){if(this.searchRunner){!this.searchId&&c.config.getBoolean("horizon.resultspage.dontRefreshBeforeSearchStart",!0)&&this.searchStartParams&&(a=e.extend({},a,this.searchStartParams));a&&a.customRequest&&(this.resultsReason=a.customRequest);
this.ariaResultMsgWidget.activateLoadMessage(this.options.ariaMsg.resultsLoading);var b=this.poll.reason&&-1<this.poll.reason.indexOf("FILTER")?200:0,d=a&&a.afterUpdateFn;d&&delete a.afterUpdateFn;this.getResults(b,a,!0,d);"undefined"!==typeof a&&"undefined"!==typeof a.append&&a.append||(c.dom.schedule(this.addTransitionClass.bind(this,a)),this.listBody.removeClass("failed").attr("aria-hidden",!1))}},reloadExpiredResults:function(){this.addTransitionClass();this.log.console("reloading expired results");
this.options.showExpiredResultsMessage&&(this.options.msg.expired_search&&this.loadingMessage.text(this.options.msg.expired_search),this.resultsListCover.addClass("expired"),this.loadingMessage.removeClass("hidden"));c.Analytics.api.trackEvent(this.loggingPrefix+"/searchexpired");var a;if(c.config.getInt("ui.rp.limitExpiredReload",!0)){if(a=this.limitedReloadUrl(),!a)return}else a=this.mergeFilterStateWithUrl(this.urlFilterState);window.location.href=a},stopSearch:function(a){e.get("/s/sparkle?action\x3dkillseeker\x26searchid\x3d%s\x26formtoken\x3d%s".format(a||
this.searchId,c.globals.formtoken))},clientTimeout:function(){this.log.console("client timed out");if(c.config.getBoolean("ui.horizon.rp.streaming.timeout.reload",!0)){this.stopSearch();var a=this.limitedReloadUrl();a&&(this.handleError({type:"timeout",message:"Reached polling timeout without completing"}),window.location=this.mergeStateWithUrl("true","force",a))}},limitedReloadUrl:function(){var a=l.exec(window.location.search),b=1;if(a&&1<a.length&&(b=parseInt(a[1])+1,!isNaN(b)&&b>c.config.getInt("ui.horizon.rp.streaming.timeout.reload.limit",
3))){a=(a=m.exec(window.location.search))&&1<a.length?parseInt(a[1]):this.lastLimitedDateMs;if(!isNaN(a)&&0<a&&0<this.lastLimitedMinMS&&Date.now()-a>this.lastLimitedMinMS)return this.lastLimitedDateMs=null,this.mergeFilterStateWithUrl(this.urlFilterState).replace(l,"").replace(m,"");this.handleError({type:"limitreload",message:"Reached max consecutive poll timeouts",attempts:b,last:a,searchExpired:!0,avoidReload:!0});return null}this.lastLimitedDateMs=Date.now();return this.mergeStateWithUrl(""+this.lastLimitedDateMs,
"lastms",this.mergeStateWithUrl(""+b,"attempt"))},startSecondPhaseTimeout:function(){var a=this;c.config.getBoolean("ui.horizon.killSecondPhase",!1)&&(this.stopSecondPhaseTimeout(),this.secondPhaseTimeoutId=window.setTimeout(function(){a.poll.ended||(a.stopSearch(),window.setTimeout(function(){a.endPolling("2ftimeout")},5E3))},this.options.secondPhaseTimeout-5E3))},stopSecondPhaseTimeout:function(){window.clearTimeout(this.secondPhaseTimeoutId);this.secondPhaseTimeoutId=null},startIdleTimeout:function(a){this.idleTimeoutId=
window.setTimeout(function(){e(window).one("mousemove",function(){c.events.publish("results.expired")})},a)},stopIdleTimeout:function(){window.clearTimeout(this.idleTimeoutId);this.idleTimeoutId=null},startClientTimeout:function(a){var b=this;a+=5E3;var c=this.searchId;this.stopClientTimeout();this.clientTimeoutId=window.setTimeout(function(){c===b.searchId&&b.clientTimeout()},a)},stopClientTimeout:function(){window.clearTimeout(this.clientTimeoutId);this.clientTimeoutId=null},startedStreaming:function(){this.options.enforceIdleTimeout&&
this.startIdleTimeout(6E4*this.options.idleExpireMinutes);null===this.clientTimeoutId&&this.startClientTimeout(2*this.options.pollingTimeout);var a=c.storage.get("search_submit_pageId"),b="RP";a&&"results"!==a&&(b="FD",c.storage.remove("search_submit_pageId"));c.Analytics.api.trackEvent({category:"ResultsPage",action:"search_started",label:b})},didReceiveResults:function(a){},updateDOM:function(a,b){try{this.log.time("updateDOM");for(b=0;b<a.children.length;b++)if(!c.dom.merge(this.element.find("#"+
a.children[b].id).get(0),a.children[b]))return!1;return!0}catch(d){return!1}finally{this.log.timeEnd("updateDOM")}},checkFilteredCountForPreservedFilters:function(a){var b=this;if(this.preserveFilters){var d={};this.options.nonClearablePreservedFilters.forEach(function(a){b.preservedFilters.hasOwnProperty(a)&&(d[a]=b.preservedFilters[a])});this.clearPreservedFilters();if(0===a.filtered||a.filtered<this.options.removeFiltersThreshold&&a.total>=this.options.removeFiltersThreshold)c.Widgets.Toaster.addToast(this.options.msg.filters_removed,
{button:!0,escaped:!1,auto:!0,theme:"centered filters-cleared-toast"}),this.preservedFilters=0<Object.keys(d).length?d:null,this.filterState=0<Object.keys(d).length?d:{},this.refreshResults({resetFilters:!0})}},mergeStateWithUrl:function(a,b,c){if(b){var d=c||window.location.href.split("#")[0],e="string"!==typeof a;c=d.split("?");if(1<c.length){for(var d=c[1].split("\x26"),g=!1,k=0;k<d.length;k++)d[k].startsWith(b)&&(g=e?null:b+"\x3d"+a,-1<d[k].indexOf(";map")&&(g=(g||"")+";"+d[k].split(";")[1]),
d[k]=g,g=!0);g||e||d.push(b+"\x3d"+a);a=d.filter(function(a){return"string"===typeof a&&a.length});d=c[0]+(a.length?"?"+a.join("\x26"):"")}else e||(d+="?"+b+"\x3d"+a);return d}},mergeFilterStateWithUrl:function(a){return this.mergeStateWithUrl(a,"fs")},mergeSortStateWithUrl:function(a){return this.mergeStateWithUrl(a,"sort")},updateUrlFilterState:function(a){window.history&&window.history.replaceState&&window.history.replaceState(null,null,this.mergeFilterStateWithUrl(a))},updateUrlSortState:function(a){window.history&&
window.history.replaceState&&window.history.replaceState(null,null,this.mergeSortStateWithUrl(a))},toggleLeftRailCollapsed:function(){this.element.find(".col-left-rail").toggleClass("collapsed")},shouldTrackStreamingPerformance:function(a){return c.config.getBoolean("ui.horizon.resultspage.streamingPerformance.trackForAllSearches",!0)},getAdsHelper:function(){this.adsHelper||(this.adsHelper=new c.base.results.AdsHelper);return this.adsHelper},skipLoadingTreatment:function(){return!1},destroy:function(){this.base();
c.events.publish("resultspage.JavaScriptComponent.cleanup",this.vertical)},setColumnsVisible:function(a,b){var c=this,e=function(){a?(c.listCol.removeClass("hidden"),c.leftRail.removeClass("hidden"),c.rightRail.removeClass("hidden")):(c.listCol.addClass("hidden"),c.leftRail.addClass("hidden"),c.rightRail.addClass("hidden"))};b?setTimeout(e.bind(c),b):e()},setPreservedFilterState:function(a){this.preservedFilters=e.extend({},this.filterState)},bounceResults:function(){var a=this.listCol.get(0),b=this.leftRail.get(0),
c=this.rightRail.get(0);a.classList.remove("reload");a.classList.add("reload");b&&b.classList.add("reload");c&&c.classList.add("reload");setTimeout(function(){b&&b.classList.remove("reload");c&&c.classList.remove("reload");a&&a.classList.remove("reload")},2E3)},getPageContainerLeftMargin:function(){var a=this.element.find(".pageContainer").first(),b=Number(a.css("padding-left").replace("px","")),b=0===b?this.options.defaultPaddingLeft:b;return Number(a.css("margin-left").replace("px",""))+b}})})(R9,
jq||jQuery);(function(f,k,l){var m=f.config.getBoolean("ui.horizon.resultspage.reconcile.openDetails",!0),n=f.config.getBoolean("ui.horizon.resultspage.reconcile.openDialogs",!0);f.publish("base.results.ResultsPageDOMUtils",{mergeOpenResults:function(a,d){if(m){var c=a.find(".Base-Results-HorizonResult.DetailOpen");c.length&&this.mergeOpenDetails(c,a)}n&&(c=k(".Common-Widgets-Dropdown-DropdownDialog-Content.open"),c.length&&this.mergeOpenDialogs(c,a,d))},mergeOpenDialogs:function(a,d,c){for(var b=0;b<a.length;b++){var e=
a[b].getAttribute("data-dropdown-owner");if(e&&d.find("#"+e).length){e=c.find("#"+a[b].id);if(e.length){var g=e.attr("id").split("-")[0],h=k("#"+g),g=c.find("#"+g);if(h.length&&g.length&&h.index()===g.index()){a[b].setAttribute("reconcile-ignore","attributes");f.dom.merge(a[b],e[0]);e[0].remove();continue}}a[b].remove()}}},mergeOpenDetails:function(a,d){for(var c=0;c<a.length;c++)if(!d.find("#"+a[c].id).hasClass("DetailOpen")){a[c].setAttribute("reconcile-ignore","attributes");var b=a[c].getElementsByClassName("detailsWrapper");
1===b.length&&(b[0].setAttribute("reconcile-ignore","all"),b=b[0].getElementsByClassName("detailsContent"),b.length&&b[0].children.length&&b[0].children[0].setAttribute("do-not-destroy","true"))}}});f.publish("base.results.AdsHelper",l.extend({adRequestInfo:null,adsResponseDate:null,adUpdateTimerID:null,constructor:function(a){this.adRequestInfo={}},updateAds:function(a){f.config.getBoolean("ui.ads.copyPollAdsData",!0)&&(a=k.extend(!0,{},a));if(f.config.getBoolean("ui.ads.nowAfterResponse",!0)&&this.adRequestInfo)for(var d in this.adRequestInfo)if(this.adRequestInfo.hasOwnProperty(d)){var c=
this.adRequestInfo[d];if(c)for(var b=0;b<c.length;b++)c[b].now=0}this.adsResponseDate=Date.now();window.clearTimeout(this.adUpdateTimerID);this.adUpdateTimerID=setTimeout(function(){f.events.publish("resultspage.ads.update",a)},f.config.getInt("ui.horizon.resultspage.ads.updateDelay",100))},requiresAdsPoll:function(){if(!f.config.getBoolean("ui.horizon.resultspage.requireAdsPoll",!0)||this.adsResponseDate||!this.adRequestInfo)return!1;for(var a in this.adRequestInfo)if(this.adRequestInfo.hasOwnProperty(a)){var d=
this.adRequestInfo[a];if(d&&d.pop)for(var c=0;c<d.length;c++)if(d[c].now)return!0}return!1},clearAdRequestInfo:function(a){this.adRequestInfo&&(this.adRequestInfo[a]=[])},onSetupAdsRequest:function(a){if(a&&a.adType&&a.pageLocation){this.adRequestInfo||(this.adRequestInfo={});this.adRequestInfo[a.adType]||(this.adRequestInfo[a.adType]=[]);for(var d=this.adRequestInfo[a.adType],c,b=0;b<d.length;b++)d[b]&&d[b].pageLocation===a.pageLocation&&(c=1,d[b]=a);c||d.push(a)}},setAdRequestSearchOptions:function(a,
d){if(a&&this.adRequestInfo){var c="",b="",e,g,h=function(a){if(!a||!a.length)return"";for(var c="",b,e=0;e<a.length;e++)(b=a[e])&&b.pageLocation&&(!isNaN(b.minRefreshRate)&&(0<b.minRefreshRate||0===b.minRefreshRate)&&(g=void 0===g?b.minRefreshRate:Math.min(g,b.minRefreshRate)),b.now||b.events&&b.events.pop&&"string"===typeof d&&0<=b.events.indexOf(d))&&(f.config.getBoolean("ui.ads.nowAfterResponse",!0)||(b.now=0),c+=b.pageLocation+",");return c};for(e in this.adRequestInfo)this.adRequestInfo.hasOwnProperty(e)&&
("displayAd"===e?c=h(this.adRequestInfo[e]):"textAd"===e&&(b=h(this.adRequestInfo[e])));d&&f.events.publish("resultspage.ads.options");!a.forceRefreshAds&&this.adsResponseDate&&0<g&&Date.now()-this.adsResponseDate<g||(b&&(a.textAdPageLocations=b.substr(0,b.length-1)),c&&(a.displayAdPageLocations=c.substr(0,c.length-1)),a.existingAds=!!this.adsResponseDate)}}}))})(R9,jQuery,base2.Base);var _extends=Object.assign||function(c){for(var e=1;e<arguments.length;e++){var f=arguments[e],a;for(a in f)Object.prototype.hasOwnProperty.call(f,a)&&(c[a]=f[a])}return c};
(function(c,e){var f=c.config.getBoolean("ui.whisky.modal.enabled",!1);c.createComponentClass("common.booking.ClickoutController","framework.JavaScriptComponent",{options:{postClickDelay:200},resultsOrderLogString:null,searchIdExpirationCheckFailed:!1,hotelCarsPostClickXSellRequested:!1,addEventHandlers:function(){var a=this;this.base();this.subscribe("clickout.open",function(g){a.searchIdExpirationCheckFailed?(c.Analytics.api.trackEvent("searchidexpired/bestclick"),c.events.publish("results.expired")):
a.open(g)});this.subscribe("clickout.resultsOrder.update",function(c){return a.resultsOrderLogString=c});this.subscribe("searchid.expiration.check.failed",function(){return a.searchIdExpirationCheckFailed=!0});this.subscribe("resultspage.cleanup",function(){return a.searchIdExpirationCheckFailed=!1})},open:function(a){var g=this,b=a.data||{},d=e(a.element),h=a.event,k=a.callback||e.noop,l=h&&(h.metaKey||h.ctrlKey);d.length&&("A"!==d.get(0).nodeName&&(d=d.find("a").eq(0)),b.target=b.target||d.attr("target"),
b.url=b.url||d.attr("href"),b.name=b.name||d.data("name"),b.code=b.code||d.data("code"),b.splitProvider=b.splitProvider||d.data("split-provider"),b.element=d,b.showWhiskyModal=!!b.showWhiskyModal,void 0===b.clickoutWarningDialog&&(b.clickoutWarningDialog=d.data("clickout-warning-dialog")));h&&h.preventDefault();b.noExternalRedirect=b.noExternalRedirect||b.splitProvider||b.clickoutWarningDialog;"undefined"===typeof b.showAfterclick&&(b.showAfterclick=!b.noExternalRedirect);b.noExternalRedirect?this.postClick(b,
k,l):(b.target=b.target||"_blank",(a="self"===b.target)&&this.postClick(b,k,l),d=b.url,this.resultsOrderLogString&&(d+=(1>d.indexOf("?")?"?":"\x26")+"resultsOrder\x3d"+encodeURIComponent(this.resultsOrderLogString)),f&&b.showWhiskyModal?c.events.publish("cars.whisky.modal.startWatching",{url:d+"\x26_kw_whiskyModal\x3dtrue"}):window.open(d,b.target),a||setTimeout(function(){return g.postClick(b,k,l)},this.options.postClickDelay))},postClick:function(a,g,b){c.events.publish(["multibook.providerClicked",
"provider.book.click"],_extends({resultId:a.resultId,providerName:a.name,providerCode:a.code,splitProvider:a.splitProvider,clickoutWarningDialog:a.clickoutWarningDialog,afterclickIgnore:!a.showAfterclick||b},a.customPostClickData));if(a.splitProvider)c.events.publish("multibook.splitProvider.click",{resultId:a.resultId,element:a.element});else if(a.clickoutWarningDialog){var d=!1;b=e.extend({},a,{clickoutWarningDialog:!1,noExternalRedirect:!1,verifySubscriptionCallback:function(){d=!0}});c.events.publish("multibook.clickoutWarning.show",
b);if(!d)this.onClickoutWarningFailure(b)}!a.noExternalRedirect&&"flights"===this.options.vertical&&c.config.getBoolean("ui.post.click.xsell.enabled",!1)&&this.launchPostClickXSell(a);g(a)},onClickoutWarningFailure:function(a){var c=e.extend({},a,{clickoutWarningDialog:!1,noExternalRedirect:!1,verifySubscriptionCallback:void 0}),b;try{b=JSON.stringify(a)}finally{this.open({data:c}),this.log.error("Failed to open ClickoutWarningDialog. Subscription for result "+a.resultId+" not registered.\nPublish data: "+
b)}},launchPostClickXSell:function(a){if(!this.hotelCarsPostClickXSellRequested){this.hotelCarsPostClickXSellRequested=!0;c.Analytics.api.trackEvent("flight-hotel-xsell/impression");var e=a.element.parents("."+c.strings.encodeClassName("Base-Results-HorizonResult"));e.length&&c.ajax.execute("flights/results/xsells/HotelCarsPostClickXSell",{data:{searchId:a.searchId},appendTo:e,insertBefore:!0,replace:!1})}}})})(R9,jQuery);(function(b,d){b.createComponentClass("common.booking.SearchIdExpirationChecker","framework.JavaScriptComponent",{options:{},searchId:null,searchIdLikelyValid:!0,checkTimer:null,init:function(){this.options.searchId&&(this.searchId=this.options.searchId)},addEventHandlers:function(){var a=this;this.base();this.subscribe("resultspage.streaming.done",this.searchEnded.bind(this));this.subscribe("resultspage.refreshed",this.searchEndedWait.bind(this));this.subscribe(["search.startSearch","resultspage.searchId.changed",
"search.expired","results.expired"],this.clearCheckTimer.bind(this));d("a.bookingLink").click(function(){return a.interceptClick()})},interceptClick:function(){if(this.searchIdLikelyValid)return!0;b.Analytics.api.trackEvent("searchidexpired/booklink");b.events.publish("results.expired");return!1},clearCheckTimer:function(){this.checkTimer&&(clearTimeout(this.checkTimer),this.checkTimer=null)},searchEndedWait:function(a){var b=this;setTimeout(function(){b.searchEnded(a)},100)},searchEnded:function(a){this.clearCheckTimer();
a&&a.searchId?(this.searchId=a.searchId,this.searchIdLikelyValid=!0,this.startCheckTimer()):a&&"streaming"in a&&!a.streaming?this.startCheckTimer():this.searchId=null},startCheckTimer:function(){if(!this.checkTimer){var a=this;this.checkTimer=setTimeout(function(){a.validateFromServer();a.checkTimer=null},this.options.checkTimeout)}},validateFromServer:function(){if(this.searchId){var a=this;d.ajax({type:"POST",url:"/s/horizon/common/booking/SearchIdValidationAction",headers:{"X-CSRF":b.globals.formtoken},
data:{searchId:this.searchId},success:function(c){c&&(a.searchIdLikelyValid=!c.isExpired,c.isExpired&&b.events.publish("searchid.expiration.check.failed"))}})}}})})(R9,jQuery);
//
(function(q){q=q||{};q.CompareTo=q.CompareTo||{};window.R9=q;var m={};(function(h){h.apply=function(f,c){if(f&&c&&"object"===typeof c)for(var g in c)f[g]=c[g];return f};h.applyIf=function(f,c){if(f&&c&&"object"===typeof c)for(var g in c)void 0===f[g]&&(f[g]=c[g]);return f}})(m);(function(h){h.extend=function(f,c){var g={},b=!1,a=0,e=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(b=arguments[0],a++);for(;a<e;a++){var d=void 0,p=arguments[a];for(d in p)Object.prototype.hasOwnProperty.call(p,
d)&&(b&&"[object Object]"===Object.prototype.toString.call(p[d])?g[d]=h.extend(!0,g[d],p[d]):g[d]=p[d])}return g}})(m);(function(h){var f=Array.prototype.slice,c;h.Functions=c={bind:function(c,b,a,e){return 2>arguments.length?c:3>arguments.length?c.bind(b):4>arguments.length?Function.prototype.bind.apply(c,[].concat(b,a)):function(){var d=a||arguments;!0===e&&(d=f.call(arguments,0),d=d.concat(a));return c.apply(b||global,d)}},pass:function(c,b,a){return function(){var e=b.slice();e.push.apply(e,arguments);
return c.apply(a||this,e)}},createBarrier:function(c,b,a){return function(){--c||b.apply(a,arguments)}},processSequenceWithTimeOut:function(f,b,a,e,d){var p=f.shift();p&&(d=a||e||d?c.bind(p,a,e,d):p,d(),setTimeout(function(){c.processSequenceWithTimeOut(f,b,a,e)},b||1E3))}}})(m);(function(h){var f=Object.create||function(){var a=function(){};return function(e){a.prototype=e;return new a}}(),c=[],g,b;h.Base=b=function(){};h.apply(b,{$staticsMembers:c,$_isClass:!0,deepExtend:!1,extend:function(a){var e,
d;e=this.prototype=f(a.prototype);if(!a.$_isClass)for(d in a=b.prototype,a)a.hasOwnProperty(d)&&d in e&&(e[d]=a[d])},addMembers:function(a,e){e=e?this:this.prototype;var d,b;for(d in a)a.hasOwnProperty(d)&&(b=a[d],"object"===typeof b&&"undefined"!==typeof e.deepExtend&&!0===e.deepExtend&&(b=h.extend(!0,{},e[d]||{},b||{})),e[d]=b);return this},mixin:function(a,e){var d,b,c;if("string"!==typeof a){for(d in a)a.hasOwnProperty(d)&&this.mixin(d,a[d]);return this}if(!e)return this;e=e.prototype;d=this.prototype;
d.hasOwnProperty("mixins")||(d.mixins="mixins"in d?f(d.mixins):{});for(b in e)e.hasOwnProperty(b)&&(c=e[b],"mixins"===b?h.applyIf(d.mixins,c):"mixinId"!==b&&void 0===d[b]&&(d[b]=c));d.mixins[a]=e;return this}});for(g in b)b.hasOwnProperty(g)&&c.push(g);b.$staticsMembers=c;b.addMembers({$className:"CompareTo.Base",deepExtend:!0,constructor:function(a){}})})(m);(function(h){function f(){return function(){return this.constructor.apply(this,arguments)||null}}var c,g=h.Base,b=g.$staticsMembers;h.ClassCreator=
c=function(a,e,d){e||(e={});var b=c.createClass(a);c.process(a,e,d);return b};h.apply(c,{makeConstructor:f,onBeforeCreated:function(a,e,d){a.addMembers(e);d.onCreated.call(a,a)},createClass:function(a){var e,d=b.length;for(a||(a=f());d--;)e=b[d],a[e]=g[e];return a},process:function(a,e,d){var b=c.orderPreprocessors,n=c.preprocessors,f=[],k,l,g={onBeforeCreated:c.onBeforeCreated,preprocessors:f,onCreated:d};k=0;for(l=b.length;k<l;k++)d=b[k],"string"===typeof d&&(d=n[d],"function"===typeof d&&f.push(d));
g.preprocessors=f;c.doProcess(a,e,g)},doProcess:function(a,e,d){for(var b=d.preprocessors,n=b.shift(),f=c.doProcess;n;n=b.shift())if(!1===n.call(c,a,e,d,f))return;d.onBeforeCreated.apply(c,arguments)},orderPreprocessors:[],preprocessors:{},registerProcessor:function(a,e,d,b){d||(d="last");c.preprocessors[a]=e;c.setPreprocessorPosition(a,d,b);return c},setPreprocessorPosition:function(a,e,d){var b=c.orderPreprocessors,n;if("string"===typeof e){if("first"===e)return b.unshift(a),c;if("last"===e)return b.push(a),
c;n="after"===e?1:-1}e=b.indexOf(d);-1!==e?b.splice(Math.max(0,e+n),0,a):b.push(a);return c}});c.registerProcessor("extend",function(a,e){var d=g.prototype,b=e.extend,c;if(b&&"string"===typeof b)throw Error("Extend class not found maybe you need to change extending order?");delete e.extend;e=b&&b!==Object?b:g;if(!e.$_isClass)for(c in b=e.prototype,d)d.hasOwnProperty(c)&&!b[c]&&(b[c]=d[c]);a.extend(e)});c.registerProcessor("mixins",function(a,e,d){if(e.mixins){var b=e.mixins,c=d.onCreated;delete e.mixins;
d.onCreated=function(){d.onCreated=c;a.mixin(b);return d.onCreated.apply(this,arguments)}}})})(m);(function(h){var f=h.ClassCreator,c=h.Functions,g,b=[],a={};h.ClassManager=g={classes:{},enableNamespaceParseCache:!0,namespaceParseCache:{},dependencies:{},parseNamespace:function(e){if("string"!==typeof e)throw Error("[Manager#parseNamespace] Invalid namespace, must be a string");var a=g.namespaceParseCache,b;if(g.enableNamespaceParseCache&&a.hasOwnProperty(e))return a[e];b=[];b.push(h);b=b.concat(e.split("."));
g.enableNamespaceParseCache&&(a[e]=b);return b},setNamespace:function(e,a){var d=h;e=g.parseNamespace(e);var b=e.length-1,c=e[b],k,l;for(k=0;k<b;k++)l=e[k],"string"!==typeof l?d=l:(d[l]||(d[l]={}),d=d[l]);d[c]=a;return d[c]},set:function(e,a){g.classes[e]=g.setNamespace(e,a);return g},get:function(a){var e=g.classes,b,c,f;if(e[a])return e[a];e=h;a=g.parseNamespace(a);c=0;for(f=a.length;c<f;c++)if(b=a[c],"string"!==typeof b)e=b;else{if(!e||!e[b])return null;e=e[b]}return e},getDependencies:function(a){var e=
g.dependencies;if(e[a])return e[a];throw Error("Can't get class"+a);},setDependency:function(a,d){var e=g.getName(a);g.dependencies[e]||(g.dependencies[e]={});g.dependencies[e][d]=a[d]},isCreated:function(a){if(!g.get(a,!1))return!1;g.triggerCreated(a);return!0},getName:function(a){return a&&a.$className||""},createClass:function(a,d){if(null!==a&&"string"!==typeof a)throw Error("Invalid class name '"+a+"' specified, must be a non-empty string");var e=f.makeConstructor();d.$className=a;return f(e,
d,function(e){a&&g.set(a,e);d.singleton&&g.set(a,new e);a&&g.triggerCreated(a)})},notify:function(a,d,b){var e=[a],c,k,l,p,f;c=0;for(k=d.length;c<k;c++)p=d[c],p.fn.call(p.scope,a);c=0;for(k=e.length;c<k;c++)if(f=e[c],d=b[f]){a=0;for(l=d.length;a<l;a++)p=d[a],p.fn.call(p.scope,f);delete b[f]}},onCreated:function(e,d,c){g.addListener(e,d,c,b,a)},triggerCreated:function(e){g.notify(e,b,a)},addListener:function(a,d,b,f,r){if(b instanceof Array){var e=c.createBarrier(b.length,a,d);a=0;for(d=b.length;a<
d;a++)g.addListener(e,null,b[a],f,r)}else e={fn:a,scope:d},b?g.isCreated(b)?a.call(d,b):(r[b]||(r[b]=[]),r[b].push(e)):f.push(e)}};h.apply(h,{define:function(a,d,b){return g.createClass.apply(g,arguments)}})})(m);(function(h){var f=h.ClassCreator,c=h.ClassManager,g=["extend","requires","mixins"],b=function(){};h.apply(b,{require:function(a,d){var e=[],f,g,k;f=0;for(g=a.length;f<g;f++)k=a[f],c.isCreated(k)||e.push(k);if(e.length)c.onCreated(function(){d&&d()},b,a);else d&&d()}});var a=function(a,d){var e,
b,c;d||(d=[]);if(!a)return d;"string"===typeof a&&d.push(a);if(a instanceof Array)for(b=a.length,c=0;c<b;c++)e=a[c],"string"===typeof e&&d.push(e);if("string"!==typeof a&&!(a instanceof Array)&&"function"!==typeof a)for(c in a)a.hasOwnProperty(c)&&(e=a[c],"string"===typeof e&&d.push(e));return d};f.registerProcessor("loader",function(e,d,f,n){var p=this,k=[],l,h,v,w,m=[];l=0;for(h=g.length;l<h;l++)v=g[l],d.hasOwnProperty(v)&&(w=d[v],k=a(w,k));if(0!==k.length)return b.require(k,function(){l=0;for(h=
g.length;l<h;l++)if(v=g[l],d.hasOwnProperty(v)){w=d[v];var a=void 0,b,k,r=d,t=v,u=w,q=m;q||(q=[]);if(u){"string"===typeof u&&(k=c.get(u),r[t]=k,q.push(k));if(u instanceof Array)for(b=u.length,a=0;a<b;a++)k=u[a],"string"===typeof k&&(k=c.get(k),r[t][a]=k,q.push(k));if("string"!==typeof u&&!(u instanceof Array)&&"function"!==typeof u)for(a in u)u.hasOwnProperty(a)&&(k=u[a],"string"===typeof k&&(k=c.get(k),r[t][a]=k,q.push(k)))}m=q;c.setDependency(d,v)}n.call(p,e,d,f)}),!1},"first")})(m);(function(h){h.define("BrowserConfig",
{singleton:!0,getString:function(f,c){return q.globals&&q.globals.browserCapabilities&&"undefined"!==typeof q.globals.browserCapabilities[f]?q.globals.browserCapabilities[f]:c},getBoolean:function(f,c){return(f=this.getString(f,""))?"true"===f.toLowerCase():c},getInt:function(f,c){return(f=this.getString(f,""))?parseInt(f):c}})})(m);(function(h){h.define("Config",{singleton:!0,getString:function(f,c){return q.config&&"function"===typeof q.config.getString?q.config.getString(f,c):c},getBoolean:function(f,
c){return q.config&&"function"===typeof q.config.getBoolean?q.config.getBoolean(f,c):c},getInt:function(f,c){return q.config&&"function"===typeof q.config.getInt?q.config.getInt(f,c):c}})})(m);(function(h){var f=/[^\x20\t\r\n\f]+/g,c=function(b){return(b.match(f)||[]).join(" ")},g=function(b){return b.getAttribute&&b.getAttribute("class")||""};(function(b){"function"!==typeof b.matches&&(b.matches=b.msMatchesSelector||b.mozMatchesSelector||b.webkitMatchesSelector||function(a){a=(this.document||this.ownerDocument).querySelectorAll(a);
for(var e=0;a[e]&&a[e]!==this;)++e;return!!a[e]});"function"!==typeof b.closest&&(b.closest=function(a){for(var e=this;e&&1===e.nodeType;){if(e.matches(a))return e;e=e.parentNode}return null})})(window.Element.prototype);h.define("Dom.Element",{singleton:!0,hasClass:function(b,a){return b?(a=" "+a+" ",1===b.nodeType&&-1<(" "+c(g(b))+" ").indexOf(a)):!1},addClass:function(b,a){if(b){var e,d,p,n;e=g(b);if(d=1===b.nodeType&&" "+c(e)+" "){p=a.match(f)||[];for(n=0;a=p[n++];)0>d.indexOf(" "+a+" ")&&(d+=
a+" ");d=c(d);e!==d&&b.setAttribute("class",d)}}},removeClass:function(b,a){if(b){var e,d,p,n;e=g(b);if(d=1===b.nodeType&&" "+c(e)+" "){p=0;for(n=a.match(f)||[];a=n[p++];)for(;-1<d.indexOf(" "+a+" ");)d=d.replace(" "+a+" "," ");d=c(d);e!==d&&b.setAttribute("class",d)}}},children:function(b){var a=[];for(b=b.firstChild;b;b=b.nextSibling)1===b.nodeType&&a.push(b);return a},isLastChild:function(b){if(b.parentNode){var a=b.parentNode.childNodes;return a[a.length-1]===b}throw"There is not parent node in element";
},closest:function(b,a){return b.closest(a)},isVisible:function(b){return!!(b.offsetWidth||b.offsetHeight||b.getClientRects().length)}})})(m);(function(h){var f=document.createElement("div"),c;c=f.addEventListener?function(b,a,e){"undefined"===typeof b._eventListeners&&(b._eventListeners=[]);b.addEventListener(a,e,!1);var d=b._eventListeners;d.push({type:a,fn:e});b._eventListeners=d}:function(){};var g=function(b,a){return"function"===typeof b.matches?b.matches(a):"function"===typeof b.webkitMatchesSelector?
b.webkitMatchesSelector(a):"function"===typeof b.mozMatchsSelector?b.mozMatchesSelector(a):"function"===typeof b.msMatchesSelector?b.msMatchesSelector(a):!1};h.define("Dom.Event",{singleton:!0,addEvent:c,removeEvent:f.removeEventListener?function(b,a,e){if("undefined"!==typeof b._eventListeners){b.removeEventListener(a,e);for(var d=b._eventListeners,c,f=[],g=0,k=d.length;g<k;g++)c=d[g],c.type!==a&&c.fn!==e&&f.push(d[g]);b._eventListeners=d}}:function(){},removeAllEvents:function(b,a){if("undefined"!==
typeof b._eventListeners){for(var e=b._eventListeners||[],d,c=[],f=0,g=e.length;f<g;f++)d=e[f],a&&d.type!==a?c.push(d):b.removeEventListener(d.type,d.fn);b._eventListeners=e}},delegateEvent:function(b,a,e,d){c(b,a,function(a){for(var c=a.target;b!==c&&!g(c,"html");){if(g(c,e)){d(c,a);break}c=c.parentNode}})}})})(m);(function(h){var f=function(a){var e={},b,d=a.length;for(b=0;b<d;b++)b in a&&(e[b]=a[b]);return e},c=/#.*$/,g,b,a=/\?/,e=/([?&])_=[^&]*/;h.define("Helper.Url.Param",{singleton:!0,update:function(d,
f,n){f&&"string"!==f&&(f=this.get(f));d||(d="");g=d.replace(c,"");b=d.slice(g.length);f&&(g+=(a.test(g)?"\x26":"?")+f);!1===n&&(g=g.replace(e,"$1"),b=(a.test(g)?"\x26":"?")+"_\x3d"+(new Date).getTime()+b);return g+b},get:function(a,e){var b=[],d,c,l,g=Object.prototype.hasOwnProperty;for(c in a)if(g.call(a,c)){l=a[c];d=e?e+"["+c+"]":c;switch(typeof l){case "object":d=this.get(l,d);break;case "array":d=this.get(f(l),d);break;default:d=d+"\x3d"+encodeURIComponent(l)}l&&b.push(d)}return b.join("\x26")}})})(m);
(function(h){h.define("Helper.Browser",{singleton:!0,chromePDFInstalled:null,isChromePDFInstalled:function(){if(null===this.chromePDFInstalled){var f=!1,c=!1,g=navigator.plugins,b,a;for(a=0;b=g[a];a++)"Chrome PDF Viewer"===b.name&&"internal-pdf-viewer"===b.filename&&(f=!0),"Chrome PDF Viewer"===b.name&&"mhjfbmdgcfjbbpaeojofohoefgiehjai"===b.filename&&(c=!0);this.chromePDFInstalled=f&&c}return this.chromePDFInstalled},isDevToolsOpened:function(){var f=!1,c=new Image;Object.defineProperty(c,"id",{get:function(){f=
!0}});console.debug("%c",c);return f}})})(m);(function(h){var f={0:200,1223:204};h.define("Helper.HttpRequest",{singleton:!0,handleResponses:function(c){if(c&&c.text&&"string"===typeof c.text)try{return{state:"success",data:JSON.parse(c.text)}}catch(g){return{state:"parsererror",error:g}}return{state:"success",data:c}},sanitizeResponse:function(c,f,b){var a,e=f;f=200<=c&&300>c||304===c;b=this.handleResponses(b);if(f)204===c?e="nocontent":304===c?e="notmodified":(e=b.state,a=b.error,f=!a);else if(a=
e,c||!e)e="error";return{success:f,status:c,data:b.data,error:a,statusText:e}},request:function(c){var g,b=this,a,e,d=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");d.open(c.type,c.url,c.async);c.headers||(c.headers={});c.crossDomain||c.headers["X-Requested-With"]||(c.headers["X-Requested-With"]="XMLHttpRequest");for(g in c.headers)c.headers.hasOwnProperty(g)&&d.setRequestHeader(g,c.headers[g]);"function"!==typeof c.complete&&(c.complete=null);a=function(p){return function(){a&&
(a=e=d.onload=d.onerror=d.onabort=d.ontimeout=d.onreadystatechange=null,"abort"===p?d.abort():"error"===p?"number"!==typeof d.status?c.complete&&c.complete(b.sanitizeResponse(0,"error")):c.complete&&c.complete(b.sanitizeResponse(d.status,d.statusText)):c.complete&&c.complete(b.sanitizeResponse(f[d.status]||d.status,d.statusText,"text"!==(d.responseType||"text")||"string"!==typeof d.responseText?{binary:d.response}:{text:d.responseText})))}};d.onload=a();e=d.onerror=d.ontimeout=a("error");void 0!==
d.onabort?d.onabort=e:d.onreadystatechange=function(){4===d.readyState&&window.setTimeout(function(){a&&e()})};a=a("abort");try{d.send(c.data||null)}catch(p){if(a)throw p;}return d}})})(m);(function(h){var f,c,g=h.ClassManager;h.define("Helper.Http",{requires:["Helper.Url.Param","Helper.HttpRequest"],singleton:!0,hostname:"",crossDomain:!1,constructor:function(){var b=g.getDependencies("Helper.Http").requires;f=b[0];c=b[1]},changeHostName:function(b){this.hostname=b.replace(/^(.+?)\/*?$/,"$1");this.crossDomain=
!0},getHostName:function(){return this.hostname},isCrossDomain:function(){return this.crossDomain},getUrl:function(b){return(b=b.replace(/(^[\/#]*|[\/#]*$)/g,""))&&b.startsWith("http")?b:this.getHostName()+"/"+b},updateUrl:function(b,a,e){return this.isCrossDomain()?this.getUrl(f.update(b,a,e)):f.update(b,a,e)},handleResponse:function(b,a,e){b.success?a&&"function"===typeof a&&a.call(null,b.data):e&&"function"===typeof e&&e.call(null,b.error,b.statusText)},get:function(b,a,e,d){var f=this;return c.request({type:"GET",
url:f.updateUrl(b,a,!1),crossDomain:f.crossDomain,async:!0,complete:function(a){f.handleResponse(a,e,d)}})},post:function(b,a,e,d){var g=this;return c.request({type:"POST",crossDomain:g.crossDomain,url:g.getUrl(b),async:!0,data:"string"===typeof a?a:f.get(a),headers:{"Content-Type":"application/x-www-form-urlencoded"},complete:function(a){g.handleResponse(a,e,d)}})}})})(m);(function(h){h.define("Helper.Location",{singleton:!0,origin:function(){var f=window.location;return f.protocol+"//"+f.host}})})(m);
(function(h){h.define("Helper.ObjectProgress",{mixinId:"objectProgress",objectProgressStatus:1,constructor:function(){this.objectProgressStatus=2},stopObjectProgress:function(){this.objectProgressStatus=1},startObjectProgress:function(){this.objectProgressStatus=3},isObjectInProgress:function(){return 3===this.objectProgressStatus}})})(m);(function(h){h.define("Helper.Observer",{mixinId:"observer",events:{},constructor:function(){this.events={}},on:function(f,c){var g=this.events[f];g||(this.events[f]=
g=[]);g.push(c);return this},off:function(f,c){var g=this.events[f];if(!g)return this;"undefined"===typeof c?delete this.events[f]:this.events[f]=g.filter(function(b){if(b!==c)return b});return this},publish:function(f,c){if(c&&!c instanceof Array)throw Error("args must be array or empty");var g=this;f=g.events[f];if(!f)return g;f.forEach(function(b){b.apply(g,c||[])});return g}})})(m);(function(h){var f=h.ClassManager,c,g=h.extend,b={};h.define("Helper.ResponseSanitizer",{requires:["Helper.Storage"],
mixins:{observer:"Helper.Observer"},options:{},constructor:function(a){var e=f.getDependencies("Helper.ResponseSanitizer"),d=e.requires;e.mixins.observer.prototype.constructor.call(this);c=d[0];b=c.get("cmp2.state")||{};this.bindEvents();this.updateOptions(a)},bindEvents:function(){var a=this;a.on("updateOptions",function(e){a.updateOptions(e)});a.on("input.event",function(e,d){if("change"===e){e=d.data;var f=e.checked;a.persistItemsState(d,f);b[e.id]=f;c.set("cmp2.state",b)}})},updateOptions:function(a){this.options=
g(!0,{},this.options,a)},persistItemsState:function(a,e){var b=a.checkedItems&&0===a.checkedItems.length;e&&(b=a.checkedItems&&a.displayItems&&a.checkedItems.length===a.displayItems.length);b?c.set("cmp2.check.all",e):c.remove("cmp2.check.all")},onPrepareRendering:function(a){var e=this.options,d=0,f=0,g=Math.min(e.maxCheckedItems,e.maxPreCheckItems);a=a.items;for(var h=c.get("cmp2.check.all"),k=0;k<a.length;k+=1){var l=a[k];if(l.visible){var t=l.checked;e.storeStateSession&&b&&b.hasOwnProperty(l.id)&&
(l.checked=t=b[l.id]);e.limited&&!l.checked&&l.prechecked&&(f>=g&&(l.prechecked=!1),f+=1);t||(t=l.prechecked&&e.usePreCheckItems);null!==h&&(t=h);(l.checked=t)&&d++;e.limited&&d>e.maxCheckedItems&&(l.checked=!1)}}}})})(m);(function(h){var f,c=h.ClassManager;h.define("Helper.Cookie",{requires:["Helper.Http"],singleton:!0,constructor:function(){f=c.getDependencies("Helper.Cookie").requires[0]},get:function(c){c+="\x3d";for(var b=document.cookie.split(";"),a=0;a<b.length;a++){for(var e=b[a];" "===e.charAt(0);)e=
e.substring(1);if(0===e.indexOf(c))return e.substring(c.length,e.length)}return""},set:function(c,b,a,e,d){if(f.isCrossDomain())f.post("/s/horizon/common/compareto/CompareTosSave",b,function(a){d&&"function"===typeof d&&d(a)});else{var g="";a&&(g=new Date,g.setTime(g.getTime()+a),g="; expires\x3d"+g.toUTCString());"object"===typeof b&&(b=JSON.stringify(b));a=e?"; domain\x3d"+e:"";document.cookie=c+"\x3d"+encodeURIComponent(decodeURIComponent(b))+g+a+"; path\x3d/";d&&"function"===typeof d&&d({})}}})})(m);
(function(h){var f=!1,c,g;try{c=window.localStorage}catch(b){}try{c&&(c.setItem("vendor-support-test","success?"),g=c.getItem("vendor-support-test"),c.removeItem("vendor-support-test")),"success?"===g&&(f=!0)}catch(b){}h.define("Helper.Storage",{singleton:!0,get:function(b){if(f&&c){b=c.getItem(b);try{return JSON.parse(b)}catch(a){return b}}return null},set:function(b,a){try{f&&c&&(null!==a&&"object"===typeof a?c.setItem(b,JSON.stringify(a)):c.setItem(b,a))}catch(e){}},remove:function(b){try{f&&c&&
c.removeItem(b)}catch(a){}},clear:function(){f&&c&&c.clear()}})})(m);(function(h){h.define("Helper.UUID",{singleton:!0,get:function(){var f=(new window.Date).getTime();return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(c){var g=(f+16*Math.random())%16|0;f=Math.floor(f/16);return("x"===c?g:g&3|8).toString(16)})},randomString:function(f){var c="";f=f||5;for(var g=0;g<f;g++)c+="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".charAt(Math.floor(62*Math.random()));return c}})})(m);
(function(h){var f,c=h.ClassManager,g={scrollbars:1,location:1,statusbar:1,menubar:0,resizable:1},b=h.extend;h.define("Helper.Window",{requires:["Helper.Http"],singleton:!0,getSpinnerPath:function(){return f.getUrl("/s/compareresults/spinner")},constructor:function(){f=c.getDependencies("Helper.Window").requires[0]},getMultipleProvidersUrl:function(a){if(!a)return null;var e=a.compareTos||[],b=[],c="";if(0<e.length){for(var g=0,r;r=e[g];g++)"CLOSE"!==r.deepLink&&(b.push(r.code),c=r.deepLink);if(0<
b.length)return e=b.length,1===e?c:f.updateUrl("/s/compareresults/multi",h.apply({forcehttp:!0,providerCodes:b.join(",")},a.extra||{}))}return null},getWindowInformation:function(a){try{a=a?a:window;var e=a.document,b=a.screen,c=e.documentElement,f=e.getElementsByTagName("body")[0];return{y:"screenY"in a?a.screenY:a.screenTop,x:"screenX"in a?a.screenX:a.screenLeft,width:a.innerWidth||c.clientWidth||f.clientWidth,height:a.innerHeight||c.clientHeight||f.clientHeight,availTop:"availTop"in b?b.availTop:
0,availLeft:"availLeft"in b?b.availLeft:0,screenWidth:b.availWidth,screenHeight:b.availHeight}}catch(r){}return{y:0,x:0,width:window.screen.availWidth||800,height:window.screen.availHeight||600,availTop:0,availLeft:0,screenWidth:window.screen.availWidth||800,screenHeight:window.screen.availHeight||600}},tiled:function(a,b,d,c){return{url:this.getUrl(a),name:a.code,features:this.featuresForTiled(b,d,c)}},hidden:function(a,b){return{url:this.getUrl(a),name:a.code,features:this.featuresForHidden(!1,
b)}},getUrl:function(a){if("undefined"!==typeof a.useDeepLink&&!0===a.useDeepLink&&"undefined"!==typeof a.deepLink)return a.deepLink;var b="";a.verticalName&&(b="\x26vertical\x3d"+a.verticalName);return f.getUrl("/s/compareresults/spinner?code\x3d"+encodeURIComponent(a.code)+b)},featuresForHidden:function(a,e){var d=Math.min(1024,e.height-20),c=Math.min(1280,e.width-20),f=e.y+10,h=e.x+10;a&&(c=d=160,f=e.y+(e.height-110),h=e.x+(e.width-185));return b({},g,{top:f,left:h,height:d,width:c})},featuresForTiled:function(a,
e,d){e=Math.floor(d.screenWidth/e-10);return b({},g,{left:Math.floor((e+5)*a),top:0,height:Math.floor(d.screenHeight),width:e})},open:function(a,b,d,c){"object"===typeof d&&(d=this.objectToFeatureString(d));return open(a,this.getWindowName(b),d,c)},getWindowName:function(a){return a.replace(/[^a-z0-9]+/gi,"")},objectToFeatureString:function(a){var b=[],d;for(d in a)a.hasOwnProperty(d)&&b.push(d+"\x3d"+a[d]);return b.join(",")},features:function(a,e){var d=!0===a.top||!1,c=!0===a.bottom||!1,f=!0===
a.left||!1,h=!0===a.right||!1,k=a.height||150;a=a.width||250;var l=0,t=0;c&&(l+=d?0:e.height);h&&(t+=f?0:e.width);l+=d?10:-k;t+=h?-a:10;f&&h&&(a=e.width-20,t=10);d&&c&&(k=e.height+40,l=10);return b({},g,{top:e.y+l,left:e.x+t,height:k,width:a})},cloneHandleDimensions:function(a){var e=this.getWindowInformation(a);a=e.height;var d=e.width,c=e.y+5,e=e.x+5;return b({},g,{screenX:e,screenY:c,top:c,left:e,innerHeight:a,innerWidth:d,height:a,width:d})}})})(m);(function(h){var f=h.ClassManager;h.define("Type.CheckBoxButtonGroup",
{requires:["Dom.Element"],mixins:{observer:"Helper.Observer"},constructor:function(){var c=this,g=f.getDependencies("Type.CheckBoxButtonGroup"),b=g.requires[0];g.mixins.observer.prototype.constructor.call(this);c.on("click",function(a){b.hasClass(a,"checked")?(b.removeClass(a,"checked"),c.publish("deselect",[a,"deselect"])):(b.addClass(a,"checked"),c.publish("select",[a,"select"]));c.publish("change",[a,"change"])})}})})(m);(function(h){var f=h.ClassManager;h.define("Type.RadioButtonGroup",{requires:["Dom.Element",
"Config"],mixins:{observer:"Helper.Observer"},constructor:function(){var c=this,g=f.getDependencies("Type.RadioButtonGroup"),b=g.requires,a=b[0],e=b[1],d;g.mixins.observer.prototype.constructor.call(this);c.on("click",function(b){d&&b!==d&&(a.removeClass(d,"checked"),c.publish("change",[d,"change"]),c.publish("deselect",[d,"deselect"]));a.hasClass(b,"checked")?e.getBoolean("cmp2.radio.buttons.allow.deselect",!1)&&(d=0,a.removeClass(b,"checked"),c.publish("change",[b,"change"]),c.publish("deselect",
[b,"deselect"])):(d=b,a.addClass(b,"checked"),c.publish("change",[b,"change"]),c.publish("select",[b,"select"]))});c.on("repaint",function(b){if(b){var e=b.length,c,k;for(c=d=0;c<e;c++)k=b[c],a.hasClass(k,"checked")&&!d?d=k:a.removeClass(k,"checked")}})}})})(m);(function(h){var f={},c,g=h.ClassManager,b=h.extend;h.define("Workaround.Core",{requires:["Helper.Window"],mixins:{observer:"Helper.Observer"},options:{},blank:"about:blank",constructor:function(a){var e=g.getDependencies("Workaround.Core"),
d=e.requires;e.mixins.observer.prototype.constructor.call(this);c=d[0];this.options=b(!0,{},this.options,a);this.bindEvents()},bindEvents:function(){var a=this;a.on("input.event",function(b,d){switch(b){case "change":a.onChange(d);break;case "click":a.onClick(d);break;case "mousedown":a.onMouseDown(d);break;case "mouseup":a.onMouseUp(d);break;case "deselect":a.onDeselect(d);break;case "select":a.onSelect(d)}})},onChange:function(){},onClick:function(){},onMouseDown:function(){},onMouseUp:function(){},
onDeselect:function(){},onSelect:function(){},onResultPageOpen:function(a){var b=a.preOpen,d=a.preOpenItem,f=a.postOpenItem,g=a.postOpen;"function"===typeof b&&b.call(this,a);var b=this.getActiveProviderList(a.compareTos||[],!0),h=b.length,k=c.getWindowInformation(),l,t,v,w,u,m=c.featuresForTiled;for(l=0;t=b[l];l++)try{u={url:t.deepLink,name:t.code,features:m(l,h,k)},"function"===typeof d&&d.call(this,u,a),w=t.code,v=this.getHandle(w),v||(v=c.open(this.blank,w,u.features),this.addHandle(w,v)),this.tilingWindow(v,
u.features),v&&(v.location.href=u.url),"function"===typeof f&&f.call(this,u,v,a)}catch(x){}"function"===typeof g&&g.call(this,a)},getActiveProviderList:function(a,b){for(var e=[],c=0,f;f=a[c];c++)f.deepLink&&"CLOSE"===f.deepLink&&b&&this.closeWindow(f.code),f.deepLink&&"CLOSE"!==f.deepLink&&e.push(f);return e},closeWindow:function(a){try{c.open(this.blank,a).close()}catch(e){}},onDirectOpen:function(a,b){if("click"===a.type)this.onResultPageOpen({compareTos:b})},onSubmit:function(a){this.fireSubmitEvent(a)},
fireSubmitEvent:function(a){if("undefined"===typeof a)throw"Need specify data parameter for submit event";this.publish("onSubmit",[a])},addHandle:function(a,b){f[a]=b},getHandles:function(){return f},setHandles:function(a){f=a},getHandle:function(a){try{var b=f[a];return!b||b.closed?null:b}catch(d){return null}},tilingWindow:function(a,b){if("undefined"!==typeof b&&a){var d;this.options.resizeBeforeOpening?"undefined"!==typeof b.left&&"undefined"!==typeof b.top&&(a.resizeTo(100,100),a.moveTo(-1E7,
-1E7),d=["screenX"in a?a.screenX:a.screenLeft,"screenY"in a?a.screenY:a.screenTop],a.moveTo(d[0]+b.left,d[1]+b.top)):"undefined"!==typeof b.left&&"undefined"!==typeof b.top&&a.moveTo(b.left,b.top);"undefined"!==typeof b.width&&"undefined"!==typeof b.height&&a.resizeTo(b.width,b.height)}}})})(m);(function(h){var f,c=h.ClassManager,g;h.define("Workaround.AsyncOpen",{requires:["Helper.Window"],extend:"Workaround.Core",constructor:function(){var b=c.getDependencies("Workaround.AsyncOpen"),a=b.requires;
g=b.extend.prototype;g.constructor.apply(this,arguments);f=a[0]},onDirectOpen:function(b,a){if("click"===b.type){var e=this;b=f.getWindowInformation();for(var d=a.length,c=0,g;g=a[c];c++)g=f.tiled(g,c,d,b),this.open(g);setTimeout(function(){e.onResultPageOpen({compareTos:a})},1)}},open:function(b){setTimeout(function(){try{f.open(b.url,b.name,b.features)}catch(a){}},0)},onSubmit:function(b){var a=this,e,d,c,g;g=b.checkedItems.length;c=f.getWindowInformation();for(d=0;e=b.checkedItems[d];d++)e=f.tiled(e,
d,g,c),a.open(e);setTimeout(function(){var a=window.open("","_self");a&&!a.closed&&a.focus()},0);setTimeout(function(){a.fireSubmitEvent(b)},1)}})})(m);(function(h){var f,c=h.ClassManager,g;h.define("Workaround.AsyncOpenLastClose",{requires:["Helper.Window"],extend:"Workaround.Core",constructor:function(){var b=c.getDependencies("Workaround.AsyncOpenLastClose"),a=b.requires;g=b.extend.prototype;g.constructor.apply(this,arguments);f=a[0]},onDirectOpen:function(b,a){if("click"===b.type){var e=this;
b=f.getWindowInformation();for(var d=a.length,c=0,g;g=a[c];c++)g=f.tiled(g,c,d,b),delete g.features,this.open(g);setTimeout(function(){e.onResultPageOpen({compareTos:a})},1)}},open:function(b){setTimeout(function(){try{f.open(b.url,b.name,b.features)}catch(a){}},0)},onSubmit:function(b){var a=this,e,d,c,g;g=b.checkedItems.length;c=f.getWindowInformation();for(d=0;e=b.checkedItems[d];d++)e=f.tiled(e,d,g,c),delete e.features,a.open(e);setTimeout(function(){var a=window.open("about:blank","_blank");
a&&!a.closed&&a.close()},0);setTimeout(function(){a.fireSubmitEvent(b)},1)}})})(m);(function(h){var f,c,g=h.ClassManager,b;h.define("Workaround.ChangeWindowName",{requires:["Helper.UUID","Helper.Window"],extend:"Workaround.Core",constructor:function(a){var e=g.getDependencies("Workaround.ChangeWindowName"),d=e.requires;b=e.extend.prototype;b.constructor.apply(this,arguments);f=d[0];c=d[1]},onResultPageOpen:function(a){if(a.compareTos&&0<a.compareTos.length){var e=f.get();window.name=e;a.postOpenItem=
function(){c.open("",e,"")};a.postOpen=function(){c.open("",e,"")};b.onResultPageOpen.call(this,a)}},onSubmit:function(a){var b=f.get(),d,g,h,r,k;window.name=b;r=a.checkedItems.length;k=c.getWindowInformation();for(d=0;g=a.checkedItems[d];d++)try{h=c.tiled(g,d,r,k),c.open(h.url,h.name,h.features),c.open("",b,"")}catch(l){}this.fireSubmitEvent(a)}})})(m);(function(h){var f,c=h.ClassManager,g;h.define("Workaround.DocumentFocus",{requires:["Helper.Window"],extend:"Workaround.Core",constructor:function(){var b=
c.getDependencies("Workaround.DocumentFocus"),a=b.requires;g=b.extend.prototype;g.constructor.apply(this,arguments);f=a[0];this.blank=f.getSpinnerPath()},onSelect:function(b){g.onSelect.call(this,b);try{var a=b.data,e=f.getWindowInformation(),d=f.hidden(a,e);d.features=f.features({bottom:!0},e);var c=f.open(d.url,d.name,d.features);this.addHandle(d.name,c);this.windowFocus(c)}catch(n){}},onDeselect:function(b){g.onDeselect.call(this,b);try{var a=this.getHandle(b.data.code);a&&a.close()}catch(e){}},
focusInterval:null,windowFocus:function(b){this.focusInterval&&clearInterval(this.focusInterval);var a=0,e=this.focusInterval=setInterval(function(){try{b&&(b.blur(),b.opener.focus()),window.self.focus(),window.focus(),document.focus()}catch(d){}a++;10<a&&e&&clearInterval(e)},300)},onSubmit:function(b){var a=f.getWindowInformation(),e,d,c,g;for(e=0;d=b.checkedItems[e];e++)try{c=f.hidden(d,a),c.features=f.features({bottom:!0},a),g=f.open(c.url,c.name,c.features),this.addHandle(c.name,g),this.windowFocus(g)}catch(r){}this.fireSubmitEvent(b)}})})(m);
(function(h){var f,c=h.ClassManager,g;h.define("Workaround.HandleOpen",{requires:["Helper.Window"],extend:"Workaround.Core",constructor:function(){var b=c.getDependencies("Workaround.HandleOpen"),a=b.requires;g=b.extend.prototype;g.constructor.apply(this,arguments);f=a[0]},onDirectOpen:function(b,a){if("click"===b.type)this.onResultPageOpen({compareTos:a,postOpenItem:function(a,b){b&&!b.closed&&b.open("about:blank").close()}})},onSubmit:function(b){var a,e,d,c,g,h,k;k=b.checkedItems.length;h=f.getWindowInformation();
for(e=0;g=b.checkedItems[e];e++)try{a=f.tiled(g,e,k,h),(d=f.open(a.url,a.name,a.features))&&!d.closed&&(c=d.open("about:blank"),c.close())}catch(l){}this.fireSubmitEvent(b)}})})(m);(function(h,f){function c(a){return a.charCodeAt(0)}function g(a,b,d){b=b||"";d=d||1024;for(var e=[],f=0;f<a.length;f+=d){var k=a.slice(f,f+d),k=Array.prototype.map.call(k,c),k=new Uint8Array(k);e.push(k)}return new Blob(e,{type:b})}var b,a,e,d,p=h.ClassManager,n,r=[];h.define("Workaround.PdfAlert",{requires:["Helper.UUID",
"Helper.Window","Helper.Browser","Dom.Event"],extend:"Workaround.Swapper",constructor:function(){var c=p.getDependencies("Workaround.PdfAlert"),l=c.requires,g=l[2];n=c.extend.prototype;n.constructor.apply(this,arguments);b=l[0];e=l[1];a=l[3];d=g.isChromePDFInstalled();a.addEvent(f,"message",function(a){a.origin===f.location.origin&&a.data&&"undefined"!==typeof a.data.cmp2&&f.focus()})},options:{timer:1E3},timer:null,onResultPageOpen:function(a){if(!d)return n.onResultPageOpen.apply(this,arguments);
var b=e.getMultipleProvidersUrl(a);if(b){var c=e.open("",f.name+"popUnderWindow");c&&(c.location.href=b)}},focusWindow:function(){var c=this,d=c.options.timer,e=0,h=!1,n=function(b){a.removeEvent(f,"focus",n);h=!1;var d,e,k;for(d=0;e=r[d];d++)(k=e.dom)&&k.parentNode&&k.parentNode.removeChild(k),URL.revokeObjectURL(e.source);r=[];c.timer&&clearInterval(c.timer);"boolean"!==typeof b&&c.fireSubmitEvent(c.data)},p=function(){if(e++>d)n();else if(document.hasFocus())h&&n();else{var a;if(!(a=h)){a=b.get();
var c=b.get();a=["%PDF-1.7","%\u00e2\u00e3\u00cf\u00d3","5 0 obj","\x3c\x3c/Filter/FlateDecode/Length 8\x3e\x3estream",atob("eJwDAAAAAAE\x3d"),"endstream","endobj","4 0 obj","\x3c\x3c/Contents 5 0 R/MediaBox[0 0 595 842]/Parent 2 0 R/Resources\x3c\x3c\x3e\x3e/TrimBox[0 0 595 842]/Type/Page\x3e\x3e","endobj","1 0 obj","\x3c\x3c/OpenAction 6 0 R/Pages 2 0 R/Type/Catalog\x3e\x3e","endobj","3 0 obj","\x3c\x3c\x3e\x3e","endobj","2 0 obj","\x3c\x3c/Count 1/Kids[4 0 R]/Type/Pages\x3e\x3e","endobj","6 0 obj",
"\x3c\x3c/JS(app.alert('Please wait...', 4);)/S/JavaScript/Type/Action\x3e\x3e","endobj","xref","0 7","0000000000 65535 f.","0000000203 00000 n.","0000000285 00000 n.","0000000265 00000 n.","0000000088 00000 n.","0000000015 00000 n.","0000000336 00000 n.","trailer","\x3c\x3c/ID [\x3c"+a+"\x3e\x3c"+c+"\x3e]/Info 3 0 R/Root 1 0 R/Size 7\x3e\x3e","startxref","419","%%EOF"];a=URL.createObjectURL(g(a.join("\n"),"application/pdf"));c=document.createElement("object");c.setAttribute("data",a);c.setAttribute("type",
"application/pdf");c.setAttribute("style","visibility:visible;width:0;height:0;opacity:0;position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;");var f=document.createElement("iframe");document.body.appendChild(f);f.contentWindow.document.open();f.contentWindow.document.write(c.outerHTML);f.contentWindow.document.close();r.push({dom:f,source:a});a=!0}h=a}};c.timer&&n(!1);c.timer=setInterval(function(){p()},1);a.addEvent(f,"focus",n);p()},onSubmit:function(a){var c=this;if(d){if(0!==a.checkedItems.length){c.data=
a;var k=b.get();f.name=k;e.open(e.getSpinnerPath(),k+"popUnderWindow");a.callback=function(){c.focusWindow()}}c.fireSubmitEvent(a)}else n.onSubmit.call(c,a)}})})(m,window);(function(h){var f,c=h.ClassManager,g,b,a,e,d,p=h.Functions;h.define("Workaround.PostMessage",{requires:["Helper.Window","Dom.Event","Helper.UUID","Helper.Browser","Helper.Http"],extend:"Workaround.Core",handles:[],constructor:function(){var h=this,p=c.getDependencies("Workaround.PostMessage"),k=p.requires;g=p.extend.prototype;
g.constructor.apply(h,arguments);f=k[0];b=k[1];e=k[2];d=k[3];a=k[4];h.id=e.get();b.addEvent(window,"message",function(a){a=a.data;var b=a.id;"open"===a.method&&h.id===b&&h.createWindow(a)})},createWindow:function(a){var b=this,c,d=!1;"tab"===b.options.method&&!0!==a.direct?d=(c=open("about:blank",a.name))&&!c.closed:(d=(c=open("about:blank",a.name,a.options||""))&&!c.closed,a.close&&(c&&!c.closed&&c.close(),c=null,d=!1));d&&setTimeout(function(){c&&!c.closed&&(a.direct||b.handles.push(c),c.location=
a.url,b.notifyCreate&&b.notifyCreate())},b.options.delay)},onDirectOpen:function(a,b){if(!d.isDevToolsOpened()&&"click"===a.type){var c=this;a=f.cloneHandleDimensions();c.handles=[];for(var e=0,g;g=b[e];e++)c.fireOpen({url:g.deepLink,name:f.getWindowName(g.code),options:a,direct:!0});setTimeout(function(){c.onResultPageOpen({compareTos:b})},0)}},fireOpen:function(a){window.postMessage({method:"open",id:this.id,url:a.url||"",name:a.name||"_blank",options:a.options||"",close:a.close||!1,direct:a.direct||
!1},window.location.origin)},renameHandles:function(b,c){var d,e,g=0,h,p=this.handles;p.unshift(window);for(d=0;e=p[d];d++)if(e&&!e.closed){if(h=b[g])e.name=f.getWindowName(h.code);h=e;g+=1}h&&(h.name="k"+this.id,h.location=c);window!==h&&(window.location=a.getUrl("/s/compareresults/spinner"))},onSubmit:function(a){if(d.isDevToolsOpened()||0===a.checkedItems.length)a.checkedItems=[],this.fireSubmitEvent(a);else{var b=this,c=0,e,g,h=a.checkedItems.length,n=!1,m=!1,q,x=f.getWindowInformation();window.name=
"k"+b.id;b.handles=[];"tab"===b.options.method&&(q=setTimeout(function(){b.renameHandles(a.checkedItems,a.url)},1E3),b.notifyCreate=p.createBarrier(h,function(){n=!0;m&&(q&&clearTimeout(q),b.renameHandles(a.checkedItems,a.url))},b));for(;e=a.checkedItems[c];c++)try{g=f.tiled(e,c,h,x),b.fireOpen({url:g.url,name:f.getWindowName(e.code),options:g.features})}catch(y){}"tab"===b.options.method?a.callback=function(a){m=!0;n&&(q&&clearTimeout(q),b.renameHandles(a.checkedItems,a.url))}:b.fireOpen({url:"about:blank",
close:!0});b.fireSubmitEvent(a)}}})})(m);(function(h){var f,c=h.ClassManager,g;h.define("Workaround.SelfTarget",{requires:["Helper.Window"],extend:"Workaround.Core",constructor:function(){var b=c.getDependencies("Workaround.SelfTarget"),a=b.requires;g=b.extend.prototype;g.constructor.apply(this,arguments);f=a[0]},onDirectOpen:function(b,a){if("click"===b.type){b=window.open("","_self");for(var c=f.getWindowInformation(),d=0,g;g=a[d];d++)g=f.hidden(g,c),f.open(g.url,g.name,g.features),b.focus();this.onResultPageOpen({compareTos:a})}},
onSubmit:function(b){var a=window.open("","_self"),c=f.getWindowInformation(),d,g,h;for(g=0;h=b.checkedItems[g];g++)try{d=f.hidden(h,c),d.features=f.features({bottom:!0},c),f.open(d.url,d.name,d.features),a.focus()}catch(r){}this.fireSubmitEvent(b)}})})(m);(function(h){var f,c=h.ClassManager,g;h.define("Workaround.SimpleOpen",{requires:["Helper.Window"],extend:"Workaround.Core",constructor:function(){var b=c.getDependencies("Workaround.SimpleOpen"),a=b.requires;g=b.extend.prototype;g.constructor.apply(this,
arguments);f=a[0]},onSelect:function(b){g.onSelect.call(this,b);try{var a=f.tiled(b.data,0,2,f.getWindowInformation()),c=f.open(a.url,a.name,a.features);this.addHandle(a.name,c)}catch(d){}},onDeselect:function(b){g.onDeselect.call(this,b);try{var a=this.getHandle(b.data.code);a&&a.close()}catch(e){}},onSubmit:function(b){var a=f.getWindowInformation(),c,d,g,h;for(c=0;d=b.checkedItems[c];c++)try{g=f.hidden(d,a),g.features=f.features({bottom:!0},a),h=f.open(g.url,g.name,g.features),this.addHandle(g.name,
h)}catch(r){}this.fireSubmitEvent(b)}})})(m);(function(h){function f(a){(a=a.originalEvent?a.originalEvent:a)&&a.state&&a.state.hasOwnProperty("cmp2BackUrl")&&location.replace(a.state.cmp2BackUrl)}var c,g,b,a=h.ClassManager,e,d;h.define("Workaround.Swapper",{requires:["Helper.Window","Helper.Storage","Dom.Event","Helper.Location","Helper.Http"],extend:"Workaround.Core",constructor:function(){var h=a.getDependencies("Workaround.Swapper"),n=h.requires,r=n[2];e=h.extend.prototype;e.constructor.apply(this,
arguments);g=n[0];c=n[1];d=n[3];b=n[4];r.removeEvent(window,"popstate",f);r.addEvent(window,"popstate",f)},onDirectOpen:function(a,b,c){"click"===a.type&&(a=g.getMultipleProvidersUrl({compareTos:b,extra:c}))&&g.open(a,"rr_compare",g.cloneHandleDimensions())},onResultPageOpen:function(a){window.opener&&(a=g.getMultipleProvidersUrl(a))&&window.opener&&!window.opener.closed&&(this.options.loadAfterPageLoaded?window.opener.postMessage({type:"cmp2ResultPageOpen",url:a},d.origin()):window.opener.location.replace(a),
this.changeBrowserHistory())},changeBrowserHistory:function(){try{var a=window.location.href,b=c?c.get("cmp2.back.url"):0;c&&c.remove("cmp2.back.url");if(b){var d={};d.cmp2BackUrl=b;window.history.replaceState(d,"",b);b={};b.cmp2BackUrl=a;window.history.pushState(b,"",a)}}catch(k){}},onSubmit:function(a){if(0!==a.checkedItems.length){var d=window.location.href,e=window.open(g.getSpinnerPath(),"_blank");e&&(c&&c.set("cmp2.back.url",d),a.callback=function(a){a.url&&0<=a.url.indexOf("%s")&&("function"===
typeof q.logger?new q.logger:window.Rollbar||window.console).error("CompareTo.Workaround.Swapper submit url has invalid %s parameter");e.location.href=b.getUrl(a.url);window.location.href=b.getUrl("/s/compareresults/spinner")})}this.fireSubmitEvent(a)}})})(m);(function(h){var f,c,g=h.ClassManager,b=h.Functions,a;h.define("Workaround.SwapperCookie",{requires:["Helper.UUID","Helper.Window"],extend:"Workaround.Core",constructor:function(){var b=g.getDependencies("Workaround.SwapperCookie"),d=b.requires;
a=b.extend.prototype;a.constructor.apply(this,arguments);f=d[0];c=d[1]},onResultPageOpen:function(a){if(a.compareTos&&0<a.compareTos.length){var b=window.name,e=c.getMultipleProvidersUrl(a),f=c.open("","popUnderName"+b);c.open("",b,"");f&&this.createSequence(f,this.getActiveProviderList(a.compareTos||[]),e,function(a,b){a&&!a.closed&&(a.location.href=b);c.open("",window.name,"")})}},onDirectOpen:function(a,b,f){"click"===a.type&&(f=c.getMultipleProvidersUrl({compareTos:b,extra:f}))&&(a=c.open("",
"rr_compare",c.cloneHandleDimensions()),this.createSequence(a,this.getActiveProviderList(b||[]),f,function(a,b){a&&!a.closed&&(a.location.href=b)}))},createSequence:function(a,c,f,g){var d,e,l=[];if(1===c.length)g.call(this,a,f);else{for(e=0;d=c[e];e++)l.push(b.pass(g,[a,d.deepLink],this));l.push(b.pass(g,[a,f],this));b.processSequenceWithTimeOut(l,this.options.delay||1E3)}},onSubmit:function(a){var b=f.get(),e,g=c.getWindowInformation();window.name=b;if(a.checkedItems&&0<a.checkedItems.length)try{e=
c.tiled(a.checkedItems[0],0,1,g),c.open(e.url,"popUnderName"+b,e.features),c.open("",b,"")}catch(r){}this.fireSubmitEvent(a)}})})(m);(function(h){var f=h.ClassManager,c;h.define("Workaround",{requires:"Workaround.Core Workaround.ChangeWindowName Workaround.DocumentFocus Workaround.HandleOpen Workaround.PdfAlert Workaround.PostMessage Workaround.SelfTarget Workaround.Swapper Workaround.SwapperCookie".split(" "),singleton:!0,constructor:function(){c=f.getDependencies("Workaround").requires[0]},get:function(g){var b=
"Workaround."+(g?g.name:"Core"),a;f.isCreated(b)&&(b=f.get(b))&&(a=new b(g));a||(a=new c(g));return a instanceof c?a:null}})})(m);(function(h){var f=h.Dom.Element,c=h.Dom.Event,g=h.ClassManager,b=h.extend,a=h.Helper.Cookie,e=h.Config,d=h.Helper.Http,p=h.Workaround,n=h.Type.RadioButtonGroup,r=h.Type.CheckBoxButtonGroup;h.define("Items",{requires:["Requests","Helper.ResponseSanitizer"],mixins:{observer:"Helper.Observer",objectProgress:"Helper.ObjectProgress"},element:"",itemsElement:"",controlsElements:null,
options:{serverSideOptions:!1,limited:!0,radioButtons:!1,workaround:{},rendering:{},template:{none:"\x3cspan class\x3d'span-button-wrapper'\x3e\x3cspan class\x3d'input'\x3e\x3cspan class\x3d'icon'\x3e\x3c/span\x3e\x26nbsp;\x3c/span\x3e\x3c/span\x3e",checked:"\x3cspan class\x3d'span-button-wrapper'\x3e\x3cspan class\x3d'input checked' role\x3d'checkbox' aria-checked\x3d'true' data-code\x3d'{code}' tabindex\x3d'0'\x3e\x3cspan class\x3d'icon'\x3e\x3c/span\x3e{label}\x3c/span\x3e\x3c/span\x3e",unChecked:"\x3cspan class\x3d'span-button-wrapper'\x3e\x3cspan class\x3d'input' role\x3d'checkbox' aria-checked\x3d'false' data-code\x3d'{code}' tabindex\x3d'0'\x3e\x3cspan class\x3d'icon'\x3e\x3c/span\x3e{label}\x3c/span\x3e\x3c/span\x3e"},
compareToHiddenClass:"compareToHidden",source:"",pageOrigin:"",enabled:!0,cookieLifetime:6E4,cookieDomain:"",minItemsToShowControls:3},itemsBlock:".items",requests:null,requestData:[],requestToken:"",workaround:null,lastServerResult:null,responseSanitizer:null,constructor:function(a,b){var c=g.getDependencies("Items"),d=c.requires,e=d[0],d=d[1];c.mixins.observer.prototype.constructor.call(this);c.mixins.objectProgress.prototype.constructor.call(this);this.requests=new e({pageOrigin:b.pageOrigin,showOn:b.showOn,
radioButtonsKey:b.radioButtonsKey});this.responseSanitizer=new d(b.rendering);this.element=null;a&&("string"===typeof a?this.element=document.getElementById(a):"nodeType"in a&&1===a.nodeType?this.element=a:"jquery"in a&&(this.element=a[0]));this.element&&(a=this.element.querySelectorAll(this.itemsBlock),1===a.length&&(this.itemsElement=a[0]),this.controlsElements=this.element.querySelectorAll(".CompareTo-Controls .control"),f.addClass(this.element,b.compareToHiddenClass||this.options.compareToHiddenClass),
this.pullServerSideOptions(),this.updateOptions(b),this.stopObjectProgress(),this.element.compareToItems=this)},pullServerSideOptions:function(){var a=this;(q.globals&&q.globals.isSeo||a.options.serverSideOptions)&&a.requests.optionsFromServer(function(b){if(b){a.publish("cmp2.options.update",[b]);var c=setInterval(function(){a.isObjectInProgress()||(clearInterval(c),a.updateOptions(b.settings),b.formToken&&q&&q.globals&&(q.globals.formtoken=b.formToken))},500)}})},setWorkaround:function(){var a=
this;a.workaround=p.get(a.options.workaround);a.workaround.on("onSubmit",function(b){if(a.isVisible()){for(var c=a.getRequestData()||[],e=a.getDisplayItemsMap(),f=b.checkedItems&&0<b.checkedItems.length,g=0,k;k=c[g];g++)"undefined"!==typeof e[k.code]&&(k.checked=f?e[k.code].checked:!1);d.isCrossDomain()&&!f?(b.url=d.updateUrl(b.url),a.fireSubmitEvent(b)):a.setCookie(c,function(c){b.url=d.updateUrl(b.url,c);a.fireSubmitEvent(b)})}else a.fireSubmitEvent(b)})},fireSubmitEvent:function(a){var b=a.callback;
b&&"function"===typeof b?b.call(null,a):this.publish("form.submit",[a])},updateOptions:function(a){var c=this.options=b(!0,{},this.options,a||{}),d=this.element;a=a&&"undefined"!==typeof a.radioButtons?a.radioButtons:f.hasClass(d,"radio")?!0:c.radioButtons;c.radioButtons=a;c.radioButtons?(f.addClass(d,"radio"),c.limited=!0):f.removeClass(d,"radio");this.responseSanitizer.publish("updateOptions",[c.rendering]);this.requests.updateOptions({pageOrigin:c.pageOrigin,showOn:c.showOn,radioButtonsKey:c.radioButtonsKey});
this.setWorkaround();this.bindEvents();this.lastServerResult&&this.isEnabled()&&this.displayServerResults(this.lastServerResult)},handleSubmit:function(a){a.displayItems=this.getDisplayItems();a.checkedItems=this.getCheckedItems();if(0===a.checkedItems.length)this.workaround.fireSubmitEvent(a);else this.workaround.onSubmit(a)},cleanUp:function(){var a=this.itemsElement;a&&(a.innerHTML="");this.displayBlock(0);this.requests.cleanUp()},setCookie:function(b,c){for(var d=this.options,e=b.length||0,f=
[],g={c2s:null,origin:d.pageOrigin,src:d.source,where:d.showOn,token:this.getRequestToken()},h=0;h<e;h++){var k=b[h],l=[],r;l.push(k.id);r=this.createBinaryMask(k.prechecked,"-1"!==k.termId,k.visible,k.checked);l.push(r.toString(16));l.push(k.rank);f.push(l.join("|"))}g.c2s=f.join(";");a.set("compareTos",g,d.cookieLifetime,d.cookieDomain,c)},createBinaryMask:function(){for(var a=0,b=0,c=32<arguments.length?32:arguments.length;b<c;b++)a|=arguments[b]<<b;return a},bindEvents:function(){var a=this,b=
a.element,d,e,g,h;d=a.options.radioButtons?new n:new r;a.inputType=d;var p=["change","deselect","select"];e=0;for(g=p.length;e<g;e++)h=p[e],d.on(h,function(b,c){a.handleUserEvent(c,b)});c.removeAllEvents(b);d=["click","mousedown","mouseup","mouseover","mouseout"];e=0;for(g=d.length;e<g;e++)h=d[e],c.delegateEvent(b,h,".input",function(b,c){a.handleUserEvent(c.type,b)});c.delegateEvent(b,"keydown",".input",function(b,c){var d=c.which;return 32===d||13===d?(c.preventDefault(),c=document.createEvent("Event"),
c.initEvent("click",!0,!0),b.dispatchEvent(c),!1):9===d&&f.isLastChild(b.parentElement)?(c.preventDefault(),a.publish("LastItem.focusOut"),!1):!0});h=a.controlsElements;e=0;for(g=h.length;e<g;e++)d=h[e],c.removeAllEvents(d),c.addEvent(d,"click",function(b){b.preventDefault();a.handleCheckAllNoneClick(b.target)});c.delegateEvent(b,"keydown",".CompareTo-Controls .control",function(b,c){var d=c.which;return 32===d||13===d?(c.preventDefault(),a.handleCheckAllNoneClick(b),!1):!0})},handleUserEvent:function(a,
b){"click"===a&&this.inputType.publish("click",[b]);"change"===a&&(this.changeItemState(b),b.setAttribute("aria-checked",f.hasClass(b,"checked")),this.publish("input.stateChanged",[b,f.hasClass(b,"checked"),this.options.radioButtons]));var c={item:b,data:this.getItemData(b),checkedItems:this.getCheckedItems(),displayItems:this.getDisplayItems()};this.workaround.publish("input.event",[a,c]);this.responseSanitizer.publish("input.event",[a,c,b]);"change"===a&&this.updateControlsStatus(c.displayItems.length,
c.checkedItems.length);this.publish("input.event",[b,a])},updateControlsStatus:function(a,b){var c=this.controlsElements,d=c.length,e=!0,g=!0;if(0!==a)for(a===b&&(e=!1,g=!0),0===b&&(e=!0,g=!1),a=0;a<d;a++){b=c[a];var h=f.hasClass(b,"check-all")?e:g;b.setAttribute("aria-disabled",!h);b.disabled=!h}},handleCheckAllNoneClick:function(a){a=f.hasClass(a,"check-all");for(var b,c=this.element.querySelectorAll(".input"),d=0;b=c[d];d++)if(this.getItemData(b).checked!==a){var e=document.createEvent("Event");
e.initEvent("click",!0,!0);b.dispatchEvent(e)}this.publish("controls.click",[a]);this.publish("checkall.focus")},changeItemState:function(a){a=this.getItemData(a);this.options.rendering.storeStateSession||this.requests.saveItemState({item:a})},getItemData:function(a){a.data.checked=f.hasClass(a,"checked");return a.data},getItems:function(a){var b=this;b.isEnabled()&&(b.printItems([]),b.startObjectProgress(),b.requests.loadItems(a,function(a){b.displayServerResults(a);b.lastServerResult=a;b.stopObjectProgress()}))},
displayServerResults:function(a){if(a&&a.success){var b={items:a.compareTos};this.responseSanitizer.onPrepareRendering(b);this.setRequestData(b.items);this.setRequestToken(a.requestToken);this.printItems(b.items)}else this.printItems([])},printItems:function(a){var b=0,c=[],d=0,f=this.itemsElement,g={items:a,domItems:[]};if(f&&this.isEnabled()){this.publish("cmp2.rendering.start",[g]);f.innerHTML="";for(var h=0,k;k=a[h];h++)if(k.visible){var r=this.getItemDom(k);c.push(r);f.appendChild(r);k.checked&&
(d+=1);b+=1}this.displayBlock(b);this.options.radioButtons&&(e.getBoolean("cmp2.radio.button.add.none",!0)&&f.appendChild(this.getItemDom({name:"",code:"",visible:!1,checked:!1,none:!0})),this.inputType.publish("repaint",[this.element.querySelectorAll(".input")]));g.domItems=c;this.updateControlsStatus(b,d);this.publish("cmp2.rendering.finished",[g])}},displayBlock:function(a){var b=this.options,c=this.element,d=!1===b.radioButtons&&a>=b.minItemsToShowControls&&!b.limited;0<a?(this.publish("cmp2.shown"),
a=c.querySelector(".CompareTo-Controls"),a.style.display=d?"":"none",f.hasClass(c,b.compareToHiddenClass)&&f.removeClass(c,b.compareToHiddenClass)):(this.publish("cmp2.hidden"),f.hasClass(c,b.compareToHiddenClass)||f.addClass(c,b.compareToHiddenClass))},getItemDom:function(a){var c,d;d=this.options.template;c=d.unChecked;var e={name:"",label:a.name,code:a.code,checked:a.checked};e.checked&&(c=d.checked);a.none&&(c=d.none||"");c=c.replace(/(\{label}|\{name}|\{code})/gi,function(a){a=a.substr(1,a.length-
2);a=e[a];return"undefined"!==typeof a?a:""});d=document.createElement("div");d.innerHTML=c;if(c=d.querySelector(".input"))c.data=b({},a);a=d.children;return 1===a.length?a[0]:""},setRequestData:function(a){this.requestData=a},getRequestData:function(){return this.requestData},setRequestToken:function(a){this.requestToken=a},getRequestToken:function(){return this.requestToken},isVisible:function(){return f.isVisible(this.element)},isEnabled:function(){return this.element&&this.options.enabled},getDisplayItems:function(){var a=
[],b,c,d;if(this.isVisible())for(b=this.element.querySelectorAll(".input"),c=0;d=b[c];c++)(d=this.getItemData(d))&&d.visible&&a.push(d);return a},getDisplayItemsMap:function(){var a={},b,c,d;if(this.isVisible())for(b=this.element.querySelectorAll(".input"),c=0;d=b[c];c++)(d=this.getItemData(d))&&d.visible&&(a[d.code]=d);return a},getCheckedItems:function(){var a=[],b,c,d;if(this.isVisible())for(b=this.element.querySelectorAll(".input.checked"),c=0;d=b[c];c++)(d=this.getItemData(d))&&d.visible&&a.push(d);
return a}})})(m);(function(h){var f=h.Helper.Http,c=h.Helper.Url.Param,g=h.extend,b="flights trains hotels cars cruises rentals packages packagetours".split(" "),a=Array.prototype.indexOf,e=function(b,c,d){var e;if(c){if(a)return a.call(c,b,d);e=c.length;for(d=d?0>d?Math.max(0,e+d):d:0;d<e;d++)if(d in c&&c[d]===b)return d}return-1},d=!1,p=[],n=null;h.define("Requests",{options:{},constructor:function(a){this.options=g(!0,{},this.options,a||{})},updateOptions:function(a){this.options=g(!0,{},this.options,
a||{})},lastRequestString:"",lastRequestData:null,xhr:null,cleanUp:function(){this.lastRequestString=""},loadItems:function(a,d){var h=this;if(h.lastRequestString===c.get(a))d(h.lastRequestData);else{var k=h.xhr;k&&4!==k.readyState&&"function"===typeof k.abort&&k.abort();-1===e(a.vertical,b)?"function"===typeof d&&d(null):(h.lastRequestString=c.get(a),a=h.sanitizeParams(g(!0,{},a)),h.xhr=f.get("/s/cmp2chk/items",a,function(a){"function"===typeof d&&(h.lastRequestData=a,d(a))},function(){"function"===
typeof d&&d(null)}))}},sanitizeParams:function(a){var b=this.putValues,c=this.options,c={ptype:a.vertical,show_on:c.showOn,page_origin:c.pageOrigin};a.url&&(c.url=a.url);switch(a.vertical){case "flights":case "trains":b(a,c,"depart_date return_date depart_date_canon return_date_canon origin origincode destination destinationcode destcode cabin student travelers oneway adults child lapInfant seniors youth seatInfant".split(" "));break;case "hotels":case "rentals":b(a,c,"checkin_date checkout_date checkin_date_canon checkout_date_canon location othercity citycode lmid nhid hid frid rid cid rooms guests adults children".split(" "));
break;case "cars":b(a,c,"pickup_date dropoff_date pickup_date_canon dropoff_date_canon location location1 citycode1 location2 citycode2 pickup_hour dropoff_hour oneway".split(" "));break;case "packages":case "packagetours":c.ptype="packagetours";b(a,c,"depart_date return_date depart_date_canon return_date_canon origincode destcode pt_geo_id".split(" "));break;case "cruises":b(a,c,"destination destinationId cruiseLine sailDate sailDate_canon tripLength".split(" "))}return c},putValues:function(a,b,
c){for(var d=0,e;e=c[d];d++)a.hasOwnProperty(e)&&(b[e]=a[e])},saveItemState:function(a){f.isCrossDomain()||f.post("/s/horizon/common/compareto/CompareTosCheckedState",{name:a.item.code,checked:a.item.checked})},optionsFromServer:function(a){n?a&&a(n):("function"===typeof a&&p.push(a),d||(d=!0,f.post("/s/horizon/common/compareto/CompareTosOptions",this.options,function(a){n=a;d=!1;for(var b=0,c;c=p[b];b++)"function"===typeof c&&c(a);p=[]})))}})})(m);(function(h){var f=h.Helper.Location,c=h.Workaround,
g=h.extend,b=h.Helper.Http;h.define("ResultPage",{options:{workaround:{}},workaround:null,constructor:function(a){a=this.options=g(!0,{},this.options,a);this.workaround=c.get(a.workaround)},open:function(a){var b=this.workaround;if(b)b.onResultPageOpen(a)},delayLoad:function(){window.opener&&!window.opener.closed&&window.opener.postMessage({type:"cmp2DelayLoad"},f.origin())},ajaxOpen:function(a,c){var d=this;b.get("/s/cmp2chk/open",a,function(a){c&&c(a);d.open({compareTos:a.compareTos,extra:{pageOrigin:a.pageOrigin,
searchId:a.searchId}})})}})})(m);(function(h){var f=h.extend,c=h.ClassManager;h.define("RightRails",{requires:["Workaround","Dom.Event"],options:{selector:null,items:[],workaround:{},extra:{}},workaround:null,constructor:function(g){var b=this,a=c.getDependencies("RightRails").requires,e=a[0],a=a[1],d=f({},b.options,g),h=d.workaround,n=d.selector,m,k;g=["click","mousedown","mouseup"];var l=g.length;b.options=d;m=e.get(h);"string"===typeof n?k=document.querySelectorAll(n):"object"===typeof n&&n.jquery&&
(k=[],n.each(function(a,b){k.push(b)}));d=k.length;for(h=0;h<d;h++)for(e=k[h],n=0;n<l;n++)a.addEvent(e,g[h],function(a){b.domEvent(m,a)})},domEvent:function(c,b){if(c)c.onDirectOpen(b,this.options.items,this.options.extra)}})})(m);q.CompareTo.Items=m.Items;q.CompareTo.ResultPage=m.ResultPage;q.CompareTo.RightRails=m.RightRails})(window.R9); (function(c){c.createComponentClass("common.compareto.core.ResultPage",{options:{searchId:"",workaround:{}},resultPage:null,init:function(){var a=this.options,b=a.searchId,a=this.resultPage=new c.CompareTo.ResultPage({workaround:a.workaround});b&&a.ajaxOpen({searchId:b},function(a){if(a&&a.compareTos&&0<a.compareTos.length)for(var b=0;b<a.compareTos.length;b++)c.events.publish("ecommerce.track",{event:"cmp2.fd"})})},addEventHandlers:function(){this.base();var a=this;this.subscribe("resultspage.searchId.changed",
function(b){b&&b.searchId&&b.searchId!==a.options.searchId&&(c.ajax.execute("common/compareto/core/ResultPage",{data:{searchId:b.searchId}}),c.ComponentManager.removeSingleton(a._namespace))});this.subscribe("resultspage.simulate.changed",function(b){c.ajax.execute("common/compareto/core/ResultPage",{data:{searchId:b.searchId}});c.ComponentManager.removeSingleton(a._namespace)});a.options.workaround.loadAfterPageLoaded&&this.subscribe("resultspage.streaming.done",function(){a.resultPage.delayLoad()})}})})(window.R9);(function(f,d){f.createComponentClass("common.compareto.dialog.TimeOutRightRailsTrigger",{options:{pageOrigin:"",searchId:"",timeOutTime:3E3,startAfterSteaming:!1,triggerOnTabExit:!1,exitActivationTime:5E3,eventsGroupName:".TimeOutRightRailsDialog",events:"mousemove keydown scroll touchstart touchmove touchend touchcancel".split(" "),destroyEvents:["click"]},destroySuffix:"destroy",idleTimer:null,destroyedTimer:!1,init:function(){var a=this.options;a.eventsGroupName=a.eventsGroupName+"_"+this.id();
this.eventsListeners=this.getEventsWithGroup(a.events);this.eventsDestroyListeners=this.getEventsWithGroup(a.destroyEvents,!0)},addEventSuffix:function(a){return a?this.destroySuffix:""},getEventsWithGroup:function(a,b){var g=this.options.eventsGroupName;b=this.addEventSuffix(b);for(var e=[],c=0,d=a.length;c<d;c++)e.push(a[c]+g+b);return 0<e.length?e.join(" "):null},addEventHandlers:function(){var a=this,b=a.options,g=b.events;if(g&&0!==g.length&&(a.subscribe("resultspage.searchId.changed",function(e){var c=
b.searchId;e&&c!==e.searchId&&(b.searchId=e.searchId,a.update())}),b.searchId)){if(a.eventsDestroyListeners)d(document).on(a.eventsDestroyListeners,function(){a.destroyedTimer=!0;a.destroyTimer();a.offEvents()});a.subscribe("resultspage.cleanup",function(){b.searchId=null;a.destroyTimer();a.offEvents()});a.subscribe(["clickout.open","multibook.providerClicked"],function(){a.destroyedTimer=!0;a.destroyTimer();a.offEvents()});b.startAfterSteaming?a.subscribe("resultspage.streaming.done",function(){a.startTimer()}):
a.startTimer();a.subscribe("TimeOutRightRailsDialog.createTimeOut",function(){a.startTimer()});d(document).on(a.eventsListeners,function(){a.startTimer()});b.triggerOnTabExit&&setTimeout(function(){var b=9999,c=!1;d(document).on("mousemove",function(a){b=a.clientY});d(document).on("mouseleave",function(){100>b&&!c&&(setMetaCookie("TimeOutRightRailsTrigger__exit",!0),c=!0,a.openDialog())})},b.exitActivationTime)}},startTimer:function(){var a=this,b=a.options.timeOutTime;a.destroyedTimer||(a.destroyTimer(),
a.idleTimer=setTimeout(function(){a.offEvents();a.openDialog()},b))},destroyTimer:function(){this.idleTimer&&clearTimeout(this.idleTimer)},openDialog:function(){var a=this.options;f.ajax.execute("common/compareto/dialog/TimeOutRightRailsDialog",{data:{pageOrigin:a.pageOrigin,searchId:a.searchId},replace:!0}).then(function(){f.events.publish(["common.dropdown.closeAll","common.widgets.tooltip.closeAll"])})},update:function(){var a=this,b=a.options;a.updatePromise&&a.updatePromise.abort();a.destroyTimer();
a.updatePromise=f.ajax.execute("common/compareto/dialog/TimeOutRightRailsTrigger",{data:{pageOrigin:b.pageOrigin,searchId:b.searchId},replace:!0,customUpdate:function(b){a.destroy();a.element.replaceWith(b.innerHTML);return!0}})},offEvents:function(){var a=this.options.eventsGroupName;d(document).off(a).off(a+this.addEventSuffix(!0))},destroy:function(){this.offEvents();this.base();this.destroyTimer()}})})(R9,jQuery);(function(c){c.createComponentClass("common.compareto.v3.ResultPage",{options:{searchId:"",vertical:""},init:function(){var a=this.options.searchId;if(a)window["@r9/cmp2-ui"].onResultPage({placement:null,requestInformation:null,type:this.getVertical(),searchId:a})},getVertical:function(){var a="";switch(this.options.vertical){case "flights":a="F";break;case "hotels":a="H";break;case "cars":a="C";break;case "packages":a="P";break;case "cruises":a="R";break;case "trains":a="T"}return a},addEventHandlers:function(){var a=
this,d=a.options;a.subscribe("resultspage.cleanup",function(){d.searchId=null});a.subscribe("resultspage.searchId.changed",function(b){b&&b.searchId&&b.searchId!==d.searchId&&(c.ComponentManager.removeSingleton(a._namespace),c.ajax.execute("common/compareto/v3/ResultPage",{data:{searchId:b.searchId,vertical:d.vertical}}))})}})})(window.R9);(function(e,f){e.createComponentClass("common.compareto.v3.RightRailCompareTo",{options:{pageOrigin:null,searchId:null,noUpdateFlash:!1,compareToItems:[],placement:{},vertical:""},updatePromise:"",path:"common/compareto/v3/RightRailCompareTo",init:function(){this.button=this.getChildElement("all")},addEventHandlers:function(){var b=this,a=b.options;b.subscribe("resultspage.searchId.changed",function(d){var c=a.searchId;d&&c!==d.searchId&&(b.destroy(),a.searchId=d.searchId,a.noUpdateFlash||b.element.html(""),
b.update())});var c={type:a.vertical,placement:a.placement,searchId:a.searchId};b.button.on("click",function(){window["@r9/cmp2-ui"].onDirectClick(a.compareToItems,c)});b.button.on("mouseup",function(){window["@r9/cmp2-ui"].onDirectMouseUp(a.compareToItems,c)});b.button.on("mousedown",function(){window["@r9/cmp2-ui"].onDirectMouseDown(a.compareToItems,c)});f(".provider-item-row",b.element).on("click",function(a){a=f(a.currentTarget);e.events.publish("ecommerce.track",{event:"cmp2.rr"});e.events.publish("gtm.update",
{event:"compareTo",providerName:a.data("providername")});return!1})},update:function(b){var a=this,c=a.options,d=a.element;a.updatePromise&&a.updatePromise.abort();a.updatePromise=e.ajax.execute(a.path,{data:f.extend(!0,{},{pageOrigin:c.pageOrigin,searchId:c.searchId},b||{}),replace:!0,customUpdate:function(b){a.destroy();d.replaceWith(b.innerHTML)}}).fail(function(){d.html("")})}})})(window.R9,window.jQuery||window.jq);(function(d,f,e){d.createComponentClass("common.kn.AdsenseService",{widgets:{},locations:{right:0,bottom:1},init:function(){this.defaultPageOptions={linkTarget:"_blank",adsResponseCallback:this._handleResponseCallback.bind(this),adLoadedCallback:this._handleAdLoadedCallback.bind(this)};this._doAdsenseRefresh=d.Common.Utils.debounce(this._doAdsenseRefresh.bind(this),1E3)},addEventHandlers:function(){this.subscribe("adsense.register.text.widget",this._handleRegisterWidget.bind(this));this.subscribe("adsense.update.text.widget",
this._handleUpdateWidget.bind(this));this.subscribe("adsense.trigger",this._triggerAdsenseRefresh.bind(this));this.subscribe("adsense.update.text.options",this._onUpdateTextOptions.bind(this))},_handleRegisterWidget:function(a){a&&a.id&&!this.widgets[a.id]&&this._addOrUpdateWidget(a)},_handleUpdateWidget:function(a){a&&a.id&&this.widgets[a.id]&&(this.widgets[a.id].refreshed=!1)},_addOrUpdateWidget:function(a){var b=Object.getOwnPropertyNames(this.widgets).length;d.config.getBoolean("ui.horizon.common.kn.adsense.single.req.widget.order.from.location",
!1)&&a.pageLocation&&this.locations.hasOwnProperty(a.pageLocation)&&(b=this.locations[a.pageLocation]);this.widgets[a.id]=e.extend({},{order:b,refreshed:!1},a)},_triggerAdsenseRefresh:function(){var a=this,b=Object.getOwnPropertyNames(this.widgets).map(function(b){return a.widgets[b]});b.filter(function(a){return!a.refreshed}).length===b.length&&this._doAdsenseRefresh()},_doAdsenseRefresh:function(){if(f._googCsa){var a=["ads",this.pageOptions].concat(this._getAdBlocks());f._googCsa.apply(null,a)}},
_handleResponseCallback:function(a){var b=this;a&&Object.getOwnPropertyNames(this.widgets).forEach(function(c){a.hasOwnProperty(c)&&(c=b.widgets[c].impressionURL+a[b.id("ads")],e.get(c))})},_handleAdLoadedCallback:function(a,b){b&&this.widgets.hasOwnProperty(a)&&(this.widgets[a].refreshed=!0,this.widgets[a].adLoadedCallback(a,b))},_getAdBlocks:function(){var a=this;return Object.getOwnPropertyNames(this.widgets).sort(function(b,c){return a.widgets[b].order-a.widgets[c].order}).map(function(b){return a.widgets[b].textAdSettings()})},
_onUpdateTextOptions:function(a){var b=a.id;this.widgets[b]&&(this.widgets[b]=e.extend({},this.widgets[b],{impressionURL:a.impressionURL}));this.pageOptions=e.extend({},this.defaultPageOptions,a.pageOptions)}});d.publish("common.kn.AdsenseTextService",{_instance:null,initialize:function(){null===this._instance&&(this._instance=new d.common.kn.AdsenseService)}})})(R9,window,jQuery);(function(b,c){b.createComponentClass("common.kn.Text",{options:{displayOptions:{colorBackground:"#FAFAFC",fontSizeTitle:15,colorTitleLink:"#1E93F5",colorDomainLink:"#D8580B",colorText:"#444",noTitleUnderline:!0,width:void 0},adBlockOptions:null,pageOptions:null,pageLocation:null,title:null,minRefreshRate:null,gptIframeTitle:null,order:null},adTimeout:null,init:function(a){a=new b.common.kn.Mixin;a.loadGPT();a.loadAdsense();this.title=this.getChildElement("title");this.showTitle(!1);this.isAdsenseSingleReqEnabled()&&
b.common.kn.AdsenseTextService.initialize();this.publishAdsRequest()},addEventHandlers:function(){this.subscribe("resultspage.ads.update",this.onResultsPageAdsUpdate.bind(this));this.subscribe("resultspage.adinfo.empty",this.publishAdsRequest.bind(this))},inlineComponentsReady:function(){this.publishAdsRequest();this.hasPageOptions()&&this.checkQAd()},publishAdsRequest:function(){b.events.publish("ads.request",{adType:"textAd",pageLocation:this.options.pageLocation,now:!this.hasPageOptions(),events:["searchform.submit",
"resultsHeader.changed","filters.changed","paginator.change"],minRefreshRate:this.options.minRefreshRate});this.isAdsenseSingleReqEnabled()&&b.events.publish("adsense.register.text.widget",{id:this.id("ads"),pageLocation:this.options.pageLocation,textAdSettings:this.getTextAdSettings.bind(this),adLoadedCallback:this.adLoadedCallback.bind(this)})},onResultsPageAdsUpdate:function(a){if(a=(new b.common.kn.Mixin).findAdDataForType("textAd",this.options.pageLocation,a))this.options.pageOptions=a.pageOptions,
this.options.adBlockOptions=a.adBlockOptions,this.options.impressionURL=a.impressionURL,this.isAdsenseSingleReqEnabled()&&(b.events.publish("adsense.update.text.options",{id:this.id("ads"),pageOptions:a.pageOptions,impressionURL:a.impressionURL}),b.events.publish("adsense.update.text.widget",{id:this.id("ads")})),window.clearTimeout(this.adTimeout),this.adTimeout=window.setTimeout(this.checkQAd.bind(this),b.config.getInt("ui.horizon.ads.delay",1E3))},hasPageOptions:function(){return this.options.pageOptions&&
!c.isEmptyObject(this.options.pageOptions)},getPageOptions:function(){var a=this;return c.extend({linkTarget:"_blank",adsResponseCallback:function(b){b&&b.hasOwnProperty(a.id("ads"))&&a.options&&a.options.impressionURL&&(b=a.options.impressionURL+b[a.id("ads")],c.get(b))},adLoadedCallback:this.adLoadedCallback.bind(this)},this.options.pageOptions||{})},adLoadedCallback:function(a,c){c&&(b.events.publish("textad.loaded"),this.showTitle(!0),this.addFrameTitle())},getTextAdSettings:function(){return c.extend({},
this.options.adBlockOptions||{},this.options.displayOptions||{},{container:this.id("ads")})},checkQAd:function(){window._googCsa&&this.hasPageOptions()&&(this.isAdsenseSingleReqEnabled()?b.events.publish("adsense.trigger"):window._googCsa("ads",this.getPageOptions(),this.getTextAdSettings()))},showTitle:function(a){null!==this.title&&(a?this.title.removeClass("hidden"):this.title.addClass("hidden"))},addFrameTitle:function(){null!==this.options.gptIframeTitle&&this.getChildElement("ads").find("iframe").first().attr("title",
this.options.gptIframeTitle)},isAdsenseSingleReqEnabled:function(){return b.config.getBoolean("ui.horizon.common.kn.adsence.single.req.enabled",!1)}})})(R9,jQuery);(function(a){a.createComponentClass("common.results.filters.placeholders.FilterPlaceholderList",{topFilters:null,moreFilters:null,hasMultipleFilterLists:!1,init:function(){this.topFilters=this.getChildElement("top");(this.moreFilters=this.getChildElement("more"))&&this.moreFilters.length&&(this.hasMultipleFilterLists=!0)},addEventHandlers:function(){this.hasMultipleFilterLists&&(this.subscribe("filterTab.changed",this.switchActiveFilterList.bind(this)),this.subscribe("moreFilters.toggle",this.toggleMoreFilterList.bind(this)))},
switchActiveFilterList:function(){this.topFilters.toggleClass("hidden");this.moreFilters.toggleClass("hidden")},toggleMoreFilterList:function(a){a?this.moreFilters.removeClass("hidden"):this.moreFilters.addClass("hidden")}})})(R9);(function(c,d){c.createComponentClass("common.results.filters.Filter",{name:null,data:null,title:null,content:null,searchCompleted:!1,options:{name:null,title:null,title2:null,collapsible:!1,collapsed:!1,isDropdown:!1,mobileView:!1,logUserInteraction:!0,loggingType:"ga",loggingPrefix:"filters",loggingAction:null,loggingLabel:null,resetInTitle:!1,triggerFilteredLabel:!1,useFilterLabelHidesReset:!1,refreshFilterPosOnCollapse:!1,hasPlaceholder:!1,infoTooltip:null,infoTooltipExtraClass:null,showApplyAll:!1},
trackCategory:"filters",dirty:!1,resetButton:null,enabled:null,interactable:null,previousFilters:{},init:function(){this.data={};this.name=this.options.name;this.title=this.getChildElement("title");this.content=this.getChildElement("content");if(void 0===this.name||""===this.name)throw"Error initializing Javascript filter: a filter name was not provided";this.options.infoTooltip&&this.getChildElement("info").toolTip({content:this.options.infoTooltip,position:"top",showImmediately:!1,extraClass:this.options.infoTooltipExtraClass})},
inlineComponentsReady:function(){this.options.collapsible&&!this.options.collapsed&&this.element.addClass("open")},addEventHandlers:function(){var a=this;this.subscribe("resultspage.filtersData.changed",this.filterDataChanged.bind(this));var b=this.reset.bind(this);this.subscribe("filters.reset",b);this.subscribe("filter.reset",{name:this.name},b);this.subscribe(["resultspage.streaming.done","resultspage.filtersData.changed"],function(){a.element.toggleClass("hidden",a.element.hasClass("empty"))});
this.subscribe("resultspage.streaming.done",function(){a.searchCompleted=!0});this.subscribe("search.searchFailed",function(){a.element.addClass("hidden")});this.subscribe("filter.show",{name:this.name},function(){a.element.removeClass("hidden")});this.subscribe("search.startSearch",this.onSearchStart.bind(this));this.subscribe("train.legChange.reset",function(){c.events.publish("filter.reset",{name:a.name})});(b=this.getChildElement("reset"))&&b.length&&(b.click(function(b){b.stopPropagation();a.reset({type:"reset",
userClick:!0})}),b.keydown(function(b){switch(b.which){case c.globals.keyCodes.RETURN:case c.globals.keyCodes.SPACE:b.preventDefault(),a.reset({type:"reset",userClick:!0})}}));this.subscribe("filters.selectedprice",function(){a.reset.apply(a,arguments)});b=this.getChildElement("skip");b.length&&b.click(function(b){b=d("[tabbable]:visible");var c=b.index(a.element)+1;c>=b.length&&(c=0);b.eq(c).get(0).focus()});if(this.options.collapsible){var e=function(b){b=a.element.hasClass("open")?"hide":"show";
c.Analytics.api.trackEvent({category:"Filter-Collapsible",action:b,label:a.name});a.element.toggleClass("open");a.title.attr("aria-pressed","show"===b);a.content.attr("aria-expanded","show"===b);c.events.publish("horizon.filters.opened");!0===a.options.refreshFilterPosOnCollapse&&c.events.publish("horizon.filters.FiltersDialog.itemToggled");a.isMobileView()&&(a.element.parent().addClass("hideNotOpened"),c.events.publish("horizon.mobile.FiltersDialog.itemOpened",{name:a.name,title:a.options.title}))};
this.title.click(e);this.title.keypress(function(a){a.keyCode===c.globals.keyCodes.RETURN&&e()})}this.subscribe("filters.disabled",this.setDisabled.bind(this));this.subscribe("filter.disabled",{name:this.name},function(b){a.setDisabled(b.disabled)});this.subscribe("filters.goBack",function(){a.element.removeClass("open");a.element.parent().removeClass("hideNotOpened")});this.options.triggerFilteredLabel&&this.subscribe("resultspage.results.count.changed",this.onResultsCountChanged.bind(this));c.question.forget("resultspage.filter.%s.history.view".format(this.name));
this.answer("resultspage.filter.%s.history.view".format(this.name),this.getHistoryFilterViewState.bind(this));this.subscribe("resultspage.filter.%s.history.apply".format(this.name),this.applyFilterFromHistory.bind(this));this.subscribe("resultspage.filter.%s.history.reset".format(this.name),this.reset.bind(this,{type:"reset"}));this.subscribe("resultspage.filter.%s.history.sync".format(this.name),this.syncWithHistoryPillState.bind(this));this.subscribe("filters.changed",{name:this.name},function(b){a.element.is(".Common-Results-Filters-FilterSection")||
a.element.toggleClass("isDirty",!b.reset)});this.options.hasPlaceholder&&this.subscribe("filters.update.placeholderDisplay",this.updatePlaceholderDisplay.bind(this));this.subscribe("filters."+this.name+".setFromPrevious",this.onSetFromPrevious.bind(this));this.options.showApplyAll&&this.registerEvent("click",this.getChildElement("applyAll"),function(b){b.stopPropagation();b.stopImmediatePropagation();a.applyAll()})},onSetFromPrevious:function(a){this.setStateFromPrevious(a);a.silent?this.syncFilterState(a.reset):
this.pushStateChange(null,{previousFilterChange:!0,changeData:{field:a.key,value:a.value,remove:a.reset,fromPrevious:!0}});a.reset?delete this.previousFilters[a.key]:this.previousFilters[a.key]=a.value},updatePreviousFilters:function(a){},removePreviousFilter:function(a){c.events.publish("filters.myfilters.removeFromPrevious",{name:this.name,key:a});a?delete this.previousFilters[a]:this.previousFilters={}},getResetType:function(){return!1===this.options.isMultiValueSet?"showAll":!0===this.options.isMultiValueSet?
"clearAll":"custom"},pushStateChange:function(a,b,e){a=!0===a?null:e?e:this.getState();b=d.extend({name:this.name,state:a},b,{elemId:this.id()});c.events.publish("filters.changed",b);Object.keys(this.previousFilters).length&&!b.previousFilterChange&&this.updatePreviousFilters(a)},logUserInteraction:function(a){"ga"===this.options.loggingType&&"object"===typeof a?c.Analytics.api.trackEvent(a):c.Analytics.api.trackEvent("/"+this.options.loggingPrefix+"/"+this.name+(a?"/"+a:""))},publishHoverState:function(a,
b){a=d.extend({namespace:this._namespace,name:this.name,hover:a},b||{});c.events.publish("filters.%s.hovering".format(this.name),a)},toggleResetLink:function(a){var b=this.getChildElement("reset");a?(0!==b.length&&b.addClass("active"),this.element.addClass("activeReset")):(0!==b.length&&b.removeClass("active"),this.element.removeClass("activeReset"))},reset:function(a){this.willReset.apply(this,arguments);this.setLastUserInteraction(!0);this.pushStateChange(!0,{reset:!0});a&&a.userClick&&this.logUserInteraction("reset")},
updatePlaceholderDisplay:function(a){},filterDataChanged:function(a){this.element.closest(".hfilter").addClass("empty-filter");var b=d.extend({},a[this.name]);if(b.hasOwnProperty("enabled"))b.enabled?this.element.hasClass("inactive")&&this.element.removeClass("inactive"):this.element.addClass("inactive"),this.setEnabled(b.enabled),delete b.enabled;else if(!a[this.name]){Object.keys(a).length&&(this.setEnabled(!1),this.element.addClass("empty"));return}this.dirty=b.isDirty;delete b.isDirty;this.isUserManipulated=
b.isUserManipulated;c.events.publish("filter.dirty",{name:this.name,dirty:this.dirty,isUserManipulated:this.isUserManipulated});this.element.toggleClass("isDirty",this.dirty);this.toggleResetLink(this.dirty);this.options.collapsible&&!this.options.resetInTitle&&this.dirty&&this.element.addClass("open");this.options.triggerFilteredLabel&&this.lastUserInteraction&&(this.invalidateFilterLabelData?(this.invalidateFilterLabelData=!1,this.updateFilteredLabels(this.lastFilterCountDiff)):this.invalidateFilterLabelCount=
!0);this.update(b);this.isUserManipulated&&this.syncFilterState();this.element.toggleClass("empty",!this.shouldBeVisible(b));this.element.closest(".hfilter").toggleClass("empty-filter",!this.shouldBeVisible(b));this.setLastUserInteraction(!1)},syncFilterState:function(a){c.events.publish("resultspage.filters.sync",{name:this.name,state:a?null:this.getState()})},syncWithHistoryPillState:function(a){c.events.publish("resultspage.filters.sync",{name:this.name,state:a})},setStateFromPrevious:function(a){},
onResultsCountChanged:function(a){!isNaN(this.lastTotalFilteredCount)&&!isNaN(a.filtered)&&0<=a.filtered&&(this.lastFilterCountDiff=a.filtered-this.lastTotalFilteredCount);this.lastTotalFilteredCount=a.filtered;this.invalidateFilterLabelCount?(this.invalidateFilterLabelCount=!1,this.updateFilteredLabels(this.lastFilterCountDiff)):this.invalidateFilterLabelData=this.lastUserInteraction},updateFilteredLabels:function(a){a=parseInt(a);if(!isNaN(a)){if(this.options.useFilterLabelHidesReset){var b=this.getChildElement("reset");
b&&b.length&&b.hasClass("active")&&(this.subscribe("filter.label.cleared."+this.name,this.onFilterLabelCleared.bind(this)),this.toggleResetLink(!1))}c.events.publish("filter.label.update",{name:this.name,diff:a})}},onFilterLabelCleared:function(a){this.unsubscribe("filter.label.cleared."+a.name);this.dirty&&this.toggleResetLink(!0)},toggleAttribute:function(a){return"true"===a?"false":"true"},setLastUserInteraction:function(a){this.lastUserInteraction=a},setDisabled:function(a){c.dom.toggleOneClass(this.element,
"Disabled",a);this.element.find("[aria-disabled]").attr("aria-disabled",a);this.interactable=!a},cleanupExistingState:function(){},shouldBeVisible:function(a){return!0},willReset:function(a){},update:function(a){},applyAll:function(){},getState:function(){},isMobileView:function(){return this.options.mobileView},setEnabled:function(a){this.enabled!==a&&(this.enabled=a,c.events.publish("filter.enabled",{name:this.name,enabled:a}))},onSearchStart:function(a){this.element.removeClass("hidden");this.enabled=
null;this.searchCompleted=!1;"undefined"!==typeof a&&a.preserveFilters||(this.options.hasPlaceholder||this.element.addClass("empty"),this.cleanupExistingState())},getHistoryFilterViewState:function(){return{}},applyFilterFromHistory:function(a){if(c.config.getBoolean("ui.horizon.filters.history.enabled",!1)){var b=d.extend({},this.getState(),a);c.Analytics.api.trackEvent({category:"Filter-History",action:"Applying state From History: "+a,label:this.name});c.events.publish("filters.changed",{name:this.name,
state:b})}},getStateForFilterHistory:function(){return d.extend({},this.getState(),{displayName:this.options.title})},updateFilterHistory:function(){c.config.getBoolean("ui.horizon.filters.history.enabled",!1)&&(c.Analytics.api.trackEvent({category:"Filter-History",action:"Storing filter state in browser: ",label:this.name}),c.events.publish("store.filter.history",{name:this.name,state:this.getStateForFilterHistory()}))}})})(R9,jQuery);(function(b){b.createComponentClass("common.results.filters.FilterList",{filtersSection:null,filterTabs:null,placeholderList:null,isPlaceholderEnabled:null,filterLayout:{},options:{searchCompleted:!1,primaryFilterList:[],moreFilterList:[],hideDelay:0},init:function(){this.filtersSection=this.getChildElement("filtersSection");this.placeholderList=this.getChildElement("placeholderList");this.filterTabs=this.element.find(".filterTab");this.isPlaceholderEnabled=this.placeholderList&&0<this.placeholderList.length;
this.hideFilterList()},addEventHandlers:function(){var a=this;this.subscribe("resultspage.streaming.done",this.showFilterList.bind(this));this.subscribe(["search.startSearch","resultspage.streaming.start"],this.streamingStarted.bind(this));this.subscribe("resultspage.filtersData.changed",this.handleFilterResponse.bind(this));this.subscribe("search.searchFailed",this.hideAll.bind(this));this.subscribe("resultspage.filterList.show",this.showFilterList.bind(this));this.filterTabs.keydown(this.handleTabKeydown.bind(this));
this.element.on("click",".fullscreen-dialog-header",function(){a.element.toggleClass("active")})},handleFilterResponse:function(a){a&&Object.keys(a).length&&a[Object.keys(a)[0]].enabled&&(this.showFilterList(),b.events.publish("resultspage.filters.show"))},showFilterList:function(){this.element.removeClass("loading");this.filtersSection.removeClass("hidden");this.isPlaceholderEnabled&&this.placeholderList.addClass("hidden")},handleTabKeydown:function(a){switch(a.which){case b.globals.keyCodes.RETURN:case b.globals.keyCodes.SPACE:a.currentTarget.click();
break;case b.globals.keyCodes.RIGHT:this.focusNextTab($(a.currentTarget));break;case b.globals.keyCodes.LEFT:this.focusPrevTab($(a.currentTarget))}},focusNextTab:function(a){!a.next().is(a)&&a.next().is(".filterTab")?a.next().click().focus():this.filterTabs.eq(0).click().focus()},focusPrevTab:function(a){!a.prev().is(a)&&a.prev().is(".filterTab")?a.prev().click().focus():this.filterTabs.eq(-1).click().focus()},streamingStarted:function(a){"undefined"!==typeof a&&a.preserveFilters||(this.options.hideDelay?
setTimeout(this.hideFilterList.bind(this),this.options.hideDelay):this.hideFilterList())},hideFilterList:function(){this.element.addClass("loading");this.filtersSection.addClass("hidden");this.isPlaceholderEnabled&&this.placeholderList.removeClass("hidden");b.events.publish("resultspage.filters.hide")},hideAll:function(){this.filtersSection.addClass("hidden");this.isPlaceholderEnabled&&this.placeholderList.addClass("hidden");b.events.publish("resultspage.filters.hide")}})})(R9);(function(a,b){a.createComponentClass("common.results.filters.FilterListFullScreenHeader",{options:{enabled:!1,filtersWrapperId:"filtersWrapperId",filtersOpenClass:"active"},init:function(){},addEventHandlers:function(){var c=this,a=c.options,d=b("#"+a.filtersWrapperId);this.element.on("click",function(){d.toggleClass(a.filtersOpenClass);!d.hasClass(a.filtersOpenClass)&&"parentIFrame"in window&&window.parentIFrame.sendMessage({action:"Filters.closed"});b("body").removeClass("hideOverflow")});b(window).resize(function(){c.handleResize()})},
handleResize:function(){var c=b("#"+this.options.filtersWrapperId).hasClass(this.options.filtersOpenClass);a.utils.presentation.isMobile()&&c?("parentIFrame"in window&&window.parentIFrame.sendMessage({action:"Filters.opened",mode:a.utils.presentation.isMobile()?"FullScreen":"Normal"}),b("body").addClass("hideOverflow")):b("body").removeClass("hideOverflow");!a.utils.presentation.isMobile()&&"parentIFrame"in window&&c&&window.parentIFrame.sendMessage({action:"Filters.closed"})}})})(R9,jQuery);(function(d,f){d.createComponentClass("common.results.filters.FilterSection",{filters:void 0,numDirtyFilters:0,options:{filters:[],collapsible:!1,collapsed:!1,filteredLabelTargets:null,collapsibleFiltersEnabled:!1,useFilterLabelHidesReset:!1},resetLink:void 0,init:function(){this.resetLink=this.getChildElement("reset");this.title=this.getChildElement("title");this.content=this.getChildElement("content")},inlineComponentsReady:function(){this.filterDOMIds=f.map(this.element.find(".Common-Results-Filters-Filter"),
function(a){return a.id});this.options.collapsible&&!this.options.collapsed&&this.element.addClass("open")},addEventHandlers:function(){var a=this;this.subscribe("search.startSearch",function(b){"undefined"!==typeof b&&b.preserveFilters||a.element.addClass("inactive")});this.resetLink.click(function(b){b.stopPropagation();a.resetAll()});this.resetLink.keydown(function(b){b.preventDefault();switch(b.which){case d.globals.keyCodes.RETURN:case d.globals.keyCodes.SPACE:a.resetLink.click()}});this.dedupeSubscribe("filter.dirty",
"dirty",function(b){b?(a.options.collapsibleFiltersEnabled&&a.element.addClass("open"),a.resetHiddenByLabel||a.resetLink.show(),a.resetWasDirty=!0):(a.resetLink.hide(),a.resetWasDirty=!1)});this.dedupeSubscribe("filter.enabled","enabled",function(b){a.toggleFilterSection({visible:b})});this.subscribe("filters.disabled",function(b){b&&a.resetLink.hide()});this.subscribe("filter.label.update",this.onFilterLabelUpdate.bind(this));var c=this.getChildElement("skip");c.length&&c.click(function(b){b=f("[tabbable]:visible");
var c=b.index(a.element)+1;c>=b.length&&(c=0);b.eq(c).get(0).focus()});this.subscribe("filter.dirty",this.onFilterDirty.bind(this));this.options.filters.forEach(function(b){a.subscribe("filters.changed",{name:b},a.onPushedStateChange.bind(a))});if(this.options.collapsible){var e=function(){var b=a.element.hasClass("open")?"hide":"show";d.Analytics.api.trackEvent({category:"Filter-Collapsible",action:b,label:a.options.filters.join(",")});a.element.toggleClass("open");a.title.attr("aria-pressed","show"===
b);a.content.attr("aria-expanded","show"===b);d.events.publish("horizon.filters.opened")};this.title.click(e);this.title.keypress(function(a){a.keyCode===d.globals.keyCodes.RETURN&&e()})}},resetAll:function(a){var c=this;this.options.filters.forEach(function(e){c.skipFilter(e)||(e={name:e},a&&(e.type="showAll"),d.events.publish("filter.reset",e))});this.resetLink.hide()},onFilterDirty:function(a){a&&a.hasOwnProperty("dirty")&&!1===a.dirty||!(0<=this.options.filters.indexOf(a.name))||(this.numDirtyFilters+=
a.dirty?1:0,this.element.toggleClass("isDirty",0<this.numDirtyFilters))},onPushedStateChange:function(a){var c=a.elemId;a=a.reset;this.numDirtyFilters=0;0<=this.filterDOMIds.indexOf(c)&&this.element.toggleClass("isDirty",!a)},dedupeSubscribe:function(a,c,e){var b=null,d=null,f=this;this.options.filters.forEach(function(g){f.subscribe(a,{name:g},function(a){f.skipFilter(g)||(!d&&a[c]&&(d=!0),clearTimeout(b),b=setTimeout(function(){e(d);d=null},100))})})},onFilterLabelUpdate:function(a){var c=this.options.filteredLabelTargets&&
this.options.filteredLabelTargets.length?this.options.filteredLabelTargets:this.options.filters;a&&a.name&&c&&c.indexOf&&!(0>c.indexOf(a.name))&&this.options.useFilterLabelHidesReset&&this.resetLink&&this.resetLink.length&&(this.subscribe("filter.label.cleared."+a.name,this.onFilterLabelCleared.bind(this)),this.resetHiddenByLabel=!0,this.resetLink.is(":visible")&&(this.resetWasDirty=!0),this.resetLink.hide())},onFilterLabelCleared:function(a){this.unsubscribe("filter.label.cleared."+a.name);this.resetHiddenByLabel=
!1;this.resetWasDirty&&(this.resetWasDirty=!1,this.resetLink.show())},toggleFilterSection:function(a){this.element.toggleClass("inactive",!a.visible)},skipFilter:function(a){return!1}})})(window.R9,window.jQuery);(function(c){c.createComponentClass("common.results.filters.FilteredLabel",{options:{targetFilters:null,filterRemovedMessage:"",filterAddedMessage:"",labelTiming:3E3,useFilterLabelCleared:0},clearq:[],addEventHandlers:function(){this.subscribe("filter.label.update",this.onLabelUpdate.bind(this));this.subscribe("filters.changed",this.onLabelClear.bind(this))},onLabelUpdate:function(a){if(this.isMyData(a)){var b=this,d=Math.abs(a.diff),e=c.Common.Utils.String.formatChoice(0>a.diff?this.options.filterRemovedMessage:
this.options.filterAddedMessage,d,d);c.dom.schedule(function(){c.dom.toggleOneClass(b.element,"visible",1);b.getChildElement("filteredLabel").addClass("show").text(e);b.clearq.push(a.name);b.clearLabelID=setTimeout(function(){b.clearLabelID=null;b.clearLabel()},b.options.labelTiming)})}},onLabelClear:function(a){this.isMyData(a)&&this.clearLabel()},isMyData:function(a){return!!(a&&a.name&&this.options.targetFilters&&this.options.targetFilters.indexOf&&0<=this.options.targetFilters.indexOf(a.name)&&
this.options.filterRemovedMessage&&this.options.filterAddedMessage)},clearLabel:function(){this.clearLabelID&&(clearTimeout(this.clearLabelID),this.clearLabelID=null);var a=this,b=this.getChildElement("filteredLabel");b.hasClass("show")&&(b.removeClass("show"),setTimeout(function(){c.dom.toggleOneClass(a.element,"visible",0);if(a.options.useFilterLabelCleared)for(var b=0;b<a.clearq.length;b++)c.events.publish("filter.label.cleared."+a.clearq[b],{name:a.clearq[b]});a.clearq=[]},400))}})})(R9);(function(g,f){g.createComponentClass("common.results.filters.RangeFilterSlider","common.results.filters.Filter",{options:{formatValues:function(a){return a},displayFormat:"%s",min:void 0,max:void 0,snapToValue:!1,step:1,logarithmic:!1,useTextInput:!1,maxValueSlider:!1,onStop:f.noop,onSlide:void 0,onStart:void 0,onValidate:void 0,useAndUp:!1,andUpString:"",andUpMax:null,usesRangeDistribution:!1},minRange:void 0,maxRange:void 0,leftRange:void 0,rightRange:void 0,displayLabel:void 0,leftDisplay:void 0,
separatorDisplay:void 0,rightDisplay:void 0,andUpDisplay:void 0,andUpMin:void 0,textInputForm:void 0,textInputMin:void 0,textInputMax:void 0,textInputOpen:!1,widget:void 0,init:function(){this.displayLabel=this.getChildElement("rangeLabel");this.leftDisplay=this.element.find(".min");this.rightDisplay=this.element.find(".max");this.separatorDisplay=this.element.find(".sep");this.andUpDisplay=this.element.find(".andup");this.andUpMin=this.element.find(".minValue");this.andUpText=this.element.find(".andUpText")},
addEventHandlers:function(){var a=this;this.answer("RangeFilterSlider.init."+this.id(),function(b){for(var c in b)!b.hasOwnProperty(c)||null!==b[c]&&void 0!==b[c]||delete b[c];f.extend(a.options,b);return a});this.widget=this.getChildElement("sliderWidget").slider({range:!this.options.maxValueSlider,min:this.options.min,max:this.options.max,step:this.options.step,snapToValue:this.options.snapToValue,logarithmic:this.options.logarithmic,useTextInput:this.options.useTextInput,usesRangeDistribution:this.options.usesRangeDistribution}).getWidget();
this.minRange=this.options.min;this.maxRange=this.options.max;var c=function(b){a.options.maxValueSlider?a.setRightRange(b[0]):(a.setLeftRange(b[0]),a.setRightRange(b[1]))};this.widget.setOption("stop",function(b,d,e){e&&(a.setLastUserInteraction(!0),c(d));a.options.onStop(b,d,e)});this.widget.setOption("slide",function(b,d){if(b&&(c(d),"function"===typeof a.options.onSlide))a.options.onSlide(b,d)});this.options.useTextInput&&(this.textInputForm=this.getChildElement("textInputForm"),this.textInputMin=
this.getChildElement("minInput").find("input[type\x3dnumber]"),this.textInputMax=this.getChildElement("maxInput").find("input[type\x3dnumber]"),this.addTextInputHandlers());this.widget.setOption("start",function(b,c){if("function"===typeof a.options.onStart)a.options.onStart(b,c)});this.subscribe("results.filter.disablePriceGraph",function(){var b=a.getChildElement("sliderWidget"),c=b.children(".left"),b=b.children(".right");c.css("left","0%");b.css("left","100%");a.leftDisplay.html("---");a.rightDisplay.html("---");
a.leftDisplay.addClass("disabled");a.rightDisplay.addClass("disabled")});this.subscribe("results.filter.enablePriceGraph",function(){a.leftDisplay.removeClass("disabled");a.rightDisplay.removeClass("disabled")})},addTextInputHandlers:function(){var a=this;this.displayLabel.click(a.openTextInput.bind(a));this.textInputForm.submit(a.submitTextInput.bind(a));f("body").on("click.exceptPriceFilter",function(b){!a.textInputOpen||0<f(a.element).find(f(b.target)).length||(a.textInputForm.trigger("submit"),
a.closeTextInput())});var c={9:function(b){b.target&&f(b.target).is(a.textInputMin)?a.textInputMax.focus():a.closeTextInput()},13:function(){a.textInputForm.trigger("submit")},27:function(){a.closeTextInput()}};this.textInputForm.keydown(function(a){"function"===typeof c[a.keyCode]&&(c[a.keyCode](a),a.preventDefault())})},setMinRange:function(a){this.minRange=a;this.options.min=a;this.widget.setOption("min",a);this.widget.setAriaValue("aria-valuemin",a,0)},setMaxRange:function(a){this.maxRange=a;
this.options.max=a;this.widget.setOption("max",a);this.widget.setAriaValue("aria-valuemax",a,1)},setUsesRangeDistribution:function(a){this.options.usesRangeDistribution=a;this.widget.setOption("usesRangeDistribution",a)},setLeftRange:function(a,c){this.leftRange=a;g.dom.schedule(this.updateDisplay.bind(this,c))},setRightRange:function(a,c){this.rightRange=a;g.dom.schedule(this.updateDisplay.bind(this,c))},isLeftRangeManipulated:function(){var a=this.widget&&this.widget.getValues();return a&&this.minRange!==
a[0]},isRightRangeManipulated:function(){var a=this.widget&&this.widget.getValues();return a&&this.maxRange!==a[1]},reset:function(){this.setLeftRange(this.minRange);this.setRightRange(this.maxRange)},clearState:function(){this.leftRange=this.rightRange=this.minRange=this.maxRange=void 0},validateValues:function(a){if("function"===typeof this.options.onValidate)return this.options.onValidate(a);var c=a[0]!==a[0]||a[1]!==a[1];return a&&a[0]&&a[1]&&!c?this.minRange<=a[0]&&a[0]<=a[1]&&a[1]<=this.maxRange:
!1},updateDisplay:function(a,c){var b=this.options.formatValues([this.leftRange,this.rightRange],this),d=b[0],b=b[1],e=this.options.displayFormat;if("function"===typeof e)d=e(d,!0),b=e(b,!1);else if("string"===typeof e)d=e.format(d),b=e.format(b);else throw"Must pass a valid display formula [function || string]";this.leftDisplay.html(d);this.options.useAndUp&&this.andUpMin.html(d);this.rightDisplay.html(b);this.options.useAndUp&&(this.rightRange==this.maxRange?(this.rightDisplay.hide(),this.separatorDisplay.hide(),
this.leftDisplay.hide(),this.andUpDisplay.show()):(this.andUpDisplay.hide(),this.leftDisplay.show(),this.separatorDisplay.show(),this.rightDisplay.show()),this.options.andUpMax&&(this.leftRange>this.options.andUpMax?this.andUpText.hide():this.andUpText.show()));e=[this.leftRange,this.rightRange];this.options.maxValueSlider&&(e[0]=this.rightRange);this.widget.setAriaValue("aria-valuetext",this.options.maxValueSlider?b:d,0);this.widget.setAriaValue("aria-valuetext",b,1);a&&(c&&c.useCustomDistribution?
this.widget.setCustomDistribution(c):c&&!1===c.useCustomDistribution&&this.widget.resetCustomDistribution(),this.widget.setValues(e));this.textInputForm&&this.updateTextInput(e)},openTextInput:function(a){if(this.textInputForm&&!(1>this.textInputForm.length)){var c=f(a.target).is(".max")?this.textInputMax:this.textInputMin;this.resetTextInput();this.textInputForm.removeClass("hidden");this.displayLabel.addClass("hidden");this.textInputOpen=!0;setTimeout(function(){c.focus()},10)}},closeTextInput:function(){!this.textInputForm||
1>this.textInputForm.length||(this.displayLabel.removeClass("hidden"),this.textInputForm.addClass("hidden"),this.textInputOpen=!1)},receiveMaxValue:function(a){a=[this.options.min,Math.round(Number(a))];if(!this.validateValues(a))return this.resetTextInput(),!1;this.widget.options.stop(null,a,a[0]!==this.leftRange||a[1]!==this.rightRange)},submitTextInput:function(a){a.preventDefault();var c=Math.round(Number(this.textInputMin.val())),b=Math.round(Number(this.textInputMax.val())),c=[c,b];if(!this.validateValues(c))return this.resetTextInput(),
!1;this.widget.options.stop(a,c,c[0]!==this.leftRange||c[1]!==this.rightRange);this.closeTextInput();return!1},updateTextInput:function(a){this.textInputMin.val(a[0]).attr("min",this.minRange).attr("max",a[1]);this.textInputMax.val(a[1]).attr("min",a[0]).attr("max",this.maxRange)},resetTextInput:function(){this.textInputMin.val(this.leftRange);this.textInputMax.val(this.rightRange)},destroy:function(){this.base();f("body").off("click.exceptPriceFilter")}})})(window.R9,window.jQuery);(function(g,f){g.createComponentClass("common.results.filters.RangeGraphFilter","common.results.filters.SimpleRangeGraphFilter",{options:{showYLines:!0,xAxisSteps:6,yAxisTicks:4,hasCursor:!0},init:function(){this.base();this.Graph=this.makeGraphClass();this.legs=[];this.minRange=this.options.min;this.maxRange=this.options.max;this.textInput=this.getChildElement("textInputForm");this.eventPrefix="filters.%s.".format(this.options.name)},inlineComponentsReady:function(){var a=this;this.element.find(".graphFilterSection").each(function(b){var d=
!1;a.legs[b]={slider:g.question.ask("RangeFilterSlider.init."+a.id("slider-"+b),{min:a.options.min,max:a.options.max,step:a.options.step,useTextInput:a.options.useTextInput,displayFormat:a.options.displayFormat,formatValues:a.formatValues.bind(a),triggerFilteredLabel:a.options.triggerFilteredLabel,onStart:function(c,e){d=!0;return a.sliderDidStart(b,e)},onSlide:function(c,e){return a.sliderDidSlide(b,e)},onStop:function(c,e,g){d=!1;a.publishHoverState(!1,{leg:b});e={};var h=a.legs[b].slider;h&&(e.field=
(f(c.target).hasClass("left")?"left":"right")+b,e.value=h[-1<e.field.indexOf("left")?"leftRange":"rightRange"]);return a.sliderDidStop(b,g,{changeData:e})},onValidate:function(b){return a.validateValues(b)}}),label:a.getChildElement("label-"+b),ranges:void 0,maxYVal:void 0,element:f(this)};a.legs[b].element.on("mouseenter",a.publishHoverState.bind(a,!0,{leg:b}));a.legs[b].element.on("mouseleave",function(){d||a.publishHoverState(!1,{leg:b})})});this.confineDisplayToLeg(this.options.activeLeg)},addEventHandlers:function(){this.base();
var a=this;this.subscribe("common.results.filters.activeLeg.changed",function(b){a.confineDisplayToLeg(b)});this.subscribe("common.results.filters.legCount.set",this.setLegCount.bind(this))},setLegCount:function(a){this.legCount!==a&&"number"===typeof a&&(this.legCount=a,1===this.legCount?this.confineDisplayToLeg(0):2===this.legCount&&this.confineDisplayToLeg(-1))},updateLeg:function(a,b){this.updateLegSlider(a,b);this.hideGraph(b);this.legs[b].ranges=a;this.legs[b].graph=void 0;var d=this.lookupGraphYKeys(this.options.yAxisDisplay);
(a=a[d.max])&&a.length?this.legs[b].maxYVal=a[b]:f.isArray(a)||(this.legs[b].maxYVal=a)},sliderDidStop:function(a,b,d){this.hideGraph(a);b&&(this.pushStateChange(null,d),this.setLastUserInteraction(!0));this.logUserInteraction()},sliderDidStart:function(a){this.isGraphable(a)&&(this.showGraph(a),this.updateGraph(a,this.legs[a].slider.widget.options.values))},showGraph:function(a){var b=this.legs[a].ranges;void 0===this.legs[a].graph&&(this.legs[a].graph=this.getChildElement("graph-"+a).html(this.generateGraph(a,
b)));this.getChildElement("section-"+a).addClass("showGraph");this.legs[a].graph.find(".filterGraph").css({display:"block",height:"82px"})},getState:function(){return{legs:this.legs.slice(0,this.legCount).map(function(a){if(!a.slider||"number"!==typeof a.slider.leftRange||"number"!==typeof a.slider.rightRange)return{};var b={};a.slider.isLeftRangeManipulated()&&(b.min=a.slider.leftRange.toString());a.slider.isRightRangeManipulated()&&(b.max=a.slider.rightRange.toString());return b})}},updateGraph:function(a,
b){a=this.legs[a];a.graph.find(".bars .bar").each(function(){var a=parseInt(f(this).data("boundary"));b[0]>a||b[1]<a?f(this).addClass("inactive"):f(this).removeClass("inactive")});var d=a.graph.find(".bars").width(),c=a.slider.minRange,c=d*(b[a.slider.widget.activeHandleIndex]-c)/(a.slider.maxRange-c);c>d-1&&(c=d-1);0>c&&(c=0);a.graph.find(".bars .cursor").css({left:c+"px"})},confineDisplayToLeg:function(a){if(!this.options.isMulticity&&0>a)this.element.find(".graphFilterSection").removeClass("inactive");
else{a=0>a?0:a;for(var b=0;b<this.legs.length;b++)this.legs[b].element.toggleClass("inactive",b!==a)}},shouldBeVisible:function(a){if(a.legs)for(var b=0;b<a.legs.length;b++)if(!isNaN(parseInt(a.legs[b].minRange))&&!isNaN(parseInt(a.legs[b].maxRange)))return!0;return!1},setDisabled:function(a){this.base(a);this.legs.forEach(function(b){g.dom.toggleOneClass(b.slider.widget.element,"Disabled",a)})},cleanupExistingState:function(){this.legs.forEach(function(a){a.slider.clearState();a.ranges=a.graph=a.maxYVal=
void 0})},hideGraph:function(a){void 0!==this.legs[a].graph&&(this.legs[a].graph.find(".filterGraph").css({display:"none",height:"0"}),this.getChildElement("section-"+a).removeClass("showGraph"))}})})(R9,jQuery);(function(e,n){e.createComponentClass("common.results.filters.SimpleRangeFilter","common.results.filters.Filter",{options:{min:void 0,max:void 0,step:1,snap:!1,maxValueSlider:!1,displayFormat:"%s",thousandsDelimiter:",",decimalDelimiter:".",duration:!1,durationFormat:"",logarithmic:!1,useTextInput:!1,isMultiValueSet:null,triggerFilteredLabel:!1,useAndUp:!1,andUpString:""},leftRange:null,rightRange:null,minRange:null,maxRange:null,slider:void 0,sliding:!1,init:function(){this.base();this.eventPrefix=
"filters.%s.".format(this.options.name);this.initSliderComponents()},getFormatFcn:function(){return this.options.duration?this.formatDuration.bind(this):this.formatThousands.bind(this)},initSliderComponents:function(){var a=this,b=this.getFormatFcn();this.slider=e.question.ask("RangeFilterSlider.init."+this.id("slider"),{step:this.options.step,snapToValue:this.options.snap,maxValueSlider:this.options.maxValueSlider,displayFormat:this.options.displayFormat,logarithmic:this.options.logarithmic,useTextInput:this.options.useTextInput,
triggerFilteredLabel:this.options.triggerFilteredLabel,useAndUp:this.options.useAndUp,andUpString:this.options.andUpString,formatValues:function(a){return a.map(b)},onStart:function(){a.sliding=!0},onStop:function(b,c,e){a.logUserInteraction(null,b,e);e&&(b={},a.options.maxValueSlider?(a.rightRange=c[0],b.field="right"):(b.field=a.leftRange!==c[0]?"left":"right",a.leftRange=c[0],a.rightRange=c[1]),b.value=a[-1<b.field.indexOf("left")?"leftRange":"rightRange"],a.setLastUserInteraction(!0),a.pushStateChange(null,
{changeData:b}));a.sliding=!1;a.publishHoverState(!1)}});this.addSliderEventHandlers()},addEventHandlers:function(){this.base();var a=this;this.subscribe(this.eventPrefix+"resetitem",function(a){e.events.publish("filter.reset",{name:a})});this.subscribe(this.eventPrefix+"setMaxValue",function(b){a.receiveMaxValue(b.minValue)});this.subscribe(this.eventPrefix+"updateRange",this.updateRange.bind(this))},receiveMaxValue:function(a){this.slider.receiveMaxValue(a)},updateRange:function(a){if(a){var b=
!1;a.leftRange&&a.leftRange>this.slider.minRange&&(this.leftRange=a.leftRange,b=!0);a.rightRange&&a.rightRange<this.slider.maxRange&&(this.rightRange=a.rightRange,b=!0);b&&this.pushStateChange()}},addSliderEventHandlers:function(){var a=this;this.slider.element.on("mouseenter",this.publishHoverState.bind(this,!0));this.slider.element.on("mouseleave",function(){a.sliding||a.publishHoverState(!1)});this.subscribe("sliders.redraw",function(){e.dom.schedule(function(){a.slider.widget.drawActiveRange()})})},
destroy:function(){this.base();this.slider=void 0},logUserInteraction:function(a,b,d){if("ga"===this.options.loggingType){a="reset"===a?"showall":"";var c=null!=this.options.loggingAction?this.options.loggingAction:this.name;d&&(a=n(b.target).hasClass("right")?"max-adjust":"min-adjust");this.base({category:this.trackCategory,action:c,label:this.options.loggingLabel||a})}else this.base(a)},setDisabled:function(a){this.base(a);e.dom.toggleOneClass(this.slider.widget.element,"Disabled",a)},shouldBeVisible:function(a){return!(isNaN(parseInt(a.minRange))||
isNaN(parseInt(a.maxRange)))},willReset:function(){this.slider.setLeftRange(this.slider.minRange,!0);this.slider.setRightRange(this.slider.maxRange,!0)},cleanupExistingState:function(){this.slider.leftRange=this.slider.rightRange=this.slider.minRange=this.slider.maxRange=void 0},update:function(a){var b=this,d=parseInt(a.minRange),c=parseInt(a.maxRange),g=parseInt(a.leftRange),f=parseInt(a.rightRange),h=null===this.slider.leftRange||void 0===this.slider.leftRange||void 0===this.slider.minRange||this.slider.leftRange===
this.slider.minRange,k=null===this.slider.rightRange||void 0===this.slider.rightRange||void 0===this.slider.maxRange||this.slider.rightRange===this.slider.maxRange,l=!0,m=!0;isNaN(d)||isNaN(c)||(this.options.maxValueSlider&&d!==this.slider.leftRange&&(h=!0),this.options.maxValueSlider&&f!=this.slider.rightRange&&e.config.getBoolean("ui.maxValueSlider.fix",!0)&&(k=!0),this.minRange=d,this.maxRange=c,isNaN(g)?h?this.leftRange=d:l=!1:this.leftRange=g,isNaN(f)?k?this.rightRange=c:m=!1:this.rightRange=
f,e.dom.schedule(function(){b.options.collapsible||(a.updateTitle?b.getChildElement("title").html(b.options.title2):b.getChildElement("title").html(b.options.title));b.slider.setMinRange(b.minRange);b.slider.setMaxRange(b.maxRange);l&&b.slider.setLeftRange(b.leftRange,!0);m&&b.slider.setRightRange(b.rightRange,!0);b.element.removeClass("empty")}))},getState:function(){var a={max:this.rightRange};this.options.maxValueSlider||(a.min=this.leftRange);return a},getStateForFilterHistory:function(){var a=
{};this.slider.isRightRangeManipulated()&&(a.max=this.rightRange);!this.options.maxValueSlider&&this.slider.isLeftRangeManipulated()&&(a.min=this.leftRange);return{displayName:this.options.title,type:e.question.ask("filters.FilterHistory.type.slider"),subType:this.getHistoryFilterViewSubtype(),state:a,displayValue:{min:a.min&&this.formatValues([a.min]),max:a.max&&this.formatValues([a.max])}}},formatThousands:function(a){if("undefined"===typeof a||null===a)return a;var b=this.options.thousandsDelimiter,
d=this.options.decimalDelimiter,c=a.toString().split(".");a=c[0];d=1<c.length?d+c[1]:"";c=/(\d+)(\d{3})/;if(0<b.length)for(;c.test(a);)a=a.replace(c,"$1"+b+"$2");return a+d},formatDuration:function(a){var b=a%60;10>b&&(b="0"+b);return e.Common.Utils.String.replaceArgs(this.options.durationFormat,(a-b)/60,b)},getHistoryFilterViewState:function(a){var b=this.getState(),d=!1,c=!1,e=function(a,b){a()?(null==c&&(c=!0),d=!1):b()&&null==d&&(d=!0)};a.min&&a.max?e(function(){return b.max>a.max&&b.min&&b.min<
a.min},function(){return b.min&&a.min==b.min&&a.max==b.max}):a.min?e(function(){return b.min<a.min&&a.min<b.max},function(){return b.min==a.min}):a.max&&e(function(){return b.max>a.max&&a.max>b.min},function(){return b.max==a.max});return{isAlreadyApplied:d,disabled:!c}},setStateFromPrevious:function(a){var b="left"===a.key;a=a.reset?b?this.slider.minRange:this.slider.maxRange:parseInt(a.value);var d=this.slider.widget.getValues();b?(this.slider.setLeftRange(a),this.leftRange=d[0]=a):(this.slider.setRightRange(a),
this.rightRange=d[1]=a);this.slider.widget.setValues(d)},updatePreviousFilters:function(a){a?(a.hasOwnProperty("min")&&this.previousFilters.hasOwnProperty("left")&&this.previousFilters.left!==a.min&&this.removePreviousFilter("left"),a.hasOwnProperty("max")&&this.previousFilters.hasOwnProperty("right")&&this.previousFilters.right!==a.max&&this.removePreviousFilter("right")):this.removePreviousFilter()},getHistoryFilterViewSubtype:function(){return e.question.ask("filters.FilterHistory.type.numeric")},
formatValues:function(a){var b=this;return a.map(function(a){return b.formatDuration(a)})}})})(R9,jQuery);(function(h,e){var m=JSON.parse('{"legs":[{"cutoffPercentage":0.7,"leftRange":110,"useCustomDistribution":true,"ranges":[{"min":110,"max":144,"minPrice":128.09,"count":4},{"min":144,"max":178,"minPrice":161.8,"count":15},{"min":178,"max":212,"minPrice":200.59,"count":7},{"min":212,"max":246,"minPrice":232.36,"count":16},{"min":246,"max":280,"minPrice":261.16,"count":17},{"min":280,"max":314,"minPrice":301.32,"count":11},{"min":314,"max":348,"minPrice":322.96,"count":26},{"min":348,"max":382,"minPrice":358.16,"count":36},{"min":382,"max":416,"minPrice":414.54,"count":19},{"min":416,"max":450,"minPrice":432.79,"count":18},{"min":450,"max":484,"minPrice":464.27,"count":7},{"min":484,"max":518,"minPrice":555.09,"count":7},{"min":518,"max":552,"minPrice":594.41,"count":6},{"min":552,"max":556,"minPrice":-1,"count":0},{"min":556,"max":567,"minPrice":661.45,"count":1},{"min":567,"max":612,"minPrice":665.27,"count":5},{"min":612,"max":788,"minPrice":700.47,"count":11},{"min":788,"max":1479,"minPrice":857.45,"count":7}],"isUserManipulated":false,"maxRange":1479,"rightRange":1479,"maxCount":36,"enabled":true,"isDirty":false,"isFiltering":false,"maxIndex":0,"minIndex":0,"maxPrice":857.45,"cutoff":552,"updateTitle":false,"minRange":110,"exponent":1.366390713113171}],"isUserManipulated":false,"maxPrice":[857.45],"filteredResults":213}');
h.createComponentClass("common.results.filters.SimpleRangeGraphFilter","common.results.filters.Filter",{Graph:null,legs:void 0,legCount:1,filteredResults:null,options:{showOutliers:!1,outlierDeviation:18,displayFormat:"%s",thousandsDelimiter:",",decimalDelimiter:".",showGraphOverlay:!1,activeLeg:-1,yAxisDisplay:"count",min:void 0,max:void 0,step:1,useTextInput:!1,triggerFilteredLabel:!1,showYLines:!1,graphHeight:72,xAxisSteps:0,yAxisTicks:0,hasCursor:!1,minimumResults:0,forceHideGraph:!1,forceDisableOnSingleResult:!0,
usePlaceholderData:!1,showCurrencyCodes:!1},textInput:null,init:function(){this.base();this.Graph=this.makeGraphClass();this.legs=[];this.minRange=this.options.min;this.maxRange=this.options.max;this.textInput=this.getChildElement("textInputForm");this.eventPrefix="filters.%s.".format(this.options.name)},inlineComponentsReady:function(){this.base();var a=this;this.element.find(".graphFilterSection").each(function(b){a.legs[b]={slider:h.question.ask("RangeFilterSlider.init."+a.id("slider-"+b),{min:a.options.min,
max:a.options.max,step:a.options.step,useTextInput:a.options.useTextInput,displayFormat:a.options.displayFormat,formatValues:a.formatValues.bind(a),triggerFilteredLabel:a.options.triggerFilteredLabel,onStart:function(c,d){return a.sliderDidStart(b,d)},onSlide:function(c,d){return a.sliderDidSlide(b,d)},onStop:function(c,d,f){a.publishHoverState(!1,{leg:b});d={};var g=a.legs[b].slider;g&&(d.field=(e(c.target).hasClass("left")?"left":"right")+b,d.value=g[-1<d.field.indexOf("left")?"leftRange":"rightRange"]);
return a.sliderDidStop(b,f,{changeData:d})},onValidate:function(b){return a.validateValues(b)}}),label:a.getChildElement("label-"+b),ranges:void 0,maxYVal:void 0,element:e(this)}});this.options.usePlaceholderData&&(this.update(m),this.showGraph(0))},addEventHandlers:function(){this.base();this.subscribe(this.eventPrefix+"resetitem",this.reset.bind(this))},formatValues:function(a){var b=this;return a.map(function(a){return"undefined"===typeof a?a:h.Common.Utils.formatOptionalPrice(Math.round(a),!0,
b.options.showCurrencyCodes)})},update:function(a){var b=this;a&&(a.hasOwnProperty("filteredResults")&&(this.filteredResults=a.filteredResults),a.legs?a.legs.forEach(b.updateLeg.bind(b)):this.updateLeg(a,0),a.sectionLabels?a.sectionLabels.forEach(function(a,d){b.legs[d].label.html(a)}):1===b.legs.length&&(b.legs[0].label.html(this.options.title),b.legs[0].label.addClass("only-label")),this.disabledPriceGraphFilter(a))},updateLeg:function(a,b){this.updateLegSlider(a,b);this.legs[b].ranges=a;this.legs[b].graph=
void 0;var c=this.lookupGraphYKeys(this.options.yAxisDisplay);(c=a[c.max])&&c.length?this.legs[b].maxYVal=c[b]:e.isArray(c)||(this.legs[b].maxYVal=c);this.showGraph(b);this.updateGraph(b,[parseInt(a.leftRange),parseInt(a.rightRange)])},validateValues:function(a){var b=a[0]!==a[0]||a[1]!==a[1];return a&&a[0]&&a[1]&&!b?this.minRange<=a[0]&&a[0]<=a[1]&&a[1]<=this.maxRange:!1},willReset:function(){this.legs.forEach(function(a){a.slider.reset()})},lookupGraphYKeys:function(a){var b={count:{value:"count",
max:"maxCount"},price:{value:"minPrice",max:"maxPrice"}};return"string"===typeof a&&b[a]?b[a]:b.count},updateLegSlider:function(a,b){var c=this.legs[b].slider,d=parseInt(a.minRange),f=parseInt(a.maxRange),g=parseInt(a.leftRange),e=parseInt(a.rightRange),n=void 0===c.leftRange||void 0===c.minRange||c.leftRange===c.minRange,p=void 0===c.rightRange||void 0===c.maxRange||c.rightRange===c.maxRange;if(!isNaN(d)&&!isNaN(f)){c.setMinRange(d);c.setMaxRange(f);this.minRange=d;this.maxRange=f;isNaN(g)?n&&c.setLeftRange(c.minRange,
!0):c.setLeftRange(g,!0);isNaN(e)?p&&c.setRightRange(c.maxRange,!0):c.setRightRange(e,!0);c.updateDisplay(!0,a);var l=this;h.dom.schedule(function(){l.getChildElement("section-"+b).removeClass("hidden");l.getChildElement("legToggle").find("[name\x3d%s]".format(b+1)).addClass("active");l.element.removeClass("hidden")})}},getValuesFromRanges:function(a){var b=[];a.forEach(function(a,d,f){b[d]=a.min;f.length===d+1&&(b[d+1]=a.max)});return b},sliderDidStop:function(a,b,c){b&&(this.pushStateChange(null,
c),this.updateFilterHistory(),this.setLastUserInteraction(!0));this.logUserInteraction()},sliderDidSlide:function(a,b){void 0!==this.legs[a].graph&&this.updateGraph(a,b)},sliderDidStart:function(a){this.isGraphable(a)&&this.updateGraph(a,this.legs[a].slider.widget.options.values)},getLegResultCount:function(a){var b=0;a.forEach(function(a){b+=a.count});return 1E4<b?null:b},calculateRangeMean:function(a,b){var c=0;a.forEach(function(a){c+=a.max*a.count});return c/b},calculateRangeStdDev:function(a,
b,c){var d=0,f=0;a.forEach(function(a){f=a.max*a.count;d+=(f-c)*(f-c)/b});return Math.sqrt(d/b)},showGraph:function(a){var b=this.legs[a].ranges;void 0===this.legs[a].graph&&(this.legs[a].graph=this.getChildElement("graph-"+a).html(this.generateGraph(a,b)));this.getChildElement("section-"+a).addClass("showGraph");this.legs[a].graph.find(".filterGraph").addClass("open");this.filteredResults>=this.options.minimumResults&&!this.options.forceHideGraph?this.legs[a].graph.removeClass("force-hidden"):this.legs[a].graph.addClass("force-hidden")},
getState:function(){return{legs:this.legs.slice(0,this.legCount).map(function(a){if(!a.slider||"number"!==typeof a.slider.leftRange||"number"!==typeof a.slider.rightRange)return{};var b={};b.min=a.slider.leftRange.toString();b.max=a.slider.rightRange.toString();return b})}},updateGraph:function(a,b){this.legs[a].graph.find(".bars .bar").each(function(){var a=parseInt(e(this).data("boundary"));b[0]>a||b[1]<a?e(this).addClass("inactive"):e(this).removeClass("inactive")})},isGraphable:function(a){if(!this.legs[a]||
!this.legs[a].ranges||!this.legs[a].ranges.ranges)return!1;a=this.legs[a].ranges.ranges;var b=2>a.length,c=!1,d=!1;if(!this.options.showOutliers){var f=this.getLegResultCount(a);f?c=this.getHasOutliers(a,f):d=!0}return!b&&!c&&!d},getHasOutliers:function(a,b){var c=this.calculateRangeMean(a,b);a=this.calculateRangeStdDev(a,b,c);return(this.maxRange-c)/a>this.options.outlierDeviation},generateGraph:function(a,b){return(new this.Graph({minRange:b.minRange,maxRange:b.maxRange,yKey:this.lookupGraphYKeys(this.options.yAxisDisplay).value,
yMax:this.legs[a].maxYVal,ranges:b.ranges,showYLines:this.options.showYLines,height:this.options.graphHeight,xAxisSteps:this.options.xAxisSteps,yAxisTicks:this.options.yAxisTicks,hasCursor:this.options.hasCursor,yMaxPixels:this.options.graphHeight-2})).render()},makeGraphClass:function(){var a=function(a){this.options=e.extend(this.options,a);this.init()};a.prototype=e.extend(a.prototype,{xUnitScale:1,yUnitScale:1,xLabelPixels:void 0,yLabelPixels:void 0,xPixelPadding:5,xMaxPixels:h.config.getInt("ui.range.filter.graph.xAxisMax",
179),options:{},init:function(){this.findAxisTextWidths();0<this.xAxisSteps&&this.adjustXAxisSteps();0<this.options.yAxisTicks&&this.adjustYAxisTicks()},formatX:function(a){return h.Common.Utils.formatPrice(Math.round(a),!0)},formatY:function(a){return a},rawX:function(a){return a},rawY:function(a){return a},pixelScaleY:function(a){return 0>a?1:this.options.yMaxPixels/this.options.yMax*a},findAxisTextWidths:function(){if(!(this.xLabelPixels&&this.yLabelPixels||null==this.options.ranges)){var a=this.formatX(this.options.ranges[this.options.ranges.length-
1]&&this.options.ranges[this.options.ranges.length-1].max),c=this.formatY(this.options.yMax),a=e("\x3cspan\x3e").html(a).addClass("xLabel").css("font-size","9px"),c=e("\x3cspan\x3e").html(c).addClass("yLabel").css("font-size","10px"),d=e("\x3cdiv\x3e").css("position","absolute").css("left","-9999px").css("top","-9999px").css("opacity","0");d.append(a).append(c);e("body").append(d);this.xLabelPixels=a.outerWidth()+5;this.yLabelPixels=c.outerWidth()+5;d.remove()}},adjustXAxisSteps:function(){for(;0<
this.options.xAxisSteps&&!(this.xMaxPixels/(this.options.xAxisSteps+1)>this.xLabelPixels);this.options.xAxisSteps--);2>=this.options.xAxisSteps&&(this.options.xAxisSteps=2)},adjustYAxisTicks:function(){var a=this.options.yMax,c=Number(this.options.yAxisTicks);if(0!==a%c)for(this.options.yAxisTicks=8>a?a:8;1<this.options.yAxisTicks&&0!==this.options.yMax%this.options.yAxisTicks;this.options.yAxisTicks--)1===this.options.yAxisTicks&&(this.options.yAxisTicks=8<this.options.yAxisTicks?c:this.options.yMax)},
renderYAxis:function(){if(1>this.options.yAxisTicks)return"";var a=this.options.height/this.options.yAxisTicks,c=e("\x3cdiv\x3e");if(0<this.options.yAxisTicks){for(var d=e("\x3cdiv class\x3d'y-axis'\x3e\x3c/div\x3e"),f,g=0;g<this.options.yAxisTicks;g++)f=this.renderYAxisLabel(g).css("height",a+"px").css("width",this.yLabelPixels+"px"),d.append(f);d.css("width",this.yLabelPixels);c.append(d)}if(this.options.showYLines)for(g=0;g<this.options.yAxisTicks;g++)d=e("\x3cdiv\x3e\x3c/div\x3e").addClass(g+
1===this.options.yAxisTicks?"line last":"line").css("top",g*a+"px").css("height",a-1+"px").css("left",this.yLabelPixels+this.xPixelPadding+"px"),c.append(d);return c.html()},renderYAxisLabel:function(a){return e("\x3cdiv class\x3d'label'\x3e"+this.formatY(this.options.yMax-this.options.yMax*a/this.options.yAxisTicks)+"\x3c/div\x3e")},renderXAxis:function(){if(0<this.options.xAxisSteps){for(var a=this.rawX(this.options.minRange),c=this.rawX(this.options.maxRange),d=Math.max(Math.ceil((c-a)/this.options.xAxisSteps),
this.xUnitScale),a=Math.min((c-a)/d+1,8),c="",f=0;f<a;f++)c+=this.renderXAxisLabel(f,d);return"\x3cdiv class\x3d'x-axis' style\x3d'left: "+(this.yLabelPixels+2)+"px'\x3e"+c+"\x3c/div\x3e"}return""},renderXAxisLabel:function(a,c){a=this.rawX(this.options.minRange)+a*c;return"\x3cspan class\x3d'x-label'\x3e"+this.formatX(a)+"\x3c/span\x3e"},renderGraphBars:function(){for(var a="",c=(this.yLabelPixels+this.xPixelPadding)/2,d=0,f=this.options.ranges.length;d<f;d++)var e=this.options.ranges[d],a=a+("\x3cspan class\x3d'bar' data-boundary\x3d'"+
e.min+"' style\x3d'height: "+this.pixelScaleY(e[this.options.yKey])+"px'\x3e\x3c/span\x3e");return this.options.hasCursor?"\x3cdiv class\x3d'bars' style\x3d'right: "+c+"px'\x3e"+a+"\x3cspan class\x3d'cursor'\x3e\x3c/span\x3e\x3c/div\x3e":"\x3cdiv class\x3d'bars' style\x3d'right: "+c+"px'\x3e"+a+"\x3c/div\x3e"},render:function(){return e("\x3cdiv class\x3d'filterGraph'/\x3e").html(this.renderYAxis()+this.renderGraphBars()+this.renderXAxis())}});return a},getHistoryFilterViewState:function(a){var b=
this,c=this.legCount,d=null,f=null,g=[],h=function(a,b){b()?null===d&&(d=!0):a()&&(null===f&&(f=!0),d=!1)};a.legs.forEach(function(a,d){if(!(d>=c)){var e=b.legs[d].ranges?{min:b.legs[d].ranges.minRange,max:b.legs[d].ranges.maxRange}:{},k=b.legs[d].ranges?{min:b.legs[d].ranges.leftRange,max:b.legs[d].ranges.rightRange}:{};a.min&&a.max?h(function(){return a.min>e.min&&a.max<e.max},function(){return a.min==k.min&&a.max==k.max}):a.min?h(function(){return a.min<e.max},function(){return a.min==k.min}):
a.max?h(function(){return a.max>e.min},function(){return a.max==k.max}):f=!1;g.push(a)}});return e.extend(this.base(),{state:{legs:g},isAlreadyApplied:d,disabled:!f})},getStateForFilterHistory:function(){var a=this,b={legs:this.legs.slice(0,this.legCount).map(function(a){if(!a.slider||"number"!==typeof a.slider.leftRange||"number"!==typeof a.slider.rightRange)return{};var b={};a.slider.isLeftRangeManipulated()&&(b.min=a.slider.leftRange.toString());a.slider.isRightRangeManipulated()&&(b.max=a.slider.rightRange.toString());
return b})};return{displayName:this.options.title,state:b,type:h.question.ask("filters.FilterHistory.type.slider"),subtype:this.getFilterHistoryDisplayViewSubtype(),displayValue:b.legs.map(function(b,d){return{displayName:a.getLegDisplayName(d),min:b.min&&a.formatValues([parseInt(b.min)]),max:b.max&&a.formatValues([parseInt(b.max)])}})}},getLegDisplayName:function(){return null},getFilterHistoryDisplayViewSubtype:function(){return h.question.ask("filters.FilterHistory.type.numeric")},setDisabled:function(a){a=
a||this.options.forceDisableOnSingleResult&&1>=this.filteredResults;this.base(a);this.legs&&this.legs.forEach(function(b){b.slider.element.find(".r9RangeSlider").toggleClass("Disabled",a)})},disabledPriceGraphFilter:function(a){this.setDisabled(0===a.legs.length);this.element.hasClass("Disabled")?h.events.publish("results.filter.disablePriceGraph"):h.events.publish("results.filter.enablePriceGraph")},setStateFromPrevious:function(a){var b=parseInt(a.key[a.key.length-1]);if(this.legs&&b<this.legs.length){var b=
this.legs[b].slider,c=a.key.startsWith("left");a=a.reset?c?b.minRange:b.maxRange:parseInt(a.value);var d=b.widget.getValues();c?(b.setLeftRange(a),d[0]=a):(b.setRightRange(a),d[1]=a);b.widget.setValues(d)}},updatePreviousFilters:function(a){a?a.legs.forEach(function(a,c){var b="left"+c;c="right"+c;a.hasOwnProperty("min")&&this.previousFilters.hasOwnProperty(b)&&this.previousFilters[b]!==a.min&&this.removePreviousFilter(b);a.hasOwnProperty("max")&&this.previousFilters.hasOwnProperty(c)&&this.previousFilters[c]!==
a.max&&this.removePreviousFilter(c)},this):this.removePreviousFilter()}})})(R9,jQuery);(function(g,h){g.createComponentClass("common.results.filters.ValueSetFilter","common.results.filters.Filter",{content:null,renderedFilterOptions:null,options:{isMultiValueSet:!1,isDefaultChecked:!1,showAllNone:!1,onReset:null,sortInPlace:!1,sortInPlaceLazy:!1,flushState:!0,onDeselect:null,confineOnlyToHeading:!1,onChange:null,removeExpiredOptions:!0,removeExpiredHeadingsWithOptions:!1,visibleCount:0,overflowMinimum:0,showOverflowTemplate:"",hideOverflowTemplate:"",alwaysVisibleItems:[],preventNoneChecked:!1,
showItemHoverTooltip:!1,reverseOptionOrder:!1,countEnabled:!1,allowZeroCount:!1,allowEmptyPrice:!1,disableOnZeroCount:!1,disableOnNoPrice:!1,showOnly:!0,resetOnDynamicIconClick:!1,extraCssClass:"",featureClass:"",onlyLinkClass:"",hidePrice:!1,messages:{},itemTooltipTextMap:null,usePluralDisplayValue:!1,onGetState:null,reloadTop:!1,logItemActions:!1,logActionType:!0,isDropdown:!1,itemTemplateId:"valueSetFilterItem",showTooltipForEllipsed:!1,tooltipHoverDelay:1E3,allUncheckedMeansInactive:!1,reverseSortOrder:!1,
sortOverflowByCount:null,displayDefaultUnchecked:!1,inModal:!1},events:{all:"filters.valueSetFilter.showall"},only:null,showOverflowLink:void 0,overflowVisible:!1,showAsNotChecked:null,resetState:null,multisetOptions:null,init:function(){this.base();this.renderedFilterOptions={};this.content=this.getChildElement("options");0<this.options.visibleCount&&(this.showOverflowLink=this.getChildElement("overflow"));this.options.itemTooltipTextMap=this.options.itemTooltipTextMap||{};this.resetState=this.options.isMultiValueSet&&
!this.options.isDefaultChecked?0:1},addEventHandlers:function(){this.base();var a=this;void 0!==this.showOverflowLink&&(this.showOverflowLink.click(function(){a.options.isDropdown?a.getChildElement("dropdown_content").hasClass("overflow-visible")?a.hideOverflowOptions(!0):a.showOverflowOptions(!0):a.element.hasClass("overflow-visible")?a.hideOverflowOptions(!0):a.showOverflowOptions(!0)}),this.showOverflowLink.keypress(function(b){switch(b.which){case g.globals.keyCodes.SPACE:case g.globals.keyCodes.RETURN:a.showOverflowLink.click()}}));
this.subscribe("filters.%s.setonly".format(this.name),function(b){b=a.getRenderedFilterOptions()[b];a.options.preventNoneChecked&&(a.only.setSelectable(!0),b.setSelectable(!1));a.only=b});this.subscribe("filters.%s.setChecked".format(this.name),this.setCheckedItems.bind(this));this.subscribe("filters.%s.setUnChecked".format(this.name),this.setUnCheckedItems.bind(this));this.options.showItemHoverTooltip&&this.subscribe("filters.%s.hovering".format(this.name),this.onItemHover.bind(this));this.options.showAllNone&&
(this.registerEvent("click",this.getChildElement("all"),this.reset.bind(this,{type:"all",userClick:!0})),this.registerEvent("click",this.getChildElement("none"),this.deselect.bind(this,{type:"none",userClick:!0})));this.subscribe("search.startSearch",function(){a.showAsNotChecked=null;0<a.options.visibleCount&&a.hideOverflowOptions()})},inlineComponentsReady:function(){this.base();this.options.showTooltipForEllipsed&&!this.options.showItemHoverTooltip&&this.subscribe("filters.%s.hovering".format(this.name),
this.onItemHover.bind(this))},reset:function(a){if(!a||!(a.ignore===this.name||h.isArray(a.ignore)&&-1<a.ignore.indexOf(this.name))){this.options.allUncheckedMeansInactive&&(this.showAsNotChecked=!0,g.events.publish("filters."+this.name+".showAsNotChecked",!0));if("function"===typeof this.options.onReset)return this.options.onReset.apply(this,arguments);var b=this.options.flushState,c=this.options.displayDefaultUnchecked;this.forEachItem(function(e,d){d.state.disabled||d.state.noSelect||(c?(b=!0,
d.setChecked(0),d.state.selected=0):void 0!==d.state.showAllState&&a&&a.type&&"reset"!==a.type?(b=!1,d.setChecked(d.state.showAllState)):(e=d.state.resetState,void 0!==e&&void 0!==d.state.defaultSelectedState&&e!==d.state.defaultSelectedState&&(b=!1),d.setChecked(void 0!==e?e:this.resetState)),this.options.preventNoneChecked&&d.setSelectable(!0))});!this.options.resetInTitle&&0<this.options.visibleCount&&this.hideOverflowOptions();a&&a.silent?this.syncFilterState(b):this.pushStateChange(b,{reset:!0});
a&&a.userClick&&(this.setLastUserInteraction(!0),this.logUserInteraction("showall"));this.only=null}},getResetType:function(){return this.options.isDefaultChecked?"showAll":this.base()},deselect:function(a){if(!a||!(a.ignore===this.name||h.isArray(a.ignore)&&-1<a.ignore.indexOf(this.name))){if("function"===typeof this.options.onDeselect)return this.options.onDeselect.apply(this,arguments);this.forEachItem(function(a,c){c.state.disabled||c.state.noSelect||(c.setChecked(0),this.options.preventNoneChecked&&
c.setDisabled(!1))});0<this.options.visibleCount&&this.hideOverflowOptions();a&&a.silent?this.syncFilterState():this.pushStateChange(!1);a&&a.userClick&&this.logUserInteraction(a.type)}},cleanupExistingState:function(){this.forEachItem(function(a,b){g.ComponentManager.remove(b.id())});this.renderedFilterOptions={};this.multisetOptions=null;this.getOptionsContainer().empty()},sortRenderedFilterOptions:function(a){if(a.useHeadings)for(var b=Object.keys(a.headingValueMap),c=0;c<b.length;c++){var e=this.getOptionsContainer().find('.heading[data-heading\x3d"%s"]'.format(b[c])).find(".content");
this.sortOptionsInPlace(e,a.headingValueMap[b[c]])}else this.sortOptionsInPlace(this.getOptionsContainer(),a.valueMap)},sortOptionsInPlace:function(a,b){var c=a.find(".Common-Results-Filters-ValueSetFilterItem");0!==c.length&&(c=c.toArray().sort(function(a,c){a=b[h(a).data("name")];c=b[h(c).data("name")];return a&&c?a.displayOrder-c.displayOrder:0}),h(c).detach().appendTo(a))},addOptionToFilterMap:function(a,b,c,e,d){var f=this.id()+"-"+Math.floor(1E4*Math.random())+"-"+a.replace(/\W+/g,"");d=d||
{};f=h.extend({id:f,name:a},b,{showCount:this.options.countEnabled,showPrice:!this.options.countEnabled&&!this.options.hidePrice,itemTemplateId:this.options.itemTemplateId,hasCount:this.options.allowZeroCount?0<=b.count:0<b.count,hasPrice:this.options.allowEmptyPrice||b.minPrice,disabled:this.options.disableOnZeroCount?0==b.count:!1,tooltipText:this.options.itemTooltipTextMap[a],showOnly:this.options.showOnly,onlyLinkClass:this.options.onlyLinkClass,optionsContainer:this.getOptionsContainer()},d);
d=g.template.renderElement(f.itemTemplateId,f);var n=b.displayOrder,k=function(a,b){return a>b};this.options.reverseSortOrder&&(k=function(a,b){return a<b});var l=null;this.forEachItem(function(a,b){k(b.state.displayOrder,n)&&(null!==l?k(l.state.displayOrder,b.state.displayOrder)&&(l=b):l=b)},e);if(null===l||void 0!==c)if(f=f.optionsContainer,c){var m=f.find('.heading[data-heading\x3d"%s"]'.format(c));m.length||(m=this.makeHeadingContainer(c),f.append(m));m.find(".content").append(d)}else this.options.reverseOptionOrder?
f.prepend(d):(d.insertAfter(l),f.append(d));else d.insertBefore(l.element);b=this.makeFilterOption(d,b,a,c);e[a]=b;b.element.on("mouseenter",this.publishHoverState.bind(this,!0,{item:b.options.name}));b.element.on("mouseleave",this.publishHoverState.bind(this,!1,{item:b.options.name}))},addFilterItem:function(a,b,c,e){this.addOptionToFilterMap(a,b,c,this.getRenderedFilterOptions(),e)},makeFilterOption:function(a,b,c,e,d){var f=this;return new g.common.results.filters.ValueSetFilterItem(a,h.extend(!0,
{},{state:b,name:c,group:this.name,cssClass:this.options.extraCssClass+" "+this.options.featureClass+(d&&d.cssClass?" "+d.cssClass:""),onUserChange:function(){f.filterItemDidChange.apply(f,Array.prototype.slice.call(arguments).concat(this))},heading:e,headingOnlyState:this.options.confineOnlyToHeading?1:2,countEnabled:this.options.countEnabled,allowZeroCount:this.options.allowZeroCount,disableOnZeroCount:this.options.disableOnZeroCount,resetOnDynamicIconClick:this.options.resetOnDynamicIconClick,
messages:this.options.messages,tooltipText:this.options.itemTooltipTextMap[c],enableActionLogging:this.options.logItemActions,enableActionTypeLogging:this.options.logActionType,usePluralDisplayValue:this.options.usePluralDisplayValue,allUncheckedMeansInactive:this.options.allUncheckedMeansInactive,inModal:this.options.inModal},d||{}))},makeHeadingContainer:function(a){var b="\x3cdiv class\x3d'heading' data-heading\x3d\""+a+'"\x3e%s\x3c/div\x3e';a="\x3cdiv class\x3d'title'\x3e%s\x3c/div\x3e\x3cdiv class\x3d'content'\x3e\x3c/div\x3e".format(a);
return h(b.format(a))},shouldBeVisible:function(a){return(a=a.useHeadings?a.headingValueMap:a.valueMap)&&0<Object.keys(a).length},logUserInteraction:function(a,b){if("ga"===this.options.loggingType){a=a.split("/");var c=void 0;a[0]&&(c="reset"===a[0]?"showall":a[0]);var e=this.getRenderedFilterOptions()[a[0]];a[1]&&"toggle"===a[1]&&e&&(a[1]=e.state.selected?"show":"hide");a[1]&&(c=(b?"":a[1]+"-")+c+(b?"-"+a[1]:""));this.base({category:this.trackCategory,action:this.name,label:c})}else this.base(a)},
filterItemDidChange:function(a,b,c,e){var d={field:a,value:c&&c.state.selected};if(this.options.allUncheckedMeansInactive){var f=this.getRenderedFilterOptions();null==this.showAsNotChecked&&(this.showAsNotChecked=Object.keys(f).every(function(b,c){c=0<f[b].state.selected;return b===a?!c:c}));this.showAsNotChecked?(g.events.publish("filters."+this.name+".showAsNotChecked",!1),this.showAsNotChecked=!1,f[a].setChecked(1),b="only"):0===Object.keys(f).filter(function(a){return 0<f[a].state.selected}).length&&
(g.events.publish("filters."+this.name+".showAsNotChecked",!0),this.showAsNotChecked=!0,this.forEachItem(function(a,b){b.setChecked(1)}),b="showall")}this.multisetOptions&&c&&Object.keys(this.multisetOptions).forEach(function(b){var c=this.multisetOptions[b],d=a===b,e=0<this.getRenderedFilterOptions()[b].getState();c.indexOf(a);d?this.forEachItem(function(a,b){b.state.meta||(a=-1<c.indexOf(a),e?b.setChecked(a?1:0):a||b.setChecked(1))}):-1===c.indexOf(a)&&this.getRenderedFilterOptions()[b].setChecked(0)},
this);"only"===b||"price"===b||"count"===b?(this.only=this.getRenderedFilterOptions()[a],this.forEachItem(function(b,c){c.options.state.ignoreOnly||c&&b!=a&&(this.only.options.heading&&this.options.confineOnlyToHeading?this.only.options.heading===c.options.heading&&c.setChecked(0):c.setChecked(0))}),"price"===b&&g.events.publish("filters.selectedprice",{ignore:this.name})):this.only&&this.unsetOnlyOption(a);"function"===typeof this.options.onChange&&this.options.onChange.call(this,c);e||(this.setLastUserInteraction(!0),
this.pushStateChange(null,{changeData:d}),this.updateFilterHistory(),this.options.logUserInteraction&&(this.logUserInteraction("showall"===b?b:a+"/"+b),c&&c.state.filtered&&g.Analytics.api.trackEvent("filters/filteredItem/"+b)));c&&0!==c.getState()&&g.events.publish("gtm.update",{event:"resultsFilterChange",filterName:this.name,filterValue:a});this.options.reloadTop&&window.scrollTo(0,0)},unsetOnlyOption:function(a){a!==this.only.options.name?(this.only.setChecked(1),this.only=null):a===this.only.options.name&&
2!==this.only.state.selected&&(this.only=null)},update:function(a){var b=this,c=!1,e=Object.keys(this.getRenderedFilterOptions()).length;this.multisetOptions=a.multisetOptions;var d=h.extend(!0,{},a);if(d.useHeadings){a=d.headingValueMap;for(var f=Object.keys(a),g=0;g<f.length;g++){var k=f[g],k=this.updateItems(a[k],k,d);c||(c=k)}d.orderedHeadings&&this.getOptionsContainer().find(".heading").sort(function(a,b){return d.orderedHeadings.indexOf(h(a).data("heading"))>d.orderedHeadings.indexOf(h(b).data("heading"))?
1:d.orderedHeadings.indexOf(h(a).data("heading"))<d.orderedHeadings.indexOf(h(b).data("heading"))?-1:0}).appendTo(this.getOptionsContainer());this.options.removeExpiredHeadingsWithOptions&&(f=Object.keys(d.headingValueMap),this.getOptionsContainer().find(".heading").each(function(a,c){(a=h(c).data("heading"))&&""!==a&&0>f.indexOf(a)&&(h(c).find("li").each(function(a,c){(a=h(c).data("name"))&&""!==a&&delete b.getRenderedFilterOptions()[a]}),h(c).remove())}))}else c=this.updateItems(d.valueMap,void 0,
d);(this.options.sortInPlace||this.options.sortInPlaceLazy&&e!==Object.keys(this.getRenderedFilterOptions()).length)&&this.sortRenderedFilterOptions(d);this.element.hasClass("empty")&&c&&this.element.removeClass("empty")},updateItems:function(a,b,c){if(!a)return!1;var e=this,d=Object.keys(a),f=0<d.length,h=0,k=!1,d=d.sort(function(b,c){return a[b].displayOrder-a[c].displayOrder});this.options.disableOnNoPrice&&d.forEach(function(b){b=a[b];b.minPrice||(b.disabled=1,b.selected=0)});this.options.displayDefaultUnchecked?
(this.showAsNotChecked=this.allChecked(a))&&d.forEach(function(b){a[b].selected=0;a[b].showAllState=0}):this.options.allUncheckedMeansInactive&&null==this.showAsNotChecked&&(this.showAsNotChecked=this.allChecked(a))&&d.forEach(function(b){a[b].showAsNotChecked=!0});d.filter(function(a){return e.getRenderedFilterOptions().hasOwnProperty(a)}).forEach(function(b){var c=a[b];e.getRenderedFilterOptions()[b].update(c)});var l={};d.length>this.options.overflowMinimum&&(l=this.getOverflowItems(d,a));d.forEach(function(d){h++;
var f=a[d];f.showAsNotChecked=e.showAsNotChecked;e.getRenderedFilterOptions().hasOwnProperty(d)||e.addFilterItem(d,f,b,{filtersData:c});l&&l[d]&&(0===f.selected||e.options.isDefaultChecked)?(e.getRenderedFilterOptions()[d].element.addClass("overflow-item").attr("aria-hidden",!0),k=!0):e.getRenderedFilterOptions()[d].element.removeClass("overflow-item").attr("aria-hidden",!1);2===f.selected&&(e.only=e.getRenderedFilterOptions()[d])});this.options.preventNoneChecked&&this.disableOnlyOption();if(void 0!==
this.showOverflowLink&&!this.element.hasClass("overflow-visible")&&(this.showOverflowLink.toggleClass("visible",k),this.showOverflowLink.attr("aria-pressed",function(a){return"false"===a?"true":"false"}),k&&(this.options.showOverflowTemplate||this.options.hideOverflowTemplate))){var d={},m=Object.keys(l).length;this.options.showOverflowTemplate&&(d.more=g.Common.Utils.String.formatChoice(this.options.showOverflowTemplate,m,m),this.overflowVisible||this.getChildElement("overflow-text").text(d.more));
this.options.hideOverflowTemplate&&(d.less=g.Common.Utils.String.formatChoice(this.options.hideOverflowTemplate,m,m),this.overflowVisible&&this.getChildElement("overflow-text").text(d.less));Object.keys(d).length&&this.showOverflowLink.data(d)}this.handleExpiredOptions(a,b);return f},updatePlaceholderDisplay:function(a){this.options.isDropdown?this.base(a):a&&(this.getChildElement("placeholder").toggleClass("hidden",!a.visible),this.getChildElement("options").toggleClass("hidden",!!a.visible))},allChecked:function(a){var b=
Object.keys(a);return b.length?b.every(function(b){return 0<a[b].selected||0<a[b].disabled}):null},getOverflowItems:function(a,b){var c=this;if(0<this.options.visibleCount){var e=a.filter(function(a){return-1===c.options.alwaysVisibleItems.indexOf(a)});a=this.options.visibleCount-(a.length-e.length);var d=e;this.options.sortOverflowByCount&&(d=e.sort(function(a,c){a=b.hasOwnProperty(a)?b[a].count:0;return(b.hasOwnProperty(c)?b[c].count:0)-a}));var f={};d.slice(a).forEach(function(a){f[a]=a});return f}return null},
handleExpiredOptions:function(a,b){this.forEachItem(function(c,e){a.hasOwnProperty(c)||e.options.heading!==b||(this.options.removeExpiredOptions?(g.ComponentManager.remove(e.id()),delete this.getRenderedFilterOptions()[c]):e.setChecked(0))})},disableOnlyOption:function(){var a=this.getRenderedFilterOptions();if("object"===typeof a&&0!==a.length){var b=Object.keys(a),c=b.filter(function(b){return 0<a[b].getState()});b.forEach(function(b){a[b].setSelectable(!0)});1===c.length?a[c[0]].setSelectable(!1):
0===c.length&&this.log.console("ValueSetFilter#DisableOnlyOption: No filter options checked while preventNoneChecked is true. \nFilter name: "+this.options.name)}},setCheckedItems:function(a){this.forEachItem(function(b,c){0<=a.items.indexOf(b)?c.setChecked(1):c.setChecked(0)});this.pushStateChange()},setStateFromPrevious:function(a){var b=this.getRenderedFilterOptions()[a.key];if(b)if(a.reset)2===b.getState()?this.reset({silent:!0}):b.setChecked(void 0!==b.state.resetState?b.state.resetState:this.resetState);
else if(a.hasOwnProperty("value")){var c=parseInt(a.value);b.setChecked(c);this.filterItemDidChange(a.key,2===c?"only":null,b,!0)}},updatePreviousFilters:function(a){a?Object.keys(this.previousFilters).forEach(function(b){if(a&&a.hasOwnProperty(b)){var c=a[b],e=parseInt(this.previousFilters[b]);c===e||2===c&&0<e||this.removePreviousFilter(b)}},this):this.removePreviousFilter()},setUnCheckedItems:function(a){this.forEachItem(function(b,c){0<=a.items.indexOf(b)?c.setChecked(0):c.setChecked(1)});this.pushStateChange()},
onItemHover:function(a){if(!a.hasOwnProperty("namespace")||a.namespace===this._namespace){var b=this.renderedFilterOptions[a.item],c=(g.question.ask("hotels.results.filtersPinned")||!1)&&!this.options.inModal;if(this.options.showTooltipForEllipsed&&!0===a.hover){var e=b.element.find("label");if(e.length&&e[0].offsetWidth>=e[0].scrollWidth)return}!0===a.hover?b.element.toolTip({content:b.options.state.displayValue,position:c?"bottom":"top",showImmediately:!0,delay:this.options.tooltipHoverDelay}):
!1===a.hover&&b.element.data("toolTip")&&b.element.data("toolTip").removeWidget()}},showOverflowOptions:function(a){this.options.isDropdown?(this.getChildElement("dropdown_content").addClass("overflow-visible").attr("aria-expanded",!0),this.getChildElement("dropdown_content").find(".overflow-item").attr("aria-hidden",!1)):(this.element.addClass("overflow-visible").attr("aria-expanded",!0),this.element.find(".overflow-item").attr("aria-hidden",!1));this.getChildElement("overflow").attr("aria-pressed",
!0);this.showOverflowLink.find(".text").html(this.showOverflowLink.data("less"));this.overflowVisible=!0;a&&this.logUserInteraction("overflow/showmore",!0);g.events.publish("filter.overflow.toggle")},hideOverflowOptions:function(a){this.options.isDropdown?(this.getChildElement("dropdown_content").removeClass("overflow-visible").attr("aria-expanded",!1),this.getChildElement("dropdown_content").find(".overflow-item").attr("aria-hidden",!0)):(this.element.removeClass("overflow-visible").attr("aria-expanded",
!1),this.element.find(".overflow-item").attr("aria-hidden",!0));this.showOverflowLink.attr("aria-pressed",!1);this.showOverflowLink.find(".text").html(this.showOverflowLink.data("more"));this.overflowVisible=!1;a&&this.logUserInteraction("overflow/showless",!0);g.events.publish("filter.overflow.toggle")},forEachItem:function(a,b){var c=this;b=b||this.getRenderedFilterOptions();Object.keys(b).forEach(function(e){a.call(c,e,b[e])},this)},getRenderedFilterOptions:function(){return this.renderedFilterOptions},
getOptionsContainer:function(){return this.content},getState:function(){var a={};this.forEachItem(function(b,c){var e=c.getState();null!==e&&(a[c.state.code||b]=e)},h.extend({},this.getRenderedFilterOptions()));this.options.onGetState&&(a=this.options.onGetState.call(this,a));return a},getHistoryFilterViewState:function(a){var b={};this.forEachItem(function(a,c){var d=c.getState();b[c.state.code||a]=d},h.extend({},this.getRenderedFilterOptions()));var c=this.showCheckedFilterHistory()?"1":"0",e={},
d=null,f=Object.keys(a).filter(function(b){b=a[b];if(h.isArray(b)){if(b.filter(function(a){return"2"==a}).length)return!0}else return"2"==b;return!1}),f=f.length?f[0]:null,g=Object.keys(a).filter(function(a){return b.hasOwnProperty(a)}),k=function(a,c){var d=b[a],e={},f=null;h.isArray(d)?(e[a]=[],d.forEach(function(b){b==c?null===f&&(f=!0):f=!1;e[a].push(c)})):(f=c==d,e[a]=c);return{state:e,isAlreadyApplied:f}};return f?b.hasOwnProperty(f)?h.extend({},k(f,"2"),{only:f}):{disabled:!0}:g.length?(g.forEach(function(a){var b=
k(a,c);e[a]=b.state[a];b.isAlreadyApplied?null===d&&(d=b.isAlreadyApplied):d=!1}),{state:e,isAlreadyApplied:d}):{disabled:!0}},getStateForFilterHistory:function(){var a={},b=this;this.forEachItem(function(b,e){var c=e.getState();null!==c&&(a[e.state.code||b]=c)},h.extend({},this.getRenderedFilterOptions()));return h.extend({},{displayName:this.options.title,type:g.question.ask("filters.FilterHistory.type.checkbox"),inclusive:this.showCheckedFilterHistory(),state:h.extend({},a),displayValue:Object.keys(a).reduce(function(a,
e){a[e]=b.getFilterHistoryDisplayValue(e);return a},{})})},getFilterHistoryDisplayValue:function(a){var b=g.config.getBoolean("ui.horizon.filters.history.%s.show.code.only".format(this.name),!1),c=this.getRenderedFilterOptions();return c.hasOwnProperty(a)?b?c[a].state.code:c[a].state.displayValue:null},showCheckedFilterHistory:function(){return g.config.getBoolean("ui.horizon.filters.history.%s.show.checked.items".format(this.name),!1)}})})(R9,jQuery);(function(c,e){var f=c.config.getBoolean("ui.horizon.fitlers.valueSetFilterItem.clearDisabledPrice",!0);c.createComponentClass("common.results.filters.ValueSetFilterItem",{checkbox:null,options:{name:null,loggingValue:null,group:null,state:{code:null,displayValue:null,pluralDisplayValue:null,minPrice:null,selected:0,info:!1,showAllSate:void 0,resetState:void 0,noSelect:!1,disabled:!1,hideOnly:!1,ignoreOnly:!1,displayOrder:0,filtered:!1,partiallyFiltered:!1,resetOnDynamicIconClick:!1,tooltipText:null,
href:null,cssClass:null,enableItemActionLogging:!1,enableActionTypeLogging:!0,count:0,showAsNotChecked:null,meta:!1},unrolled:!1,withImage:!1,onlyOnClick:!1,heading:void 0,headingOnlyState:1,onUserChange:e.noop,onRemove:e.noop,countEnabled:!1,allowZeroCount:!1,disableOnZeroCount:!1,messages:{},usePluralDisplayValue:!1,allUncheckedMeansInactive:!1,inModal:!1},events:{only:"filters.valueSetFilterItem.only"},eventPrefix:"",loggingPrefix:"filters",updateKey:null,state:null,init:function(){this.state=
e.extend({},this.options.state||{});this.checkbox=this.getChildElement("check");this.price=this.getChildElement("price");this.only=this.getChildElement("only");this.count=this.getChildElement("count");this.funnel=this.element.find(".funnel");this.innerCount=e("span",this.count);this.eventPrefix="filters.%s.%s.".format(this.options.group,this.options.name);this.options.onUserChange=this.options.onUserChange.bind(this,this.options.name);this.options.tooltipText&&(this.tooltip=this.getChildElement("tooltip-anchor").toolTip(this.getTooltipOptions({content:this.options.tooltipText})).getWidget());
this.update(this.state);var a=this;c.dom.schedule(function(){a.checkbox.prop("checked",0<a.state.selected).attr("aria-checked",0<a.state.selected);"string"===typeof a.state.cssClass&&a.element.addClass(a.state.cssClass);a.options.cssClass&&a.element.addClass(a.options.cssClass);a.state.disabled&&a.setDisabled(!0);a.state.hasOwnProperty("noSelect")&&(a.element.toggleClass("NoSelect",a.state.noSelect),a.checkbox.attr("aria-disabled",a.state.noSelect))})},addEventHandlers:function(){var a=this;this.registerEvent("click",
this.element.find(".FilterCheckbox"),this.checkboxClicked.bind(this));this.registerEvent("keypress",this.element,function(b){b.keyCode===c.globals.keyCodes.RETURN&&a.checkboxClicked(b)});this.registerEvent("click",this.price,this.priceClicked.bind(this));this.registerEvent("click",this.count,this.countClicked.bind(this));this.registerEvent("click",this.only,this.onlyClicked.bind(this));this.options.resetOnDynamicIconClick&&this.registerEvent("click",this.funnel,this.funnelClicked.bind(this));if(this.options.showRemoveIcon){var b=
this.getChildElement("remove"),d=null;"function"===typeof this.options.onRemove&&this.registerEvent("click",b,function(b){b.stopPropagation();d&&d.close();a.options.onRemove(a)});b.attr("title")&&(d=b.toolTip().getWidget())}this.registerEvent("keypress",this.only,function(b){switch(b.which){case c.globals.keyCodes.SPACE:case c.globals.keyCodes.RETURN:a.only.click()}});this.addSubscriptionHandlers()},addSubscriptionHandlers:function(){var a=this;this.subscribe(this.eventPrefix+"setchecked",this.setChecked.bind(this));
this.only&&this.only.length&&this.subscribe(this.eventPrefix+"onlyclick.force",function(){a.only.click()});this.subscribe(this.eventPrefix+"quickclick.force",function(){a.state.disabled||a.state.hideOnly||a.state.noSelect||a.setChecked(1,"quickfilter")});this.subscribe(this.eventPrefix+"quickunclick.force",function(){a.state.disabled||a.state.hideOnly||a.state.noSelect||a.setChecked(0,"quickfilter")});this.subscribe(this.eventPrefix+"setchecked.force",function(b){a.setChecked(b.selected,b.changeType||
"toggle")});this.subscribe(this.eventPrefix+"resetitem",function(b){a.setChecked(a.state.resetState,b.changeType||"toggle")});this.subscribe(["filters.disabled",this.eventPrefix+"disabled"],this.setDisabled.bind(this));this.subscribe("resultspage.cleanup",function(b){a.isClean=!0});this.subscribe("filters."+this.options.group+".showAsNotChecked",function(b){a.state.showAsNotChecked=b})},countClicked:function(a){this.state.disabled||this.state.hideOnly||this.state.noSelect||(this.setChecked(1),this.options.onUserChange("count"),
this.options.enableItemActionLogging&&c.Analytics.api.trackEvent({category:this.loggingPrefix,action:this.options.group,label:"count"}))},priceClicked:function(a){if(this.price.attr("href"))window.open(this.price.attr("href"),"_blank");else{if(this.state.disabled||this.state.hideOnly||this.state.noSelect)return;this.setChecked(1);this.options.onUserChange("price")}this.options.enableItemActionLogging&&c.Analytics.api.trackEvent({category:this.loggingPrefix,action:this.options.group,label:"price"})},
onlyClicked:function(a){a.stopPropagation();this.state.disabled||(this.options.heading?this.setChecked(this.options.headingOnlyState):this.setChecked(2),this.options.onUserChange("only"))},funnelClicked:function(){c.events.publish("filters.reset",{type:"showAll"})},checkboxClicked:function(a){a.preventDefault();if(!this.state.disabled&&!this.state.noSelect){a=0<this.state.selected?0:1;var b="toggle";this.options.enableActionTypeLogging&&(b=0<this.state.selected?"unselect":"select");this.options.onlyOnClick&&
2!==this.state.selected&&(a=2,b="only");this.setChecked(a);this.options.onUserChange(b);a=0<this.state.selected?"show":"hide";this.options.enableItemActionLogging&&c.Analytics.api.trackEvent({category:this.loggingPrefix,action:this.options.group,label:a+"-"+this.options.name})}},setDisabled:function(a){this.state.disabled=a;c.dom.toggleOneClass(this.element,"Disabled",a);this.element.attr("aria-disabled",a);c.dom.toggleOneClass(this.checkbox.parent(),"Disabled",a);c.events.publish(this.eventPrefix+
"state.disabled",a)},setSelectable:function(a){this.state.noSelect=!a;c.dom.toggleOneClass(this.element,"Disabled",!a);this.element.attr("aria-disabled",!a);c.dom.toggleOneClass(this.checkbox.parent(),"Disabled",!a)},setPrice:function(a){a=a||"";this.state.minPrice=a;this.price.text(a)},setCount:function(a){this.state.count=a;this.innerCount.text(a)},setChecked:function(a,b){var d=this.options.allUncheckedMeansInactive&&this.state.showAsNotChecked?!1:0<a;c.dom.toggleOneClass(this.element,"Checked",
d);this.checkbox.prop("checked",d).attr("aria-checked",d);this.state.selected=a;c.events.publish(this.eventPrefix+"changed",this.state);if(b)this.options.onUserChange(b)},setDisplayValue:function(a){this.element.find(".label").text(a);this.state.displayValue=a},update:function(a){var b=this;this.options.disableOnZeroCount&&0===a.count&&a.filtered?(a.disabled=!0,this.state.userSelectedDisabled=this.state.selected!==a.resetState):this.state.userSelectedDisabled=!1;a.disabled&&f&&(a.minPrice="");this.state.filtered=
a.filtered;this.state.displayOrder=a.displayOrder;this.state.showAllState=a.showAllState;this.state.resetState=a.resetState;this.state.meta=a.meta;var d=this.computeUpdateKey(a);if(!c.config.getBoolean("ui.horizon.filters.updateKey",!0)||d!==this.updateKey||this.isClean)this.isClean=!1,this.state.selected=a.selected,this.state.disabled=a.disabled,c.dom.schedule(function(){b.updateElement(a);b.updateKey=d})},updateElement:function(a){a.cssClass&&a.cssClass!==this.state.cssClass&&(this.element.removeClass(this.state.cssClass),
this.element.addClass(a.cssClass),this.state.cssClass=a.cssClass);this.setChecked(a.selected);this.setPrice(a.minPrice);this.state.displayValue!==a.displayValue&&this.setDisplayValue(a.displayValue);(0!==a.count||this.options.allowZeroCount)&&a.count!==this.state.count&&this.options.countEnabled&&this.setCount(a.count);this.updateDynamicFilterTooltip(a);var b=!!a.hideOnly;if(this.state.hideOnly!==b||this.element.hasClass("No-Only")!==b)this.state.hideOnly=b,this.element.toggleClass("No-Only",this.state.hideOnly);
b=!!a.noSelect;this.state.noSelect!==b&&(this.state.noSelect=b,this.element.toggleClass("NoSelect",this.state.noSelect));this.setDisabled(!!a.disabled);this.price.attr("href",a.href||null)},updateDynamicFilterTooltip:function(a){this.element.removeClass("Filtered FilteredOut");if(a.filtered||a.partiallyFiltered){var b=a.filtered?this.options.messages.filtered:this.options.messages.partiallyFiltered;if(b){this.showingTooltip=!0;var d=a.displayValue;this.options.usePluralDisplayValue&&(d=a.pluralDisplayValue);
b=c.Common.Utils.String.formatString(b,d);this.element.addClass("Filtered"+(a.filtered?" FilteredOut":""));this.funnel.attr({"data-title":b,"aria-label":b,"aria-disabled":!this.options.resetOnDynamicIconClick});this.funnel.getWidget()||this.funnel.toolTip(this.getTooltipOptions())}}else this.showingTooltip&&(this.funnel.attr({title:"","aria-disabled":!0}),this.showingTooltip=!1)},computeUpdateKey:function(a){var b="selected filtered partiallyFiltered hideOnly noSelect disabled showAsNotChecked".split(" ").reduce(function(b,
c){return b+(a[c]?"1":"0")},""),b=b+(this.options.countEnabled?a.count:a.minPrice),b=b+(a.cssClass?a.cssClass:""),b=b+a.displayValue;return b+=a.href?a.href:""},getTooltipOptions:function(a){var b=this.options.cssClass&&-1!==this.options.cssClass.indexOf("kayak-flights");return e.extend({},{position:"top",extraClass:"Common-Results-Filters-ValueSetFilterItem__Tooltip "+this.options.cssClass+" "+(b?"uikit ":"")+(this.options.inModal?"modal-layer":""),orientation:b?"start":"middle",size:b?"uikit":"m"},
a)},getState:function(){return this.state.disabled&&!this.state.userSelectedDisabled?null:this.state.selected}})})(R9,jQuery);(function(c,e){c.createComponentClass("common.results.AfterclickContainer",{options:{searchId:"",url:"",rateLimitCount:c.config.getInt("ui.afterclick.rate_limited_occurrence",2),rateLimitPeriod:864E5,rateLimitStorageKey:"hotel_afterclick_last"},searchId:"",dialogContent:null,dialog:null,init:function(){this.dialogContent=this.getChildElement("content");this.searchId=this.options.searchId;this.options.rateLimitStorageKey||(this.options.rateLimitStorageKey="hotel_afterclick_last")},addEventHandlers:function(){if(!c.config.getBoolean("ui.no.popup.enabled",
!1)||"notloggedin"===c.globals.analytics.loginState){var a=this;c.events.subscribe("multibook.providerClicked",function(b){b&&b.afterclickIgnore||c.config.getBoolean("ui.ignore.afterclick.popup",!1)||a.openAfterclick(b.resultId)});c.events.subscribe("resultspage.searchId.changed",function(b){a.searchId=b.searchId})}},rateLimit:function(a){if("prevent"===c.storage.get("prevent-afterclick"))return c.storage.remove("prevent-afterclick"),!0;if(!c.config.getBoolean("ui.afterclick.rate_limited",!0))return!1;
a=a||{};var b=new Date,g=isNaN(a.rateLimitCount)?2:a.rateLimitCount,e=isNaN(a.rateLimitPeriod)?864E5:a.rateLimitPeriod,f=a.rateLimitStorageKey,d;if(!c.storage.isAvailable()||!f)return!1;a=c.storage.get(f);"string"===typeof a&&(a=[]);if(!a||a.length<g)return a=a?a.concat(b.getTime()):[b.getTime()],c.storage.set(f,a),!1;for(d=0;d<g;d++){if(isNaN(a[d]))return c.storage.set(f,[b.getTime()]),!1;if(b.getTime()-(new Date(a[d])).getTime()>e)return a[d]=b.getTime(),c.storage.set(f,a),!1}return!0},openAfterclick:function(a){var b=
this;b.dialog&&b.dialog.isOpen()||!b.options.url||!b.searchId||b.rateLimit(this.options)||(a={resultId:a,searchId:b.searchId},c.Analytics.api.trackEvent({category:"AfterClick",action:"request"}),c.ajax.execute(b.options.url,{data:a,appendTo:this.dialogContent,replace:!0}).then(function(a){b.dialog=b.getChildElement("afterclickdialog").dialog({extraCssClass:"afterclickModal"}).getWidget();a=b.getChildElement("content").children().eq(0);if(e("#acerror").length){try{c.Analytics.api.trackEvent({category:"AfterClick",
action:"failed",label:e("#acerror").get(0).innerText.trim()})}catch(h){}console.log(e("#acerror").get(0).innerText)}else c.Analytics.api.trackEvent({category:"AfterClick",action:"displayed"}),b.options.responsive?(b.dialog.setContentDimensions(a.outerWidth(),a.outerHeight(),"95%"),b.dialog.setViewPortOverflow("hidden")):b.dialog.setContentDimensions(a.outerWidth(),a.outerHeight()),b.dialog.setOption("onClose",function(){c.Analytics.api.trackEvent({category:"AfterClick",action:"closed"})}),b.dialog.open(),
c.events.publish("afterclick.dialog.opened")}).fail(function(a){c.Analytics.api.trackEvent({category:"AfterClick",action:"failed",label:"ajax"})}))}})})(R9,jQuery);(function(a,c){a.createComponentClass("common.results.BookingLinksExpiredDialog",{expiredResultsDialog:null,options:{redirectUrl:""},addEventHandlers:function(){a.events.subscribe("search.expired",this.showBookingLinksExpiredDialog.bind(this))},showBookingLinksExpiredDialog:function(){var b=this;if(null===this.expiredResultsDialog){this.expiredResultsDialog=this.element.dialog({onClose:function(){a.events.publish("resultspage.transition.remove")}}).getWidget();var d=this.options.redirectUrl?this.options.redirectUrl:
"/";this.getChildElement("home-btn").click(function(){a.Analytics.api.trackEvent("booklinkexpired/homepage");window.location=d});this.getChildElement("refresh-btn").click(function(){c(document.body).css("cursor","wait");a.Analytics.api.trackEvent("booklinkexpired/refresh");a.config.getInt("ui.rp.limitExpiredReload",!0)?(a.events.publish("user.refresh.expired"),b.expiredResultsDialog&&b.expiredResultsDialog.close()):window.location.reload()})}this.expiredResultsDialog.open()}})})(R9,jQuery);(function(a){a.createComponentClass("common.results.Compliance",{options:{collapse:"",expand:"",showCollapse:!1,defaultCollapsed:!1},block:null,toggleCollapse:null,collapsed:!1,init:function(){this.block=this.getChildElement("frenchWarning");this.toggleCollapse=this.getChildElement("collapse");this.options.defaultCollapsed&&this.options.showCollapse&&!this.collapsed&&this.toggleCollapsed()},addEventHandlers:function(){if(this.options.showCollapse)this.toggleCollapse.on("click",this.toggleCollapsed.bind(this))},
toggleCollapsed:function(){this.collapsed=!this.collapsed;this.block.toggleClass("collapsed",this.collapsed);this.toggleCollapse.text(this.options[this.collapsed?"expand":"collapse"])}})})(R9);(function(b){b.createComponentClass("common.results.CurrencyConversionInfo",{options:{vertical:null,dialogContainerId:"currencyConversionInfoDialogContent",linkSelector:"a.dialog",collapseButtonEnabled:!1},dialog:null,addEventHandlers:function(){this.base();var a=this;this.element.find(this.options.linkSelector).click(function(b){b.preventDefault();a.showDialog()});this.options.collapseButtonEnabled&&a.getChildElement("expand-disclaimer-trigger").click(function(){a.element.toggleClass("collapsed");
a.getChildElement("read-more").toggleClass("hidden");a.getChildElement("collapse").toggleClass("hidden")})},destroyDialog:function(){this.dialog&&(this.dialog.close(),this.dialog=null)},showDialog:function(){this.destroyDialog();this.dialog=this.getChildElement(this.options.dialogContainerId).dialog({}).getWidget();this.dialog.open()}})})(R9);(function(d,g){d.createComponentClass("common.results.DisplayCounts",{filteredCount:null,totalCount:null,showAllLink:null,product:null,baseProductString:null,options:{withUnits:!1,isHorizontalMode:!1,labelMsg:"",filteredCountId:"",totalCountId:"",pluralProductMsg:"",singleProductMsg:"",ariaLabel:"",wrapperClass:""},init:function(){this.filteredCount=this.getChildElement("filteredCount");this.totalCount=this.getChildElement("totalCount");this.product=this.element.find("span.product");this.baseProductString=
this.product.html()},addEventHandlers:function(){var a=this;this.subscribe("resultspage.results.count.changed",function(c){d.dom.schedule(a.updateCounts.bind(a,c))});this.subscribe(["search.searchFailed","search.startSearch"],function(){d.dom.schedule(a.updateCounts.bind(a,{filtered:0,total:0}))});this.bindShowAll()},bindShowAll:function(){this.filteredCount=this.getChildElement("filteredCount");this.totalCount=this.getChildElement("totalCount");this.product=this.element.find("span.product");this.showAllLink=
this.element.find("a.showAll").eq(0);this.showAllLink.click(function(){g(this).hasClass("disabled")||(d.events.publish("filters.reset",{type:"showAll"}),d.Analytics.api.trackEvent({category:"Filters",action:"see-all-results"}))})},updateCounts:function(a){if(this.options.withUnits){this.filteredCount.text(a.filtered);this.totalCount.text(a.total);this.showAllLink.css("display",a.filtered===a.total?"none":"inline-block");var c=this.element.children().first();c.removeClass("visible").addClass("visible");
c.removeClass("simple").addClass("simple");this.element.removeClass("visible").addClass("visible");this.element.removeClass("simple").addClass("simple")}else{var b="";""!=this.options.ariaLabel&&(b=' aria-label\x3d"'+this.options.ariaLabel+'"');var c="\x3cspan id\x3d"+this.options.filteredCountId+"\x3e"+a.filtered+"\x3c/span\x3e",e="\x3ca class\x3d'showAll' href\x3d'javascript:void(0)'"+b+"\x3e\x3cspan id\x3d"+this.options.totalCountId+"\x3e"+a.total+"\x3c/span\x3e\x3c/a\x3e",b="\x3ca class\x3d'showAll' href\x3d'javascript:void(0)'"+
b+"\x3e\x3cspan id\x3d"+this.options.totalCountId+"\x3e"+a.total+"\x3c/span\x3e\x3cspan class\x3d'product'\x3e "+this.options.pluralProductMsg+"\x3c/span\x3e\x3c/a\x3e",f=this.getChildElement("showLabel"),b=d.Common.Utils.String.formatChoice(this.options.labelMsg,a.filtered,a.filtered,c,e,b,this.options.pluralProductMsg,this.options.singleProductMsg,f.length?f[0].outerHTML:"");this.options.isHorizontalMode&&(b=this.options.pluralProductMsg,b=b.charAt(0).toUpperCase()+b.slice(1),b=d.Common.Utils.String.formatString(this.options.labelMsg,
c,e,b));c="\x3cdiv class\x3d'"+this.options.wrapperClass+" visible'\x3e"+b+"\x3c/div\x3e";this.element.html(c).addClass("visible");d.events.publish("displayCounts.newData",{data:c});this.bindShowAll()}this.element.find("a.showAll").toggleClass("disabled",a.filtered===a.total);a.hasOwnProperty("product")?this.product.html(a.product):this.product.html()!==this.baseProductString&&this.product.html(this.baseProductString)}})})(R9,jQuery);(function(a){a.createComponentClass("common.results.NoResults","common.results.SearchFailed",{options:{vertical:null},addEventHandlers:function(){this.base();var b=this;a.events.ready("common.results.NoResults.ready",this.element);this.getChildElement("newSearchLink").click(function(c){c.preventDefault();a.events.publish(b.options.vertical+".inline.search.form.show",{focus:!0});return!1});a.events.subscribe("search.searchFailed",this.handleSearchFailure.bind(this))},handleSearchFailure:function(a){a&&
a.type===this.failureTypes.NO_RESULTS&&this.showSearchFailedView()}})})(R9);(function(d,c){d.createComponentClass("common.results.Paginator",{trackCategory:"Pagination",activeIndex:0,pageCount:0,pageNumberTemplateId:"paginatorItem",numbered:!0,loader:null,loading:!1,activeSearch:!1,options:{button:!1,buttonInfinite:!0,infinite:!1,silent:!1,maxPages:5,infiniteScrollingOffset:0,logUserInteraction:!1,disableDuringPolling:!1},init:function(){this.numbered=!this.options.button&&!this.options.infinite;this.numbered||(this.loader=this.getChildElement("loader"))},addEventHandlers:function(){var a=
this;this.subscribe("resultspage.searchId.changed",function(){a.activeSearch=!0});this.subscribe("resultspage.pageNumber.changed",function(b){a.setIndex(b);a.updateDOM()});this.subscribe("paginator.update",function(b){a.setIndex(b.pageNumber);a.updateBounds(b.pageCount);if(a.options.infinite)if(b.pageNumber===b.pageCount)c(window).off("scroll.pagination");else if(1===b.pageNumber)c(window).on("scroll.pagination",a.scrollPagination.bind(a));if(a.options.button){if(b.pageNumber>=b.pageCount||1===b.pageNumber||
!a.options.buttonInfinite)c(window).off("scroll.pagination");else if(2===b.pageNumber)c(window).on("scroll.pagination",a.scrollPagination.bind(a));b.pageNumber>=b.pageCount||0===b.pageCount?a.element.removeClass("visible"):a.element.addClass("visible")}a.updateDOM()});this.subscribe("paginator.hide",function(){a.element.removeClass("visible")});this.numbered?(this.element.find("a.page-Previous").click(function(b){1>=a.activeIndex?b.preventDefault():(a.options.logUserInteraction&&a.logUserInteraction("Prev"),
a.userChangedIndex(--a.activeIndex))}),this.element.find("a.page-Next").click(function(b){a.activeIndex>=a.pageCount?b.preventDefault():(a.options.logUserInteraction&&a.logUserInteraction("Next"),a.userChangedIndex(++a.activeIndex))})):this.subscribe("search.poll.response",function(){a.element.removeClass("loading");a.loading=!1});this.options.button&&(this.getChildElement("loadMore").click(function(){a.element.addClass("loading");a.logUserInteraction("More");a.userChangedIndex(++a.activeIndex)}),
this.getChildElement("loadMore").keypress(function(b){switch(b.which){case d.globals.keyCodes.RETURN:case d.globals.keyCodes.SPACE:a.getChildElement("loadMore").click()}}),this.subscribe("paginator.text.set",function(b){a.getChildElement("loadMore").text(b)}));if(this.options.infinite)c(window).on("scroll.pagination",a.scrollPagination.bind(a));this.options.disableDuringPolling&&(this.subscribe("resultspage.streaming.start",this.disablePaginator.bind(this,!0)),this.subscribe("resultspage.streaming.done",
this.disablePaginator.bind(this,!1)))},logUserInteraction:function(a,b){d.Analytics.api.trackEvent({category:this.trackCategory,action:a,label:b})},scrollPagination:function(){!this.loading&&this.activeSearch&&this.element.offset().top<c(window).scrollTop()+(c(window).height()+this.options.infiniteScrollingOffset)&&(this.element.addClass("loading"),this.loading=!0,this.userChangedIndex(++this.activeIndex))},disablePaginator:function(a){this.element.toggleClass("disabled",a)},userChangedIndex:function(a){this.setIndex(a);
d.events.publish("paginator.change",{pageNumber:a,append:this.options.button||this.options.infinite})},setIndex:function(a){this.activeIndex=a},getIndex:function(){return this.activeIndex},updateBounds:function(a){this.pageCount!==a&&(this.pageCount=a)},updateDOM:function(){var a=this;this.numbered&&!this.options.silent&&c("[page-idx]").each(function(){parseInt(c(this).attr("page-idx"))===a.activeIndex?c(this).removeClass("Paginator-Item-Hidden"):c(this).addClass("Paginator-Item-Hidden")});this.options.infinite||
this.options.button||(1<this.pageCount?(this.element.addClass("visible"),this.numbered&&(this.renderDisplayRange(),this.element.find("a.page-Next, a.page-Previous").removeClass("disabled"),this.activeIndex===this.pageCount?this.element.find("a.page-Next").addClass("disabled"):1===this.activeIndex&&this.element.find("a.page-Previous").addClass("disabled"))):this.element.removeClass("visible"))},renderPageLink:function(a){return d.template.render(this.pageNumberTemplateId,{index:a,cssClass:a===this.activeIndex?
"active":""})},renderEllipsis:function(){return"\x3cspan\x3e\x26nbsp;\x26hellip;\x26nbsp;\x3c/span\x3e"},renderDisplayRange:function(){var a=this,b=this.element.find("div.page-Numbers");b.html("");var d=this.renderPageLink(1),e=0<this.activeIndex-1?this.activeIndex-1:1,f=e+this.options.maxPages-1;f>=this.pageCount&&(f=this.pageCount,e=f-this.options.maxPages+1);for(2<e?d+=this.renderEllipsis():2>e?e=2:--f;e<f;e++)d+=this.renderPageLink(e);f<this.pageCount&&(d+=this.renderEllipsis());d+=this.renderPageLink(this.pageCount);
b.html(d).find("a").click(function(){c(this).parent().hasClass("active")||(a.options.logUserInteraction&&a.logUserInteraction("Page",c(this).data("idx")),a.userChangedIndex(c(this).data("idx")),c(this).parent().addClass("active"))})}})})(R9,jQuery);(function(c,e){c.createComponentClass("common.results.ProgressBar",{bar:null,timerId:null,currentValue:null,startTime:null,elapsedTime:null,delayInterval:150,options:{linear:!1,totalTime:6E4,interval:750,percentage:0,visible:!0,startEvents:["search.startSearch"],stopEvents:["resultspage.streaming.done"]},init:function(){this.bar=this.getChildElement("bar");0<this.options.percentage&&(this.currentValue=this.options.percentage);this.options.visible&&this.startTimer()},addEventHandlers:function(){var a=
this;this.subscribe(this.options.stopEvents,function(){a.finish()});this.subscribe(this.options.startEvents,function(b){b=b&&!isNaN(b.delay)?b.delay:400;a.stopTimer();a.element.addClass("Reset").addClass("notrans");a.setPercentage(0);var d=function(){a.element.removeClass("Reset");a.start();c.dom.schedule(function(){a.element.removeClass("notrans")})};0<b?setTimeout(d,b):d()})},setPercentage:function(a){isNaN(a)||(this.currentValue=100<a?100:a,a="translateX("+this.currentValue+"%)",this.bar.css({transform:a,
msTransform:a}))},getPosition:function(a){return this.options.linear?a:(3.4+(1-Math.exp(-(6*a-1.5))))/4.4},timerCallback:function(){this.elapsedTime=(new Date).getTime()-this.startTime;if(this.elapsedTime>=this.options.totalTime)this.finish();else if(100===this.currentValue)this.finish();else{var a=100*this.getPosition(this.elapsedTime/this.options.totalTime);this.setPercentage(a);c.events.publish("progressbar.percentage.change",{percent:a});this.setNextTimeout(this.delayInterval)}},finish:function(){var a=
this;this.setPercentage(100);this.stopTimer();setTimeout(function(){a.element.addClass("Hidden");c.events.publish("progressbar.finished")},400)},start:function(){this.element.removeClass("Hidden");this.startTimer()},setNextTimeout:function(a){var b=this;this.timerId=window.setTimeout(function(){b.timerCallback()},a)},startTimer:function(){null===this.timerId&&(this.elapsedTime=0,this.startTime=(new Date).getTime(),this.setNextTimeout(this.delayInterval))},stopTimer:function(){null!==this.timerId&&
(window.clearTimeout(this.timerId),this.startTime=this.timerId=null)}})})(R9,jQuery);(function(d,b){d.createComponentClass("common.results.ResultsPageNotifications",{options:{openDuration:6E3},open:!1,queue:null,showTimeoutId:null,messageContainer:null,init:function(){this.queue=[];this.messageContainer=this.getChildElement("container").detach()},inlineComponentsReady:function(){this.toolTip=this.getChildElement("target").getWidget();this.toolTip.setOption("onClose",this.closeMessage.bind(this));this.toolTip.setOption("keepOpenOnContentHover",!0);this.toolTip.setOption("closeOnBodyClick",
!1);this.toolTip.setOption("fixedPositioning",{bottom:"50px",top:"inherit"})},addEventHandlers:function(){var a=this;this.subscribe("resultspage.notify",this.queueMessage.bind(this));b(document).on("click.notificationTooltip","#r9-tooltiprpnotify-wrapper .js-close",function(){a.open&&a.toolTip.close()})},destroy:function(){this.base();b(document).off("click.notificationTooltip")},queueMessage:function(a){this.queue.push(a);this.open||this.showNextMessage()},showNextMessage:function(){this.showTimeoutId&&
window.clearTimeout(this.showTimeoutId);this.showTimeoutId=window.setTimeout(this.handleNextMessage.bind(this),100)},handleNextMessage:function(){var a=this.queue.splice(0,1)[0];if(a&&a.content){this.messageContainer.find(".js-content").empty().append(a.content);this.toolTip.setContent(this.messageContainer);this.toolTip.open();this.open=!0;var c="number"===typeof a.openDuration?a.openDuration:this.options.openDuration;if(a.keepOpen||a.openWhileIdle){if(a.openWhileIdle)b(document).one("mousemove scroll click",
function(){this.toolTip.closeAfter(c)}.bind(this))}else this.toolTip.closeAfter(c)}},prepareMessage:function(a){this.messageContainer.find(".js-content").empty().append(a);return this.messageContainer},closeMessage:function(){this.open=!1;this.queue.length&&this.showNextMessage()}})})(R9,jQuery);(function(b){window.showUsSanctionedCountriesPopup=function(){window.open("http://www.treasury.gov/resource-center/sanctions/Programs/Pages/Programs.aspx","_blank")};b.createComponentClass("common.results.SearchFailed",{defaultErrorMessage:null,hasUniqueNoResultsMessage:!1,failureTypes:{BAD_QUERY:"query",NO_RESULTS:"noresults",SERVER_ISSUE:"server",TIMEOUT:"timeout"},init:function(){var a=this;this.defaultErrorMessage=this.getChildElement("reason").html();b.events.when(["common.results.NoResults.ready",
"rentals.results.RentalNoResults.ready"],function(){a.hasUniqueNoResultsMessage=!0})},addEventHandlers:function(){b.events.subscribe("search.searchFailed",this.handleSearchFailure.bind(this));b.events.subscribe("search.startSearch",this.hideSearchFailedView.bind(this));b.events.subscribe("resultspage.requestResults",this.hideSearchFailedView.bind(this))},handleSearchFailure:function(a){this.hasUniqueNoResultsMessage&&a&&a.type===this.failureTypes.NO_RESULTS?this.hideSearchFailedView():this.showSearchFailedView(a&&
a.userDisplayMessage?a.userDisplayMessage:this.defaultErrorMessage)},showSearchFailedView:function(a){this.getChildElement("reason").html(a);this.element.show()},hideSearchFailedView:function(){this.element.hide()}})})(R9);(function(d,e){var f={hotels:"hotels/results/HotelShare",cruises:"cruises/results/CruiseShare",cars:"cars/results/CarShare",rentals:"rentals/results/RentalShare",flights:"flights/results/FlightShare",trains:"trains/results/TrainShare"};d.createComponentClass("common.results.Sharing",{dialog:null,urlInput:null,clipper:null,copyTooltip:null,emailFrom:null,emailTo:null,emailMessage:null,message:null,form:null,send:null,hid:null,rating:null,photoColumn:null,cityName:"",cityImageUrl:"",options:{vertical:"hotels",
sourceId:void 0,messages:{},useClipboardCopy:!1,photoColumn:!1,hasRating:!1,useStars:!0,smartEmail:!1},init:function(){this.form=this.getChildElement("form");this.urlInput=this.getChildElement("url");this.urlInput.attr("data-clipboard-target","#"+this.id("url"));this.options.useClipboardCopy?this.clipper=new d.common.widgets.clipboard.ClipboardCopy(".clipboardTrigger"):"undefined"!==typeof window.Clipboard?this.clipper=new Clipboard(".clipboardTrigger"):(this.element.find(".col-copy").hide(),this.element.find(".col-url").removeClass("col-url").addClass("col"));
this.copyTooltip=this.getChildElement("tooltip");this.emailFrom=this.getChildElement("emailFrom");this.emailTo=this.getChildElement("emailTo");this.emailMessage=this.getChildElement("emailMessage");this.hid=this.getChildElement("sharing_email_resultid");this.send=this.getChildElement("send");this.options.photoColumn&&(this.options.hasRating&&(this.rating=this.getChildElement("rating").children()),this.photoColumn=this.getChildElement("photoColumn"))},addEventHandlers:function(){var a=this;if(null!==
this.clipper&&!this.options.useClipboardCopy)this.clipper.on("success",function(b){d.Analytics.api.trackEvent({category:"Share",action:"copy-link"});a.copyTooltip.addClass("show");setTimeout(function(){a.copyTooltip.removeClass("show")},2E3)});d.events.subscribe("share",function(b){if(b&&("flighttracker"===b.page||"explore"===b.page))return b.sourceId&&b.sourceId!==a.options.sourceId||(a.createDialog(),a.dialog.open(),setTimeout(function(){a.urlInput.val(b.url);a.urlInput.focus()},100)),!1;var c=
f[a.options.vertical];c?a.openForm(b,c):console.warn("No share component found for current vertical: "+a.options.vertical)});this.form.on("submit",function(b){a.options.smartEmail?(a.emailTo.getWidget().val(a.emailTo.val().replace(" ","")),a.emailFrom.getWidget().val(a.emailFrom.val().replace(" ",""))):(a.emailTo.val(a.emailTo.val().replace(" ","")),a.emailFrom.val(a.emailFrom.val().replace(" ","")));b=validateEmail(a.emailFrom.val());var c=a.validateToField();a.emailTo.toggleClass("form-error",!c);
a.emailFrom.toggleClass("form-error",!b);c&&b?(a.send.attr("disabled","disabled"),a.showMessage("SHARING_PROGRESS"),e.ajax({type:"POST",url:d.globals.remoteHost+"/s/emailresult",data:a.form.serialize(),headers:{"X-CSRF":d.globals.formtoken},success:function(){d.events.publish("share.success",a.getChildElement("sharing_email_resultid").val());a.send.removeAttr("disabled");a.dialog&&a.showSuccess("SHARING_SUCCESS");d.Analytics.api.trackEvent({category:"Share",action:"share-result"})},error:function(){a.showError("SHARING_ERROR");
a.send.removeAttr("disabled")}})):(a.showError("EMAIL_ERROR"),a.options.smartEmail&&(a.emailTo.getWidget().checkRestrictions(),a.emailFrom.getWidget().checkRestrictions()));return!1})},createDialog:function(){var a=this;this.dialog=this.dialog||this.getChildElement("dialog").dialog({isOpenTopZindex:!0,onClose:function(){a.emailTo.removeClass("form-error");a.emailFrom.removeClass("form-error");a.clearMessage();d.Analytics.api.trackEvent({category:"Share",action:"close-share"});a.options.photoColumn&&
a.clearSharingData()}}).getWidget()},openForm:function(a,b){var c=this;this.options.hasRating=null;d.action.execute(b,{searchId:a.searchId,resultId:a.resultId,filterState:d.question.ask("resultspage.urlFilterState.get")},function(b){var d=a.tripShareUrl?a.tripShareUrl:b.url;a.sharingDialogTitle&&""!==a.sharingDialogTitle&&c.getChildElement("title").html(a.sharingDialogTitle);c.urlInput.val(d);c.createDialog();c.dialog.open();c.urlInput.focus();c.getChildElement("sharing_email_fs").val(b.fs);c.getChildElement("sharing_email_subject").val(b.emailSubject);
c.getChildElement("sharing_email_searchid").val(a.searchId);c.getChildElement("sharing_email_resultid").val(a.resultId);c.options.photoColumn&&c.addSharingData(e.extend({},a,b));a.hideSharingForm&&(c.element.addClass("no-sharing-form"),c.getChildElement("sharingForm").hide())})},addSharingData:function(a){a.hasOwnProperty("tripSourceName")?this.getChildElement("sourceName").html(a.tripSourceName):a.hasOwnProperty("sourceName")&&this.getChildElement("sourceName").html(a.sourceName);a.hasOwnProperty("hotelName")&&
this.getChildElement("sourceName").html(a.hotelName);a.hasOwnProperty("sourceImageUrl")?(this.photoColumn.removeClass("hidden").css({"background-image":"none"}),this.photoColumn.animate({opacity:0},0).css({"background-image":'url("'+a.sourceImageUrl+'")'}).animate({opacity:1},1E3)):d.Common.Utils.String.isEmpty(this.cityImageUrl)&&this.photoColumn.addClass("hidden");this.rating&&(a.hasOwnProperty("rating")?(this.rating.removeClass(function(a,c){return(c.match(/(^|\s)count-\S+/g)||[]).join(" ")}),
this.rating.addClass("count-"+a.rating),this.rating.attr("data-count",a.rating),!a.useStars&&this.options.useStars&&this.rating.removeClass("starIcon").addClass("circleIcon"),a.useStars||this.options.useStars?this.rating.find(".star").removeClass("circle"):this.rating.find(".star").addClass("circle")):this.rating.attr("aria-hidden","true"))},validateToField:function(){var a=this.emailTo.val().split(","),b=!0;e.each(a,function(a,d){validateEmail(d.replace(" ",""))||(b=!1)});return b},showMessage:function(a){this.getChildElement("message").removeClass("success error").html(this.options.messages[a])},
showError:function(a){this.getChildElement("message").removeClass("success").addClass("error").html(this.options.messages[a])},showSuccess:function(a){this.getChildElement("message").removeClass("error").addClass("success").html(this.options.messages[a])},clearMessage:function(){this.getChildElement("message").html("")},clearSharingData:function(){this.photoColumn.hasClass("hidden")&&this.photoColumn.removeClass("hidden");this.options.hasRating&&null!==this.rating&&this.rating.hasClass("circleIcon")&&
this.rating.removeClass("circleIcon").addClass("starIcon")}})})(window.R9,window.jq||window.jQuery);var _slicedToArray=function(){return function(e,d){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var a=[],b=!0,c=!1,g=void 0;try{for(var f=e[Symbol.iterator](),h;!(b=(h=f.next()).done)&&(a.push(h.value),!d||a.length!==d);b=!0);}catch(k){c=!0,g=k}finally{try{if(!b&&f["return"])f["return"]()}finally{if(c)throw g;}}return a}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}();
(function(e,d){e.createComponentClass("common.results.SortDropdown",{sortDropdownWidget:null,placeholderOption:[],unrolledOptions:null,unrolledDropdowns:null,dropdownWidgetType:"dropdown",useDropdownPlaceholderOption:!1,options:{activeSortType:"rank_a",isSortUnrolled:!1,hasDropdown:!1,hasDropdownSortText:!1,useSelectWidget:!1,styleJamSelect:!1},init:function(){this.options.hasDropdown&&(this.options.styleJamSelect?this.setupStyleJamSelect():this.setupDropdownWidget());this.options.useSelectWidget&&
this.setupSelectWidget();this.options.isSortUnrolled&&this.setupUnrolledOptions();this.options.hasDropdown&&this.options.isSortUnrolled&&(this.options.useSelectWidget||(this.placeholderOption=d(this.sortDropdownWidget.element.find('option[value\x3d""]'))),this.useDropdownPlaceholderOption=!0,this.updatePlaceholderOption())},addEventHandlers:function(){var a=this;this.options.isSortUnrolled&&this.unrolledOptions.click(function(b){a.setSortMode(d(b.currentTarget).attr("data-sort"))});this.subscribe(["resultsHeader.sortType.set",
"resultspage.sortMode.changed"],this.handleSortModeChange.bind(this))},setupDropdownWidget:function(){var a=this;this.dropdownWidgetType=this.options.useSelectWidget?"r9Select":this.dropdownWidgetType;(this.sortDropdownWidget=this.getChildElement("sorting")[this.dropdownWidgetType]({change:function(b){return b&&a.setSortMode()}}).getWidget())||this.log.console("SortDropdownWidget is undefined, but hasDropdown is set to true in sortDropdown's velocity template.")},setupStyleJamSelect:function(){var a=
this;this.sortDropdownWidget=this.getChildElement("sorting").getWidget();this.sortDropdownWidget.setOption("change",function(b){return a.setSortMode()})},setupSelectWidget:function(){this.options.isSortUnrolled&&(this.placeholderOption=d(this.sortDropdownWidget.dropdownOptions[0]).detach())},setupUnrolledOptions:function(){this.unrolledOptions=this.getChildElement("sortUnrolled").find("a.sortOption");this.unrolledDropdowns=this.getChildElement("sortUnrolled").find("a.sortDropdown")},setSortMode:function(){var a=
0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.sortDropdownWidget&&this.sortDropdownWidget.getValue(),a=d.extend({},1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},{sortCode:a});e.events.publish("resultsHeader.sortType.set",a)},handleSortModeChange:function(a){a.sortCode&&(this.setSelectedDropdownOption(a.sortCode),this.setSelectedUnrolled(a.sortCode),this.updatePlaceholderOption())},setSelectedDropdownOption:function(a){if(this.options.hasDropdown){var b=this.findDropdownSortElement(a),
c=b&&0<b.length;c&&(this.sortDropdownWidget.setValue(a),this.sortDropdownWidget.setText(b.attr("title")));this.sortDropdownWidget.element.toggleClass("selected",c).attr("aria-selected",c)}},setSelectedUnrolled:function(a){var b=this;if(this.options.isSortUnrolled){var c=this.unrolledOptions.add(this.unrolledDropdowns);c.each(function(a,c){return b.resetUnrolledOption(c)});var d=a.split("_")[0],c=c.filter("[data-sort*\x3d"+d+"]");a=this.flipSortCodeDirection(a);c.addClass("selected").attr("aria-selected",
!0);c.attr("data-sort",a)}},resetUnrolledOption:function(a){d(a).removeClass("selected").attr("aria-selected",!1);var b=d(a).attr("data-default-sort");b&&d(a).attr("data-sort",b)},flipSortCodeDirection:function(a){var b=a.split("_"),c=_slicedToArray(b,2),b=c[0];return(c=c[1])?b+"_"+("a"===c?"b":"a"):a},updatePlaceholderOption:function(){if(this.useDropdownPlaceholderOption){var a=this.placeholderOption.text();this.element.find(".sortOption.selected").length?(this.sortDropdownWidget.setText(a),this.sortDropdownWidget.setValue(this.placeholderOption.val(),
!1),this.sortDropdownWidget.element.removeClass("selected").attr("aria-selected",!1)):(this.placeholderOption.removeAttr("selected").attr("aria-selected",!1),this.sortDropdownWidget.element.addClass("selected").attr("aria-selected",!0));this.placeholderOption({disabled:"disabled","aria-disabled":!0,hidden:"hidden","aria-hidden":!0})}},findDropdownSortElement:function(a){return this.options.useSelectWidget?this.sortDropdownWidget.dropdownOptions.filter(function(b,c){return d(c).attr("data-value")===
a}):this.options.styleJamSelect?this.sortDropdownWidget.getSelectedItem(a):this.element.find("option[value\x3d"+a+"]")}})})(window.R9,window.jq||window.jQuery);var _slicedToArray=function(){return function(e,c){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var a=[],b=!0,f=!1,d=void 0;try{for(var h=e[Symbol.iterator](),g;!(b=(g=h.next()).done)&&(a.push(g.value),!c||a.length!==c);b=!0);}catch(k){f=!0,d=k}finally{try{if(!b&&h["return"])h["return"]()}finally{if(f)throw d;}}return a}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}(),_typeof="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:
function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};
(function(e,c){e.createComponentClass("common.results.SortTabContainer",{unrolledTabs:null,rolledTabs:null,moreDropdown:null,slider:null,currentSortState:"",activeTabElement:null,lastUnrolledTab:null,watchListTab:null,watchListCountEl:null,watchListCount:0,unrolledTabsSize:0,watchListAddedMessage:"",firstLoad:!0,watchListMsgTimeoutId:null,distanceTab:null,currentSortBase:"",infoTooltip:null,options:{activeSortTab:"rank_a",showDropdown:!0,maxUnrolledTabs:3,accountMessage:"",pricePlusMessage:"",priceFromMessage:"",
bestValueTabCls:"bestflightTab",formatPrice:!0,watchlistMakeoverEnabled:!1,watchListSortMax:"",watchListAccMsgHide:!1,watchListMsgDuration:2E3,toolTipExtraCssClass:"",customTicketEnabled:!1,customTicketStr:"customTicket_a",showSlideOverlay:!1},init:function(){this.unrolledTabs=this.getChildElement("unrolledTabs");this.rolledTabs=this.getChildElement("rolledTabs");this.lastUnrolled=this.getChildElement("lastUnrolled");this.moreDropdown=this.getChildElement("moreDropdown").getWidget();this.options.watchlistMakeoverEnabled&&
(this.watchListTab=this.getChildElement("watchlistTab"),this.watchListCountEl=this.getChildElement("watchlistCount"),this.unrolledTabsSize=this.unrolledTabs.attr("data-size"),this.watchListAddedMessage=this.watchListCountEl.parent().attr("data-added"));this.options.showSlideOverlay&&(this.slider=this.getChildElement("slider"))},addEventHandlers:function(){var a=this,b=this;this.subscribe(["resultsHeader.changed","resultspage.sortMode.changed"],this.handleSortModeChange.bind(this));this.subscribe("results.distance.sort.hide",
function(){b.element.find("[data-code\x3d'distance']");var a=c(".unrolledTabGrid").find("div:not('.col-hidden') \x3e [data-code\x3d'distance']");c(".rolledTabs").find("[data-code\x3d'distance']");var d=c(".rolledTabs").find("li a:not([data-code\x3d'distance'])").first();0<a.length&&0<d.length&&b.moveSelectedRolledTab(d);c(".rolledTabs").find("li \x3e a[data-code\x3d'distance']").parent().hide();c(".unrolledTabGrid").find("div:not('.col-hidden') \x3e [data-code\x3d'distance']").parent().addClass("col-hidden");
0==c(".rolledTabs").find("li \x3e a:not([data-code\x3d'distance'])").length&&(c(".col-overflow").addClass("col-hidden"),b.element.find(".tabGrid").removeClass("withDropdown"))});this.subscribe("results.distance.sort.show",function(){if("distance"==b.options.activeSortTab.split("_")[0]){var a=c(".rolledTabs").find("[data-code\x3d'distance']").first();1==a.length&&(a.parent().show(),b.moveSelectedRolledTab(a));0==c(".unrolledTabGrid").find("div:not('.col-hidden') \x3e [data-code\x3d'distance']").length&&
(a=c(".unrolledTabGrid").find("div.col-hidden \x3e [data-code\x3d'distance']"),0<a.length&&a.first().parent.removeClass("col-hidden"))}else c(".unrolledTabGrid").find("div.col-hidden \x3e [data-code\x3d'distance']").parent().removeClass("col-hidden"),c(".rolledTabs").find("[data-code\x3d'distance']").first().parent().show();0<c(".rolledTabs").find("li \x3e a").length&&(c(".col-overflow").removeClass("col-hidden"),b.element.find(".tabGrid").addClass("withDropdown"))});this.element.find("a.sortTab").each(function(f,
d){c(d).click(function(f){var g=c(f.currentTarget).attr("data-sort"),h={};a.options.customTicketEnabled&&(h.customTicket=g===b.options.customTicketStr);e.config.getBoolean("ui.horizon.sortTab.arrowFix.enabled",!1)&&"rank"===d.dataset.code&&(g="rank_a");a.updateSortState(a.activeTabElement||d,a.options.activeSortTab===g&&"watchlist_a"!==g&&g!==b.options.customTicketStr);g=c(f.currentTarget).attr("data-sort");a.fromCustomTicket(d.dataset.code)&&(g=d.dataset.code+("happinessScore"===d.dataset.code?"_b":
"_a"),h.forceChange=!0);e.config.getBoolean("ui.horizon.sortTab.arrowFix.enabled",!1)&&"rank"===d.dataset.code&&(g="rank_a");a.activeTabElement=d;a.options.activeSortTab=g;a.currentSortBase=c(f.currentTarget).attr("data-code");c(d).parent().hasClass("rolledContainer")&&a.moveSelectedRolledTab(d);a.setSortMode(a.options.activeSortTab,h)});c(d).keypress(function(a){a.preventDefault();switch(a.which){case e.globals.keyCodes.RETURN:case e.globals.keyCodes.SPACE:c(d).click()}});f=c(d).find(".js-infoTooltip");
0!==f.length&&f.toolTip({content:f.data("tooltip"),extraClass:"mm-style sortTabInfoTooltip",position:"bottom"})});this.subscribe("resultspage.searchId.changed",function(b){a.setActiveTab()});this.options.watchlistMakeoverEnabled&&this.watchListTab&&this.watchListTab.length&&(this.subscribe("savedItemsListUpdated",this.enableWatchTab.bind(this)),"watchlist_a"===this.options.activeSortTab&&this.showWatchList());this.subscribe("search.poll.response",this.handleResultsResponse.bind(this))},handleSortModeChange:function(a){if(a&&
a.sortCode){var b=a.sortCode.split("_")[0];""!==this.currentSortBase&&b===this.currentSortBase||this.updateSortLayout(b);this.setActiveTab(a.customTicket?this.options.customTicketStr:a.sortCode)}},handleResultsResponse:function(a){if(a=a.sortTabData){this.element.find(".sortTab:not([data-sub-text])").addClass("hideSubTitle");if(a.cheapestPrice){var b=this.element.find(".priceTab"),c="true"===a.useFromMessage?this.options.priceFromMessage:this.options.pricePlusMessage;b.find(".price").text(this.getFormattedSortTabPrice(a.cheapestPrice,
c));b.removeClass("hideSubTitle")}a.cheapestBestFlight&&(b=this.element.find("."+this.options.bestValueTabCls),b.find(".price").text(this.getFormattedSortTabPrice(a.cheapestBestFlight)),b.removeClass("hideSubTitle"));a.shortestDurationFlightPrice&&(b=this.element.find(".durationTab"),b.find(".price").text(this.getFormattedSortTabPrice(a.shortestDurationFlightPrice)),b.removeClass("hideSubTitle"));a.highestHappinnessScoreFlightPrice&&(b=this.element.find(".happinessScoreTab"),b.find(".price").text(this.getFormattedSortTabPrice(a.highestHappinnessScoreFlightPrice)),
b.removeClass("hideSubTitle"));a.highestRankHotel&&(b=this.element.find(".rankTab"),b.find(".price").text(this.getFormattedSortTabPrice(a.highestRankHotel,this.options.priceFromMessage)),b.removeClass("hideSubTitle"));a.highestUserRatingHotel&&(b=this.element.find(".userratingTab"),b.find(".price").text(this.getFormattedSortTabPrice(a.highestUserRatingHotel,this.options.priceFromMessage)),b.removeClass("hideSubTitle"));a.cheapestFlightDuration&&(b=this.element.find(".priceTab"),b.find(".duration").text(a.cheapestFlightDuration),
b.removeClass("hideSubTitle"));a.shortestDurationFlightDuration&&(b=this.element.find(".durationTab"),b.find(".duration").text(a.shortestDurationFlightDuration),b.removeClass("hideSubTitle"));a.highestHappinnessScoreFlightDuration&&(b=this.element.find(".durationAndPriceRatioTab"),b.find(".duration").text(a.highestHappinnessScoreFlightDuration),b.removeClass("hideSubTitle"))}},getFormattedSortTabPrice:function(a,b){return!0===this.options.formatPrice?(b&&0!==b.length||(b=this.options.pricePlusMessage),
e.Common.Utils.String.formatString(b,a)):a},isWatchListActive:function(){return"watchlist"===this.options.activeSortTab.split("_")[0]},toggleSavedItems:function(a){a?(this.showNavMenuMessage(),e.events.publish("resultsSavedItems.show")):e.events.publish("resultsSavedItems.hide")},enableWatchTab:function(a){if(a){var b=this.watchListCount;this.watchListCount=a.listSize;0<this.watchListCount?this.showWatchList(b):this.hideWatchList()}this.firstLoad=!1},showWatchList:function(a){this.watchListTab.hasClass("col-hidden")&&
(this.watchListTab.removeClass("col-hidden"),this.unrolledTabs.removeClass("unrolledCount"+this.unrolledTabsSize).addClass("unrolledCount"+(this.unrolledTabsSize+1)));this.watchListCountEl[this.watchListCount?"show":"hide"]();this.watchListCountEl.text(9<this.watchListCount?this.options.watchListSortMax:this.watchListCount);this.showWatchListMessage(a)},hideWatchList:function(){this.watchListTab.hasClass("col-hidden")||(this.watchListTab.addClass("col-hidden"),this.unrolledTabs.removeClass("unrolledCount"+
(this.unrolledTabsSize+1)).addClass("unrolledCount"+this.unrolledTabsSize));this.watchListCountEl.text(0);this.isWatchListActive()&&this.watchListTab.next().children().trigger("click")},showWatchListMessage:function(a){this.removeWatchListMessage();clearTimeout(this.watchListMsgTimeoutId);!this.watchListAddedMessage||this.firstLoad||a>=this.watchListCount||(this.inViewport()?this.showWatchListToolTip():this.animateInView(this.showWatchListToolTip.bind(this)))},showWatchListToolTip:function(a){var b=
this;this.watchListCountEl.toolTip({subNameSpace:"watchListAdded",content:this.watchListAddedMessage,position:"bottom",activation:"click",showImmediately:!0,closeOnBodyClick:!1,offsetAgainstEdge:!1,appendTo:"#"+b.watchListTab.attr("id")});this.watchListMsgTimeoutId=setTimeout(function(){b.removeWatchListMessage();"function"===typeof a&&a()},this.options.watchListMsgDuration)},showNavMenuMessage:function(){this.options.watchListAccMsgHide||(this.options.watchListAccMsgHide=!0,setMetaCookie("watchListAccMsgHide",
"true"),e.Analytics.api.trackEvent({category:"watchlist",action:"NavMenu-msg-show"}),e.events.publish("NavMenu.showMessage",{id:"profileIcon",text:this.options.accountMessage}))},removeWatchListMessage:function(){this.watchListCountEl.data("toolTip")&&this.watchListCountEl.data("toolTip").removeWidget()},inViewport:function(){var a,b;a=c(window).scrollTop();b=a+c(window).height();var f,d;f=this.element.offset().top;d=f+this.element.outerHeight();return f<=b&&d>=a},animateInView:function(a){var b=
this,f=this.element.children(".tabGrid"),d=this.element.outerHeight();this.element.css("height",d);f.addClass("fixed down");c(window).on("scroll.SortTabContainer",function(){b.inViewport()&&(f.removeClass("fixed down"),c(window).off("scroll.SortTabContainer"))});setTimeout(function(){a(function(){f.removeClass("down");c(window).off("scroll.SortTabContainer");setTimeout(function(){f.removeClass("fixed");b.element.css("height","")},500)})},500)},updateSortLayout:function(a){a=this.rolledTabs.find("[data-code\x3d'"+
a+"']");a.length&&a.attr("data-rank")>this.options.maxUnrolledTabs&&this.moveSelectedRolledTab(a)},moveSelectedRolledTab:function(a){this.lastUnrolledTab=this.lastUnrolled.find(".sortTab");var b=(c(this.lastUnrolledTab).attr("data-rank")||this.options.maxUnrolledTabs)-this.options.maxUnrolledTabs;c(a).detach().appendTo(c(this.lastUnrolled));a="li:eq("+b+")";c(this.lastUnrolledTab).detach().appendTo(c(this.rolledTabs.find(a)))},setSortMode:function(){var a=c.extend({},1<arguments.length&&void 0!==
arguments[1]?arguments[1]:{},{sortCode:0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.options.activeSortTab});e.events.publish("resultsHeader.sortType.set",a)},setActiveTab:function(){var a=this,b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.options.activeSortTab;this.options.activeSortTab=b;var f=b.split("_");this.element.find("a.sortTab").each(function(b,e){var d=c(e).attr("data-code")===f[0],h="watchlist"===c(e).attr("data-code");c(e).toggleClass("active",d);c(e).attr("aria-selected",
d);a.options.showSlideOverlay&&d&&a.slider.css("transform","translate("+100*b+"%)");d&&a.options.activeSortTab!==c(e).attr("data-sort")&&a.updateSortState(e,!0);a.options.watchlistMakeoverEnabled&&h&&a.toggleSavedItems(d)})},enableTab:function(a){a&&("object"===("undefined"===typeof a?"undefined":_typeof(a))?a.removeClass("disabled"):this.element.find("a.sortTab[data-code\x3d'"+a+"']").removeClass("disabled"))},disableTab:function(a){a&&("object"===("undefined"===typeof a?"undefined":_typeof(a))?
a.addClass("disabled"):this.element.find("a.sortTab[data-code\x3d'"+a+"']").addClass("disabled"))},isDisabledTab:function(a){return a?this.element.find("a.sortTab[data-code\x3d'"+a+"']").hasClass("disabled"):!1},updateSortState:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.activeTabElement,b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:!1,e,d;b?(e=c(a).attr("data-sort").split("_"),d=_slicedToArray(e,2),e=d[0],(d=d[1])&&(d="a"===d?"b":"a")):(e=c(a).attr("data-code"),
d=c(a).attr("data-direction"));d&&e&&(c(a).attr("data-sort",e+"_"+d),c(a).toggleClass("ascending",b?!c(a).hasClass("ascending"):"a"===c(a).attr("data-icon")),c(a).attr("aria-label","a"===d?c(a).attr("data-lbl-asc"):c(a).attr("data-lbl-dsc")))},fromCustomTicket:function(a){return this.options.customTicketEnabled&&this.options.activeSortTab===this.options.customTicketStr&&a!==this.currentSortBase}})})(window.R9,window.jq||window.jQuery);(function(c,b){c.createComponentClass("common.results.TabUrgency",{originalTitle:void 0,isOn:!1,waitTimeout:void 0,options:{title:void 0,waitTime:5E3,includeCurrentTitle:!0},init:function(){this.originalTitle=document.title},isRP:function(){return 0===b(".vm-fd").length},addEventHandlers:function(){window.onblur=b.proxy(this.turnOn,this);window.onfocus=b.proxy(this.turnOff,this)},turnOn:function(){var a=this;a.isRP()&&!a.isOn&&(a.isOn=!0,a.originalTitle=document.title,a.waitTimeout=setTimeout(function(){document.title=
a.options.includeCurrentTitle?a.options.title+" "+a.originalTitle:a.options.title},a.options.waitTime))},turnOff:function(){this.isRP()&&(this.isOn=!1,clearTimeout(this.waitTimeout),0===document.title.indexOf(this.options.title)?document.title=this.originalTitle:this.originalTitle=document.title)}})})(R9,jQuery);(function(c){R9.extend("Widgets",{Checkbox:function(a,b){this.elementNode=a;this.element=c(this.elementNode);this.icon=c(R9.Widgets.Checkbox.findIconNode(this.elementNode));this.validateElement()&&(this.options=c.extend({},this.options,b),this.init())}});R9.extend("Widgets.Checkbox",{isCheckbox:function(a){return a&&a.nodeName&&"input"==a.nodeName.toLowerCase()&&"checkbox"==a.type.toLowerCase()},isWidgetControlled:function(a){return c(a).hasClass(R9.Widgets.Checkbox.prototype.widgetBaseClass+"-input")},
refresh:function(a,b){b=c(b);b[a.checked?"addClass":"removeClass"](R9.Widgets.Checkbox.prototype.widgetBaseClass+"-icon-checked");b[a.disabled?"addClass":"removeClass"](R9.Widgets.Checkbox.prototype.widgetBaseClass+"-icon-disabled")},findIconNode:function(a){return c(a).closest("[id$\x3d'-icon']")},findElementNode:function(a){return document.getElementById(a.id.substring(0,a.id.lastIndexOf("-icon")))}});R9.extend("Widgets.Checkbox.prototype",{widgetName:"checkbox",widgetBaseClass:"r9-checkbox",elementNode:null,
element:null,icon:null,options:{click:null,change:null},init:function(){this.bindInputClickEvent();this.bindInputEvent("change",this.handleElementChangeEvent);this.bindInputEvent("focus",this.handleElementFocusEvent);this.bindInputEvent("blur",this.handleElementBlurEvent);this.element.data(this.widgetName,this)},validateElement:function(){return R9.Widgets.Checkbox.isCheckbox(this.elementNode)&&R9.Widgets.Checkbox.isWidgetControlled(this.elementNode)},bindInputEvent:function(a,b){var c=this;a+="."+
this.widgetName;this.element.unbind(a).bind(a,function(a){b.call(c,this,R9.Widgets.Checkbox.findIconNode(this),a)})},bindInputClickEvent:function(){this.bindInputEvent("click",this.handleElementClickEvent)},handleElementClickEvent:function(a,b,c){this.options.click&&this.options.click.apply(this,arguments)},handleElementChangeEvent:function(a,b,c){R9.Widgets.Checkbox.refresh(a,b);this.options.change&&this.options.change.apply(this,arguments)},handleElementFocusEvent:function(a,b,d){a.disabled||(c(b).addClass(this.widgetBaseClass+
"-state-focus"),this.options.focus&&this.options.focus.apply(this,arguments))},handleElementBlurEvent:function(a,b,d){a.disabled||(c(b).removeClass(this.widgetBaseClass+"-state-focus"),this.options.blur&&this.options.blur.apply(this,arguments))}})})(jq||jQuery);
(function(c){R9.createWidgetClass("checkbox.Checkbox",c.extend({},R9.Widgets.Checkbox.prototype,{isToggle:!1,options:{keydown:c.noop,click:null,change:null},init:function(){this.elementNode=this.element.get(0);this.element.parent().is(".toggle")&&(this.isToggle=!0);this.label=this.getChildElement("label")},addEventHandlers:function(){this.bindInputClickEvent();this.bindInputEvent("change",this._handleElementChangeEvent);this.bindInputEvent("focus",this.handleElementFocusEvent);this.bindInputEvent("blur",
this.handleElementBlurEvent)},_handleElementChangeEvent:function(a,b,d){this.handleElementChangeEvent(a,b,d);b=c(a).prop("checked");a.setAttribute("aria-checked",b);this.label&&this.isToggle&&this.label.attr("aria-label",this.label.children(b?".on":".off").html())},setEnabled:function(a){a?this.element.removeAttr("disabled"):this.element.attr("disabled","disabled");this.element.attr("aria-disabled",!a);R9.Widgets.Checkbox.refresh(this.element,this.icon)},getValue:function(){return this.element.prop("checked")},
setChecked:function(a){this.element.prop("checked",a)}}))})(jq||jQuery);/*
 clipboard.js v1.7.1
 https://zenorocha.github.io/clipboard.js

 Licensed MIT © Zeno Rocha
*/
(function(m){"object"==typeof exports&&"undefined"!=typeof module?module.exports=m():"function"==typeof define&&define.amd?define([],m):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Clipboard=m()})(function(){return function f(h,k,a){function b(d,g){if(!k[d]){if(!h[d]){var c="function"==typeof require&&require;if(!g&&c)return c(d,!0);if(e)return e(d,!0);g=Error("Cannot find module '"+d+"'");throw g.code="MODULE_NOT_FOUND",g;}g=k[d]={exports:{}};
h[d][0].call(g.exports,function(a){return b(h[d][1][a]||a)},g,g.exports,f,h,k,a)}return k[d].exports}for(var e="function"==typeof require&&require,l=0;l<a.length;l++)b(a[l]);return b}({1:[function(f,h,k){"undefined"==typeof Element||Element.prototype.matches||(f=Element.prototype,f.matches=f.matchesSelector||f.mozMatchesSelector||f.msMatchesSelector||f.oMatchesSelector||f.webkitMatchesSelector);h.exports=function(a,b){for(;a&&9!==a.nodeType;){if("function"==typeof a.matches&&a.matches(b))return a;
a=a.parentNode}}},{}],2:[function(f,h,k){function a(a,l,d,g){return function(c){c.delegateTarget=b(c.target,l);c.delegateTarget&&g.call(a,c)}}var b=f("./closest");h.exports=function(b,l,d,g,c){var e=a.apply(this,arguments);return b.addEventListener(d,e,c),{destroy:function(){b.removeEventListener(d,e,c)}}}},{"./closest":1}],3:[function(f,h,k){k.node=function(a){return void 0!==a&&a instanceof HTMLElement&&1===a.nodeType};k.nodeList=function(a){var b=Object.prototype.toString.call(a);return void 0!==
a&&("[object NodeList]"===b||"[object HTMLCollection]"===b)&&"length"in a&&(0===a.length||k.node(a[0]))};k.string=function(a){return"string"==typeof a||a instanceof String};k.fn=function(a){return"[object Function]"===Object.prototype.toString.call(a)}},{}],4:[function(f,h,k){function a(a,b,c){return a.addEventListener(b,c),{destroy:function(){a.removeEventListener(b,c)}}}function b(a,b,c){return Array.prototype.forEach.call(a,function(a){a.addEventListener(b,c)}),{destroy:function(){Array.prototype.forEach.call(a,
function(a){a.removeEventListener(b,c)})}}}var e=f("./is"),l=f("delegate");h.exports=function(d,g,c){if(!d&&!g&&!c)throw Error("Missing required arguments");if(!e.string(g))throw new TypeError("Second argument must be a String");if(!e.fn(c))throw new TypeError("Third argument must be a Function");if(e.node(d))return a(d,g,c);if(e.nodeList(d))return b(d,g,c);if(e.string(d))return l(document.body,d,g,c);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList");
}},{"./is":3,delegate:2}],5:[function(f,h,k){h.exports=function(a){if("SELECT"===a.nodeName)a.focus(),a=a.value;else if("INPUT"===a.nodeName||"TEXTAREA"===a.nodeName){var b=a.hasAttribute("readonly");b||a.setAttribute("readonly","");a.select();a.setSelectionRange(0,a.value.length);b||a.removeAttribute("readonly");a=a.value}else{a.hasAttribute("contenteditable")&&a.focus();var b=window.getSelection(),e=document.createRange();e.selectNodeContents(a);b.removeAllRanges();b.addRange(e);a=b.toString()}return a}},
{}],6:[function(f,h,k){function a(){}a.prototype={on:function(a,e,l){var b=this.e||(this.e={});return(b[a]||(b[a]=[])).push({fn:e,ctx:l}),this},once:function(a,e,l){function b(){g.off(a,b);e.apply(l,arguments)}var g=this;return b._=e,this.on(a,b,l)},emit:function(a){for(var b=[].slice.call(arguments,1),l=((this.e||(this.e={}))[a]||[]).slice(),d=0,g=l.length;d<g;d++)l[d].fn.apply(l[d].ctx,b);return this},off:function(a,e){var b=this.e||(this.e={}),d=b[a],g=[];if(d&&e)for(var c=0,f=d.length;c<f;c++)d[c].fn!==
e&&d[c].fn._!==e&&g.push(d[c]);return g.length?b[a]=g:delete b[a],this}};h.exports=a},{}],7:[function(f,h,k){(function(a,b){if(void 0!==k)b(h,f("select"));else{var e={exports:{}};b(e,a.select);a.clipboardAction=e.exports}})(this,function(a,b){var e=b&&b.__esModule?b:{default:b},f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},d=function(){function a(a,
b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(c,b,d){return b&&a(c.prototype,b),d&&a(c,d),c}}();b=function(){function a(c){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.resolveOptions(c);this.initSelection()}return d(a,[{key:"resolveOptions",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.action=a.action;
this.container=a.container;this.emitter=a.emitter;this.target=a.target;this.text=a.text;this.trigger=a.trigger;this.selectedText=""}},{key:"initSelection",value:function(){this.text?this.selectFake():this.target&&this.selectTarget()}},{key:"selectFake",value:function(){var a=this,b="rtl"==document.documentElement.getAttribute("dir");this.removeFake();this.fakeHandlerCallback=function(){return a.removeFake()};this.fakeHandler=this.container.addEventListener("click",this.fakeHandlerCallback)||!0;this.fakeElem=
document.createElement("textarea");this.fakeElem.style.fontSize="12pt";this.fakeElem.style.border="0";this.fakeElem.style.padding="0";this.fakeElem.style.margin="0";this.fakeElem.style.position="absolute";this.fakeElem.style[b?"right":"left"]="-9999px";this.fakeElem.style.top=(window.pageYOffset||document.documentElement.scrollTop)+"px";this.fakeElem.setAttribute("readonly","");this.fakeElem.value=this.text;this.container.appendChild(this.fakeElem);this.selectedText=(0,e.default)(this.fakeElem);this.copyText()}},
{key:"removeFake",value:function(){this.fakeHandler&&(this.container.removeEventListener("click",this.fakeHandlerCallback),this.fakeHandler=null,this.fakeHandlerCallback=null);this.fakeElem&&(this.container.removeChild(this.fakeElem),this.fakeElem=null)}},{key:"selectTarget",value:function(){this.selectedText=(0,e.default)(this.target);this.copyText()}},{key:"copyText",value:function(){var a=void 0;try{a=document.execCommand(this.action)}catch(p){a=!1}this.handleResult(a)}},{key:"handleResult",value:function(a){this.emitter.emit(a?
"success":"error",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})}},{key:"clearSelection",value:function(){this.trigger&&this.trigger.focus();window.getSelection().removeAllRanges()}},{key:"destroy",value:function(){this.removeFake()}},{key:"action",set:function(){if(this._action=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"copy","copy"!==this._action&&"cut"!==this._action)throw Error('Invalid "action" value, use either "copy" or "cut"');
},get:function(){return this._action}},{key:"target",set:function(a){if(void 0!==a){if(!a||"object"!==(void 0===a?"undefined":f(a))||1!==a.nodeType)throw Error('Invalid "target" value, use a valid Element');if("copy"===this.action&&a.hasAttribute("disabled"))throw Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if("cut"===this.action&&(a.hasAttribute("readonly")||a.hasAttribute("disabled")))throw Error('Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes');
this._target=a}},get:function(){return this._target}}]),a}();a.exports=b})},{select:5}],8:[function(f,h,k){(function(a,b){if(void 0!==k)b(h,f("./clipboard-action"),f("tiny-emitter"),f("good-listener"));else{var e={exports:{}};b(e,a.clipboardAction,a.tinyEmitter,a.goodListener);a.clipboard=e.exports}})(this,function(a,b,e,f){function d(a){return a&&a.__esModule?a:{default:a}}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function c(a,b){a="data-clipboard-"+a;if(b.hasAttribute(a))return b.getAttribute(a)}var h=d(b);b=d(e);var k=d(f),l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},
n=function(){function a(a,b){for(var d=0;d<b.length;d++){var c=b[d];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(a,c.key,c)}}return function(b,d,c){return d&&a(b.prototype,d),c&&a(b,c),b}}();f=function(a){function b(a,d){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");var c;c=(b.__proto__||Object.getPrototypeOf(b)).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
c=!c||"object"!=typeof c&&"function"!=typeof c?this:c;return c.resolveOptions(d),c.listenClick(a),c}return g(b,a),n(b,[{key:"resolveOptions",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.action="function"==typeof a.action?a.action:this.defaultAction;this.target="function"==typeof a.target?a.target:this.defaultTarget;this.text="function"==typeof a.text?a.text:this.defaultText;this.container="object"===l(a.container)?a.container:document.body}},{key:"listenClick",
value:function(a){var b=this;this.listener=(0,k.default)(a,"click",function(a){return b.onClick(a)})}},{key:"onClick",value:function(a){a=a.delegateTarget||a.currentTarget;this.clipboardAction&&(this.clipboardAction=null);this.clipboardAction=new h.default({action:this.action(a),target:this.target(a),text:this.text(a),container:this.container,trigger:a,emitter:this})}},{key:"defaultAction",value:function(a){return c("action",a)}},{key:"defaultTarget",value:function(a){if(a=c("target",a))return document.querySelector(a)}},
{key:"defaultText",value:function(a){return c("text",a)}},{key:"destroy",value:function(){this.listener.destroy();this.clipboardAction&&(this.clipboardAction.destroy(),this.clipboardAction=null)}}],[{key:"isSupported",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:["copy","cut"],b=!!document.queryCommandSupported;return("string"==typeof a?[a]:a).forEach(function(a){b=b&&!!document.queryCommandSupported(a)}),b}}]),b}(b.default);a.exports=f})},{"./clipboard-action":7,
"good-listener":4,"tiny-emitter":6}]},{},[8])(8)});(function(b,c){b.createWidgetClass("loader.AriaLoadMessage",{options:{message:""},init:function(){this.message=this.getChildElement("message")},deactivateLoadMessage:function(a){this.message.text(a);this.message.attr("aria-label",a)},activateLoadMessage:function(a){"undefined"!==typeof a?this.message.text(a):this.message.text(this.options.message);"undefined"!==typeof a?this.message.attr("aria-label",a):this.message.attr("aria-label",this.options.message)}})})(R9,jQuery);(function(d){R9.extend("Widgets",{RadiobuttonSet:function(a,b){this.elementNode=a;this.element=d(this.elementNode);if(!b||b.dontValidate||this.validateElement())this.options=d.extend({},this.options,b),this.init()}});R9.extend("Widgets.RadiobuttonSet",{isRadiobuttonSet:function(a){return a&&a.nodeName&&"span"===a.nodeName.toLowerCase()},isWidgetControlled:function(a){return d(a).hasClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass)},findLabelNode:function(a){return document.getElementById(a.id+
"-label")},findRadiobuttonSetNode:function(a){return null!=a?a.parentNode:null},refresh:function(a){var b=!1;a.find("input."+R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass).each(function(){var a=d(R9.Widgets.RadiobuttonSet.findLabelNode(this)),e=d(this);e.prop("checked")?(b=!0,a.addClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+"-label-checked")):a.removeClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+"-label-checked");e.prop("disabled")?a.addClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+
"-label-disabled"):a.removeClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+"-label-disabled")});b||(a=a.find("input."+R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass).first(),a.prop("checked",!0),d(R9.Widgets.RadiobuttonSet.findLabelNode(a[0])).addClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+"-label-checked"))},applyCallback:function(a,b,c,e){a&&(d.isFunction(a)?a.apply(b,c):(a=a[e.target.value],d.isFunction(a)&&a.apply(b,c)))}});R9.extend("Widgets.RadiobuttonSet.prototype",
{widgetName:"radiobuttonset",widgetBaseClass:"r9-radiobuttonset",elementNode:null,element:null,options:{change:null,click:null},init:function(){this.bindInputEvent("focus",this.handleElementFocusEvent);this.bindInputEvent("blur",this.handleElementBlurEvent);this.bindInputEvent("change",this.handleElementChangeEvent);this.bindInputEvent("click",this.handleElementClickEvent);this.element.data(this.widgetName,this);R9.Widgets.RadiobuttonSet.refresh(this.element)},bindInputEvent:function(a,b){var c="input."+
this.widgetBaseClass;a+="."+this.widgetName;var d=this;this.element.off(a,c).on(a,c,function(a){b.call(d,this,R9.Widgets.RadiobuttonSet.findLabelNode(this),a)})},validateElement:function(){return R9.Widgets.RadiobuttonSet.isRadiobuttonSet(this.elementNode)&&R9.Widgets.RadiobuttonSet.isWidgetControlled(this.element)&&void 0===this.element.data(this.widgetName)},handleElementFocusEvent:function(a,b,c){a.disabled||d(b).addClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+"-label-focused")},handleElementBlurEvent:function(a,
b,c){a.disabled||d(b).removeClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+"-label-focused")},handleElementChangeEvent:function(a,b,c){a.disabled||(R9.Widgets.RadiobuttonSet.applyCallback(this.options.change,this,arguments,c),R9.Widgets.RadiobuttonSet.refresh(this.element))},handleElementClickEvent:function(a,b,c){a.disabled||(R9.Widgets.RadiobuttonSet.applyCallback(this.options.click,this,arguments,c),R9.Widgets.RadiobuttonSet.refresh(this.element))}})})(jq||jQuery);
(function(d){R9.createWidgetClass("radio.StyleJamRadioButtonSet",d.extend({},R9.Widgets.RadiobuttonSet.prototype,{currentRadio:null,isTabList:!1,init:function(a){setTimeout(this.refresh.bind(this),1);this.currentRadio=this._getLabelForButton(this._getButtons().filter(":checked"));this.isTabList="tablist"===this.element.attr("role")},refresh:function(){R9.Widgets.RadiobuttonSet.refresh(this.element);var a=this.getEnabledRadios().filter("[aria-checked\x3dtrue]");a.length&&this.element.attr("aria-activedescendant",
a.attr("id"));this.focusRadio();this.isTabList&&window.setTimeout(function(){var a=this.getCheckedButton();this._getButtons().attr("aria-selected",!1);a.attr("aria-selected",!0);this.setActiveTabPanel(a)}.bind(this),1)},addEventHandlers:function(a){this.bindInputEvent("change",this.handleElementChangeEvent);this.bindInputEvent("click",this.onClick);this.element.on("focus",this.onFocus.bind(this));this.element.on("blur",this.onBlur.bind(this));this.element.on("keydown",this.onKeyDown.bind(this))},
onClick:function(a,b,c){this.handleElementClickEvent(a,b,c);this.isTabList&&this._getButtons().each(function(b,c){a===c&&this.setButtonCheckedById(c.id)}.bind(this));this.focusRadio()},focusRadio:function(a){a&&a.length||(a=this._getLabelForButton(this._getButtons().filter(":checked")));a.length&&(this.element.attr("aria-activedescendant",a.attr("id")),this.handleActiveLabel(a),a.attr("aria-checked","false"!==a.attr("aria-checked")),this.currentRadio=a)},getAllRadios:function(){return this.element.find("label")},
getEnabledRadios:function(){return this.element.find("label").filter('[data-is-label-disabled\x3d"false"]')},focusButtonSet:function(){this.getChildElement("set").focus()},onFocus:function(){var a=this.element.attr("aria-activedescendant");"undefined"===typeof a&&0<this.getEnabledRadios().length&&(a=this.getEnabledRadios().get(0).id);a&&this.focusRadio(d("#"+a));this.element.addClass("focused")},onBlur:function(){this.element.removeClass("focused")},onKeyDown:function(a){switch(a.which){case R9.globals.keyCodes.SPACE:this.checkCurrentRadio();
break;case R9.globals.keyCodes.UP:case R9.globals.keyCodes.LEFT:this.focusPreviousRadio();break;case R9.globals.keyCodes.DOWN:case R9.globals.keyCodes.RIGHT:this.focusNextRadio();break;default:return!0}return!1},checkCurrentRadio:function(){this.currentRadio&&this.checkRadio(this.currentRadio)},focusPreviousRadio:function(){var a=this.getPrevButtons(),b=this.getEnabledRadios(),a=a.length?d(a.get(0)):d(b.get(b.length-1));this.checkRadio(a)},focusNextRadio:function(){var a=this.getNextButtons(),a=a.length?
d(a.get(0)):d(this.getEnabledRadios().get(0));this.checkRadio(a)},checkRadio:function(a){a.click();this.currentRadio.attr("aria-checked",!1);this.focusRadio(a);this.currentRadio.attr("aria-checked",!0)},setActiveTabPanel:function(a){a=d("[id\x3d'%s']".format(a.attr("aria-controls")));a.length&&(this._getButtons().get().reduce(function(a,c){c=d(c).attr("aria-controls");return a.add(d("[id\x3d'%s']".format(c)))},d()).attr("aria-expanded",!1),a.attr("aria-expanded",!0))},getCheckedButton:function(){var a=
this._getButtons().get(0);this._getButtons().get().some(function(b){if(!0===d(b).prop("checked"))return a=b,!0});return d(a)},getPrevButtons:function(){return this.currentRadio.prevAll("label:visible")},getNextButtons:function(){this.currentRadio.nextAll("label:visible")},getCheckedPair:function(){var a=this.getCheckedButton();return{value:a.val(),title:this._getLabelForButton(a).attr("title")}},getRadioButtonAmount:function(){return this.element.find("input").length},getValue:function(){return this.getCheckedButton().val()},
setValue:function(a){this.setButtonCheckedByValue(a)},setButtonCheckedById:function(a){this._setButtonChecked(function(b){return b.attr("id")===a})},setButtonCheckedByValue:function(a){this._setButtonChecked(function(b){return b.val()===a})},setButtonEnabledById:function(a,b){this._setButtonEnabled(function(b){return b.attr("id")===a},b)},setButtonEnabledByValue:function(a,b){this._setButtonEnabled(function(b){return b.val()===a},b)},_setButtonChecked:function(a){var b=this;this._getButtons().each(function(c,
e){c=d(e);e=!!a(c);c.prop("checked",e);c.attr("aria-checked",e);b.handleActiveLabel(b.getAllRadios().filter("[for\x3d'#"+c.attr("id")+"']"))});this.refresh()},_setButtonEnabled:function(a,b){var c=this;this._getButtons().each(function(){var e=d(this);!0===a(e)&&(e.prop("disabled",!1===b),e.attr("aria-disabled",!1===b),c.handleDisabledLabel(c.getAllRadios().filter("[for\x3d'#"+e.attr("id")+"']"),b))});this.refresh()},_getButtons:function(){return this.element.find("input."+this.widgetBaseClass)},_getLabelForButton:function(a){return a.next(".js-label")},
handleActiveLabel:function(a){this.getAllRadios().attr("aria-checked",!1);R9.dom.swapClasses(this.getAllRadios(),a.data("active-state"),a.data("default-state"));R9.dom.swapClasses(a,a.data("default-state"),a.data("active-state"))},handleDisabledLabel:function(a,b){a.attr("data-is-label-disabled",!b);b?R9.dom.swapClasses(a,a.data("disabled-state"),a.data("default-state")):R9.dom.swapClasses(a,a.data("default-state"),a.data("disabled-state"))},addNewRadioButton:function(a,b,c,d,g,k,h){if(a){var e=this.element.find("input").first().clone(),
f=this.element.find("label").first().clone();e.attr("id",a);f.attr("id",a+"-label");f.attr("for",a);b&&e.attr("value",b);c&&e.attr("name",c);g&&f.attr("title",g);d&&f.find(".label-text").text(d);this.element.append(e,f);h&&this.setButtonEnabledById(a,h);k&&this.setButtonCheckedById(a);this.refresh()}},deleteRadioButtonByValue:function(a){if(a&&(a=this.element.find("input[value\x3d"+a+"]"))){var b=this.element.find("label[id\x3d"+a.attr("id")+"-label]");d(a).remove();b&&b.remove();this.refresh()}}}))})(jQuery);(function(d){R9.extend("Widgets",{Slider:function(a,b){this.elementNode=a;this.element=d(this.elementNode);if(!this.validateElement())return this;this.options=d.extend({},this.options,b);this.init()}});R9.extend("Widgets.Slider.prototype",{elementNode:null,element:null,elementWidth:0,elementPositionLeft:0,activeRange:null,handles:[],activeHandle:null,activeHandleIndex:null,startValues:null,timelineDepPoints:null,timelineDepTimes:null,timelineArrTimes:null,timelineHours:null,timelinePrices:null,timelineLegSignatures:null,
timelineElements:null,timelineLabels:null,mouseMoveDelegate:d.noop,mouseUpDelegate:d.noop,options:{start:d.noop,stop:d.noop,slide:d.noop,min:0,max:100,step:1,values:[],range:!0,logarithmic:!1,snapToValue:!1,timeValueAmount:0,exponent:-1,cutoff:-1,totalRange:-1,totalStepAmount:-1,equalStepAmount:-1,cutoffPercentage:-1,equalStepRange:-1,expStepAmount:-1,useCustomDistribution:!1},init:function(){var a=this.element.data("r9RangeSlider");null!=a&&(this.options.values=a.getValues());this.element.data("r9RangeSlider",
this);var b=this;this.handles=this.element.children(".r9-rangeSlider-handle");this.activeRange=this.element.find(".r9-rangeSlider-activeRange");this.handles.off(".r9RangeSlider").on("mousedown.r9RangeSlider touchstart.r9RangeSlider",function(a){b.mouseDown(a);a.preventDefault();a.stopPropagation(!0)});a=this.options.values;if(!a||1>a.length)a=this.options.range?[this.options.min,this.options.max]:[this.options.min];this.determineSetValues(a);setTimeout(function(){b.drawActiveRange()},60)},validateElement:function(){return 0<
this.element.length&&this.element.hasClass("r9-rangeSlider")},setStartValues:function(){this.startValues=[];for(var a=0;a<this.options.values.length;a++)this.startValues[a]=this.options.values[a]},setupActiveHandle:function(a){this.activeHandle=a;this.activeHandleIndex=null;this.elementWidth=this.element.outerWidth();this.elementPositionLeft=this.element.offset().left;for(a=0;a<this.handles.length;a++)this.activeHandle==this.handles[a]&&(this.activeHandleIndex=a);d(this.activeHandle).addClass("r9-rangeSlider-handle-active")},
mouseDown:function(a){this.setupActiveHandle(a.target);var b=this;this.mouseMoveDelegate=function(a){b.mouseMove(a)};this.mouseUpDelegate=function(a){a.stopPropagation(!0);b.mouseUp(a)};d(document).bind("mousemove.r9RangeSlider touchmove.r9RangeSlider",this.mouseMoveDelegate).bind("mouseup.r9RangeSlider touchend.r9RangeSlider",this.mouseUpDelegate);this.setStartValues();this.options.start(a,this.options.values)},mouseUp:function(a){d(this.activeHandle).removeClass("r9-rangeSlider-handle-active");
this.activeHandleIndex=this.activeHandle=null;d(document).unbind("mousemove.r9RangeSlider touchmove.r9RangeSlider",this.mouseMoveDelegate).unbind("mouseup.r9RangeSlider touchend.r9RangeSlider",this.mouseUpDelegate);var b=!1;if(this.startValues)for(var c=0;c<this.options.values.length;c++){if(this.options.values[c]!=this.startValues[c]){b=!0;break}}else b=!0;this.options.stop(a,this.options.values,b)},setActiveHandleValue:function(a){var b=100*this.positionForValue(a);d(this.activeHandle).css("left",
b+"%").css("z-index","3");for(b=0;b<this.handles.length;b++)this.handles[b]==this.activeHandle&&(this.options.values[b]=a,this.setAriaValue("aria-valuenow",a,b),1<this.handles.length&&(0===b?this.setAriaValue("aria-valuemin",a,1):this.setAriaValue("aria-valuemax",a,0)));this.drawActiveRange()},setAriaValue:function(a,b,c){void 0!==c?d(this.handles[c]).attr(a,b):d(this.handles).attr(a,b)},mouseMove:function(a){a.preventDefault();a.stopPropagation();var b=a.originalEvent;b.touches&&0<b.touches.length?
a.pageX=b.touches[0].pageX:b.changedTouches&&0<b.changedTouches.length&&(a.pageX=b.changedTouches[0].pageX);this.setActiveHandleValue(this.valueForPosition(Math.min(this.elementWidth,Math.max(0,a.pageX-this.elementPositionLeft))/this.elementWidth,this.activeHandleIndex));this.options.slide(a,this.options.values)},getValues:function(){return this.options.values.slice(0)},getValue:function(){return 0<this.options.values.length?this.options.values[0]:0},setValues:function(a){var b=this;this.options.values=
[];for(var c=0;c<a.length;c++){var e=this.trimAlignValue(a[c]),f=100*this.positionForValue(e),g=2;1<a.length&&(0==c&&90<=f||c==a.length-1&&10>=f)&&(g=3);this.options.values.push(e);d(this.handles[c]).css("left",f+"%").css("z-index",g)}setTimeout(function(){b.drawActiveRange()},60);R9.config.getBoolean("ui.slider.nonBlockingDrawActiveRange",!0)?setTimeout(this.drawActiveRange.bind(this),1):this.drawActiveRange();this.options.slide(null,this.options.values)},determineSetValues:function(a){if(R9.config.getBoolean("ui.slider.safeSetValues",
!0))return this.safeSetValues(a);this.setValues(a);return null},safeSetValues:function(a){try{return this.setValues(a),null}catch(b){return b}},errorSetValues:function(a){R9.Widgets.Slider.singleSetValuesError||(R9.Widgets.Slider.singleSetValuesError=1,R9.config.getBoolean("ui.slider.logRollbar",!1)&&window.Rollbar&&Rollbar.error?Rollbar.error("Slider setValues failed",{error:a&&a.message?a.message:"(unknown error)",winTop:window===window.top,winParent:window.top===window.parent}):R9.config.getBoolean("ui.slider.logVs",
!0)&&R9.Analytics.api.trackEvent({category:"slider",action:"error",label:"setvalues",value:(window===window.top)+"-"+(window.top===window.parent)}))},setCustomDistribution:function(a){this.options.exponent=a.exponent;this.options.cutoff=a.cutoff;this.options.totalRange=this.options.max-this.options.min;this.options.totalStepAmount=a.ranges.length;this.options.cutoffPercentage=a.cutoffPercentage;this.options.equalStepAmount=this.options.cutoffPercentage*this.options.totalStepAmount;this.options.equalStepRange=
this.options.cutoff-this.options.min;this.options.expStepAmount=this.options.totalStepAmount-this.options.equalStepAmount;this.options.useCustomDistribution=!0},resetCustomDistribution:function(){this.options.exponent=-1;this.options.cutoff=-1;this.options.totalRange=this.options.max-this.options.min;this.options.totalStepAmount=-1;this.options.equalStepAmount=-1;this.options.cutoffPercentage=-1;this.options.equalStepRange=-1;this.options.expStepAmount=-1;this.options.useCustomDistribution=!1},setTimelinePoints:function(a,
b,c,d,f,g,h){this.timelineDepPoints=a;this.timelineDepTimes=b;this.timelineArrTimes=c;this.timelineHours=d;this.timelinePrices=f;this.timelineLegSignatures=g;h&&this.clearTimelineValues();this.setTimelineValues()},clearTimelineValues:function(){this.element.find(".timelineValue").remove();this.clearTimelineHours()},setTimelineValues:function(){this.timelineElements=[];for(var a=0;a<this.timelineDepPoints.length;a++)this.setTimelinePoint(a);this.setTimelineHours()},setTimelinePoint:function(a){var b=
d("\x3cspan /\x3e").addClass("timelineValue"),c=d('\x3cdiv class\x3d"times"  /\x3e').text(this.timelineDepTimes[a]+" - "+this.timelineArrTimes[a]),e=d('\x3cdiv class\x3d"priceValue" /\x3e').text(this.timelinePrices[a]),f=d("\x3cdiv /\x3e");b.data("legSig",this.timelineLegSignatures[a]);f.append(c);f.append(e);a=100*this.positionForValue(this.timelineDepPoints[a]);this.element.append(b);b.css("left",a+"%");b.off("mouseover.r9Timeline").on("mouseover.r9Timeline",function(){d(this).addClass("highlight")});
b.off("mouseout.r9Timeline").on("mouseout.r9Timeline",function(){d(this).removeClass("highlight")});this.markFilteredOutTimeLinePoint(b);b.toolTip({delay:0,showImmediately:!1,extraClass:"timelinePoint",content:""+f.html()});this.timelineElements.push(b)},markFilteredOutTimeLinePoint:function(a){if(a&&0!==a.length){var b=this.getPositionLeftValue(this.handles[0],0),c=this.getPositionLeftValue(this.handles[1],100),d=this.getPositionLeftValue(a,100);b>d||c<d?a.addClass("filteredOut"):a.removeClass("filteredOut")}},
markFilteredOutTimeLinePoints:function(){var a=this;this.timelineElements&&0!==this.timelineElements.length&&$.each(this.timelineElements,function(b,c){a.markFilteredOutTimeLinePoint(c)})},clearTimelineHours:function(){this.element.find(".timelineHour").remove()},setTimelineHours:function(){for(var a=0,b=0;24>b;b++){var c=this.options.min+36E5*b;if(c>this.options.min&&c<this.options.max){var e=d("\x3cspan /\x3e").addClass("timelineHour").text(this.timelineHours[a]);this.element.append(e);c=100*this.positionForValue(c);
e.css("left",c+"%");a++}}},getPositionLeftValue:function(a,b){return a?parseFloat($(a)[0].style.left):b},formatHourLabel:function(a){var b=new Date(a);a=b.getUTCHours();10>a&&(a="0"+a);b=b.getUTCMinutes();10>b&&(b="0"+b);return a+":"+b},triggerStop:function(){this.options.stop({},this.options.values,!0)},setValue:function(a){var b=this.options.values.slice(0);b[0]=a;this.determineSetValues(b)},getOption:function(a){return this.options[a]},setOption:function(a,b){if("object"==typeof a)for(a in b=a,
b)b.hasOwnProperty(a)&&(this.options[a]=b[a]);else this.options[a]=b;this.determineSetValues(this.options.values)},positionForValue:function(a){if(this.options.logarithmic){var b=Math.log(this.options.min);a=(Math.log(a)-b)/((Math.log(this.options.max)-b)/1)}else a=this.options.useCustomDistribution?a>this.options.cutoff?Math.log(a-this.options.cutoff)/this.options.exponent/this.options.expStepAmount*(1-this.options.cutoffPercentage)+this.options.cutoffPercentage:(a-this.options.min)/this.options.equalStepRange*
this.options.cutoffPercentage:(a-this.options.min)/(this.options.max-this.options.min);return a.toFixed(5)},valueForPosition:function(a,b){if(this.options.logarithmic&&1!==a){var c=Math.log(this.options.min);a=Math.exp(c+(Math.log(this.options.max)-c)*a)}else a=this.options.useCustomDistribution&&1!==a&&0<a?a>this.options.cutoffPercentage?this.options.cutoff+Math.exp((a*this.options.totalStepAmount-this.options.equalStepAmount)*this.options.exponent):1/this.options.cutoffPercentage*a*this.options.equalStepRange+
this.options.min:this.options.min+(this.options.max-this.options.min)*a;a=this.trimAlignValue(a);0<b&&(a=Math.max(a,this.options.values[b-1]));b+1<this.handles.length&&(a=Math.min(a,this.options.values[b+1]));return a},drawActiveRange:function(){var a=!1,b=0,c=d(this.handles[this.handles.length-1]).css("left"),e=d(this.activeRange);this.options.range&&(b=d(this.handles[0]).css("left"));if(c&&0<=c.indexOf("%")||b&&0<=b.indexOf("%"))a=!0;c=parseInt(c)-parseInt(b);e.css({left:b,width:(c||0)+(a?"%":"")});
(1<this.handles.length?this.options.values[0]===this.options.min&&this.options.values[1]===this.options.max:this.options.values[0]===this.options.max)?e.addClass("fullRange"):e.removeClass("fullRange");this.markFilteredOutTimeLinePoints()},trimAlignValue:function(a){if(a<=this.options.min)return this.options.min;if(a>=this.options.max)return this.options.max;var b;this.options.snapToValue?(b=10<this.options.step?this.options.step:10,b=Math.ceil(Math.pow(b,Math.floor(Math.log(a)/Math.log(b))-1))):
b=0<this.options.step?this.options.step:1;var c=a%b;a-=c;2*Math.abs(c)>=b&&(a+=0<c?b:-b);a=parseFloat(a.toFixed(5));a=Math.min(a,this.options.max);return Math.max(a,this.options.min)}})})(jq||jQuery);
(function(d,a){d.createWidgetClass("slider.Slider",a.extend({},d.Widgets.Slider.prototype,{init:function(){var a=this;this.handles=this.element.children(".handle");this.activeRange=this.element.find(".activeRange");this.handles.off(".r9RangeSlider").on("mousedown.r9RangeSlider touchstart.r9RangeSlider",function(b){a.mouseDown(b);b.preventDefault();b.stopPropagation(!0)});this.handles.off("focus.sliderHandle").on("focus.sliderHandle",function(){a.focusHandler(1)});this.handles.off("blur.sliderHandle").on("blur.sliderHandle",
function(){a.focusHandler(0)});this.setAriaValue("aria-valuemin",this.options.min);this.setAriaValue("aria-valuemax",this.options.max);setTimeout(function(){var b=a.options.values;if(!b||1>b.length)b=a.options.range?[a.options.min,a.options.max]:[a.options.min];(b=a.determineSetValues(b))&&a.errorSetValues(b);a.setAriaValue("aria-label",a.options.ariaLabel)},1)},focusHandler:function(a){this.handles.off("keydown.sliderHandle");this.handles.off("keyup.sliderHandle");if(a&&!this.element.hasClass("Disabled")){var b=
this;this.handles.on("keydown.sliderHandle",function(a){switch(a.keyCode){case d.globals.keyCodes.LEFT:case d.globals.keyCodes.DOWN:a.preventDefault();b.keyMoveHandle(a,-1,1);break;case d.globals.keyCodes.RIGHT:case d.globals.keyCodes.UP:a.preventDefault();b.keyMoveHandle(a,1,1);break;case 33:a.preventDefault();b.keyMoveHandle(a,1,5);break;case 34:a.preventDefault(),b.keyMoveHandle(a,-1,5)}});this.handles.on("keyup.sliderHandle",function(a){switch(a.keyCode){case d.globals.keyCodes.LEFT:case d.globals.keyCodes.DOWN:case d.globals.keyCodes.RIGHT:case d.globals.keyCodes.UP:a.preventDefault(),
b.mouseUp(a),b.startValues=null}})}},keyMoveHandle:function(b,c,d){this.setupActiveHandle(b.target);var e=a(b.target).position().left/this.elementWidth,g=1/((this.options.max-this.options.min)/(null!==this.options.step?this.options.step:1));this.options.logarithmic&&(g=.01);c=this.valueForPosition(Math.min(this.elementWidth,Math.max(0,e+g*c*d)),this.activeHandleIndex);this.startValues||this.setStartValues();this.setActiveHandleValue(c);this.options.start(b,this.options.values);this.options.slide(b,
this.options.values)},mouseDown:function(){this.element.hasClass("Disabled")||d.Widgets.Slider.prototype.mouseDown.apply(this,arguments)},validateElement:function(){return this.element.hasClass("Common-Widgets-Slider-Slider")}}))})(R9,jQuery);(function(g,c){g.createWidgetClass("text.EmailInput",{options:{maxEmails:-1,placeholder:"",readonly:!1},inputElem:null,init:function(){this.inputElem=this.getChildElement("inputEl");var a=this;setTimeout(function(){a.processValue(a.inputElem.val())},1)},addEventHandlers:function(){var a=this;this.addInputEventHandlers();this.element.on("click",".email",function(){c(this).remove();a.checkRestrictions();a.updateValue()})},addInputEventHandlers:function(){var a=this,d=!0;a.inputElem.on("keyup",function(b){switch(b.which){case 32:a.handleSpaceKey();
break;case 8:b=a.inputElem.val();var e=b.split(" "),e=a.addEmail(e);c.trim(b)!==c.trim(e)&&a.inputElem.val(e);d=!0;break;default:a.checkComma()}}).on("keydown",function(b){switch(b.which){case 13:case 9:a.handleReturnKey(b);break;case 8:0===a.getCaretPosition()&&d&&(a.element.find(".email").last().remove(),a.checkRestrictions(),a.updateValue()),d=!1}}).on("focus",function(){a.element.addClass("focused")}).on("blur",function(b){a.handledReturnID||a.handleReturnKey(b);a.element.removeClass("focused")})},
checkComma:function(){var a=c.trim(this.inputElem.val());","===a[a.length-1]&&(a=this.addEmail([a.substring(0,a.length-1)]),""===c.trim(a)&&this.inputElem.val(""))},handleSpaceKey:function(){""===this.addEmail([this.inputElem[0].value])&&(this.inputElem[0].value="")},handleReturnKey:function(a){var d=this;d.handledReturnID&&clearTimeout(d.handledReturnID);this.handledReturnID=setTimeout(function(){d.handledReturnID=null},100);var b=this.inputElem[0].value,e=b.split(" ");this.addEmail(e,!0);this.inputElem[0].value=
"";if(13===a.which||""!==c.trim(b))a.stopPropagation(),a.preventDefault()},getCaretPosition:function(){var a=0,d=this.inputElem[0];if(document.selection)d.focus(),a=document.selection.createRange(),a.moveStart("character",-d.value.length),a=a.text.length;else if(d.selectionStart||"0"==d.selectionStart)a=d.selectionStart;return a},val:function(a){if("undefined"!==typeof a)this.processValue(a);else return this.getValue()},processValue:function(a){this.element.find(".email").remove();this.inputElem[0].value=
a?this.addEmail(a.split(",")):"";this.updateValue()},isValidEmail:function(a){a=c.trim(a);return"function"===typeof window.validateEmail?validateEmail(a):/^[a-zA-Z0-9.!#$%&\u2019*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(a)},prepareEmailElem:function(a){a=c.trim(a);if(!a)return!1;var d=c("\x3cdiv class\x3d'email'\x3e\x3c/div\x3e");c(document.createTextNode(a)).appendTo(d);return d},addEmail:function(a,d){var b=this,e="";c.each(a,function(c,f){if(0<b.options.maxEmails&&c>=b.options.maxEmails)return!1;
if(b.isValidEmail(f)){if(c=b.prepareEmailElem(f))c.insertBefore(b.inputElem),b.checkRestrictions(),b.updateValue()}else{a.splice(0,c);c=a.join(" ");if(d){if(c=b.prepareEmailElem(c))c.insertBefore(b.inputElem),b.checkRestrictions(),b.updateValue()}else e=c;return!1}});return e},updateValue:function(){var a=this.element.find(".email").map(function(){return c(this).text()}).get().join();this.element.val(a);this.getChildElement("hidnEl").val(a)},getValue:function(){var a=this.element.val(),d=c.trim(this.inputElem.val());
""!==d&&(a+=","+d);return a},checkRestrictions:function(){var a=this.element.find(".email").length;0<this.options.maxEmails&&(a>=this.options.maxEmails?(this.element.addClass("disabled"),this.inputElem.prop("disabled",!0)):(this.element.removeClass("disabled"),this.inputElem.prop("disabled",!1)));a?(this.inputElem.prop("placeholder",""),this.options.readonly&&this.inputElem.prop("readonly","readonly")):(this.inputElem.prop("placeholder",this.options.placeholder),this.options.readonly&&this.inputElem.prop("readonly",
""))}})})(window.R9,window.jq||window.jQuery);(function(b,c){b.createComponentClass("flights.results.filters.AirlinesFilter","common.results.filters.ValueSetFilter",{options:{restoreMultAfterOnly:!1},unsetOnlyOption:function(a){this.base(a);null===this.only&&this.options.restoreMultAfterOnly&&(a=this.getRenderedFilterOptions().MULT)&&a.setChecked(1)}})})(R9,jQuery);(function(d,e){d.createComponentClass("flights.results.filters.AirportsFilterSection","common.results.filters.FilterSection",{legToggleSetElem:null,legToggleSetWidget:null,lastLegCount:null,enabledForSearch:!1,init:function(){this.base();this.legToggleSetElem=this.getChildElement("leg-toggle")},addEventHandlers:function(){this.base();this.subscribe("search.startSearch",this.onSearchStart.bind(this));this.subscribe("flights.filters.setLeg",this.onSetLegSelection.bind(this));this.subscribe("search.poll.response",
this.onSearchPollResponse.bind(this))},inlineComponentsReady:function(){this.base();this.legToggleSetElem.length&&(this.legToggleSetWidget=this.legToggleSetElem.styleJamRadioButtonSet({change:this.onChangedLegRadio.bind(this)}).getWidget())},toggleFilterSection:function(a){this.base(a);this.element.closest(".hfilter").toggleClass("inactive",!a.visible)},onSearchStart:function(){this.enabledForSearch=!1;this.setupLegTabs(0);this.toggleFilterSection({visible:!1})},onChangedLegRadio:function(a){a&&this.triggerChangeLegDisplay(a.value)},
onSetLegSelection:function(a){this.legToggleSetWidget&&this.legToggleSetWidget.setButtonCheckedByValue(a+"");this.triggerChangeLegDisplay(a)},triggerChangeLegDisplay:function(a){d.events.publish("flights.filters.changeLeg",{id:this.id("airports"),legIndex:parseInt(a)-1})},setupLegTabs:function(a){this.lastLegCount=a;if(2>a)this.legToggleSetElem.toggleClass("inactive",!0),this.triggerChangeLegDisplay(0);else if(this.legToggleSetElem.toggleClass("inactive",!1),this.legToggleSetWidget)for(var b=this.legToggleSetWidget.getAllRadios().length,
c=0;c<b;c++)this.legToggleSetWidget.setButtonEnabledByValue(c+1+"",c<a)},onSearchPollResponse:function(a){var b=a&&a.isMulticity?parseInt(a.legCount):0;a=!!(a&&a.filtersData&&a.filtersData.airports&&a.filtersData.airports.enabled);if(this.enabledForSearch!==a||b!==this.lastLegCount)this.enabledForSearch=a,this.setupLegTabs(a&&!isNaN(b)?b:0)}})})(R9,jQuery);(function(c){c.createComponentClass("flights.results.filters.BookingProvidersFilter","common.results.filters.ValueSetFilter",{options:{directOnlyEnabled:!1,directOnlyKey:"",directBookingToolTipText:"",featureClass:""},addFilterItem:function(b,a,c){this.base(b,a,c);this.options.directOnlyEnabled&&(b=this.getRenderedFilterOptions()[this.options.directOnlyKey])&&(a=0<=this.options.featureClass.indexOf("kayak-flights"),b.element.toolTip({content:this.options.directBookingToolTipText,position:"top",orientation:a?
"start":"middle",showImmediately:!1,extraClass:a?"uikit":"",size:a?"uikit":""}),b.element.addClass("directProvidersOnlyOption"))}})})(R9);(function(a,b){a.createComponentClass("flights.results.filters.FlightEquipmentSection","common.results.filters.FilterSection",{})})(R9,jQuery);(function(d,e){d.createComponentClass("flights.results.filters.FlightFilterList","common.results.filters.FilterList",{searchId:void 0,initialSearchId:null,forceAjaxUpdateInterval:null,priceFilterStub:null,filterWrappers:null,options:{isMulticity:!1,travelers:1,legCount:2,priceTypeEnabled:!1,filterTabView:!1,hoistCabin:!1},init:function(){var a=this;this.base();if(this.options.searchCompleted)var b=d.events.subscribe("resultspage.filtersData.changed",function(){a.showFilterList();d.events.unsubscribe("resultspage.filtersData.changed",
b)});this.filterWrappers={};this.element.find(".filterWrapper").each(function(){a.filterWrappers[this.getAttribute("data-name")]=e(this)})},addEventHandlers:function(){this.base();var a=this,b=this.getChildElement("topList"),f=this.getChildElement("moreList");this.subscribe(["search.startSearch","search.searchFailed"],function(){a.options.searchCompleted=!1});this.setupPriceFilterPositionHandlers();this.getChildElement("moreToggle").click(function(){a.element.toggleClass("expanded");a.publishMoreFilterToggle(a.element.hasClass("expanded"))});
this.getChildElement("filterTabs").on("click",".filterTab",function(){if(!e(this).is(".selectedTab")){var c=e(this).is(".moreListTab");a.element.toggleClass("show-more-tab",c);a.element.find(".filterTab").toggleClass("selectedTab").attr("aria-selected",function(a,c){return"true"===c?"false":"true"});c&&f.removeClass("hidden").attr("aria-expanded",!0);a.options.filterTabView&&(b.attr("aria-expanded",!c),f.attr("aria-expanded",c));a.publishMoreFilterToggle(c)}});this.getChildElement("airlinefees").click(function(){d.Analytics.api.trackEvent({category:"Filters",
action:"airlinefees"})});this.subscribe("search.poll.response",function(c){c.hasOwnProperty("isMulticity")&&a.setMulticityMode(c.isMulticity);c.hasOwnProperty("showPlusMinusThree")&&a.getChildElement("flexmatrix").parent().toggleClass("hidden",!c.showPlusMinusThree);c.hasOwnProperty("showAirlineMatrix")&&a.getChildElement("airline-matrix").toggleClass("hidden",!c.showAirlineMatrix);c.hasOwnProperty("showAirlineFees")&&a.getChildElement("airlinefees").toggleClass("hidden",!c.showAirlineFees)});this.subscribe("resultspage.searchId.changed",
function(c){a.searchId=c.searchId});this.getChildElement("flexmatrix").off("click").click(function(){f.hasClass("Disabled")||d.events.publish("flights.results.toggle.flex_matrix")});this.getChildElement("airline-matrix").off("click").click(function(){f.hasClass("Disabled")||d.events.publish("flights.results.toggle.airline_matrix")});this.subscribe("filters.disabled",function(a){f.toggleClass("Disabled",a).find("a.matrix, .flex-features \x3e a").attr("disabled","disabled")});this.subscribe("resultspage.streaming.done",
function(c){a.element.find(".dispCt").removeClass("hidden")});this.options.hoistCabin&&this.setupCabinFilterPositionHandler()},setupCabinFilterPositionHandler:function(){var a=this.filterWrappers.cabin.prev(),b=function(b){(b=b?this.filterWrappers.stops:a)&&!this.filterWrappers.cabin.prev().is(b)&&(this.filterWrappers.cabin.detach().insertAfter(b),this.filterWrappers.cabin.children().addClass("open"))};this.subscribe("resultspage.cleanup",b.bind(this,!1));this.subscribe("flights.filters.hoistCabin",
b.bind(this,!0))},setupPriceFilterPositionHandlers:function(){var a=d.config.getBoolean("ui.non-price-sort-price-filter.enabled",!0),b=this.filterWrappers.price;if((this.options.priceTypeEnabled||a)&&b){b.prev();var f=/duration|depart|arrive/,c=this,g={sortCode:d.question.ask("resultspage.sortMode.get"),travelers:this.options.travelers},e=function(d,e){e=null;a&&d.hasOwnProperty("sortCode")&&f.test(d.sortCode)?e=c.filterWrappers.stops:c.options.priceTypeEnabled&&d.hasOwnProperty("travelers")&&1<d.travelers&&
(e=c.filterWrappers["airlines-section"]);e&&!b.prev().is(e)&&(b.detach().insertAfter(e),b.children().addClass("open"))};this.options.priceTypeEnabled&&this.subscribe("search.startSearch",function(a){g.travelers=a.travelers;e(g)});a&&this.subscribe("resultsHeader.sortType.set",function(a){g.sortCode=a.sortCode;e(g)});e(g)}},streamingStarted:function(a){this.options.searchCompleted||this.base(a);this.element.find(".dispCt").addClass("hidden")},publishMoreFilterToggle:function(a){d.Analytics.api.trackEvent({category:"Filters",
action:"more-filters",label:a?"show":"hide"});window.setMetaCookie("showAllFilters.flight",a?"true":"false");d.events.publish("sliders.redraw");d.events.publish("moreFilters.toggle",a)},setMulticityMode:function(a){a&&this.getChildElement("airports").hide()},setFilterMatrixView:function(a,b){var d=e("#aboveHeaderContainer");e("html, body").animate({scrollTop:0},500);"plusminusthree"===a?(this.isFlexOpen=b,this.isAirlineMatrixOpen=!b):"airlinestops"===a&&(this.isAirlineMatrixOpen=b,this.isFlexOpen=
!b);d.removeClass(function(a,b){return(b.match(/vm\-(\S)*/)||[]).join(" ")});b&&d.addClass("vm-"+a)},toggleAirlineMatrix:function(a){this.setFilterMatrixView("airlinestops",a);this.airlineMatrixLoaded?d.events.publish("flights.results.airlinestops.show",a):d.events.publish("flights.resultspage.getairlinematrix");this.logMatrixInteraction("airlinestops",a)},togglePlusMinusThree:function(a){this.setFilterMatrixView("plusminusthree",a);this.flexDialogLoaded?d.events.publish("flights.results.flexmatrix.show",
a):d.events.publish("flights.resultspage.getflex");this.logMatrixInteraction("plusminusthree",a)},logMatrixInteraction:function(a,b){var e=b?"show":"hide",c=a;"plusminusthree"==a&&(c="fleview-plusminus");"airlinestops"==a&&(c="airlinematrix",e=b?"open":"close");d.Analytics.api.trackEvent({category:"Filters",action:c,label:e});d.action.execute("common/utils/history/UserStateUpdateAction",{storageType:"viewState",searchId:this.searchId,key:a,value:b?"true":"false"})}})})(R9,jQuery);(function(a,b){a.createComponentClass("flights.results.filters.FlightQualityFilterSection","common.results.filters.FilterSection",{})})(R9,jQuery);(function(g,e){g.createComponentClass("flights.results.filters.FlightTimesFilter","common.results.filters.RangeGraphFilter",{Graph:null,legs:void 0,legCount:2,legSections:null,isFlexDates:!1,flexRangeLegs:{},hasWeekendDefaultState:!1,options:{canToggleFlexOptIn:!1,flexOptInClientTemplate:"",fullMeridiem:!0,isMulticity:!1,yAxisDisplay:"price"},init:function(){this.base();this.element.data("component",this);this.eventPrefix="filters.%s.".format(this.options.name);this.legSections=this.element.find(".js-legSection")},
addEventHandlers:function(){this.base();var a=this;this.subscribe("flights.filters.multicity.setLeg",function(b){a.confineDisplayToLeg(b)});this.subscribe("flights.filters.takeoffLanding.setCategory",this.confineDisplayToTakeoffLanding.bind(this));this.subscribe("search.poll.response",function(b){b.hasOwnProperty("isMulticity")&&(a.options.isMulticity=b.isMulticity)});this.answer("FlightTimesFilter.getLegs"+a.name,function(){return a.legs})},confineDisplayToLeg:function(a){if(-1!==a)this.base(a);
else{a=2;for(var b=0;b<this.legs.length;b++)this.legs[b].element.toggleClass("inactive",b>=a)}},confineDisplayToTakeoffLanding:function(a){var b=this;this.element.toggleClass("inactive",{takeoff:0,landing:1}[this.name]!==a&&-1!==a);this.legs.forEach(function(a,f){a.element.removeClass("inactive").toggleClass("hidden",f>=b.legCount)})},cleanupExistingState:function(){this.base();this.options.isMulticity=!1},update:function(a){this.isFlexDates=a.isFlexDates;this.hasWeekendDefaultState=a.hasWeekendDefaultState;
a.legs&&this.setLegCount(a.legs.length);this.base(a);a.hasOwnProperty("airports")&&g.events.publish("flights.filters.%s.airports".format(this.name),{airports:a.airports});a.flexRangeLegs&&(this.flexRangeLegs=a.flexRangeLegs,this.options.canToggleFlexOptIn&&this.updateFlexOptInToggles(a.flexRangeLegs));this.options.isMulticity&&a.sectionLabels&&1===a.sectionLabels.length&&this.legs.forEach(function(b){b.label.html(a.sectionLabels[0])})},updateFlexOptInToggles:function(a){var b=this.element.find(".js-flexOptIn");
this.legSections.each(function(c,f){var d=b.eq(c);"boolean"!==typeof a[c]?d.length&&d.remove():(d.length||(d=this.renderFlexOptInToggle(e(f),c),this.initFlexOptInCheckbox(d,c+"")),d.find('input[type\x3d"checkbox"]').getWidget().setChecked(a[c]))}.bind(this))},renderFlexOptInToggle:function(a,b){b=g.template.renderElement(this.options.flexOptInClientTemplate,{name:this.name,legNumber:b});a.append(b);return b},initFlexOptInCheckbox:function(a,b){a=a.find('input[type\x3d"checkbox"]');a.length&&a.checkbox({change:this.onFlexOptInChange.bind(this,
b)})},onFlexOptInChange:function(a,b){b=e(b).getWidget().getValue();if(this.flexRangeLegs[a]!==b){var c={};c[a]=b;this.flexRangeLegs=e.extend({},this.flexRangeLegs,c);this.pushStateChange();this.setLastUserInteraction(!0)}this.logUserInteraction()},pushStateChange:function(a,b){this.hasWeekendDefaultState&&a?this.base(!1,b,{legs:this.legs.slice(0,this.legCount).map(function(a){return a.slider?{min:a.slider.minRange.toString(),max:a.slider.maxRange.toString()}:{}}),flexRangeLegs:Object.keys(this.flexRangeLegs).slice(0,
this.legCount).reduce(function(a,b){a[b]=!1;return a},{})}):this.base(a,b,null)},willReset:function(){this.flexRangeLegs={}},filterDataChanged:function(a){var b=this.element.hasClass("inactive");this.base(a);this.element.toggleClass("inactive",b)},showGraph:function(a){var b=this.element.find(".timesFilterSection").eq(a),c=b.outerHeight(),f=-24,d=b.find(".js-flexOptIn");d.length&&(c+=6,f+=d.outerHeight()+18);this.base(a);b.css("height",c).find(".timesFilterSectionInner").css("bottom",f)},hideGraph:function(a){this.base(a);
this.element.find(".timesFilterSection").eq(a).css("height","").find(".timesFilterSectionInner").css("bottom","")},getState:function(){return e.extend({},this.base(),{flexRangeLegs:this.flexRangeLegs})},formatValues:function(a,b){var c=this,f=this.isFlexDates,d=this.spansDays(a),e=!1;if(Object.keys(this.flexRangeLegs).length)var g=this.legs.findIndex(function(a){return a.slider===b}),e=this.flexRangeLegs[g];return a.map(function(a,b){b=e||!f&&(d||0===b)?"ddd LT":"LT";return c.formatHourTime(moment.utc(a).format(b))})},
formatHourTime:function(a){return this.options.fullMeridiem?a:this.shortenMeridiem(a)},shortenMeridiem:function(a){var b=/[ ]?([aApP])[mM]$/g,c=b.exec(a);c&&1<c.length&&(a=a.replace(b,c[1].toLowerCase()));return a},spansDays:function(a){return moment.utc(a[0]).day()!==moment.utc(a[1]).day()},makeGraphClass:function(){var a=this.base(),b=this,c=function(b){this.options=e.extend(a.options,b);this.findAxisTextWidths()};c.prototype=e.extend(a.prototype,c.prototype,{xUnitScale:36E5,yUnitScale:1,formatX:function(a){return b.formatHourTime(moment.utc(a).format("ha"))},
formatY:function(a){return g.Common.Utils.formatPrice(Math.round(a),!0)},rawX:function(a){return moment(a).utc().startOf("hour")._d.getTime()},render:function(){return e("\x3cdiv class\x3d'filterGraph'/\x3e").html(this.renderYAxis()+this.renderGraphBars()+this.renderXAxis())}});return c},getFilterHistoryDisplayViewSubtype:function(){return g.question.ask("filters.FilterHistory.type.time")},getLegDisplayName:function(a){return"Leg "+(a+1)}})})(R9,jQuery);(function(c,f){c.createComponentClass("flights.results.filters.PerLegValueSetFilter","common.results.filters.ValueSetFilter",{activeLegIndex:0,activeLegOverride:null,legsContainer:void 0,legRenderedFilterOptions:void 0,legCount:1,isMulticity:!1,init:function(){this.base();this.legRenderedFilterOptions=[];this.legsContainer=this.getChildElement("legs")},addEventHandlers:function(){var a=this;this.base();this.subscribe(["common.results.filters.activeLeg.changed","flights.filters.multicity.setLeg"],
this.setActiveLegIndex.bind(this));this.subscribe("flights.filters.changeLeg",{id:this.id()},this.changedActiveLegIndex.bind(this));this.subscribe("flights.filters.multicity",function(b){a.isMulticity=b})},inlineComponentsReady:function(){this.isMulticity="m"===c.question.ask("flights.resultspage.oneway")},shouldBeVisible:function(a){return(a=a.legValues)&&a.reduce(function(a,d){return a&&0<Object.keys(d).length},!0)},update:function(a){a=a.legValues;this.legCount=a.length;for(var b=0;b<this.legCount;b++)this.legsContainer.children().length<=
b&&(this.legsContainer.append(f("\x3cdiv class\x3d'leg-%s'/\x3e".format(b))),this.legRenderedFilterOptions.push({})),this.activeLegOverride=b,this.base(a[b]);this.activeLegOverride=null;this.legsContainer.find(".leg-"+this.getActiveLeg()).addClass("active")},cleanupExistingState:function(){this.base();this.legRenderedFilterOptions=[];this.legsContainer.children().remove()},reset:function(a){if(this.isMulticity){a=f.extend({},a,{silent:!0});for(var b=0;b<this.legCount;b++)this.activeLegOverride=b,
this.base(a);this.pushStateChange(null,{reset:!0});c.events.publish("flights.filters.setLeg",1);this.setActiveLegIndex(0)}else this.base(a)},getState:function(){var a={},b=0,d=this.legCount;this.legRenderedFilterOptions.forEach(function(g){b<d&&Object.keys(g).forEach(function(e){var c=g[e].getState();a.hasOwnProperty(e)&&a[e].length===d||(a[e]=Array.apply(null,Array(d)).map(String.prototype.valueOf,"null"));"number"===typeof c&&(a[e][b]=c.toString())});b++});Object.keys(a).forEach(function(b){0===
a[b].filter(function(a){return"null"!==a}).length&&delete a[b]});return 0<Object.keys(a).length?a:null},getOptionsContainer:function(){return this.legsContainer.find(".leg-"+this.getActiveLeg())},getRenderedFilterOptions:function(){var a=this.legRenderedFilterOptions[this.getActiveLeg()];void 0===a&&(a={});return a},getActiveLeg:function(){return null!==this.activeLegOverride?this.activeLegOverride:this.activeLegIndex},changedActiveLegIndex:function(a){a&&this.setActiveLegIndex(a.legIndex)},setActiveLegIndex:function(a){this.activeLegIndex=
-1<a?a:0;this.legsContainer.children().removeClass("active");this.legsContainer.find(".leg-"+this.activeLegIndex).addClass("active")}})})(R9,jQuery);(function(d,e){d.createComponentClass("flights.results.filters.SpecificLegFilter","common.results.filters.Filter",{name:"specificleg",state:null,specificLegs:null,activeLeg:-1,init:function(){this.base();this.specificLegs={};this.state={}},addEventHandlers:function(){this.base();var a=this;this.subscribe("common.results.filters.specificleg.change",this.handleSpecificLegChange.bind(this));this.subscribe("common.results.filters.activeLeg.changed",function(b){a.activeLeg=b})},handleSpecificLegChange:function(a){a.checked?
this.addSpecificLeg(a):this.removeSpecificLeg(a);this.pushStateChange()},addSpecificLeg:function(a){var b=this;a.removeOld&&Object.keys(this.state).forEach(function(c){c=c.split(":");parseInt(c[1])===a.leg&&b.removeSpecificLeg({signature:c[0],leg:c[1]})});this.state[a.signature+":"+a.leg]=!0;this.specificLegs[a.leg]=a.resultId},removeSpecificLeg:function(a){var b=a.signature+":"+a.leg;this.state.hasOwnProperty(b)&&(delete this.state[b],delete this.specificLegs[a.leg])},cleanupExistingState:function(){this.specificLegs=
{};this.state={}},reset:function(a){var b=d.question.ask("flights.resultspage.currentview");a&&"showAll"===a.type&&(-1<this.activeLeg||"segment"===b||"customticket"===b)||this.base(a)},willReset:function(){this.specificLegs={};this.state={};this.activeLeg=-1},update:function(a){a.hasOwnProperty("signatures")&&(this.cleanupExistingState(),Object.keys(a.signatures).forEach(function(b){this.state[a.signatures[b]+":"+b]=!0;a.hasOwnProperty("legs")&&(this.specificLegs[b]=a.legs[b])},this))},getState:function(){var a=
Object.keys(this.state);return 0<a.length?{signatures:a,legs:this.specificLegs}:null}})})(R9,jQuery);(function(b){b.createComponentClass("flights.results.filters.StopsFilter","common.results.filters.ValueSetFilter",{addEventHandlers:function(){this.base();var c=this;this.answer("filters.stops.hasNonStop",function(){var a=c.getRenderedFilterOptions();return a.hasOwnProperty("0")&&!a["0"].state.disabled});b.config.getBoolean("ui.horizontal-filters.stickybar.enabled",!1)&&b.events.subscribe("common.results.filters.StopsFilterExposed.setfilter",this.updateExposedStops.bind(this));b.config.getBoolean("ui.filters.StopsFilterRadioSet.enabled",
!1)&&(c=this,b.events.subscribe("common.results.filters.StopsFilterRadioSet.setfilter",function(a){if(!1!==c.interactable){var d=c.getRenderedFilterOptions();a=a||"";-1<a.indexOf("uptoonestop")&&("undefined"!==typeof d[0].state.disabled&&!0===d[0].state.disabled?d[1].setChecked(2,"only"):(d[0].setChecked(1,"select"),d[1].setChecked(1,"select"),"undefined"!==typeof d[2]&&d[2].setChecked(0,"unselect")));-1<a.indexOf("direct")&&(d[0].setChecked(1,"only"),d[1].setChecked(0,!1),"undefined"!==typeof d[2]&&
d[2].setChecked(0,!1));-1<a.indexOf("any")&&b.events.publish("filter.reset",{name:"stops"})}}))},update:function(c){this.base(c);var a=!1;this.forEachItem(function(c,b){if("0"===c){if(1===b.state.selected||2===b.state.selected)a=!0}else if(1===b.state.selected||2===b.state.selected)a=!1},a);this.disableLayover(a);b.config.getBoolean("ui.horizontal-filters.stickybar.enabled",!1)&&b.events.publish("common.results.filters.StopsFilterExposed.state",this.makeDataFrom(c));b.config.getBoolean("ui.filters.StopsFilterRadioSet.enabled",
!1)&&b.events.publish("common.results.filters.StopsFilterRadioSet.state",this.makeDataFrom(c))},disableLayover:function(c){b.events.publish("filter.disabled",{name:"layoverdur",disabled:c})},updateExposedStops:function(c){var a=this.getRenderedFilterOptions();"uptoonestop"===c&&("undefined"!==typeof a[0].state.disabled&&!0===a[0].state.disabled?a[1].setChecked(2,"only"):(a[0].setChecked(1,"select"),a[1].setChecked(1,"select"),"undefined"!==typeof a[2]&&a[2].setChecked(0,!1)),b.Analytics.api.trackEvent("filters/stops/exposed/uptoonestop"));
"nonstop"===c&&(a[0].setChecked(1,"only"),a[1].setChecked(0,!1),"undefined"!==typeof a[2]&&a[2].setChecked(0,!1),b.Analytics.api.trackEvent("filters/stops/exposed/nonstoponly"));"anystops"===c&&(a[0].setChecked(1,"select"),a[1].setChecked(1,"select"),"undefined"!==typeof a[2]&&a[2].setChecked(1,"select"),b.Analytics.api.trackEvent("filters/stops/exposed/anystops"))},makeDataFrom:function(c){var a={},b={},f={};this.forEachItem(function(d,e){a[d]=e.state.selected;b[d]="undefined"!==typeof c.valueMap[d].minPrice&&
null!==c.valueMap[d].minPrice?c.valueMap[d].minPrice:e.state.minPrice;f[d]=e.state.disabled});return{state:a,minPrice:b,disabled:f}}})})(R9);(function(c,g){c.createComponentClass("flights.results.filters.TimesFilterSection","common.results.filters.FilterSection",{landingEl:null,legToggleButtonSet:null,setCategoryEvent:"",options:{isMulticity:!1,takeoffLandingTabs:!1,legCount:2},init:function(){this.base();this.landingEl=this.getChildElement("showLanding");this.legToggleButtonSet=this.getChildElement("legToggle");this.airportsSection=this.getChildElement("airportsSection");this.setCategoryEvent=this.options.takeoffLandingTabs?"flights.filters.takeoffLanding.setCategory":
"flights.filters.multicity.setLeg"},addEventHandlers:function(){this.base();var a=this;this.landingEl.click(this.openLandingSection.bind(this));this.landingEl.keypress(function(b){b.keyCode===c.globals.keyCodes.RETURN&&a.openLandingSection(a)});this.subscribe("resultspage.searchId.changed",function(){a.element.removeClass("expanded");a.landingEl.removeClass("hidden");a.legToggleButtonSet.addClass("hidden")});this.options.takeoffLandingTabs||this.legToggleButtonSet.radioButtonSet();this.legToggleButtonSet.getWidget().setOption("change",
function(b){c.events.publish(a.setCategoryEvent,parseInt(b.value)-1)});this.subscribe("flights.filters.setLeg",function(b){a.legToggleButtonSet.getWidget().setButtonCheckedByValue(b+"")});this.subscribe("search.poll.response",this.handleSearchPollResponse.bind(this))},onPushedStateChange:function(a){var b=a.reset;0<=this.filterDOMIds.indexOf(a.elemId)&&!this.skipFilter(a.name)&&(this.element.toggleClass("isDirty",!b),this.element.find(".horizontalFilterHead").toggleClass("isDirty",!b))},inlineComponentsReady:function(){this.base();
(this.options.isMulticity||this.options.takeoffLandingTabs&&1<this.options.legCount)&&this.setupLegTabs(this.options.legCount)},openLandingSection:function(){this.element.addClass("expanded");this.landingEl.addClass("hidden");c.Analytics.api.trackEvent({category:"Filter",action:"times",label:"show-landing"})},setupLegTabs:function(a){var b=this,f=this.getChildElement("dropdown_content");this.options.takeoffLandingTabs?1===f.length&&f.addClass("multicity"):this.element.parent().find(".legToggle").addClass("visible");
this.legToggleButtonSet.parent().addClass("visible");this.airportsSection.addClass("visible");this.element.addClass("multicity");this.options.isMulticity=!0;this.legCount=a;this.legToggleButtonSet.find("label").each(function(d,e){e=g(e);0===d&&(c.events.publish(b.setCategoryEvent,d),b.legToggleButtonSet.getWidget().setValue(e.prev().val()));e.toggleClass("active",d<a);b.legToggleButtonSet.getWidget().setButtonEnabledByValue(function(){return d<=b.legCount},d);d===a&&e.addClass("borderless")})},clearMulticityFilters:function(){this.options.isMulticity=
!1;this.element.removeClass("multicity");this.legToggleButtonSet.find("label.active").removeClass("active");this.element.parent().find(".legToggle").removeClass("visible");this.airportsSection.removeClass("visible")},clearTakeoffLandingTabs:function(){c.events.publish(this.setCategoryEvent,-1);this.legToggleButtonSet.parent().removeClass("visible")},handleSearchPollResponse:function(a){a.searchStartedThisPoll&&(this.options.takeoffLandingTabs?a.isOneWay?this.clearTakeoffLandingTabs():this.setupLegTabs(a.legCount):
a.isMulticity?this.setupLegTabs(a.legCount):this.clearMulticityFilters(),c.events.publish("flights.filters.multicity",a.isMulticity))},skipFilter:function(a){return!this.element.hasClass("multicity")&&"airports"===a}})})(window.R9,window.jQuery);(function(b,e){b.createComponentClass("flights.results.scripts.FlightAboveHeaderContent",{options:{searchId:void 0,flexDialogLoaded:!1,airlineMatrixLoaded:!1},flexDialogLoaded:!1,airlineMatrixLoaded:!1,aboveHeadContainer:null,flexMatrixWrapper:null,airlineWrapper:null,init:function(){this.aboveHeadContainer=this.element.closest("#aboveHeaderContainer");this.flexMatrixWrapper=this.element.find(".flexMatrixWrapper");this.airlineWrapper=this.element.find(".airlineWrapper");this.searchId=this.options.searchId;
(this.airlineMatrixLoaded=this.options.airlineMatrixLoaded)&&this.aboveHeadContainer.hasClass("vm-airlinestops")&&this.toggleAirlineMatrix(!0);(this.flexDialogLoaded=this.options.flexDialogLoaded)&&this.aboveHeadContainer.hasClass("vm-plusminusthree")&&this.togglePlusMinusThree(!0)},addEventHandlers:function(){var a=this;this.subscribe("flights.results.flexmatrix.hide",function(){a.togglePlusMinusThree(!1)});this.subscribe("flights.results.airlinestops.hide",function(){a.toggleAirlineMatrix(!1)});
this.subscribe("flights.results.toggle.flex_matrix",function(){a.togglePlusMinusThree()});this.subscribe("flights.results.toggle.airline_matrix",function(){a.toggleAirlineMatrix()});this.subscribe(["search.startSearch","search.searchFailed"],function(){a.flexDialogLoaded=!1;a.airlineMatrixLoaded=!1});this.subscribe("flights.resultspage.flexloaded",function(){a.flexDialogLoaded=!0});this.subscribe("flights.resultspage.airlinestopsloaded",function(){a.airlineMatrixLoaded=!0});this.subscribe("resultspage.searchId.changed",
function(c){a.searchId=c.searchId})},setFilterMatrixView:function(a,c){var b=this.aboveHeadContainer,d="plusminusthree"===a?this.flexMatrixWrapper:"airlinestops"===a?this.airlineWrapper:null;if(!b.hasClass("vm-"+a)||!c)if(e("html, body").animate({scrollTop:0},500),null!=d){if(c){b.removeClass(function(a,b){return(b.match(/vm\-(\S)*/)||[]).join(" ")});d.height(0);b.addClass("vm-"+a);var f=d.children("div").height();d.animate({height:f},function(){d.height("auto")})}else d.animate({height:0},function(){b.removeClass("vm-"+
a)});d.attr("aria-expanded",c)}},toggleAirlineMatrix:function(a){a&&this.aboveHeadContainer.hasClass("vm-airlinestops")||("undefined"===typeof a&&(a=!this.aboveHeadContainer.hasClass("vm-airlinestops")),this.setFilterMatrixView("airlinestops",a),this.airlineMatrixLoaded?(b.events.publish("flights.results.airlinestops.show",a),this.logMatrixInteraction("airlinestops",a)):b.events.publish("flights.resultspage.getairlinematrix"))},togglePlusMinusThree:function(a){a&&this.aboveHeadContainer.hasClass("vm-plusminusthree")||
("undefined"===typeof a&&(a=!this.aboveHeadContainer.hasClass("vm-plusminusthree")),this.setFilterMatrixView("plusminusthree",a),this.flexDialogLoaded?(b.events.publish("flights.results.flexmatrix.show",a),this.logMatrixInteraction("plusminusthree",a)):b.events.publish("flights.resultspage.getflex"))},logMatrixInteraction:function(a,c){b.Analytics.api.trackEvent(a+"/"+(c?"show":"hide"));b.action.execute("common/utils/history/UserStateUpdateAction",{storageType:"viewState",searchId:this.searchId,key:a,
value:c?"true":"false"})}})})(R9,jQuery);(function(e,g){e.createComponentClass("flights.results.FlightFeeAssistant",{feesInfo:null,deferRequestId:null,pendingRequest:null,fromFeeCalcAdd:0,avoidScrollTop:0,onboardingTooltip:null,options:{carryOnInit:0,carryOnMax:1,checkedInit:0,checkedMax:1,paymentFeesEnabled:!1,deferRequestMs:1100,useToast:!0,fcFixedToast:"",fcScrollsTop:!1,showOnboarding:!1},init:function(){var a=this;this.feesInfo={cfc:this.makeFeesInfo(this.options.carryOnInit),bfc:this.makeFeesInfo(this.options.checkedInit)};this.options.showOnboarding&&
(this.onboardingTooltip=this.getChildElement("onboarding-tooltip-anchor").getWidget())&&this.onboardingTooltip.setOption("onOpen",function(){return a.options.showOnboarding=!1});this.baggageFees=this.getChildElement("bfc").add(this.getChildElement("cfc"))},addEventHandlers:function(){var a=this;this.subscribe("resultspage.flights.feeCalculator.addlink.click",this.onFeeCalcAdd.bind(this));this.subscribe("resultspage.filtersData.changed",this.onFilterDataChanged.bind(this));this.onboardingTooltip&&
this.options.showOnboarding&&(e.events.when("resultsPage.content.visible",this.initOnboarding.bind(this)),this.onboardingTooltip.bindEventHandler("click",".js-tooltip-close",function(){return a.onboardingTooltip.close()}),this.onboardingTooltip.bindEventHandler("keydown",".js-tooltip-close",this.handleCloseButtonSelect.bind(this)));var b=this.getStlBlock("hidden");this.subscribe("search.searchFailed",function(){a.element.addClass(b)});this.subscribe("search.startSearch",function(c){c.isMulticity?
a.options.paymentFeesEnabled?(a.swapClasses(a.baggageFees,"FeeBlock--visible","FeeBlock--hidden"),a.element.removeClass(b)):a.element.addClass(b):(a.element.removeClass(b),a.swapClasses(a.baggageFees,"FeeBlock--hidden","FeeBlock--visible"))});this.subscribe("resultspage.cleanup",function(){var b=a.feesInfo.cfc.numberBox&&a.feesInfo.cfc.numberBox.getWidget();b&&b.setValue(0,!0);(b=a.feesInfo.bfc.numberBox&&a.feesInfo.bfc.numberBox.getWidget())&&b.setValue(0,!0)});this.options.collapsible&&this.bindCollapsible()},
inlineComponentsReady:function(){var a=this.getChildElement("step-carry-on");a.length&&(this.feesInfo.cfc.numberBox=a.styleJamNumberBox({defaultValue:this.options.carryOnInit,min:0,max:this.options.carryOnMax,callback:this.onChangedCarryOn.bind(this)}));a=this.getChildElement("step-checked-bag");a.length&&(this.feesInfo.bfc.numberBox=a.styleJamNumberBox({defaultValue:this.options.checkedInit,min:0,max:this.options.checkedMax,callback:this.onChangedCheckedBag.bind(this)}))},destroy:function(){this.deferRequestId&&
clearTimeout(this.deferRequestId);this.pendingRequest&&(this.pendingRequest.reject(),this.pendingRequest=null);Object.values(this.feesInfo).forEach(function(a){return a.numberBox=null})},makeFeesInfo:function(a){return{numberBox:null,lastRequest:a,nextRequest:a}},bindCollapsible:function(){var a=this.getChildElement("filter"),b=this.getChildElement("filter-title"),c=this.getChildElement("filter-content"),d=function(d){d=a.hasClass("open")?"hide":"show";e.Analytics.api.trackEvent({category:"Filter-Collapsible",
action:d,label:"feeassistant"});a.toggleClass("open");b.attr("aria-pressed","show"===d);c.attr("aria-expanded","show"===d);e.events.publish("horizon.filters.opened")};this.registerEvent("click",b,d);this.registerEvent("keypress",b,function(){event.keyCode===e.globals.keyCodes.RETURN&&d()})},onChangedCarryOn:function(a,b){this.setChangedBagCount("cfc",0<a,b)},onChangedCheckedBag:function(a,b){this.setChangedBagCount("bfc",0<a,b)},setChangedBagCount:function(a,b,c){var d=this.feesInfo[a];this.deferRequestId?
clearTimeout(this.deferRequestId):this.pendingRequest||this.checkStartLoadingDisplay();var f=isNaN(this.options.deferRequestMs)?1100:this.options.deferRequestMs;this.fromFeeCalcAdd&&(f=0);d.nextRequest=c;this.syncFilterState(a,c);0<f?this.deferRequestId=setTimeout(this.sendBagCounts.bind(this),f):this.sendBagCounts();e.Analytics.api.trackEvent({category:"FeeAssistant",action:b?"increment":"decrement",label:a+"-"+c})},sendBagCounts:function(){var a=this;this.deferRequestId&&(clearTimeout(this.deferRequestId),
this.deferRequestId=null);Object.values(this.feesInfo).every(function(a){return a.lastRequest===a.nextRequest})?this.checkResetLoadingDisplay():(this.pendingRequest&&this.pendingRequest.reject(),this.pendingRequest=g.Deferred().done(function(){a.fromFeeCalcAdd&&!a.avoidScrollTop&&a.options.fcScrollsTop&&g(window).scrollTop(0);a.options.useToast&&e.events.publish("resultspage.notify",{content:a.options.toastMessage})}).always(function(){a.fromFeeCalcAdd=0;a.avoidScrollTop=0;a.pendingRequest=null;a.checkResetLoadingDisplay()}),
Object.keys(this.feesInfo).forEach(function(b){var c=a.feesInfo[b];c.lastRequest!==c.nextRequest&&(c.lastRequest=c.nextRequest,a.publishFilterChange(b,c.nextRequest))}))},getFilter:function(a,b){return{name:a,state:0<b?{baggageCount:b}:null}},syncFilterState:function(a,b){e.events.publish("resultspage.filters.sync",this.getFilter(a,b))},publishFilterChange:function(a,b){e.events.publish("filters.changed",this.getFilter(a,b))},onFilterDataChanged:function(a){var b=this;this.pendingRequest?this.pendingRequest.resolve():
a&&Object.keys(this.feesInfo).filter(function(b){return b&&a[b]&&a[b].isFiltering}).forEach(function(c){var d=parseInt(a[c].selBaggageCount);!isNaN(d)&&0<=d&&(b.feesInfo[c].numberBox&&b.feesInfo[c].numberBox.getWidget().setValue(d,!0),b.feesInfo[c].lastRequest=b.feesInfo[c].nextRequest=d);b.syncFilterState(c,d)})},onFeeCalcAdd:function(a){a&&a.name&&this.feesInfo[a.name].numberBox&&(this.fromFeeCalcAdd=1,this.avoidScrollTop=a.avoidScrollTop,this.feesInfo[a.name].numberBox.getWidget().increment())},
checkStartLoadingDisplay:function(){e.events.publish("fee.assistant.start",{delay:0})},checkResetLoadingDisplay:function(){this.deferRequestId||this.pendingRequest||e.events.publish("fee.assistant.done")},initOnboarding:function(){var a=this;window.setTimeout(function(){a.options.showOnboarding&&a.onboardingTooltip.open()},2E3)},handleCloseButtonSelect:function(a){switch(a.which){case e.globals.keyCodes.MOUSE_LEFT:case e.globals.keyCodes.RETURN:case e.globals.keyCodes.SPACE:this.onboardingTooltip.close()}}})})(R9,
jQuery);(function(c,d){c.createComponentClass("flights.results.FlightLeftRail","base.results.Rail",{priceAlertsEnabled:!0,addEventHandlers:function(){var a=this;this.base();this.subscribe("search.searchFailed",function(){a.element.addClass("searchFailed")});this.subscribe("resultspage.refreshed",function(){a.element.removeClass("searchFailed")});this.subscribe("flights.results.priceAlertEnabled",function(b){a.setAlertsEnabled(b.enabled&&b.visible)})},setAlertsEnabled:function(a){this.getChildElement("priceAlertsContainer").css("display",
a?"block":"none");this.priceAlertsEnabled=a}})})(R9,jQuery);(function(c){c.createComponentClass("flights.results.FlightPriceAlertBanner",{toggle:void 0,options:{alwaysShow:!1,visible:!1,economyOnlyAlerts:!1,sourceId:null},init:function(){this.toggle=this.getChildElement("toggle")},inlineComponentsReady:function(){var a=c.question.ask("flights.results.alerts.existingAlert");a&&0<a.length&&this.setChecked(!0)},addEventHandlers:function(){var a=this,d=this.toggle.parent().is(".StyleJamCheckbox")?"styleJamCheckbox":"checkbox";this.toggle[d]({change:function(b,
d,e){c.Analytics.api.trackEvent({category:"Price-Alert",action:b.checked?"toggleOn":"toggleOff"});b.checked?c.events.publish("flights.results.alerts.create",{sourceId:a.options.sourceId}):c.events.publish("flights.results.alerts.delete")},click:function(a){$(a).blur()}});this.subscribe("flights.priceAlert.deleted",this.setChecked.bind(this,!1));this.subscribe("flights.priceAlert.setview",function(b){a.setChecked("edit"===b.view)});this.subscribe("search.startSearch",function(b){a.setVisible(a.isEnabledForQuery(b))});
this.subscribe("resultspage.cleanup",function(){a.setChecked(!1);a.setCheckboxEnabled(!1)});this.subscribe(["flights.results.priceAlert.show","flights.results.prediction"],function(b){a.setCheckboxEnabled(!!b)});this.subscribe("flights.results.priceAlertEnabled",function(b){a.setCheckboxEnabled(b.enabled);a.setVisible(b.visible)});this.subscribe("flight.results.alerts.driveby.cancel",function(){a.setChecked(!1)})},isEnabledForQuery:function(a){return this.options.economyOnlyAlerts&&"e"!==a.cabin?
!1:!a.isMulticity&&"openflex"!==a.flex_category&&!a.freeRegionId&&!a.countrySearch},setChecked:function(a){this.toggle.prop("checked",a)},setCheckboxEnabled:function(a){this.toggle.getWidget().setEnabled(a)},setVisible:function(a){this.element.toggleClass("hidden",!a).attr("aria-hidden",!a);this.toggle.attr("aria-hidden",!a)}})})(R9);(function(b){b.createComponentClass("flights.results.FlightPriceAlertButton",{options:{trackCreateAlertPath:"",horizontalFPP:!1,useToast:!1,wireButtonStyle:!1,sourceId:null,msg:{priceAlertSaved:"",priceAlertUpdated:"",priceAlertRemoved:""}},alertMode:"",createButton:void 0,init:function(){this.createButton=this.getChildElement("create")},inlineComponentsReady:function(){var a=b.question.ask("flights.results.prediction.is");a&&!this.options.wireButtonStyle&&this.updateButtonColor(a);(a=b.question.ask("flights.results.alerts.existingAlert"))&&
0<a.length&&this.updateButtonVisibility(!0)},openDriveby:function(){if(!this.driveby){var a={sourceId:this.options.sourceId};this.options.horizontalFPP&&(a.popover=!0,a.appendTo=this.getChildElement("popover"),a.success=this.onDrivebyPopover.bind(this));b.events.publish("flights.results.alerts.create",a)}},addEventHandlers:function(){var a=this;this.getChildElement("create").off("click.pricealert").on("click.pricealert",function(){a.createButton.hasClass("clickedPriceAlert")||(a.createButton.addClass("clickedPriceAlert"),
a.openDriveby())});this.subscribe(["alertsaved.success","flight.results.alerts.driveby.cancel"],function(){a.createButton.removeClass("clickedPriceAlert")});this.options.useToast&&this.subscribe("alertsaved.success",function(){if("edit"!==a.alertMode)a.updateToastEnabled=!0;else if(!a.updateToastEnabled)return;var d=b.template.render(a.id()+"-successToastContent",{alertUpdated:"edit"===a.alertMode});b.events.publish("resultspage.notify",{content:d});b.Analytics.api.trackEvent({category:"pricealert/managelink/impression",
action:"impression"})});this.options.wireButtonStyle||this.subscribe("flights.results.prediction",this.updateButtonColor.bind(this));this.subscribe("flights.priceAlert.setview",function(b){a.preventDialogClose=!1;a.updateButtonVisibility("edit"===b.view);a.alertMode=b.view});this.subscribe(["flights.results.priceAlert.show","flights.results.prediction"],function(b){a.element.toggleClass("hidden",!1===b)});this.subscribe("resultspage.cleanup",function(){a.updateButtonVisibility(!1);a.driveby&&(a.driveby.destroy(),
a.driveby=null)});this.subscribe("flights.results.priceAlertEnabled",function(b){a.setVisible(b.enabled&&b.visible)});var c=this.getChildElement("alert-created-button");c.length&&(this.subscribe("flights.priceAlert.deleted",function(){a.alertMode="";a.updateButtonVisibility(!1);c.removeClass("clickedPriceAlert");a.options.useToast&&b.events.publish("resultspage.notify",{content:a.options.msg.priceAlertRemoved})}),c.on("click",function(){$(this).hasClass("clickedPriceAlert")||($(this).addClass("clickedPriceAlert"),
b.events.publish("flights.results.alerts.delete"))}),this.subscribe("error.alert",function(){c.removeClass("clickedPriceAlert")}));this.options.useToast&&(this.subscribe(["resultspage.streaming.start","search.startSearch"],function(){a.updateToastEnabled=!1}),this.subscribe("resultspage.streaming.done",function(){a.updateToastEnabled=!0}))},setVisible:function(a){a?this.element.show():this.element.hide()},updateButtonVisibility:function(a){this.element.toggleClass("existing",a)},updateButtonColor:function(a){this.createButton.toggleClass("Button-Grey-Invert",
!0===a.buy)},onDrivebyPopover:function(){if(this.driveby)this.driveby.dialog.open();else{var a=this.getChildElement("dialog").styleJamDropdownDialog({target:this.element.find(".alertButton"),staticPosition:{top:"35px",right:0},container:this.element,alignment:"left",direction:"down"}).getWidget();this.driveby=this.getChildElement("popover").children().eq(0).data("driveby");this.driveby.bindDialog(a)}}})})(R9);(function(c,e){function g(a){return Object.keys(a).map(function(b){return 0<a[b].selected?b:null}).filter(function(a){return null!==a}).join(",")}function f(a,b){return a.hasOwnProperty(b)&&0<a[b].selected}c.publish("flights.results.FlightPriceAlertsUtils",{showEmailAlertError:function(a){c.events.publish("error.alert",{messages:a})},emailAlertSaveSuccess:function(a){c.events.publish("alertsaved.success",{alertid:a})},showDuplicateEmailAlertError:function(a,b){c.events.publish("alertsaved.error",
{errorid:a,error:b})}});c.createComponentClass("flights.results.FlightPriceAlertsController","framework.JavaScriptComponent",{options:{anonUser:!0,includeMaxPrice:!1,alertSavedMessage:null,alertSavedMessageShort:null,alertUpdatedMessage:null,alertManageLinkMessage:null,showManageLink:!1,isPriceAlertsAnon:!1,initialFormData:null,isAccountWatchListEnabled:!1,showAlertFeedbackMessaging:!0},shortDepartDate:null,shortReturnDate:null,isOneWay:!1,updateSavedAlert:!1,showFeedbackMessage:!1,searchId:null,
alertFormData:{ac:null,alertid:null,action:null,alertsrc:null,hsrc:null,code:null,dest:null,desthint:null,destlist:null,depart_date:null,return_date:null,numtrav:null,travadl:null,travsen:null,travyth:null,travchd:null,travsinf:null,travlinf:null,cabin:null,Enonstop:!1,oneway:null,dt:"e",ns:null,"1s":null,"2s":null,depairports:null,retairports:null,airlines:null,max:null,dtakeoffmin:null,dtakeoffmax:null,atakeoffmin:null,atakeoffmax:null,dlandingmin:null,dlandingmax:null,alandingmin:null,alandingmax:null,
removeHistory:null,createFromButton:null},init:function(){window.alerts=this;this.alertFormData=e.extend({},this.alertFormData,this.options.initialFormData);this.options.initialFormData&&(this.shortDepartDate=this.options.initialFormData.shortDepartDate,this.shortReturnDate=this.options.initialFormData.shortReturnDate,this.isOneWay=this.options.initialFormData.isOneWay)},addEventHandlers:function(){var a=this;this.base();this.subscribe("searchform.submit",function(b){a.syncSearchParams(b)});this.subscribe("resultspage.filtersData.changed",
function(b){a.syncFilterState(b);a.updateSavedAlert&&!a.options.anonUser&&(a.alertFormData.removeHistory=!0,a.getShowAlertFiltersUpdate(b)&&(a.showFeedbackMessage=!0),a.saveEmailPriceAlert(),a.updateSavedAlert=!1)});this.options.isPriceAlertsAnon&&this.options.anonUser?this.subscribe("flights.results.alerts.create",this.showDriveByEmailAlert.bind(this)):this.subscribe("flights.results.alerts.create",this.createPriceAlert.bind(this));this.subscribe("flights.results.alerts.delete",this.deletePriceAlert.bind(this));
this.subscribe("flights.results.alerts.driveby",this.saveDriveByEmailAlert.bind(this));this.subscribe("flights.results.alerts.multiFlightDriveby",this.saveMultiFlightDriveByEmailAlert.bind(this));this.subscribe("flights.results.existingAlert",function(b){a.alertFormData.alertid=b;c.events.publish("flights.priceAlert.setview",{view:"edit"})});this.subscribe("resultspage.streaming.done",function(){setTimeout(function(){!a.options.anonUser&&a.alertFormData.alertid&&0<a.alertFormData.alertid.length&&
(a.alertFormData.removeHistory=!1,a.saveEmailPriceAlert())},500)});this.subscribe("resultspage.searchId.changed",function(b){a.searchId=b.searchId});this.subscribe("alertauth.show",this.showAlertAuth.bind(this));this.subscribe("alertsaved.success",function(b){a.showPriceAlertSaved(b.alertid)});this.subscribe("alertsaved.error",function(b){a.showPriceAlertSaved(b.errorid,b.error)});this.subscribe("filters.changed",function(){a.alertFormData.alertid&&a.alertFormData.alertid.length&&(a.updateSavedAlert=
!0)});this.answer("flights.results.alerts.existingAlert",function(){return a.alertFormData.alertid})},clearFormData:function(){Object.keys(this.alertFormData).forEach(function(a){this.alertFormData[a]=null},this);this.shortDepartDate=this.shortReturnDate=null;this.isOneWay=!1;this.alertFormData.dt="e"},syncSearchParams:function(a){this.clearFormData();this.alertFormData.depart_date=a.depart_date;this.alertFormData.return_date=a.return_date;this.alertFormData.code=a.origincode?a.origincode.split("/")[0]:
"";this.alertFormData.dest=this.alertFormData.desthint=this.alertFormData.destlist=a.destinationcode?a.destinationcode.split("/")[0]:"";this.alertFormData.numtrav=a.travelers;this.alertFormData.travadl=a.adults;this.alertFormData.travsen=a.seniors;this.alertFormData.travyth=a.youth;this.alertFormData.travchd=a.child;this.alertFormData.travlinf=a.lapInfant;this.alertFormData.travsinf=a.seatInfant;this.isOneWay=a.oneway;this.alertFormData.cabin=a.cabin;this.alertFormData.oneway=a.oneway?"y":a.isMulticity?
"m":"weekend"===a.flex_category?"w":"n";this.shortDepartDate=moment(a.depart_date_canon).format("MMM D");this.isOneWay||(this.shortReturnDate=moment(a.return_date_canon).format("MMM D"))},syncFilterState:function(a){this.alertFormData.dtakeoffmin=this.alertFormData.dtakeoffmax=this.alertFormData.atakeoffmin=this.alertFormData.alandingmax="NONE";this.alertFormData.airlines="ALL";this.alertFormData.depairports=this.alertFormData.retairports=this.alertFormData.max=null;this.alertFormData.max=null;a.hasOwnProperty("stops")&&
(this.alertFormData.ns=f(a.stops.valueMap,"0")?"Y":"N",this.alertFormData["1s"]=f(a.stops.valueMap,"1")?"Y":"N",this.alertFormData["2s"]=f(a.stops.valueMap,"2")?"Y":"N");if(a.hasOwnProperty("airports")&&a.airports.isDirty){var b=a.airports.legValues[0];this.alertFormData.depairports=g(b.headingValueMap[b.orderedHeadings[0]]);1<b.orderedHeadings.length&&(this.alertFormData.retairports=g(b.headingValueMap[b.orderedHeadings[1]]))}a.hasOwnProperty("airlines")&&a.airlines.isDirty&&(b=Object.keys(a.airlines.valueMap).filter(function(b){var d=
a.airlines.valueMap[b];return 0===d.selected&&!d.disabled&&"MULT"!==b&&"operators"!==b}),this.alertFormData.airlines=0<b.length?b.join(","):"ALL");a.hasOwnProperty("takeoff")&&a.takeoff.isDirty&&(this.alertFormData.dtakeoffmin=a.takeoff.legs[0].leftRange,this.alertFormData.dtakeoffmax=a.takeoff.legs[0].rightRange,1<a.takeoff.legs.length&&(this.alertFormData.atakeoffmin=a.takeoff.legs[1].leftRange,this.alertFormData.atakeoffmax=a.takeoff.legs[1].rightRange));a.hasOwnProperty("landing")&&a.landing.isDirty&&
(this.alertFormData.alandingmin=a.landing.legs[0].leftRange,this.alertFormData.alandingmax=a.landing.legs[0].rightRange,1<a.landing.legs.length&&(this.alertFormData.dlandingmin=a.landing.legs[1].leftRange,this.alertFormData.dlandingmax=a.landing.legs[1].rightRange));this.options.includeMaxPrice&&a.hasOwnProperty("price")&&a.price.isDirty&&(this.alertFormData.max=a.price.rightRange)},serialize:function(){var a=this;return Object.keys(a.alertFormData).map(function(b){var d=a.alertFormData[b];return null===
d||void 0===d||""===d?"":encodeURIComponent(b)+"\x3d"+encodeURIComponent(d)}).join("\x26")},createPriceAlert:function(a){this.options.anonUser?this.showAlertAuth():(this.showFeedbackMessage=!0,this.alertFormData.createFromButton=!0,this.saveEmailPriceAlert());a&&a.vsLog&&c.Analytics.api.trackEvent(a.vsLog);c.Analytics.api.trackEvent({category:"Price-Alert",action:"create",value:"new"})},deletePriceAlert:function(a){this.options.anonUser&&!this.alertFormData.alertid?this.showAlertAuth():(this.showFeedbackMessage=
!0,this.deleteEmailPriceAlert(a));a&&a.vsLog&&c.Analytics.api.trackEvent(a.vsLog);c.Analytics.api.trackEvent({category:"Price-Alert",action:"delete",value:this.alertFormData.alertid})},renderSearchDataForLogin:function(a){var b=e(a.elementNode).find(".flightCities");a=e(a.elementNode).find(".flightDates");b.empty();a.empty();b.append(e("\x3cspan\x3e%s\x3c/span\x3e".format(this.alertFormData.code)));b.append(e("\x3cspan class\x3d'%s'/\x3e".format(this.isOneWay?"arrow singleArrow":"arrow doubleArrow")));
b.append(e("\x3cspan\x3e%s\x3c/span\x3e".format(this.alertFormData.dest)));a.append(e("\x3cspan\x3e%s\x3c/span\x3e".format(this.shortDepartDate)));this.isOneWay||(a.append(e("\x3cspan\x3e - \x3c/span\x3e")),a.append(e("\x3cspan\x3e%s\x3c/span\x3e".format(this.shortReturnDate))))},showAlertAuth:function(a,b){var d=this;a=e.extend({},a,{promoType:"alerts"});a={promo:"priceAlert",promoType:a.promoType,username:a.username,aftershow:this.renderSearchDataForLogin.bind(this),success:function(){c.authentication.cached_dialog.dialog.close();
d.showFeedbackMessage=!0;d.alertFormData.createFromButton=!0;d.saveEmailPriceAlert().done(function(){window.location.reload()}).fail(function(){d.log.error("Save email price alert failed")})}};b?c.authentication.showLogin(a):c.authentication.showSignup(a)},saveEmailPriceAlert:function(a){var b=e.Deferred();this.alertFormData.action="save";this.alertFormData.hsrc="y";this.alertFormData.alertsrc=a||"toolbox";e.ajax({type:"POST",headers:{"X-CSRF":c.globals.formtoken},url:"/k/alertajax",data:this.serialize(),
dataType:"script",error:function(a,e){c.events.publish("error.alert",{messages:e});b.reject()},success:function(){b.resolve()}});return b},deleteEmailPriceAlert:function(a){var b=this;e.ajax({type:"POST",url:"/h/hermes/prefs/ajax/alert/v1",headers:{"X-CSRF":c.globals.formtoken},data:{action:"delete",alertid:this.alertFormData.alertid},success:function(){b.alertFormData.alertid="";c.events.publish("flights.priceAlert.deleted");a&&a.success()},error:function(a,b){c.events.publish("error.alert",{messages:b})}})},
showDriveByEmailAlert:function(a){if(!this.openExistingDriveby(a)){var b=a&&a.popover,d={data:{searchId:this.searchId,forceShow:!0,popover:b},replace:!0};a&&a.hasOwnProperty("sourceId")&&(d.data.sourceId=a.sourceId);b&&(d.appendTo=a.appendTo);c.ajax.execute("flights/results/"+(b?"ForzaFlightPriceAlertDriveBy":"FlightPriceAlertDriveBy"),d).then(function(){a&&a.success&&a.success()})}},openExistingDriveby:function(a){var b=a&&a.popover?"pricealert.driveby.popover":"pricealert.driveby",d=c.question.ask(b);
if(null===d)return!1;if(d===this.searchId)return c.events.publish(b+".show",a),!0;c.events.publish(b+".destroy");return!1},saveDriveByEmailAlert:function(a){var b=this;this.alertFormData.action="driveby";this.alertFormData.alertsrc="driveby";e.ajax({type:"POST",url:"/k/run/drivebyalert/createflightpricealert",headers:{"X-CSRF":c.globals.formtoken},data:{searchid:this.searchId,email:a.email,optin:a.optin,regurl:a.sourceId||"drivebysave",noforcelogin:b.options.isPriceAlertsAnon},success:function(d){d&&
d.success?(c.Analytics.api.trackEvent({category:a.vsCategory||"Drive-By",action:"signup"}),b.alertFormData.alertid=d.alertid,c.events.publish("flights.priceAlert.setview",{view:"edit"}),"function"===typeof a.success?a.success():b.showAlertCompleteFeedback(!0,!0),c.authentication.needsRefresh=!0):d&&!d.success&&d.existingUser&&b.showAlertAuth(null,!0)},cache:!1})},saveMultiFlightDriveByEmailAlert:function(a){var b=this;this.alertFormData.action="driveby";this.alertFormData.alertsrc="driveby";e.ajax({type:"POST",
url:"/k/run/drivebyalert/createflightpricealerts",headers:{"X-CSRF":c.globals.formtoken},data:{flights:JSON.stringify(a.flights),email:a.email,optin:a.optin,regurl:a.sourceId||"drivebysave",noforcelogin:b.options.isPriceAlertsAnon},success:function(a){a&&a.success?(b.alertFormData.alertid=a.alertid,b.showAlertCompleteFeedback(!0,!0),c.Analytics.api.trackEvent({category:"Drive-By",action:"signup"}),c.events.publish("flights.priceAlert.setview",{view:"edit"}),c.authentication.needsRefresh=!0):a&&!a.success&&
a.existingUser&&b.showAlertAuth(null,!0)},cache:!1})},showPriceAlertSaved:function(a){c.events.publish("flights.priceAlert.setview",{view:"edit"});if(this.alertFormData.alertid&&0<this.alertFormData.alertid.length)this.showFeedbackMessage&&(this.showAlertCompleteFeedback(!1),this.showFeedbackMessage=!1);else{c.Analytics.api.trackEvent("pricealert/exactdate/create");var b=c.question.ask("flights.results.prediction.is");b&&"none"!==b.advice?c.Analytics.api.trackEvent("pricealert/prediction/"+(b.buy?
"buy":"hold")):c.Analytics.api.trackEvent("pricealert/prediction/nodata");this.alertFormData.alertid=a;this.showAlertCompleteFeedback(!0)}},getShowAlertFiltersUpdate:function(a){return a.stops.isDirty||a.airlines.isDirty||a.airports.isDirty||a.landing.isDirty||a.takeoff.isDirty||a.price.isDirty?!0:!1},showAlertCompleteFeedback:function(a,b){if(this.options.showAlertFeedbackMessaging){var d=e(".belowSearchContainer .warningsContainer"),f=a?this.options.alertSavedMessage:this.options.alertUpdatedMessage,
g=a?"alertSavedWarning":"alertUpdatedWarning";a&&b&&(f=this.options.alertSavedMessageShort);this.options.showManageLink&&(f+=" \x3ca href\x3d'"+(this.options.isAccountWatchListEnabled?"/watchlist":"/alerts")+"' target\x3d'_blank' class\x3d'manageLink'\x3e"+this.options.alertManageLinkMessage+"\x3c/a\x3e",c.Analytics.api.trackEvent({category:"pricealert/managelink/impression",action:"impression"}));d.empty();d.append("\x3cdiv class\x3d'%s'\x3e\x3cspan\x3e%s\x3c/span\x3e\x3c/div\x3e".format(g,f));e(".manageLink",
d).on("click.manageLink",function(){c.Analytics.api.trackEvent({category:"pricealert/managelink/click",action:"click"})});d.addClass("visible");e(document).one("click",function(){d.removeClass("visible");e(".manageLink",d).off("click.manageLink")});a||setTimeout(function(){d.removeClass("visible")},8E3)}c.events.publish("watching",{searchId:this.searchId})}})})(R9,jQuery);(function(c,d){c.createComponentClass("flights.results.FlightPriceDisclaimerBanner",{passengerDisclaimer:null,showDisclaimerForQuery:!1,loggingPrefix:"resultspage",action:"bagfees",options:{bagFeesDialogEnabled:!1,noPassengerWarnForLapInfants:!0},init:function(){this.bannerContainer=this.getChildElement("banner-container");this.passengerDisclaimer=this.getChildElement("passenger-price-disclaimer")},addEventHandlers:function(){var a=this;this.options.bagFeesDialogEnabled&&this.registerEvent("click",
this.getChildElement("fee-link"),function(b){c.events.publish("flights.results.bagFeesLink.click");c.Analytics.api.trackEvent({category:a.loggingPrefix,action:a.action,label:"open-dialog"})});this.subscribe("resultsHeader.changed",function(b){b.priceType&&a.passengerDisclaimer.toggleClass("hidden","totaltaxes"===b.priceType)});this.subscribe("searchform.submit",function(b){var c=1>=b.travelers;a.passengerDisclaimer.toggleClass("hidden",c);a.bannerContainer.toggleClass("hidden",c&&!a.options.bagFeesDialogEnabled||
a.options.noPassengerWarnForLapInfants&&!!b.lapInfant&&0<b.lapInfant)})}})})(R9,jQuery);(function(b,c){b.createComponentClass("flights.results.FlightQueryAlerts",{addEventHandlers:function(){var a=this;this.registerEvent("click",this.element.find(".js-link"),this.handleLinkClick.bind(this));this.subscribe("resultspage.cleanup",function(){a.element.remove();a.destroy()})},handleLinkClick:function(a){a=c(a.currentTarget).parent().data("code");if(-1<a.indexOf("mixed-cabin")){var d=-1<a.indexOf("excluded")?1:0;b.events.publish("filters.cabin..setchecked.force",{selected:d})}b.Analytics.api.trackEvent({category:"queryAlerts",
label:"link",action:"clicked",value:a})}})})(R9,jQuery);(function(c){c.createComponentClass("flights.results.FlightQueryPricePrediction",{wrappers:null,adviceText:null,chart:null,info:null,tooltipTrigger:null,advice:null,chartIcon:null,dataCheckPromise:null,searchId:null,ariaLabel:null,options:{showFullGraph:!1,checkEnoughData:!1,useStopsMask:!1,shruggieEnabled:!0,msg:{LOADING_TEXT:""}},init:function(){this.wrappers=this.getChildElement("wrapper");this.adviceText=this.getChildElement("advice");this.chart=this.getChildElement("chart");this.chartIcon=this.getChildElement("chartIcon");
this.info=this.getChildElement("info");this.tooltipTrigger=this.getChildElement("tooltip-trigger");this.ariaLabel=this.getChildElement("ariaLabel");this.options.showFullGraph&&(this.dialog=$("#"+this.id("graph-dialog")),this.wrappers=this.wrappers.add($("#"+this.id("graph-dialog-body"))),this.adviceText=this.adviceText.add($("#"+this.id("advice-dialog"))),this.chartIcon=this.chartIcon.add($("#"+this.id("chartIcon-dialog"))))},addEventHandlers:function(){var a=this;this.answer("flights.results.prediction.is",
function(){return a.advice?{buy:a.advice.buy,advice:a.advice.advice}:null});this.options.checkEnoughData&&this.subscribe("resultspage.searchId.changed",this.checkPredictionHasEnoughData.bind(this));this.subscribe("resultspage.streaming.done",function(b){b.searchId&&0<b.searchId.length&&!b.error&&(a.searchId=b.searchId,a.dataCheckPromise?a.dataCheckPromise.then(a.requestPrediction.bind(a)):a.requestPrediction())});this.options.useStopsMask&&this.subscribe("filters.changed",{name:"stops"},function(){a.searchId&&
a.requestPrediction()});this.subscribe(["search.startSearch","resultspage.cleanup"],this.clearPrediction.bind(this,!0));this.subscribe("search.searchFailed",this.clearPrediction.bind(this,!1));this.addGraphAndTooltipHandlers()},addGraphAndTooltipHandlers:function(){var a=this;this.options.showFullGraph?(this.registerEvent("click",function(){"buy"!==a.advice&&"wait"!==a.advice||a.dialog.getWidget().open()}),this.subscribe("flights.results.prediction.farehistory.fail",function(){a.dialog.addClass("no-graph")})):
this.tooltipTrigger.getWidget()&&"click"===this.tooltipTrigger.getWidget().options.activation&&this.registerEvent("click",this.chart,function(){a.tooltipTrigger.attr("aria-hidden")&&setTimeout(function(){a.tooltipTrigger.getWidget().open()},0)})},requestPrediction:function(){var a={searchId:this.searchId};if(this.options.useStopsMask){var b=c.question.ask("resultspage.filterState.is","stops");if(b){var d=0;Object.keys(b).forEach(function(a){b[a]&&(a=parseInt(a),d|=2>a?a+1:4)});a.stopsMask=d}else a.stopsMask=
7}c.action.execute("flights/results/FlightPricePredictionAction",a,this.onPredictionCompleted.bind(this))},checkPredictionHasEnoughData:function(a){var b=this,d=$.Deferred();this.dataCheckPromise=d.promise();c.action.execute("flights/results/FlightPricePredictionEnoughDataAction",{searchId:a.searchId}).always(function(a){a.hasEnoughData?(b.element.removeClass("hidden"),d.resolve()):d.reject()})},onPredictionCompleted:function(a){this.advice=a.advice;this.element.removeClass("loading");this.wrappers.attr("class",
a.cssClass);this.updateAdviceHeader(a.adviceText,!1);this.info.html(a.infoText);this.tooltipTrigger.getWidget()&&this.tooltipTrigger.getWidget().setContent(a.moreInfoText);"none"!==a.advice?(this.chartIcon.attr("aria-hidden","false"),this.tooltipTrigger.attr("aria-hidden","false")):this.options.shruggieEnabled||(this.clearPrediction(!1),this.element.addClass("hidden"));c.events.ready("flights.results.prediction",a);c.Analytics.api.trackEvent({category:"Price-Prediction",action:"read-advice",label:a.advice});
this.ariaLabel.html(a.adviceText+"\x3cbr\x3e"+a.infoText+"\x3cbr\x3e"+(a.moreInfoText||""))},updateAdviceHeader:function(a,b){this.adviceText.html(a);this.adviceText.attr("aria-busy",b)},clearPrediction:function(a){this.searchId=this.advice=null;this.wrappers.get(0).className="";this.chartIcon.attr("aria-hidden","true");this.dataCheckPromise=null;this.skipPrediction=!1;this.updateAdviceHeader(a?this.options.msg.LOADING_TEXT:"",a);this.info.html("");this.tooltipTrigger.attr("aria-hidden","true");this.ariaLabel.html("");
this.tooltipTrigger.getWidget()&&this.tooltipTrigger.getWidget().setContent("");this.options.checkEnoughData&&this.element.addClass("hidden")}})})(R9);(function(b,d){b.createComponentClass("flights.results.FlightResultsFooterDisclaimers",{options:{totalPriceEnabled:!1},addEventHandlers:function(){if(this.options.totalPriceEnabled){var c=this.getChildElement("priceDisclaimers");this.subscribe("searchform.submit",function(a){c.toggleClass("fullPrice",0<a.lapInfant)});this.subscribe("resultsHeader.changed",function(a){a.hasOwnProperty("priceType")&&c.toggleClass("fullPrice","totaltaxes"===a.priceType)})}var b=this.getChildElement("hackerFares");this.subscribe("resultspage.streaming.done",
function(){b.removeClass("hidden")})}})})(R9,jQuery);(function(d,c){d.createComponentClass("flights.results.FlightResultsListHeader","base.results.ResultsListHeader",{addEventHandlers:function(){this.base();var b=this.element;b.find(".col-views \x3e a").click(function(){b.find(".active").removeClass("active").attr("aria-selected",!1);c(this).addClass("active").attr("aria-selected",!0);d.events.publish("flights.results.setView",c(this).data("view"))});b.find(".col-views \x3e .switch").click(function(){var a=b.find(".col-views \x3e a"),e=a.filter(".active")[0],
a=a.not(".active")[0];c(e).removeClass("active").attr("aria-selected",!1);c(a).addClass("active").attr("aria-selected",!0);d.events.publish("flights.results.setView",c(a).data("view"))});this.subscribe("flights.results.header.setView",function(a){b.find(".col-views \x3e a").removeClass("active").attr("aria-selected",!1);b.find(".col-views \x3e a[data-view\x3d%s]".format(a)).addClass("active").attr("aria-selected",!0)})},generateSortLoggingLabel:function(b,a){switch(b){case "price":return a?"cheapest":
"mostexpensive";case "recommended":return a?"best":"worst";case "duration":return a?"shortest":"longest";case "airline":return a?"AtoZ":"ZtoA";case "depart-takeoff":return a?"early":"late";case "depart":return a?"early":"late";case "return-takeoff":return a?"early":"late";case "return":return a?"early":"late"}}})})(R9,jQuery);(function(d,e){d.createComponentClass("flights.results.FlightResultsPage","base.results.ResultsPage",{vertical:"flights",urlSearchStartSupported:!0,activeLeg:-1,chosenResultId:void 0,focusedResultId:void 0,renderPlusMinusThreeFlex:!1,renderAirlineStopsMatrix:!1,requestAlternateFlexDates:!1,renderCustomTicketHeader:!1,preserveCustomTicketHeader:!1,specificLegs:null,activeDestinationAirport:null,resultsListHeader:null,activeCabin:null,bundleHackerFares:!1,delimitedUnstackedResultStackIds:"",featuredPriceMap:null,
customTicketOpened:!1,bestFlightsParams:null,legsData:null,isOneWay:!1,isRoundTrip:!1,isMultiCity:!1,gtmUpdates:null,momondoGraphContainer:null,momondoBelowBarContainer:null,upsellNonLocale:!0,searchStartedWithFilters:!1,options:{legCount:2,activeLeg:-1,chosenResultId:null,focusedResultId:null,focusedResultType:null,currentview:"list",oneway:null,activeDestinationAirport:null,selectLegSwitchToSegmentView:!1,requestAlternateFlexDates:!1,resultsPlaceholderEnabled:!1,showStaticLoadingMessage:!1,retainOpenedResults:!1,
footerDisclaimersEnabled:!1,firstResultsUseFilteredCount:!1,bundleHackerFares:!1,unstackedResultStackIds:"",customTicketEnabled:!1,customTicketSort:"depart",datesGraphForEcoOnly:!1,noNonstopWarningEnabled:!1},init:function(){this.base();var a=this;this.specificLegState={};this.specificLegs={};this.gtmUpdates={};this.ajaxAppendTo=this.resultsList;this.requestAlternateFlexDates=this.options.requestAlternateFlexDates;this.resultsListHeader=this.element.find(".resultsListHeader");this.momondoGraphContainer=
this.element.find(".momondo-graph-container");this.momondoBelowBarContainer=this.element.find(".momondo-below-search-bar");this.options.resultsPlaceholderEnabled&&(this.resultsPlaceholder=this.getChildElement("placeholder"));this.formBlock=e(".pinnedContent",this.element);this.options.persistWindowScroll=!this.appendResults;this.setLegCount(this.options.legCount);if("number"===typeof this.options.activeLeg&&-1<this.options.activeLeg||"string"===typeof this.options.chosenResultId)this.options.currentview=
"customticket"!==this.options.currentview?"segment":"customticket";"number"===typeof this.options.activeLeg&&this.setActiveLeg(this.options.activeLeg,!0);"string"===typeof this.options.chosenResultId&&this.setChosenResultId(this.options.chosenResultId);"string"===typeof this.options.focusedResultId&&(this.focusedResultId=this.options.focusedResultId);"string"===typeof this.options.focusedResultType&&(this.focusedResultType=this.options.focusedResultType);"string"===typeof this.options.activeDestinationAirport&&
(this.activeDestinationAirport=this.options.activeDestinationAirport);this.options.bundledHackerFaresEnabled&&(this.bundleHackerFares=this.options.bundleHackerFares);this.delimitedUnstackedResultStackIds=this.options.unstackedResultStackIds;if(this.options.filtersData){var c=this.options.filtersData.flexdepart,b=this.options.filtersData.flexreturn;c&&c.isDirty&&(this.filterState.flexdepart={},Object.keys(c.valueMap).forEach(function(b){a.filterState.flexdepart[b]=c.valueMap[b].selected}));b&&b.isDirty&&
(this.filterState.flexreturn={},Object.keys(b.valueMap).forEach(function(c){a.filterState.flexreturn[c]=b.valueMap[c].selected}))}},addEventHandlers:function(){var a=this;this.base();this.setupSpecificLegEvents();this.setupDisclaimerEvents();this.subscribe("flights.resultspage.getairlinematrix",function(){a.renderAirlineStopsMatrix=!0;a.refreshResults()});this.subscribe("flights.resultspage.getflex",function(){a.renderPlusMinusThreeFlex=!0;a.requestAlternateFlexDates=!1;a.refreshResults()});this.subscribe("flights.resultspage.transition",
function(b){b.isLoading?a.addTransitionClass():a.removeTransitionClass()});this.options.pauseStreamingForDetails&&this.subscribe(["common.resultspage.detailsRequested","common.resultspage.modal.detailsOpen"],function(b){!a.poll.ended&&a.poll.activeRequest&&(a.poll.activeRequest.abort(),clearTimeout(a.poll.nextPollTimeoutId),b&&b.then?b.then(a.getResults.bind(a)):"function"===typeof b&&(a.endPolling("pausedetails"),b()))});this.subscribe("flights.resultspage.gtm.update",this.handleGTMUpdate.bind(this));
this.subscribe("flights.results.setActiveDestination",function(b){a.activeDestinationAirport=b.code;d.action.execute("common/utils/history/UserStateUpdateAction",{storageType:"viewState",searchId:a.searchId,key:"activeDestinationAirport",value:a.activeDestinationAirport});a.setPageNumber(1);a.refreshResults()});this.subscribe("flights.results.details.rates.categoryChanged",function(b){a.viewState.activeRatesTables||(a.viewState.activeRatesTables={});a.viewState.activeRatesTables[b.resultId]=b.category;
d.action.execute("common/utils/history/UserStateUpdateAction",{storageType:"viewState",searchId:a.searchId,key:"activeRatesTables",value:JSON.stringify(a.viewState.activeRatesTables)})});this.subscribe("flights.results.multibook.featured.recordPrice",function(b){a.poll.ended&&(null===a.featuredPriceMap&&(a.featuredPriceMap={lastPollId:"",prices:{}}),a.featuredPriceMap.lastPollId!==a.poll.pollingId&&(a.featuredPriceMap.lastPollId=a.poll.pollingId,a.featuredPriceMap.prices={}),a.featuredPriceMap.prices[b.resultId]=
b.price)});this.subscribe("flights.resultspage.bundleHackerFares.set",function(b){a.bundleHackerFares=b.bundleHackerFares;b.refresh&&a.refreshResults(b)});this.subscribe("flights.resultspage.stackedResults.unstack",function(b){-1===a.delimitedUnstackedResultStackIds.indexOf(b.stackId)&&(a.delimitedUnstackedResultStackIds+=0<a.delimitedUnstackedResultStackIds.length?","+b.stackId:b.stackId);b.refresh&&a.refreshResults({customUpdate:"unstack",pageNumber:1,append:!1})});this.subscribe("flights.resultspage.bestflights.setParams",
function(b){var c={};void 0===b.priceEmphasis||null===b.priceEmphasis||isNaN(b.priceEmphasis)||(c.priceEmphasis=b.priceEmphasis);void 0===b.durationEmphasis||null===b.durationEmphasis||isNaN(b.durationEmphasis)||(c.durationEmphasis=b.durationEmphasis);void 0!==b.limitSubEconomy&&(c.limitSubEconomy=b.limitSubEconomy);void 0!==b.preferredAirlines&&e.isArray(b.preferredAirlines)&&(c.preferredAirlines=b.preferredAirlines);a.bestFlightsParams=c;a.refreshResults()});this.subscribe("flights.results.toggleNonLocale",
function(b){a.upsellNonLocale&&"show"===b.action?(a.upsellNonLocale=!1,a.refreshResults({showNonLocale:!0})):d.events.publish("filters.providers.ONLY_LOCALE.setchecked.force",{selected:"show"!==b.action?1:0})});this.subscribe("flights.results.toggleMultiModal",function(b){a.refreshResults({showMultiModal:!0})});var c=function(){a.chosenResultId=null;a.specificLegs={}};c.priority=0;this.subscribe("filters.reset",c);this.subscribe("flights.search.rtow.form.displayCat",function(b){b.displayCat&&"roundtrip"!==
b.displayCat&&(a.options.currentview="list")});c=this.onQuickfilterStateChange.bind(this);this.subscribe("quickfilters.changed",c);this.answer("flights.resultspage.currentview",function(){return a.options.currentview});this.answer("flights.resultspage.oneway",function(){return a.options.oneway});this.answer("flights.resultspage.featuredprices",function(){if(null!==a.featuredPriceMap)return a.featuredPriceMap.prices});c=window["@r9/gdpr"];this.options.searchId&&c&&c.canShowConsentDialog()||this.subscribe("resultspage.searchId.changed",
function(b){b.searchId&&b.searchId.length&&a.setupDriveByAlertRequest(b.searchId)});this.subscribe("search.startSearch",function(b){a.setMomondoGraphVisibility.call(a,b);a.setMomondoBelowBarVisibility.call(a,b)})},inlineComponentsReady:function(){this.base();this.options.searchId&&d.events.ready("resultsPage.content.visible")},resetSortTypeForNewSearch:function(a){this.base(a);d.config.getBoolean("ui.resultspage.resetDefaultSortOrderOnSearch",!0)&&(this.options.ascending="_a"===this.options.defaultSortType.substr(-2))},
switchView:function(a,c,b){if(this.options.currentview!==a){if("list"===a)this.setActiveLeg(-1),this.element.find(".header-wrapper").removeClass("segment-view"),d.Analytics.api.trackEvent({category:"View",action:"roundtrip"});else if("segment"===a||"customticket"===a){var e=Object.keys(this.specificLegs);e.length<this.legCount||"undefined"!==typeof c?(c="undefined"!==typeof c?c:0<e.length?Math.max.apply(null,e.map(function(a){return parseInt(a)+1})):0,this.setActiveLeg(c)):this.chosenResultId=this.specificLegs["0"];
this.element.find(".header-wrapper").addClass("segment-view");d.Analytics.api.trackEvent({category:"View",action:a});this.renderAirlineStopsMatrix=!1}else return;this.options.pageNumber=1;this.options.currentview=a;d.events.publish("flights.results.header.setView",this.options.currentview);b||this.refreshResults({append:!1})}},resetCustomTicketView:function(){this.customTicketOpened=!1;this.specificLegs={};this.setChosenResultId(null);d.events.publish("filter.reset",{name:"specificleg"});this.switchView(this.beforeCustomTicket||
"list",void 0,!0)},startSearch:function(a){var c=this,b=!0;this.customTicketOpened&&this.options.defaultSortType&&(d.events.publish("flights.results.customTicket.header.remove",!0),this.resetCustomTicketView(),this.resetSortTypeForNewSearch(this.options.defaultSortType));this.base(a);a&&"openflex"===a.flex_category?this.element.addClass("OpenFlexView"):(this.element.removeClass("OpenFlexView"),this.options.resultsPlaceholderEnabled&&(this.options.placeholderDelay?(b=!1,setTimeout(function(){c.resultsPlaceholder.addClass("visible");
d.events.ready("resultsPage.content.visible")},this.options.placeholderDelay)):this.resultsPlaceholder.addClass("visible")));b&&d.events.ready("resultsPage.content.visible");this.toggleGrayBG(a.oneway)},handleError:function(a){this.base(a);a&&"object"===typeof a&&0===a.status||this.destroyOldResults()},destroyAboveContainers:function(){d.ComponentManager.remove(e("#aboveResultsContainer").find(".Flights-Results-FlightAboveResultsContent"),!1);d.ComponentManager.remove(e("#aboveHeaderContainer").find(".FlightAboveHeaderContent"),
!1)},destroyOldResults:function(a){this.destroyAboveContainers();var c=!1,b=!1;if(a&&a.length&&(a.children().each(function(a,d){"searchResultsList"==d.id&&(c=0===d.children.length,b=!0)}),(c=c||!b)&&d.config.getBoolean("ui.horizion.rp.skipEmptyList",!0)&&0<this.poll.lastPollTotalCount&&!this.poll.ended))return;this.base()},beforeAppendNewResults:function(){this.base();this.destroyAboveContainers()},onFilterStateChange:function(){var a=this.options.pageNumber;this.base.apply(this,arguments);1<a&&this.appendResults&&
e(window).scrollTop(0);this.warnNonStop=!1},onResultsListHeaderChange:function(a){a.rpIgnore||(this.options.customTicketEnabled&&a.customTicket&&!this.customTicketOpened?(this.beforeCustomTicket=this.options.currentview,"customTicket"===a.sort.sortType&&(a.sort.sortType=this.options.customTicketSort),this.switchView("customticket",void 0,!0)):this.options.customTicketEnabled&&!a.customTicket&&this.customTicketOpened&&this.resetCustomTicketView(),this.base(a))},updateCustomTicketPlaceholderVisibility:function(){var a=
!this.poll.ended,c=this.element.find(".custom-ticket-placeholder");this.element.find("#searchResultsList").toggleClass("invisible",a);c.toggleClass("visible",a)},onQuickfilterStateChange:function(a){var c=this.options.pageNumber;this.resultsList.removeClass("hidden");this.setPageNumber(1);this.resultsReason="filters.changed";this.poll.reason="FILTER";this.refreshResults({filterState:a});1<c&&this.appendResults&&e(window).scrollTop(0)},cleanupExistingSearch:function(){this.base();this.setChosenResultId(null);
this.setActiveLeg(-1,!0);this.renderAirlineStopsMatrix=this.renderPlusMinusThreeFlex=!1;this.requestAlternateFlexDates=this.options.requestAlternateFlexDates;this.activeDestinationAirport=null;this.specificLegs={};this.activeCabin=null;this.upsellNonLocale=!0;this.warnNonStop=this.searchStartedWithFilters=!1;this.options.customTicketEnabled&&d.events.publish("flights.results.customTicket.header.remove",!0);this.options.bundledHackerFaresEnabled&&(this.bundleHackerFares=!0)},getFetchResultsOpts:function(){var a=
this.base();a.activeLeg=this.activeLeg;this.chosenResultId&&(a.chosenResultId=this.chosenResultId);this.focusedResultId&&(a.focusedResultId=this.focusedResultId);this.focusedResultType&&(a.focusedResultType=this.focusedResultType);this.activeDestinationAirport&&(a.activeDestinationAirport=this.activeDestinationAirport);this.options.retainOpenedResults&&!this.poll.ended&&a.openDetails&&(a.retainOpenedResults=0<Object.keys(a.openDetails).length);this.options.bundledHackerFaresEnabled&&(a.bundleHackerFares=
this.bundleHackerFares);0<this.delimitedUnstackedResultStackIds.length&&(a.delimitedUnstackedResultStackIds=this.delimitedUnstackedResultStackIds);this.bestFlightsParams&&(a.bestFlightsParams=this.bestFlightsParams);a.view=this.options.currentview;a.renderPlusMinusThreeFlex=this.renderPlusMinusThreeFlex;a.renderAirlineStopsMatrix=this.renderAirlineStopsMatrix;a.requestAlternateFlexDates=this.requestAlternateFlexDates;this.options.customTicketEnabled&&"customticket"===this.options.currentview&&(a.renderCustomTicketHeader=
!this.customTicketOpened,a.preserveCustomTicketHeader=this.customTicketOpened,a.renderCustomTicketResult=this.customTicketOpened&&d.question.ask("customTicket.tabs.isLast"));return a},addTransitionClass:function(a){this.options.forceLoadingTreatmentSkip&&this.skipLoadingTreatment()||(this.options.showStaticLoadingMessage&&(0<=e.inArray(this.poll.reason,["FILTER","FILTER.RESET","SORT"])?(this.resultsListHeader.addClass("updating"),this.resultsListCover.addClass("updating"),this.getChildElement("loadingMessage").text(this.options.msg.updating_results).removeClass("hidden")):
this.resultsListHeader.addClass("loading")),(this.poll.ended||"POLL"!==this.poll.reason)&&this.resultsListCover.addClass("no-spin"),this.base(a))},removeTransitionClass:function(){this.base();this.resultsListCover.removeClass("no-spin");this.resultsListCover.removeAttr("style");this.options.showStaticLoadingMessage&&(this.resultsListCover.removeClass("updating"),this.resultsListHeader.removeClass("updating loading"))},setupDisclaimerEvents:function(){this.subscribe("disclaimer.togglewhy",function(){e("#whydisclaimer").toggle()})},
setupSpecificLegEvents:function(){this.specificLegs={};this.subscribe("flights.result.specificleg.change",this.handleListViewSpecificLegUpdate.bind(this));this.subscribe("flights.results.setView",this.switchView.bind(this));this.subscribe("flights.results.selectLeg",this.selectLeg.bind(this));this.subscribe("flights.results.removeLeg",this.removeLeg.bind(this));this.options.customTicketEnabled&&this.subscribe("flights.results.setLegView",this.selectedLegView.bind(this))},handleListViewSpecificLegUpdate:function(a){this.handleSpecificLegUpdate(a);
this.options.selectLegSwitchToSegmentView&&"list"===this.options.currentview&&a.checked&&this.segmentViewEnabled&&this.switchView("segment",this.determineNextActiveLeg(a.leg))},handleSpecificLegUpdate:function(a){a.checked?this.specificLegs[a.leg]=a.resultId:delete this.specificLegs[a.leg];var c=Object.keys(this.specificLegs);-1<this.activeLeg&&c.length>=this.legCount&&a.resultId&&(this.chosenResultId=a.resultId);d.events.publish("common.results.filters.specificleg.change",a)},syncFilterState:function(a){this.base(a);
this.filterState.specificleg?this.specificLegs=this.filterState.specificleg.legs:(this.chosenResultId=null,this.specificLegs={})},setLegCount:function(a){this.legCount=a;d.events.publish("common.results.filters.legCount.set",this.legCount)},setLegsData:function(a){this.legsData=a},setActiveLeg:function(a,c){this.customTicketOpened&&a>=this.legCount&&this.activeLeg!==a&&d.events.publish("customTicket.tabs.activeTab",this.legCount);a>=this.legCount||this.activeLeg===a||(this.activeLeg=a,d.events.publish("common.results.filters.activeLeg.changed",
a),c||d.action.execute("common/utils/history/UserStateUpdateAction",{storageType:"viewState",searchId:this.searchId,key:"activeLeg",value:this.activeLeg}))},selectedLegView:function(a){this.setActiveLeg(parseInt(a),!0);this.resultsReason="filters.changed";this.poll.reason="FILTER";this.refreshResults()},setChosenResultId:function(a){(this.chosenResultId=a)?(!this.customTicketOpened&&this.element.addClass("ChosenResultView"),d.events.publish("paginator.hide"),d.events.publish("filters.disabled",!0)):
(!this.customTicketOpened&&this.element.removeClass("ChosenResultView"),d.events.publish("filters.disabled",!1))},determineNextActiveLeg:function(a){if(a===this.legCount-1)for(var c=0;c<a;c++)if(!this.specificLegs[c])return c;a+=1;if(this.customTicketOpened){for(;a<this.legCount;a++)if(!this.specificLegs[a])return a;return this.legCount}return a},selectLeg:function(a){if(a.id)this[a.customTicket?"animatePageToTop":"animateLegToTop"](e(document.getElementById(a.id)));a.leg<this.legCount&&this.setActiveLeg(this.determineNextActiveLeg(a.leg));
a.checked=!0;a.removeOld=a.customTicket;this.handleSpecificLegUpdate(a)},removeLeg:function(a){a.checked=!1;this.setActiveLeg(a.leg);(0===a.leg&&!this.customTicketOpened||this.customTicketOpened&&1===Object.keys(this.specificLegs).length)&&d.events.publish("filter.reset",{name:"specificleg"});this.customTicketOpened||this.element.find(".Flights-Results-SegmentViewHeader").addClass(0===a.leg?"removeDepart":"removeReturn");this.setChosenResultId(null);this.handleSpecificLegUpdate(a)},animateLegToTop:function(a){var c=
this,b=e("#aboveHeaderContainer").find(".sblHeader").eq(this.activeLeg);b.addClass("chosen");a.addClass("chosen animating");a.find(".Flights-Results-SegmentResultInfo").addClass("chosen");this.listBody.addClass("animatingSelectedLeg");e(window).scrollTop(0);a.css({transform:"translateY(%spx)".format(a.offset().top-b.offset().top)});a.detach().insertAfter(b);setTimeout(function(){a.css("transform","translateY(0)");setTimeout(function(){e(document).trigger("scroll");a.removeClass("animating");c.listBody.removeClass("animatingSelectedLeg")},
400)},50);this.activeLeg>=this.legCount&&this.element.addClass("ChosenResultView")},animatePageToTop:function(){e(window).scrollTop(this.listCol.offset().top-(this.formBlock.hasClass("R9-Sticky")?this.formBlock.height():0))},toggleGrayBG:function(a){this.element.hasClass("GrayBG")&&"m"===a&&!d.config.getBoolean("ui.flights.results.grayBG.multicity",!1)&&this.element.removeClass("GrayBG")},doCustomUpdate:function(a){return!a.append&&d.config.getBoolean("ui.horizon.flights.resultspage.mergeDOM",!0)},
preprocessResponse:function(a){a&&a.hasOwnProperty("showPriceAlerts")&&d.events.publish("flights.results.priceAlertEnabled",{visible:a.showPriceAlerts,enabled:a.priceAlertsEnabled});a&&a.hasOwnProperty("isCustomTicket")&&(this.customTicketOpened=a.isCustomTicket);a&&a.hasOwnProperty("flightSearchOperators")&&d.events.publish("flights.results.searchOperators",a.flightSearchOperators);a&&a.hasOwnProperty("bestExactAirportPrice")&&d.events.publish("flights.results.cheapest.exactAirport.price",a.bestExactAirportPrice);
this.customTicketOpened?d.events.publish("customTicket.sort.hidden",d.question.ask("customTicket.tabs.isLast")):this.options.customTicketEnabled&&d.events.publish("flights.results.customTicket.header.remove");this.base(a)},didReceiveResults:function(a){var c;a.hasOwnProperty("activeLeg")&&!isNaN(parseInt(a.activeLeg))&&(this.setActiveLeg(parseInt(a.activeLeg),!0),c={filtered:a.filteredCountForLeg,total:a.totalCountForLeg,product:a.product},d.events.publish("resultspage.results.count.changed",c));
this.options.resultsPlaceholderEnabled&&this.customTicketOpened&&this.updateCustomTicketPlaceholderVisibility();a.hasOwnProperty("legCount")&&this.setLegCount(a.legCount);a.hasOwnProperty("legsData")&&this.setLegsData(a.legsData);a.hasOwnProperty("chosenResultId")&&this.setChosenResultId(a.chosenResultId);a.hasOwnProperty("isFlex")&&d.events.publish("flights.results.flexmatrix.show");a.hasOwnProperty("isSegmentViewEnabled")&&(d.events.publish("flights.results.setSegmentLinkVisible",a.isSegmentViewEnabled),
this.segmentViewEnabled=a.isSegmentViewEnabled,!1!==a.isSegmentViewEnabled||this.customTicketOpened||(this.options.currentview="list",this.setActiveLeg(-1,!0)));a.hasOwnProperty("aboveHeaderClass")&&e("#aboveHeaderContainer").addClass(a.aboveHeaderClass);a.hasOwnProperty("existingAlertId")&&d.events.publish("flights.results.existingAlert",a.existingAlertId);a.hasOwnProperty("oneway")&&(this.options.oneway=a.oneway,this.toggleGrayBG(a.oneway));a.hasOwnProperty("isSegmentView")&&this.element.find(".header-wrapper").toggleClass("segment-view",
a.isSegmentView);a.hasOwnProperty("isOneWay")&&(this.isOneWay=a.isOneWay);a.hasOwnProperty("isRoundTrip")&&(this.isRoundTrip=a.isRoundTrip);a.hasOwnProperty("isMulticity")&&(this.isMultiCity=a.isMulticity);a.hasOwnProperty("sortMode")&&(c=this.getSortDataFromString(a.sortMode),this.options.sortMode=c.sortType,this.options.ascending=c.ascending,this.customTicketOpened||d.events.publish("resultsHeader.sortType.set.no.refresh",{sortCode:a.sortMode}));a.hasOwnProperty("activeCabin")&&a.activeCabin!==
this.activeCabin&&(this.activeCabin=a.activeCabin,d.events.publish("flights.results.activeCabin.changed",this.activeCabin));this.options.resultsPlaceholderEnabled&&0<a.filteredCount&&this.resultsPlaceholder.removeClass("visible");a.hasOwnProperty("insightsContainerData")&&d.events.publish("flights.results.insightsContainerData",e.extend({searchComplete:this.poll.ended},a.insightsContainerData));this.searchStartedWithFilters&&a.completed&&a.hasOwnProperty("cheapestResultHiddenByFilters")&&d.events.publish("flights.results.cheapestResultHiddenByFilters",
{hidden:a.cheapestResultHiddenByFilters,price:a.cheapestHiddenPrice});this.updateFooter(a.filtersData&&a.filtersData.quality&&a.filtersData.quality.valueMap.hasOwnProperty("split"))},getSortDataFromString:function(a){a=a.split("_");var c=a[1];return{sortType:a[0],ascending:c?"a"===c:null}},shouldTrackStreamingPerformance:function(){return this.searchStartParams.origincode&&this.searchStartParams.destinationcode&&-1<d.config.getString("ui.horizon.resultspage.flights.trackStreamingPerformance","").split(",").indexOf(this.searchStartParams.origincode+
this.searchStartParams.destinationcode)?!0:this.base()},updateFooter:function(a){this.options.footerDisclaimersEnabled&&d.events.publish("footer.update.rp.disclaimer",{message:a?this.options.msg.footerMessageHf:this.options.msg.footerMessage})},skipLoadingTreatment:function(){return this.options.resultsPlaceholderEnabled},adjustTimesFilterState:function(a,c){a.legs&&a.legs.forEach(function(a,e){if(0!==Object.keys(a).length){var b;b=moment(c.isMulticity?c["depart_date"+e]:0===e?c.depart_date:c.return_date,
d.globals.apiDateFormat).utc();["max","min"].forEach(function(c){if(a[c]){var d=moment(parseInt(a[c],10)).utc(),e=b.diff(d.clone().startOf("day"),"days");0!==e&&(a[c]=d.add(e,"days").toDate().getTime().toString())}})}})},setPreservedFilterState:function(a){this.base(a);this.preservedFilters.takeoff&&this.adjustTimesFilterState(this.preservedFilters.takeoff,a);this.preservedFilters.landing&&this.adjustTimesFilterState(this.preservedFilters.landing,a);!this.preservedFilters.flexdepart||a.depart_date===
this.searchStartParams.depart_date&&a.depart_date_flex===this.searchStartParams.depart_date_flex||delete this.preservedFilters.flexdepart;!this.preservedFilters.flexreturn||a.return_date===this.searchStartParams.return_date&&a.return_date_flex===this.searchStartParams.return_date_flex||delete this.preservedFilters.flexreturn},setupDriveByAlertRequest:function(a){d.ajax.execute("flights/results/FlightPriceAlertDriveBy",{data:{searchId:a},replace:!0})},handleGTMUpdate:function(a){this.gtmUpdates[a.resultId]&&
window.clearTimeout(this.gtmUpdates[a.resultId]);this.gtmUpdates[a.resultId]=setTimeout(function(){d.events.publish("gtm.update",a)},500)},endPolling:function(a,c,b){this.poll.ended||(this.base(a,c,b),"completed"===a&&this.preserveFilters&&b&&this.poll.usingPreservedFilters&&this.checkFilteredCountForPreservedFilters(b),this.options.resultsPlaceholderEnabled&&this.resultsPlaceholder.removeClass("visible"),this.options.noNonstopWarningEnabled&&this.warnNonStop&&this.checkNoNonstopFound())},checkNoNonstopFound:function(){d.question.ask("filters.stops.hasNonStop")||
(d.events.publish("resultspage.notify",{content:this.options.msg.nononstop_warning,openWhileIdle:!0}),d.events.publish("filter.reset",{name:"stops"}),this.warnNonStop=!1)},checkFilteredCountForPreservedFilters:function(a){var c=this.preservedFilters,b={};this.options.nonClearablePreservedFilters.forEach(function(a){c.hasOwnProperty(a)&&(b[a]=c[a])});this.clearPreservedFilters();a.filteredCount<=this.options.removeFiltersThreshold?(d.events.publish("resultspage.preservedFilters.removed"),d.events.publish("resultspage.notify",
{content:this.options.msg.preserved_filters_removed}),this.preservedFilters=0<Object.keys(b).length?b:null,this.filterState=0<Object.keys(b).length?b:{},this.refreshResults({resetFilters:!0})):this.options.messageAppliedPreservedFilters&&d.events.publish("resultspage.notify",{content:this.options.msg.preserved_filters_applied})},isFirstResults:function(a,c){return this.options.firstResultsUseFilteredCount?a&&c&&0<c.filteredCount&&0>this.poll.lastPollTotalCount:this.base(a,c)},setMomondoGraphVisibility:function(a){null!=
this.momondoGraphContainer&&this.momondoGraphContainer.toggleClass("hidden",this.options.datesGraphForEcoOnly&&"e"!=a.cabin)},setMomondoBelowBarVisibility:function(a){null!=this.momondoBelowBarContainer&&a&&this.momondoBelowBarContainer.toggleClass("hidden","exact"!==a.flex_category)},startedStreaming:function(){this.searchStartedWithFilters=!!this.urlFilterState;this.warnNonStop=this.options.noNonstopWarningEnabled&&this.searchStartedWithFilters&&-1<this.urlFilterState.indexOf("stops\x3d");this.searchStartedWithFilters&&
-1<this.urlFilterState.indexOf("cabin\x3d")&&d.events.publish("flights.filters.hoistCabin")}})})(R9,jQuery);(function(a,c){a.createComponentClass("flights.results.FlightRightRail","base.results.Rail",{adsContainer:null,addEventHandlers:function(){this.subscribe("right.rail.hide",c.proxy(this.hide,this));this.subscribe("right.rail.show",c.proxy(this.show,this));if(-1<this.options.components.indexOf("price-prediction")){var a=this;this.subscribe("flights.results.priceAlertEnabled",function(b){a.getChildElement("priceAlertsContainer").css("display",b.enabled&&b.visible?"block":"none")})}},hide:function(){var d=
this,b=c.Deferred(),e=b.promise();this.unbindWindowEvents();this.hasAnimation()?(this.element.on(a.Common.Utils.Browsers.ANIMATION_END,function(){b.resolve();d.element.off(a.Common.Utils.Browsers.ANIMATION_END)}),this.element.addClass("animate")):b.resolve();e.then(function(){d.element.addClass("is-hidden");a.events.publish("right.rail.hideAnimationDone")})},show:function(){this.bindWindowEvents();this.element.removeClass("animate");this.element.removeClass("is-hidden");this.onScroll()},hasAnimation:function(){return"0s"!==
this.element.css("animationDuration")}})})(R9,jQuery);(function(d,f,g){d.createComponentClass("flights.results.FlightSnackshotHeader","common.results.SortTabContainer",{allTabs:null,customizeBestFlightsTooltip:null,moreDropdownElement:null,moreDropdownContainer:null,activeSortType:"",dropdownTabVisible:!1,dropdownTabActive:!1,tabIndicator:null,tabIndicatorId:null,options:{snackshotData:null,msg:{takeoffTemplate:"",landingTemplate:""}},init:function(){this.unrolledTabs=this.element.find(".js-sort-tab-unrolled");this.rolledTabs=this.element.find(".js-sort-tab-rolled");
this.lastUnrolledTab=f();this.allTabs=this.unrolledTabs.add(this.rolledTabs);this.moreDropdownElement=this.element.find(".js-sort-dropdown-widget");this.moreDropdown=this.moreDropdownElement.parent().getWidget();this.moreDropdownContainer=this.getChildElement("sort-dropdown-container");this.tabIndicator=this.getChildElement("tab-indicator");this.customizeBestFlightsTooltip=this.getChildElement("bestflights-settings-icon").getWidget();this.activeSortType=this.options.activeSortTab;this.dropdownTabVisible=
this.dropdownTabActive=!!this.getTabForType(this.rolledTabs,this.activeSortType).length},addEventHandlers:function(){this.base();this.subscribe("searchform.submit",this.handleNewSearch.bind(this));this.subscribe("resultspage.searchId.changed",this.resetSnackshotDisplay.bind(this));this.moreDropdown&&(this.moreDropdown.setOption("onOpen",this.handleDropdownToggle.bind(this,!0)),this.moreDropdown.setOption("onClose",this.handleDropdownToggle.bind(this,!1)),this.subscribe("sortDropdown.visibility.change",
this.onSortDropdownVisible.bind(this)));this.customizeBestFlightsTooltip&&(this.registerEvent("click",this.customizeBestFlightsTooltip.element,function(){return!1}),this.customizeBestFlightsTooltip.setOption("onOpen",function(){d.events.publish("flights.resultspage.customizeBestFlights.tooltip.open")}),this.subscribe("flights.resultspage.customizeBestFlights.tooltip.close",this.customizeBestFlightsTooltip.close.bind(this.customizeBestFlightsTooltip)),this.subscribe("flights.resultspage.bestflights.setParams",
function(a){this.swapClassesToggle(this.getChildElement("bestflights-settings-icon"),"SortTab__Settings__Icon--Default","SortTab__Settings__Icon--Updated",a.isDefault)}.bind(this)))},getTabForType:function(a,b){return a.filter("[data-sort\x3d'"+b+"']")},handleNewSearch:function(a){this.updateOriginDestination(a);this.resetSnackshotDisplay()},updateOriginDestination:function(a){a.origin&&(this.fillAirportCodeLabels(a.origin,"depart",this.options.msg.takeoffTemplate),this.fillAirportCodeLabels(a.origin,
"arriveReturn",this.options.msg.landingTemplate));a.destination&&(this.fillAirportCodeLabels(a.destination,"arrive",this.options.msg.landingTemplate),this.fillAirportCodeLabels(a.destination,"departReturn",this.options.msg.takeoffTemplate))},fillAirportCodeLabels:function(a,b,c){a=d.Common.Utils.String.formatString(c,(a||"").split("/")[0]);this.getTabForType(this.rolledTabs,b+"_a").add(this.getTabForType(this.rolledTabs,b+"_b")).find(".js-label").text(a)},onSortDropdownVisible:function(a){this.setDropdownTabVisible(a);
a||(this.swapClasses(this.rolledTabs,"SortTab--visible","SortTab--hidden"),this.rolledTabs.attr({"aria-hidden":!0,"data-hidden":!0}))},handleDropdownToggle:function(a){var b=a&&!this.dropdownTabActive;this.moreDropdownElement.toggleClass(this.getStlBlock("SortDropdown__Trigger--dropdown-tab-hidden--open"),b);this.rolledTabs.filter("[data-hidden\x3d'false']").find(".js-sort-tab-row").toggleClass(this.getStlBlock("SortTab__RowContainer--rolled--open"),a)},handleResultsResponse:function(a){this.base(a);
a&&a.sortTabData&&this.updateSnackshotDisplay(a)},updateSnackshotDisplay:function(a){Object.keys(a.sortTabData).forEach(function(b){b=a.sortTabData[b];var c=this.getTabForType(this.unrolledTabs,b.code);this.renderSnackshotDataForTab(c,b)}.bind(this));this.resetChangeTabIndicator(this.getTabForType(this.allTabs,this.activeSortType),300)},resetSnackshotDisplay:function(){this.unrolledTabs.each(function(a,b){this.renderSnackshotDataForTab(f(b))}.bind(this));this.tabIndicator.width(0)},renderSnackshotDataForTab:function(a,
b){if(a.length){b=b||{price:"--",stops:"",duration:""};var c=a.find(".js-price"),d=a.find(".js-stops");a=a.find(".js-duration");c.text(b.price);d.text(b.stops);a.text(b.duration);this.swapClassesToggle(a,"SortTab__SubLabel--SeparatorLeft--present","SortTab__SubLabel--SeparatorLeft--empty",!!b.stops&&!!b.duration)}},handleSortModeChange:function(a){a&&a.sortCode&&(this.updateSortLayout(a.sortCode),this.setActiveTab(a.sortCode))},setSortMode:function(a,b){if(this.getTabForType(this.rolledTabs,a).length&&
this.moreDropdown){var c=this;this.moreDropdown.isOpen?this.moreDropdown.close():d.dom.schedule(function(){c.moreDropdown.open()})}else this.base(a,b)},updateSortLayout:function(a){a=this.getTabForType(this.rolledTabs,a);if(this.dropdownTabVisible||a.length)this.dropdownTabActive=!!a.length,this.addSwapDropdownTab(a),this.setDropdownTabVisible(!this.dropdownTabActive)},setDropdownTabVisible:function(a){this.dropdownTabVisible=a;this.swapClassesToggle(this.moreDropdownContainer,"SortDropdown--dropdown-tab-visible",
"SortDropdown--dropdown-tab-hidden",a);this.swapClassesToggle(this.moreDropdownElement,"SortDropdown__Trigger--dropdown-tab-visible","SortDropdown__Trigger--dropdown-tab-hidden",a)},addSwapDropdownTab:function(a){var b=this,c=this.rolledTabs.filter("[data-hidden\x3d'false']");if(this.dropdownTabActive&&!this.dropdownTabVisible&&!c.length&&a.attr("data-hidden"))this.swapClasses(a,"SortTab--hidden","SortTab--visibility--animation"),g.setTimeout(function(){b.swapClasses(a,"SortTab--visibility--animation",
"SortTab--visible")},0);else if(a.length&&c.length&&!c.is(a))this.swapClasses(a,"SortTab--hidden","SortTab--visible"),this.swapClasses(c,"SortTab--visible","SortTab--hidden");else return;this.rolledTabs.attr({"aria-hidden":!0,"data-hidden":!0});a.attr({"aria-hidden":!1,"data-hidden":!1})},moveSelectedRolledTab:function(){},setActiveTab:function(a){var b=this.getTabForType(this.allTabs,this.activeSortType);if(a&&a!==this.activeSortType){var c=b.find(".js-border-container"),d=b.find(".js-label"),f=
b.find(".js-subLabel"),e=this.getTabForType(this.allTabs,a),g=e.find(".js-border-container"),h=e.find(".js-label"),k=e.find(".js-subLabel");this.swapClasses(b,"SortTab--active","SortTab--inactive");this.swapClasses(c,"SortTab--active__BorderContainerBottom","SortTab--inactive__BorderContainerBottom");this.swapClasses(d,"SortTab__Label--active","SortTab__Label--inactive");this.swapClasses(f,"SortTab__SubLabel--active","SortTab__SubLabel--inactive");this.swapClasses(e,"SortTab--inactive","SortTab--active");
this.swapClasses(g,"SortTab--inactive__BorderContainerBottom","SortTab--active__BorderContainerBottom");this.swapClasses(h,"SortTab__Label--inactive","SortTab__Label--active");this.swapClasses(k,"SortTab__SubLabel--inactive","SortTab__SubLabel--active");b.attr("aria-selected",!1);e.attr("aria-selected",!0);this.activeSortType=a;a=0<=this.unrolledTabs.index(e)?50:300;this.resetChangeTabIndicator(e,a)}else 1>this.tabIndicator.width()&&this.resetChangeTabIndicator(b,300)},resetChangeTabIndicator:function(a,
b){var c=this;clearTimeout(this.tabIndicatorId);0<b?this.tabIndicatorId=setTimeout(function(){c.changeTabIndicator(a)},b):c.changeTabIndicator(a)},changeTabIndicator:function(a){var b=a&&a.length&&a.position();b&&this.tabIndicator.width(a.width()-20).css("left",b.left+10+"px")},updateSortState:function(){}})})(R9,$,window);(function(f,g){f.createComponentClass("flights.results.FlightSortDropdown","common.results.SortDropdown",{SEARCHTYPE_ROUNDTRIP:"roundtrip",SEARCHTYPE_MULTI:"multi",SEARCHTYPE_ONEWAY:"oneway",removedSortOptions:g(),options:{isOneWay:!1,isGanttView:!1,numLegs:1,recommendedSortEnabled:!1,styleJamSelect:!1,dynamicWording:!1,dynamicSorts:[],oneWaySorts:[]},init:function(){this.base();this.options.styleJamSelect||this.setDropdownSorts()},addEventHandlers:function(){var a=this;this.base();this.subscribe("resultsHeader.sortType.set.no.refresh",
function(c){f.dom.schedule(function(){a.options.styleJamSelect?a.sortDropdownWidget.setValue(c.sortCode,!1):a.sortDropdownWidget.setValue(c.sortCode)})});this.options.dynamicWording&&this.subscribe(["resultspage.streaming.done","resultspage.filtersData.changed","filter.show"],function(){a.flightSearchFormState=f.question.ask("flights.rp.searchform");null!==a.flightSearchFormState&&a.flightSearchFormState.isMulticity?a.updateSorts(a.flightSearchFormState,a.SEARCHTYPE_MULTI):null!==a.flightSearchFormState&&
a.flightSearchFormState.oneway?a.updateSorts(a.flightSearchFormState,a.SEARCHTYPE_ONEWAY):a.updateSorts(a.flightSearchFormState,a.SEARCHTYPE_ROUNDTRIP)})},updateSorts:function(a,c){var d=0,b=0,e=this.dropdownHasVisibleItems();if(this.options.styleJamSelect)if(d=this.options.dynamicSorts.length,c===this.SEARCHTYPE_MULTI)for(b=0;b<d;b++)this.sortDropdownWidget.hideNode(this.options.dynamicSorts[b]);else if(c===this.SEARCHTYPE_ONEWAY){for(b=0;b<d;b++)this.sortDropdownWidget.hideNode(this.options.dynamicSorts[b]);
for(b=0;b<this.options.oneWaySorts.length;b++)this.sortDropdownWidget.showNode(this.options.oneWaySorts[b])}else for(b=0;b<d;b++)this.sortDropdownWidget.showNode(this.options.dynamicSorts[b]);else this.sortDropdownWidget.dropdownOptions.each(function(a,b){});this.updateOptionsWithCode(a);a=this.dropdownHasVisibleItems();e!==a&&(a?this.element.show():this.element.hide(),f.events.publish("sortDropdown.visibility.change",a))},dropdownHasVisibleItems:function(){return"function"===typeof this.sortDropdownWidget.hasVisibleNodes?
this.sortDropdownWidget.hasVisibleNodes():!0},handleSearchSubmit:function(a){this.options.isOneWay=a.oneway;this.options.isGanttView=a.hasOwnProperty("depart_date_flex")&&"exact"!==a.depart_date_flex;this.options.numLegs=a.hasOwnProperty("nrLegs")&&a.nrLegs;this.options.styleJamSelect||this.setDropdownSorts()},setDropdownSorts:function(){if(this.options.hasDropdown){var a=this.getSortOptionsToDisplay();this.removedSortOptions.length&&this.renderSortOptions(a);a=this.detachUnusedSortOptions(a);this.removedSortOptions.add(a)}},
getSortOptionsToDisplay:function(){var a=this.options,c=a.isGanttView,d=a.isSortUnrolled,b=a.numLegs,e=!a.isOneWay&&!d&&c,h=2>=b&&!c,b=2===b&&!c;return{airline:!0,price:!d,duration:!d&&!c,firstLegDuration:e,lastLegDuration:e,depart:h,arrive:h,departReturn:b,arriveReturn:b,bestValue:a.recommendedSortEnabled}},renderSortOptions:function(a){var c=g();this.removedSortOptions.each(function(d,b){d=(g(b).val()||"").split("_")[0];!0===a[d]&&c.add(b)});this.options.useSelectWidget?this.sortDropdownWidget.dropdownOptions.append(c):
this.sortDropdownWidget.select.append(c)},detachUnusedSortOptions:function(a){var c=Object.keys(a),d=c.filter(function(b){return!a[b]});if(this.options.useSelectWidget)return this.sortDropdownWidget.dropdownOptions.filter(function(){var a=g(this).attr("data-value"),a=-1<a.indexOf("_")?a.split("_")[0]:a;return""===a||-1<d.indexOf(a)}).detach();var b=this.options.useSelectWidget?"data-value":"value",c=c.reduce(function(c,d){return!1===a[d]?c+",["+b+"^\x3d'"+d+"']":c},!1===a[c[0]]?"[value^\x3d'"+c[0]+
"']":"null");return this.sortDropdownWidget.select.find(c).detach()},setSortMode:function(a){this.base(a)},updateOptionsWithCode:function(a){var c=this;if(null!==a)if(this.options.styleJamSelect)for(var d=this.options.dynamicSorts.length,b="",e="",e=!1,h=0;h<d;h++){var b=this.options.dynamicSorts[h],e="depart_a"===b||"depart_b"===b||"arriveReturn_a"===b||"arriveReturn_b"===b,f=this.sortDropdownWidget.getItemText(b);f&&(e=this.updateTextWithCode(f,this.getCode(a,e)),this.sortDropdownWidget.updateItemText(b,
e))}else{var n=!1,k="",l="",m=g();this.sortDropdownWidget.dropdownOptions.each(function(d,e){m=g(e);k=m.attr("data-title");l=m.text();n="depart_a"===b||"depart_b"===b||"arriveReturn_a"===b||"arriveReturn_b"===b;k=c.updateTextWithCode(k,c.getCode(a,n));l=c.updateTextWithCode(l,c.getCode(a,n));k&&l&&(m.attr("data-title",k),m.text(l))})}},updateTextWithCode:function(a,c){return a.replace(/\([A-Z]{3}\)|\(\)/,"("+c+")")},getCode:function(a,c){var d="",b=/[A-Z]{3}/;c?null!==a.origincode&&-1!==a.origincode.indexOf("/")?
d=a.origincode.split("/")[0]:"undefined"!==typeof a.origin_code&&null!==a.origin_code&&-1!==a.origin_code.indexOf("/")?d=a.origin_code.split("/")[0]:b.test(a.origincode)&&(d=a.origincode):null!==a.destinationcode&&-1!==a.destinationcode.indexOf("/")?d=a.destinationcode.split("/")[0]:"undefined"!==typeof a.destination_code&&null!==a.destination_code&&-1!==a.destination_code.indexOf("/")?d=a.destination_code.split("/")[0]:b.test(a.destinationcode)&&(d=a.destinationcode);return d}})})(R9,jQuery);(function(a,c){a.createComponentClass("flights.results.NoFlightResults","common.results.NoResults",{showNearbyAirportsButton:null,init:function(){this.base();this.showNearbyAirportsButton=this.getChildElement("showNearbyAirports")},addEventHandlers:function(){this.base();this.showNearbyAirportsButton.click(function(b){b.preventDefault();a.events.publish("flights.search.enableNearbyAirports",!0)})},showSearchFailedView:function(){a.question.ask("flights.search.nearbyAirportsEnabled")?this.showNearbyAirportsButton.hide():
this.showNearbyAirportsButton.show();this.element.is(":visible")||a.Analytics.api.trackEvent("flights/noFlightResults");this.element.show()}})})(R9,jQuery);(function(d,e){d.createComponentClass("flights.results.PlaceholderList",{options:{legs:2,classes:null,isExpandable:!1},$results:null,init:function(){this.cards=this.element.find(".js-card")},addEventHandlers:function(){var b=this;this.options.isExpandable||this.subscribe(["searchform.submit","multilocale.search.submit"],function(c){b.morphResults(c.legCount)});this.options.isExpandable&&this.subscribe("placeholderlist.expand",{id:this.id()},this.expandList.bind(this));this.$results=this.element.children()},
expandList:function(){function b(){d.dom.swapClasses(e(c.cards[a]),d.stylejam.flights.results.PlaceholderList.expandingCardHidden,d.stylejam.flights.results.PlaceholderList.expandingCardShown);a++;a<f&&setTimeout(b,10)}var c=this,a=0,f=c.cards.length;b()},morphResults:function(b){var c=this.getStlClasses();c&&this.$results.each(function(){var a=e(this).find(".js-leg").parent(),f=a.children().length;if(f<b)for(var g=a.children().eq(0);f++<b;)g.clone().appendTo(a);a.children().each(function(a){d.dom.swapChildrenClasses(e(this),
c,"solo","default");d.dom.swapChildrenClasses(e(this),c,a>=b?"visible":"hidden",a>=b?"hidden":"visible")});1==b&&d.dom.swapChildrenClasses(a.children().eq(0),c,"default","solo")})}})})(R9,jQuery);(function(b,g){b.createComponentClass("flights.results.SplitBookingHelper","framework.JavaScriptComponent",{searchId:null,componentPath:"flights/results/SplitBookingDialog",pendingRequests:{},dialogsOpened:[],addEventHandlers:function(){var a=this;this.base();this.subscribe(["multibook.splitProvider.click","SplitBooking.request"],this.requestSplitBookingDialog.bind(this));this.subscribe("resultspage.searchId.changed",function(b){a.searchId=b.searchId});this.subscribe("filters.changed",this.onFiltersChanged.bind(this))},
onFiltersChanged:function(a){this.dialogsOpened.length&&b.dom.schedule(this.clearDialogs.bind(this))},clearDialogs:function(){this.dialogsOpened.length&&(this.dialogsOpened.forEach(function(a){a&&b.events.publish("SplitBookingDialog.remove",{resultId:a})}),this.dialogsOpened=[])},requestSplitBookingDialog:function(a){var e=a.searchId||this.searchId,c=g(a.element),d=a.targetElementId||c.length&&c.attr("id"),h=this;c.length&&!d&&(d="tmp-"+Math.round(1E5*Math.random()),c.attr("id",d));d||this.log.error("SplitBookingDialog requested, but no target supplied");
b.Analytics.api.trackEvent({action:"buttonClick",category:"splitProvider"});var f=d+"_"+a.resultId;b.question.ask("SplitBookingDialog.%s.exists".format(a.resultId))?b.events.publish("SplitBookingDialog.open",{targetElementId:d,resultId:a.resultId}):this.pendingRequests[f]||(this.pendingRequests[f]=!0,(c=b.question.ask("resultspage.filterState.is"))&&(c=JSON.stringify(c)),b.events.publish("SplitBookingDialog.remove",{resultId:a.resultId}),this.makeDialogRequest({searchId:e,resultId:a.resultId,filterState:c,
targetElementId:d}).then(function(){b.events.publish("SplitBookingDialog.loaded",{resultId:a.resultId});h.dialogsOpened.push(a.resultId)}).fail(function(){b.events.publish("SplitBookingDialog.error",{resultId:a.resultId})}).always(function(){delete h.pendingRequests[f]}))},makeDialogRequest:function(a,e){a=g.extend({},a,e);return b.ajax.execute(this.componentPath,{data:a,handleSearchExpired:!0})}})})(R9,jQuery);(function(d,f){function m(a){return a?p.exec(a)||a&&(-1!==a.indexOf("cy")||-1!==a.indexOf("cg"))?a:a.split("/")[0]:""}function q(a,b){return null===a||"undefined"===typeof a?"function"===typeof b?b():b:a}var p=/[0-9]+[fr]{1,2}/;d.createComponentClass("flights.search.FlightInlineSearchForm","base.search.SearchForm",{vertical:"flights",formQuestion:"flights.rp.searchform",loggingPrefix:"Search-Form",originField:null,nearbyOrigin:null,isNearbySmartyOrigin:null,isNearbySmartyDestination:null,destinationField:null,
destination_code:null,nearbyDestination:null,daterangePicker:null,datePicker:null,flexDatePicker:null,flexDepartDate:null,displayView:null,flexDepart:null,flexReturn:null,flexWeekend:null,flexWeekendDepart:null,flexWeekendReturn:null,flexMonthLengthOfStay:null,flexDaterangePicker:null,startingForm:null,displayCountsLabel:null,isRegionSearchSupported:!1,preserveFilters:!1,multiCityDialog:null,previousSearchType:"",previousOrigin:null,previousOriginCode:null,previousDestination:null,previousDestinationCode:null,
options:{advancedFlexDatePickerEnabled:!1,autoSubmit:!1,backToFDMultiCity:!0,debugForm:!1,display:"roundtrip",displayOverlay:!0,displayViewFormFocus:!1,errMsg:{},flexDateDisplay:{},flex_category:"",forceEditMode:!1,msg:{},phoenixRising:!1,multiCityDisplayDates:null,multiCityDisplayLocations:null,nearbyDestination:!1,nearbyOrigin:!1,isNearbyInSmarty:!1,nearbySmartyTemplateSuffix:"",pinnable:!1,preserveFiltersOnSearchChange:!1,shortDateFormat:"MMM d",singleDateField:!1,submitOnSearchTypeChange:!1,travelersQuestion:"flights.rp.search.travelers",
useCmp2Submit:!1,useLegacyDatePicker:!0,revertOnClickOut:!1,flexForAllSearch:!1,departDateFlexOnLoad:!1,returnDateFlexOnLoad:!1,pinnableImmediateSubmit:!1,regionDisplayAirportPicker:!1,showFlexDatesEnabled:!1,hasEditIcon:!0,airportMultiSelect:!1,showBaggageDropdown:!1,originAirportMultiSelections:[],destinationAirportMultiSelections:[],allAirportsLocalizedText:null},state:{travelers:0,cabin:"e"},init:function(){this.base();this.searchForm=this.getChildElement("searchform");this.displayView=this.getChildElement("display");
this.bindOriginDestination();this.bindDaterangePickers(this.options.flex_category,this.options.display);this.publishChangeOrigin();this.publishChangeDestination();this.displayCountsLabel=this.element.find("label.counts");this.isRegionSearchSupported=-1<d.config.getString("ui.flights.smarty.regionEnabled","32,51,58,72,77").split(",").indexOf(""+this.options.flareSmartyType);this.options.pinnable&&(this.edit=this.getChildElement("edit"))},inlineComponentsReady:function(){this.base();this.options.pinnable&&
this.bindDelayedDropdowns();this.options.phoenixRising||(this.startingForm=this.serialize())},renewAdvancedDatePicker:function(a){this.options.advancedFlexDatePickerEnabled&&this.datePicker&&(1===Object.keys(a).length&&f.extend(a,{depart_date_flex:this.options.depart_date_flex,return_date_flex:this.options.return_date_flex}),"openflex"===a.flex_category&&this.options.openflex_length_of_stay&&!a.openflex_length_of_stay&&(a.openflex_length_of_stay=this.options.openflex_length_of_stay),this.silenceDatePickerChange=
!0,this.datePicker.loadFlexData(a),this.silenceDatePickerChange=!1)},onVisible:function(a){var b=d.question.ask("SearchPage.view");"function"===typeof a&&(null===b||"RP"===b?a.call(this):this.subscribe("resultspage.routed",a.bind(this)))},addEventHandlers:function(){var a=this;this.base();this.subscribe(["searchform.submit","multilocale.search.submit"],function(b){var c="FD"===b.pageType;b=f.extend(!0,{},b,{pageType:a.getPageType()});if("anywhere"===b.flex_category)window.location=b.url;else if(a.previousSearchType=
"",a.options.revertOnClickOut&&"flights"===b.tab&&b.id!==a.id()&&(a.startingForm=b),a.loadFormView(b),a.options.airportMultiSelect&&c&&a.resetAirportMultiSelect(b),a.updateDisplayView(b),a.options.displayOverlay&&a.setView("Display"),a.options.pinnable)a.onPinnableClickOut()});this.subscribe("flights.inline.search.form.display.change",function(b){a.switchFormView(b.value);a.options.autoSubmit&&"multicity"!==b.value&&a.options.submitOnSearchTypeSwitch&&!a.validate()&&a.autoSubmit()});this.subscribe("flights.search.cabinType.change",
{namespace:this.id()},function(b){a.state.cabin=b.value});this.options.forceEditOpen&&this.setEditMode(!0);this.options.displayOverlay?(d.events.subscribe("flight.inline.search.form.show",function(b){a.setView("Form");b.focus&&a.originField.inputEl.focus()}),this.getChildElement("change").keypress(function(b){b.keyCode===d.globals.keyCodes.RETURN&&(a.setView("Form"),a.options.displayViewFormFocus&&a.focusFormAfterDisplayView(a.getChildElement("displayOrigin")))}),this.getChildElement("display").on("mousedown",
function(b){0===f(b.target).closest("#"+a.id()+" label.counts a.showAll").length&&(a.element.hasClass("MultiCity")?a.options.backToFDMultiCity||(a.switchFormView("multicity"),d.events.publish("flights.inline.search.form.display.set","multicity")):(a.setView("Form"),a.options.displayViewFormFocus&&a.focusFormAfterDisplayView(b.target),d.Analytics.api.trackEvent({category:a.loggingPrefix,action:"change-search"})))})):this.subscribe("flight.inline.search.form.show",function(b){a.options.singleDateField?
a.dateRangeInput.focus():a.departDate.focus()});this.bindTravelers();this.getChildElement("toggleFlex").click(function(b){a.element.toggleClass("FlexDate");var c=a.element.hasClass("FlexDate");a.flexDepart&&a.flexReturn&&(a.flexDepart.element.attr("aria-expanded",c),a.flexReturn.element.attr("aria-expanded",c&&"oneway"!==a.options.display),c&&a.flexDepart.element.focus());f(b.currentTarget).attr("aria-pressed",c);a.options.flex_category=c?"plusminusthree":"exact";d.Analytics.api.trackEvent({category:a.loggingPrefix,
action:"advanced-options",label:c?"show":"hide"})});this.bindLogging();this.answer("flights.rp.searchform.display",function(){return a.options.display});this.answer("flights.rp.searchform.topOffset",function(){return a.element.offset().top+a.element.outerHeight()});this.answer(this.formQuestion+".buildSearchURL",function(b){return a.buildSearchURL(b||a.serialize())});this.subscribe("resultspage.streaming.start",function(b){!a.isDisplayViewUpdated&&a.options.displayOverlay&&a.updateDisplayView(b);
a.displayCountsLabel.addClass("hidden")});this.subscribe("resultspage.streaming.done",function(){a.displayCountsLabel.removeClass("hidden")});this.getChildElement("change").click(function(){a.element.hasClass("MultiCity")&&a.handleMultiCityForm()});this.subscribe("flights.search.swapLocations",this.onOriginDepartureSwitch.bind(this));this.subscribe("flights.search.enableNearbyAirports",function(b){var c=!1;b&&a.options.isNearbyInSmarty?(a.isNearbySmartyOrigin||(a.originField.getSmarty().setIsNearbyChecked(!0),
a.onSmartyNearbyOrigin({enabled:!0}),c=!0),a.isNearbySmartyDestination||(a.destinationField.getSmarty().setIsNearbyChecked(!0),a.onSmartyNearbyDestination({enabled:!0}),c=!0)):!b||a.nearbyOrigin.is(":checked")&&a.nearbyDestination.is(":checked")||(a.startingForm=a.serialize(),c=!0,a.nearbyOrigin.prop("checked",!0),a.nearbyDestination.prop("checked",!0));c&&(a.isSubmitted=!1,a.onSubmit())});this.answer("flights.search.nearbyAirportsEnabled",function(){return a.nearbyDestination.is(":checked")&&a.nearbyOrigin.is(":checked")});
this.options.pinnable&&(this.onVisible(function(){f(document).off("click.pinnableBind").on("click.pinnableBind",function(b){b=f(b.target);if(1===b.closest("#"+a.id()).length)a.onPinnableClick(b);else 0===b.closest(".R9-Overlay, .r9-smarty, .js-overlay").length&&(a.pinnableCloseTimer=setTimeout(a.onPinnableClickOut.bind(a),100))});this.registerEvent("scroll",f(window),a.onPinnableScroll.bind(a));a.subscribe(["DateInput.startDate.onFocus","DateInput.endDate.onFocus"],a.onPinnableClick.bind(a))}),this.subscribe("pinnableBar.pinnedChange",
function(b){a.pinned=b}),this.subscribe(["InputModal.closed","DatePicker.dismiss","Select.closed","DropdownDialog.close"],function(){setTimeout(function(){clearTimeout(a.pinnableCloseTimer)},10)}),this.getChildElement("close",this.onPinnableClose.bind(this)),this.submitButton.click(this.onPinnableSubmitClick.bind(this)),this.searchForm.click(this.onSearchFormClick.bind(this)));if(this.options.phoenixRising){var b=f.Deferred(),c=2,e=function(){0===--c&&b.resolve()};this.subscribe("flights.search.cabinType.init."+
this.id(),e);this.subscribe("flights.search.travelers.init."+this.id(),e);b.promise().then(function(){a.state.cabin=a.getChildElement("cabinType").getWidget().getValue();a.startingForm=a.serialize()})}var g=this.getChildElement("progress-bar");this.subscribe("flights.search.inlineSearchForm.toggleProgressBar",function(a){g.toggleClass("hidden",!a)});this.answer(this.formQuestion,function(){return a.serialize()});d.events.ready("flights.searchForm.questionAnswers");this.bindSearchPendingState();this.bindFormChangedState();
this.options.showBaggageDropdown&&this.subscribe("flights.search.baggageCounts.changed",this.updateBaggageCounts.bind(this));this.options.useCmp2Submit&&(this.subscribe("cmp2.rendering.finished",function(b){a.element.toggleClass("cmp2-ready",!!(b&&b.items&&b.items.length))}),this.subscribe("cmp2.hidden",{visible:!1},function(){a.element.removeClass("cmp2-ready")}))},minimized:!1,editMode:!1,submitMode:!1,hovered:!1,pinned:!1,searchPending:!1,onPinnableSubmitClick:function(a){if(this.options.forceEditMode)return!1;
if(!this.options.pinnableImmediateSubmit&&!this.editMode)return this.setEditMode(!0),this.setMinimized(!1),!!this.options.useStyleJamInlineSearchButton},onPinnableScroll:function(){if(this.options.forceEditMode)return!1;this.pinned&&!this.hovered&&(this.setMinimized(!0),this.editMode&&this.setEditMode(!1))},onPinnableClose:function(){if(this.options.forceEditMode)return!1;this.setEditMode(!1)},onPinnableClick:function(a){if(this.options.forceEditMode)return!1;f(a).hasClass("js-multicity-submit")||
this.editMode||this.options.pinnableImmediateSubmit&&a&&this.submitButton.is(a)||(this.setMinimized(!1),this.setEditMode(!0))},onSearchFormClick:function(){},onPinnableClickOut:function(){if(this.options.forceEditMode)return!1;this.minimized||this.setMinimized(!0);this.editMode&&this.setEditMode(!1)},updateBaggageCounts:function(a){this.searchFormFilterState||(this.searchFormFilterState={});this.searchFormFilterState[a.type]=""+a.value},setMinimized:function(a){a?(this.minimized=!0,this.element.addClass("minimized")):
(this.minimized=!1,this.element.removeClass("minimized"))},setEditMode:function(a){if(a){var b=this;setTimeout(function(){b.editMode=!0},300);this.element.addClass("edit-mode");this.options.hasEditIcon&&this.submitButton.attr("aria-label",this.options.msg.accessibilityEditSearch)}else this.editMode=!1,this.element.removeClass("edit-mode"),this.options.hasEditIcon&&this.submitButton.attr("aria-label",this.options.msg.accessibilitySubmitSearch),this.options.revertOnClickOut&&null!==this.startingForm&&
this.loadFormView(this.startingForm),this.options.autoSubmit&&(this.originField.val()||null==this.previousOrigin||(this.originField.val(this.previousOrigin),this.originField.code(this.previousOriginCode),this.previousOriginCode=this.previousOrigin=null),this.destinationField.val()||null==this.previousDestination||(this.destinationField.val(this.previousDestination),this.destinationField.code(this.previousDestinationCode),this.previousDestinationCode=this.previousDestination=null));setTimeout(function(){d.Analytics.api.trackEvent({category:this.loggingPrefix,
action:"edit-mode",label:a?"on":"off"})}.bind(this),100)},setEditIcon:function(a){if(this.options.hasEditIcon)if(a){var b=this;setTimeout(function(){b.editMode=!0},300);this.element.addClass("edit-mode");this.submitButton.attr("aria-label",this.options.msg.accessibilityEditSearch)}else this.editMode=!1,this.element.removeClass("edit-mode"),this.submitButton.attr("aria-label",this.options.msg.accessibilitySubmitSearch)},onSubmit:function(a){var b=this.validate();if(b)this.showError(b);else{if(!this.startingForm||
this.checkFormChanges()){this.startingForm=b=this.serialize();if(this.options.regionSearchEnabled&&(b.freeRegionId||b.countrySearch)){window.location.href="/"+this._generate(b);return}this.searchPending=!0;this.options.flexForAllSearch&&(d.events.publish("filter.reset",{name:"flexdepart"}),d.events.publish("filter.reset",{name:"flexreturn"}));this.base(a)&&(this.updateDisplayView(b),this.setView("Display"));d.Analytics.api.trackEvent({category:this.loggingPrefix,action:"search",label:"origin:%s;dest:%s;depart:%s;return:%s;travelers:%s;triptype:%s;cabin:%s;departflex:%s;returnflex:%s".format(m(b.origin),
m(b.destination),b.depart_date_canon,b.return_date_canon,b.travelers,this.options.display,b.cabin,b.depart_date_flex,b.return_date_flex)});this.options.autoSubmit&&(this.isSubmitted=!1)}else d.events.publish("resultsHeader.changed",{tab:"flights"}),this.base(a)&&(this.updateDisplayView(),this.setView("Display"));if(this.options.pinnable)this.onPinnableClickOut(!0);this.setFormChangedState(!1);this.options.airportMultiSelect&&(a=this.originField.getAirportMultiSelections().length,b=this.destinationField.getAirportMultiSelections().length,
(a||b)&&d.Analytics.api.trackEvent({category:"airportMultiSelect",action:"submit",label:a,value:b}))}},serialize:function(){var a=this.base();a.provider="";var b=d.question.ask("flights.rp.search.travelers"),c={},e="oneway"===this.options.display;c.isMulticity="multicity"===this.options.display;c.oneway=e;c.flex_category=this.options.flex_category;if(this.options.advancedFlexDatePickerEnabled&&this.datePicker&&this.datePicker.getFlexCategory()){c.flex_category=this.datePicker.getFlexCategory();this.options.flex_category=
c.flex_category;var g=moment(this.departDate.getDate()),h=moment(this.returnDate.getDate()),l=this.datePicker.getFlexDatesData();switch(c.flex_category){case "exact-graph":case "exact":case "plusminusthree":g.isValid()&&(l.depart_date=g.format(d.globals.apiDateFormat),l.depart_date_canon=g.format("YYYY-MM-DD"));!e&&h.isValid()&&(l.return_date=h.format(d.globals.apiDateFormat),l.return_date_canon=h.format("YYYY-MM-DD"));break;case "weekend":g.isValid()&&(moment(g).startOf("month").isSameOrBefore(moment())?
l.weekend_depart_date="WEEKEND":l.weekend_depart_date=g.format("YYYY-MM-DD"));break;case "openflex":g.isValid()&&(l.openflex_depart_date=g.format("YYYY-MM-DD"))}f.extend(c,l)}else"exact"===this.options.flex_category||"plusminusthree"===this.options.flex_category?(this.options.useLegacyDatePicker?(g=moment(this.daterangePicker.getStartDate()),h=moment(this.daterangePicker.getEndDate())):(g=moment(this.departDate.getDate()),h=moment(this.returnDate.getDate())),g.isValid()&&(c.depart_date=g.format(d.globals.apiDateFormat),
c.depart_date_canon=g.format("YYYY-MM-DD")),!e&&h.isValid()&&(c.return_date=h.format(d.globals.apiDateFormat),c.return_date_canon=h.format("YYYY-MM-DD")),"plusminusthree"===this.options.flex_category&&(this.flexDepart&&(c.depart_date_flex=this.flexDepart.getValue()),!e&&this.flexReturn&&(c.return_date_flex=this.flexReturn.getValue()))):"weekend"===this.options.flex_category?(c.weekend_depart_date=this.flexWeekend.getValue(),c.weekend_depart=this.flexWeekendDepart.getValue(),c.weekend_return=this.flexWeekendReturn.getValue()):
"openflex"===this.options.flex_category&&(g=this.options.useLegacyDatePicker?moment(this.flexDaterangePicker.getStartDate()):moment(this.flexDepartDate.getDate()),c.openflex_depart_date=g.format("YYYY-MM-DD"),c.openflex_length_of_stay=this.flexMonthLengthOfStay.val());c.oneway=e;c.isMulticity||(c.legCount=c.oneway?1:2);c.origin=c.origincode=this.originField.code();c.origin_location=this.originField.val();!c.origin&&this.isMultipleAirport(c.origin_location)&&(c.origin=c.origin_location);!c.origin&&
c.origin_location.match(/^[A-z]{3}$/)&&(c.origin=c.origin_location);c.destination=c.destinationcode=this.destinationField.code();c.destination_location=this.destinationField.val();c.destination_code=this.destination_code;!c.destination&&this.isMultipleAirport(c.destination_location)&&(c.destination=c.destination_location);!c.destination&&c.destination_location.match(/^[A-z]{3}$/)&&(c.destination=c.destination_location);c.nearby_origin=this.options.isNearbyInSmarty?!!this.isNearbySmartyOrigin:this.nearbyOrigin.is(":checked");
c.nearby_destination=this.options.isNearbyInSmarty?!!this.isNearbySmartyDestination:this.nearbyDestination.is(":checked");null!==p.exec(c.destination)?c.freeRegionId=parseInt(c.destination.replace(/[A-z]+/,"")):c.countrySearch=this.isCountryOrCountryGroup(c.destination);f.extend(c,a,{cabin:this.state.cabin,preserveFilters:this.preserveFilters},b);return c},getStorageExceptions:function(){return this.preserveFilters?["preserveFilters"]:[]},switchFormView:function(a){this.previousSearchType=this.options.display;
this.options.display=a;this.datePicker&&this.datePicker.setDateMode("oneway"===a?"single":"range");if("multicity"===a)this.handleMultiCityForm();else{a=this.serialize();var b;if("multicity"===this.previousSearchType&&(b=d.question.ask("flights.rp.searchform.multicity"),!0===this.options.adjustRTCabinType)){var c=d.question.ask("flights.searchform.multicity.first.leg.cabin");c&&(a.cabin=c)}this.loadFormView(a,b)}this.loadCompareToItems()},isMultipleAirport:function(a){if("undefined"!==typeof a&&-1!=
a.indexOf(",")){a=a.split(",");var b=!0;f.each(a,function(a,e){3!==f.trim(e).length&&(b=!1)});return b}return!1},focusFormAfterDisplayView:function(a){if(a){a=f(a);var b=this,c;if(a.is(this.getChildElement("displayOrigin")))c=function(){b.originField.inputEl&&b.originField.inputEl.trigger&&b.originField.inputEl.focus().trigger("mousedown")};else if(a.is(this.getChildElement("displayDestination")))c=function(){b.destinationField.inputEl&&b.destinationField.inputEl.trigger&&b.destinationField.inputEl.focus().trigger("mousedown")};
else if(a.is(this.getChildElement("displayDepart"))||a.is(this.getChildElement("displayDepartDay")))c=function(){b.daterangePicker&&b.daterangePicker.startDisplay&&b.daterangePicker.startDisplay.trigger&&b.daterangePicker.startDisplay.trigger("mousedown")};else if(a.is(this.getChildElement("displayReturn"))||a.is(this.getChildElement("displayReturnDay")))c=function(){b.daterangePicker&&b.daterangePicker.endDisplay&&b.daterangePicker.endDisplay.trigger&&b.daterangePicker.endDisplay.trigger("mousedown")};
else if(a.is(this.getChildElement("displayCabin").parent().children())||a.is(this.getChildElement("displayTravelers"))||a.is(this.getChildElement("displayTravelerLabel"))||a.is(this.getChildElement("baggageCount"))||a.is(this.getChildElement("baggageCountLabel")))c=function(){d.events.publish("flights.inline.travelers.open")};c&&(this.focusSearchFormTID&&clearTimeout(this.focusSearchFormTID),this.focusSearchFormTID=setTimeout(c,200))}},setView:function(a){this.options.displayOverlay&&("Display"===
a?(this.element.removeClass("FormView"),this.disableSearchButton()):"Form"===a?(this.element.addClass("FormView"),this.enableSearchButton()):this.element.removeClass("FormView"),this.options.displayOverlay&&(this.getChildElement("searchform").attr("aria-hidden","Form"!==a),this.getChildElement("display").attr("aria-hidden","Display"!==a),this.getChildElement("change").attr("aria-pressed","Display"!==a)),d.Analytics.api.trackEvent("%s/searchform/view/%s".format(this.options.loggingPrefix,a)))},updateDisplayView:function(a){if(this.options.displayOverlay){this.isDisplayViewUpdated=
!0;a||(a=this.serialize());a.roundtrip?this.options.display="roundtrip":a.oneway?this.options.display="oneway":a.isMulticity&&(this.options.display="multicity");a.isMulticity||this.updateRoundTripOneWayDisplay(a);if(a.openflex_length_of_stay){var b=a.openflex_length_of_stay.split("-"),b=parseInt(b[b.length-1]);this.getChildElement("displayFlexLengthOfStayLabel").html(d.Common.Utils.String.formatChoice(this.options.msg.openflexNightsLabelChoice,b))}this.getChildElement("displayCabin").html(a.cabinDisplayType);
this.getChildElement("displayTravelers").html(a.travelers);this.getChildElement("displayTravelerLabel").html(d.Common.Utils.String.formatChoice(this.options.msg.displayTravelersLabel,a.travelers,a.travelers));this.getChildElement("baggageCount").html(a.baggageCount);this.getChildElement("baggageCountLabel").html(d.Common.Utils.String.formatChoice(this.options.msg.baggageCountLabel,a.baggageCount,a.baggageCount))}else this.enableSearchButton();this.options.backToFDMultiCity||this.updateMultiCityDisplay(a||
this.serialize())},getMultiCityLocationData:function(a){var b=[];if(!a||!a.nrLegs||1>a.nrLegs){if(this.options.multiCityDisplayDates&&this.options.multiCityDisplayLocations)for(var c=0;c<this.options.multiCityDisplayLocations.length;c++)this.options.multiCityDisplayLocations[c]&&(b.push({loc:this.options.multiCityDisplayLocations[c].first,date:this.options.multiCityDisplayDates[c]}),this.options.multiCityDisplayLocations[c].second&&b.push({loc:this.options.multiCityDisplayLocations[c].second,date:null}))}else for(c=
0;c<a.nrLegs;c++)b.push({loc:a["origin"+c],date:moment(a["depart_date_canon"+c]).format(this.options.shortDateFormat)}),a["destination"+c]===a["origin"+(c+1)]&&c!==a.nrLegs-1||b.push({loc:a["destination"+c],date:null});return b},putMultiCityLocations:function(a,b){for(var c=this.element.find(".multiCityLegTemplate"),e=0;e<a.length;e++){var g=c.clone().removeClass("multiCityLegTemplate");g.find(".airport").html(a[e].loc);var d=a[e].date?a[e].date:"\x26nbsp;";g.find(".date").html(d);b.append(g.children());
g.removeClass("hidden")}},updateRoundTripOneWayDisplay:function(a){var b=this.getLocationDisplay(a.origin,a.origin_location),c=this.getLocationDisplay(a.destination,a.destination_location);this.getChildElement("displayOrigin").html(b);this.getChildElement("displayDestination").html(c);var b=moment(a.depart_date_canon),c=moment(a.return_date_canon),e=moment(a.openflex_depart_date);this.getChildElement("displayFlexMonth").html(e.format(this.options.shortDateFormat)+" \x26ndash; "+e.add(1,"months").subtract(1,
"day").format(this.options.shortDateFormat));c&&this.getChildElement("displayReturn").html(c.format(this.options.shortDateFormat));this.options.dayOfWeekEnabled&&(this.getChildElement("displayDepartDay").html(moment(a.depart_date_canon).format("dddd")),a.return_date_canon&&this.getChildElement("displayReturnDay").html(moment(a.return_date_canon).format("dddd")));a.hasOwnProperty("depart_date_flex")&&this.flexDepart&&this.getChildElement("displayFlexDepart").html(this.options.flexDateDisplay[this.flexDepart.getValue()]);
a.hasOwnProperty("return_date_flex")&&this.flexReturn&&this.getChildElement("displayFlexReturn").html(this.options.flexDateDisplay[this.flexReturn.getValue()]);a.hasOwnProperty("weekend_depart_date")&&(this.getChildElement("displayFlexWeekend").html(this.flexWeekend.getText()),this.getChildElement("displayFlexWeekendDates").html("%s \x26ndash; %s".format(this.flexWeekendDepart.getText(),this.flexWeekendReturn.getText())));a.hasOwnProperty("openflex_length_of_stay")?this.getChildElement("displayFlexLengthOfStay").html(a.openflex_length_of_stay):
this.getChildElement("displayDepart").html(b.format(this.options.shortDateFormat))},getLocationDisplay:function(a,b){a="string"===typeof a?a.split("/")[0]:"";return/(?:[0-9]+[fr]{1,2})|(?::\d+-)/.exec(a)?b:a},loadCompareToItems:function(){this.options.useCmp2Submit&&this.base()},loadFormView:function(a,b){this.element.removeClass("RoundTrip OneWay FlexDate FlexWeekend FlexMonth MultiCity");a=f.extend(!0,{},a);a.isMulticity?(this.element.addClass("MultiCity"),this.options.display="multicity"):this.options.display=
a.oneway?"oneway":"roundtrip";d.events.publish("flights.inline.search.form.display.set",this.options.display);!this.options.flex_category&&a.flex_category&&(this.options.flex_category=a.flex_category);this.originField.val(a.origin_location);this.originField.code(a.origincode);a.destination_location&&a.destination_code&&(this.destination_code=a.destination_code);this.destinationField.val(a.destination_location);this.destinationField.code(a.destinationcode);if(this.options.useLegacyDatePicker)this.daterangePicker.setStartDate(a.depart_date),
a.oneway||this.daterangePicker.setEndDate(a.return_date),this.daterangePicker.setSingleDateMode(a.oneway);else{this.departDate.setDate(a.depart_date_canon);var c;a.return_date_canon?c=a.return_date_canon:b&&b.depart_date1&&(c=b.depart_date1);c&&this.returnDate.setDate(c);"weekend"!==a.flex_category&&"openflex"!==a.flex_category&&this.datePicker.setDateMode(a.oneway?"single":"range");this.options.singleDateField&&this.dateRangeInput.setDateMode(a.oneway?"single":"range")}a.namespace=this.id();d.events.publish("flights.search.travelers.set",
a);this.state.cabin=a.cabin;d.events.publish("flights.search.cabinType.set",{value:a.cabin,namespace:a.namespace});a.searchFormFilterState&&d.events.publish("searchform.loadForm.searchFormFilterState",{searchFormFilterState:a.searchFormFilterState});this.nearbyOrigin.prop("checked",a.nearby_origin);this.nearbyDestination.prop("checked",a.nearby_destination);this.options.isNearbyInSmarty&&(this.originField&&this.originField.getSmarty()&&this.originField.getSmarty().setIsNearbyChecked&&this.originField.getSmarty().setIsNearbyChecked(a.nearby_origin),
this.destinationField&&this.destinationField.getSmarty()&&this.destinationField.getSmarty().setIsNearbyChecked&&this.destinationField.getSmarty().setIsNearbyChecked(a.nearby_destination));b=this.options.useLegacyDatePicker?this.daterangePicker.endElement:this.returnDate.element;a.isMulticity||(a.oneway?(this.element.addClass("OneWay"),b.attr("aria-expanded",!1),"plusminusthree"===a.flex_category&&this.element.addClass("FlexDate")):(b.attr("aria-expanded",!0),"plusminusthree"===a.flex_category?this.element.addClass("RoundTrip FlexDate"):
"weekend"===a.flex_category?this.element.addClass("FlexWeekend"):"openflex"===a.flex_category?this.element.addClass("FlexMonth"):this.element.addClass("RoundTrip")));this.loadFlexData(a);this.publishChangeOrigin();this.publishChangeDestination()},loadFlexData:function(a){this.options.advancedFlexDatePickerEnabled&&this.datePicker?this.renewAdvancedDatePicker(a):a.isMulticity||(a.oneway?(this.setAriaValue(this.flexReturn,"expanded",!1),"plusminusthree"===a.flex_category&&(this.bindFlexDate(!0),this.flexDepart&&
(this.setAriaValue(this.flexDepart,"expanded",!0),this.flexDepart.setValue(a.depart_date_flex)))):"plusminusthree"===a.flex_category?(this.bindFlexDate(!1),this.flexDepart&&this.flexReturn&&(this.flexDepart.setValue(a.depart_date_flex),this.flexReturn.setValue(a.return_date_flex),this.setAriaValue(this.flexReturn,"expanded",!1),this.setAriaValue(this.flexDepart,"expanded",!1))):"weekend"===a.flex_category?(this.bindFlexWeekend(),this.flexWeekend&&this.flexWeekendDepart&&this.flexWeekendReturn&&(this.flexWeekend.setValue(a.weekend_depart_date),
this.flexWeekendDepart.setValue(a.weekend_depart),this.flexWeekendReturn.setValue(a.weekend_return),this.setAriaValue(this.flexWeekendDepart,"expanded",!0),this.setAriaValue(this.flexWeekendReturn,"expanded",!0))):"openflex"===a.flex_category?(this.bindFlexMonth(),this.flexMonthLengthOfStay&&this.flexMonthLengthOfStay.val(a.openflex_length_of_stay),this.options.useLegacyDatePicker?this.flexDaterangePicker.setStartDate(moment(a.openflex_depart_date).toDate()):this.flexDepartDate.setDate(moment(a.openflex_depart_date).toDate())):
this.element.addClass("RoundTrip"))},setAriaValue:function(a,b,c){a&&a.element&&a.element.length&&a.element.attr("aria-"+b,c)},handleMultiCityForm:function(){var a=this.serialize();d.events.publish("flights.search.multicity.activate");this.loadFormView(a)},getStorageProps:function(){return"multicity"===this.options.display?null:"depart_date return_date origincode destinationcode travelers cabin flex_category oneway nearby_origin nearby_destination".split(" ")},getPageType:function(){return"RP"},bindTravelers:function(){var a=
this;this.subscribe("flights.search.travelers.lapInfant",function(b){0<b.count?a.element.addClass("showWarning"):a.element.removeClass("showWarning")});this.subscribe("flights.search.travelers.change",function(){a.isEnoughInformationForCompareToRequest()&&a.loadCompareToItems();a.options.autoSubmit&&a.autoSubmit()})},autoSubmit:function(){if("multicity"!==this.options.display&&this.checkFormChanges())this.onSubmit()},bindFlexDate:function(a){var b=this;this.flexDepart||(this.flexDepart=this.getChildElement("flexDepart").dropdown({change:function(){d.Analytics.api.trackEvent({category:b.loggingPrefix,
action:"select-flexrange-depart",label:this.getValue()});b.options.autoSubmit&&b.autoSubmit()}}).getWidget());this.flexReturn||a||(this.flexReturn=this.getChildElement("flexReturn").dropdown({change:function(){d.Analytics.api.trackEvent({category:b.loggingPrefix,action:"select-flexrange-return",label:this.getValue()});b.options.autoSubmit&&b.autoSubmit()}}).getWidget())},bindFlexWeekend:function(){this.flexWeekend||(this.flexWeekend=this.getChildElement("flexWeekend").dropdown().getWidget());this.flexWeekendDepart||
(this.flexWeekendDepart=this.getChildElement("flexWeekendDepart").dropdown().getWidget());this.flexWeekendReturn||(this.flexWeekendReturn=this.getChildElement("flexWeekendReturn").dropdown().getWidget())},bindFlexMonth:function(){var a=this;this.flexMonthLengthOfStay||(this.flexMonthLengthOfStay=this.getChildElement("flexMonthLengthOfStay"));this.options.useLegacyDatePicker?this.flexDaterangePicker||(this.flexDaterangePicker=this.bindDaterangePicker(this.getChildElement("flexDepartDate"),function(b,
c){a.options.autoSubmit&&a.autoSubmit()},{singleDateMode:!0})):(this.flexDepartDate=this.getChildElement("flexDepartDate").getWidget(),this.flexDatePicker||(this.flexDatePicker=this.bindDaterangePicker(this.getChildElement("flexDatePicker"),function(b,c){a.options.autoSubmit&&a.autoSubmit()})))},bindOriginDestination:function(){var a=this;this.originField=new d.flights.search.FlightAirportField(this.getChildElement("origin"),{airportMultiSelectEnabled:this.options.airportMultiSelect,initialAirportMultiSelections:this.options.originAirportMultiSelections,
onChangeAirportMultiSelection:this.onAirportMultiSelectChange.bind(this),onDisableNearbyToggle:function(){a.isNearbySmartyOrigin=!1}});this.nearbyOrigin=this.getChildElement("nearbyOrigin");this.destinationField=new d.flights.search.FlightAirportField(this.getChildElement("destination"),{airportMultiSelectEnabled:this.options.airportMultiSelect,initialAirportMultiSelections:this.options.destinationAirportMultiSelections,onChangeAirportMultiSelection:this.onAirportMultiSelectChange.bind(this),onDisableNearbyToggle:function(){a.isNearbySmartyDestination=
!1}});this.nearbyDestination=this.getChildElement("nearbyDestination");this.nearbyOrigin.prop("checked",this.options.nearbyOrigin);this.nearbyDestination.prop("checked",this.options.nearbyDestination);this.options.isNearbyInSmarty&&(this.isNearbySmartyOrigin=this.options.nearbyOrigin,this.isNearbySmartyDestination=this.options.nearbyDestination);this.options.autoSubmit&&(this.previousOrigin=this.originField.val(),this.previousOriginCode=this.originField.code(),this.previousDestination=this.destinationField.val(),
this.previousDestinationCode=this.destinationField.code());var b=f.proxy(function(a,b,d,h){this.onChangeOrigin(a,b,d,h);this.publishChangeOrigin({location:a,code:b,codeType:d,locationDescription:h})},this);this.bindFlightSmartyFields(this.originField,!0,b,this.isNearbySmartyOrigin,this.onSmartyNearbyOrigin.bind(this));b=f.proxy(function(a,b,d,h){this.onChangeDestination(a,b,d,h);this.publishChangeDestination({location:a,code:b,codeType:d,locationDescription:h})},this);this.bindFlightSmartyFields(this.destinationField,
!1,b,this.isNearbySmartyDestination,this.onSmartyNearbyDestination.bind(this))},bindFormChangedState:function(){var a=this,b=function(){window.setTimeout(a.setFormChangedState.bind(a,!0),10)};this.subscribe("smarty.setitem.complete",{id:this.id("origin-airport")},b);this.subscribe("smarty.setitem.complete",{id:this.id("destination-airport")},b);this.subscribe("flights.search.swapLocations",b);this.subscribe("DatePicker.update",{action:"change",group:this.id("travelDates")},b);this.subscribe("flights.search.baggageCounts.changed",
{userChange:!0,namespace:this.id()},b);this.subscribe("DatePicker.update",{action:"flex",group:this.id("travelDates")},function(c){a.searchPending||b();a.element.removeClass("FlexDate FlexWeekend FlexMonth");"openflex"===c.flex?a.element.addClass("FlexMonth"):"weekend"===c.flex?a.element.addClass("FlexWeekend"):"plusminusthree"===c.flex&&c.data&&c.data.depart_date_flex&&c.data.return_date_flex&&("exact"!==c.data.depart_date_flex||"exact"!==c.data.return_date_flex)&&a.element.addClass("FlexDate")});
this.subscribe(["flights.inline.search.form.display.change","flights.search.travelers.change","flights.search.cabinType.change"],b)},bindSearchPendingState:function(){var a=this,b=function(){a.searchPending=!0};b.priority=2;this.subscribe("searchform.submit",b);this.subscribe("search.startSearch",function(){a.searchPending=!1})},onSmartyNearbyOrigin:function(a){this.isNearbySmartyOrigin=a&&a.enabled},onSmartyNearbyDestination:function(a){this.isNearbySmartyDestination=a&&a.enabled},onChangeOrigin:function(a,
b,c,e){void 0===a||""===a&&""===b?this.originField.code(""):(this.allowAirportMultiSelect(c)?this.originField.addAirportMultiSelection(b,a,e,"selection"):(this.originLocationVal(a),this.originCodeVal(b)),this.setFormChangedState(!0),this.options.autoSubmit&&(this.previousOrigin=a,this.previousOriginCode=b),this.isEnoughInformationForCompareToRequest()&&this.loadCompareToItems(),this.options.autoSubmit&&(this.autoSubmit(),this.originField.inputEl.blur()));d.Analytics.api.trackEvent({category:this.loggingPrefix,
action:"select-origin",value:m(this.originField.code())})},originLocationVal:function(){1===arguments.length&&this.originField.val()!==arguments[0]&&this.originField.val(arguments[0]);return this.originField.val()},destinationCodeVal:function(){1===arguments.length&&this.destinationField.code(arguments[0]);return this.destinationField.code()},originCodeVal:function(){1===arguments.length&&this.originField.code(arguments[0]);return this.originField.code()},destinationLocationVal:function(){1===arguments.length&&
this.destinationField.val()!==arguments[0]&&this.destinationField.val(arguments[0]);return this.destinationField.val()},publishChangeOrigin:function(a){if("multicity"!==this.options.display){a=a||{};var b=f.extend({},{id:null}),c=this;b.originLocation=q(a.location,function(){return c.originLocationVal()});b.originCode=q(a.code,function(){return c.originCodeVal()});d.events.publish("flights.inline.search.rtow.form.origin",b)}},onChangeDestination:function(a,b,c,e){void 0===a||""===a&&""===b?this.destinationField.code(""):
(this.allowAirportMultiSelect(c)?this.destinationField.addAirportMultiSelection(b,a,e,"selection"):(this.destinationLocationVal(a),this.destinationCodeVal(b)),this.setFormChangedState(!0),this.options.autoSubmit&&(this.previousDestination=a,this.previousDestinationCode=b),this.isEnoughInformationForCompareToRequest()&&this.loadCompareToItems(),this.options.autoSubmit&&(this.autoSubmit(),this.destinationField.inputEl.blur()));d.Analytics.api.trackEvent({category:this.loggingPrefix,action:"select-destination",
value:m(this.destinationField.code())})},publishChangeDestination:function(a){if("multicity"!==this.options.display){a=a||{};var b=f.extend({},{id:null}),c=this;b.destinationLocation=q(a.location,function(){return c.destinationLocationVal()});b.destinationCode=q(a.code,function(){return c.destinationCodeVal()});d.events.publish("flights.inline.search.rtow.form.destination",b)}},allowAirportMultiSelect:function(a){var b=this.options.airportMultiSelect;a=a&&0===a.indexOf("ap");return b&&a},resetAirportMultiSelect:function(a){this.originField.resetAirportMultiSelect();
this.destinationField.resetAirportMultiSelect();a.originMultiAirports&&a.originMultiAirports.length&&this.originField.addAirportMultiSelections(a.originMultiAirports);a.destinationMultiAirports&&a.destinationMultiAirports.length&&this.destinationField.addAirportMultiSelections(a.destinationMultiAirports)},onAirportMultiSelectChange:function(a,b){b&&this.setFormChangedState(!0)},onOriginDepartureSwitch:function(){var a=this.destinationField.val(),b=this.destinationField.code();if(d.config.getBoolean("ui.horizon.flights.smarty.od.switch.validate.enabled",
!0)){var c=this.destinationField.code();/^\d+[r|fr|cy]+$|^any$|^[A-Z]{2}cg$/.test(c)&&(b=a="")}var c=this.originField.val(),e=this.originField.code();if(this.options.airportMultiSelect){var g=this.originField.getAirportMultiSelections(),h=this.destinationField.getAirportMultiSelections();this.originField.resetAirportMultiSelect();this.destinationField.resetAirportMultiSelect();g.length?this.destinationField.addAirportMultiSelections(g):(this.destinationField.val(c),this.destinationField.code(e));
h.length?this.originField.addAirportMultiSelections(h):(this.originField.val(a),this.originField.code(b))}else this.originField.val(a),this.destinationField.val(c),this.originField.code(b),this.destinationField.code(e);this.publishChangeOrigin();this.publishChangeDestination();a=this.getChildElement("nearbyOrigin");b=this.getChildElement("nearbyDestination");a.is(":checked")!==b.is(":checked")&&(a.click(),b.click());this.loadCompareToItems();this.options.autoSubmit&&this.autoSubmit()},bindDaterangePickers:function(a,
b){var c=this;this.options.advancedFlexDatePickerEnabled||("oneway"===b?this.bindFlexDate(!0):"roundtrip"===b&&(this.bindFlexDate(!1),"weekend"===a?this.bindFlexWeekend():"openflex"===a&&this.bindFlexMonth()));this.options.useLegacyDatePicker?this.daterangePicker||(this.daterangePicker=this.bindDaterangePicker(this.getChildElement("travelDates"),function(a,b){c.options.autoSubmit&&c.autoSubmit();c.silenceDatePickerChange||d.Analytics.api.trackEvent({category:c.loggingPrefix,action:"select-date",label:"depart:"+
moment(a).format("MMM Do YY")+",return:"+moment(b).format("MMM Do YY")});c.isEnoughInformationForCompareToRequest()&&c.loadCompareToItems()})):(this.departDate=this.getChildElement("departDate").getWidget(),this.returnDate=this.getChildElement("returnDate").getWidget(),this.options.singleDateField&&(this.dateRangeInput=this.getChildElement("dateRangeInput").getWidget()),this.datePicker||(this.datePicker=this.bindDaterangePicker(this.getChildElement("datePicker"),function(a,b,h){c.silenceDatePickerChange||
d.Analytics.api.trackEvent({category:c.loggingPrefix,action:"select-date",label:"depart:"+moment(a).format("MMM Do YY")+",return:"+moment(b).format("MMM Do YY")});c.options.autoSubmit&&(a&&b&&"endDate"===h||"oneway"===c.options.display&&a)&&c.autoSubmit();c.isEnoughInformationForCompareToRequest()&&c.loadCompareToItems();h=c.returnDate.getDate();"undefined"!==typeof a&&c.departDate.setDate(a);"undefined"!==typeof b?null!==b&&moment(a).isSameOrBefore(moment(b))?c.returnDate.setDate(b):c.returnDate.setDate(null):
null!==h&&h.isSameOrBefore(moment(a))&&c.returnDate.setDate(null)}),this.renewAdvancedDatePicker({flex_category:this.options.flex_category,depart_date_flex:this.options.depart_date_flex,return_date_flex:this.options.return_date_flex})))},bindDaterangePicker:function(a,b,c){var e=this,g=function(a){var b=e.serialize();return{vertical:"flights",origin:b.origincode,destination:b.destinationcode,isOneWay:b.oneway,departDate:a?void 0:b.depart_date_canon}},h=function(a){a&&a.returnEvent&&d.dom.schedule(function(){e.submitButton&&
e.submitButton.focus()})};if(this.options.useLegacyDatePicker)return c=c||{useDaysFormat:!0,minRangeDays:0,getFormData:g,change:function(){b(this.getStartDate(),this.getEndDate())}},a.daterangePicker(c).getWidget();a=a.getWidget();c=c||{minRangeDays:0,getFormData:g,change:b,dismiss:h};f.extend(a.options,c);return a},bindFlightSmartyFields:function(a,b,c,e,g){var h=this,f=function(a){return function(b){setTimeout(function(){a.val()&&0!==a.val().length||c(b.initialVal,b.initialCode)},1)}},n=a.inputEl,
k={flareSmartyType:h.options.flareSmartyType,dataSource:h.options.smartyUrl,smartyControlGroup:null,setItem:function(){return function(a,d){if(d){var e=h.options.regionDisplayAirportPicker?!1:!b&&h.isRegionSearchSupported;setTimeout(function(){var a,g,f;if("ap"===d.type||"apnc"===d.type||"rail"===d.type)a=d.short_str||d.str,g=d.str,f=d.id;else if("isl"===d.type)a=d.str,f="";else if(e&&"reg"===d.type)a=d.short_str||d.str,f=d.rid+"r";else if(e&&"freereg"===d.type)a=d.short_str||d.str,f=d.frid+"fr";
else if(e&&h.options.regionSearchEnabled&&"ctry"===d.type)a=d.short_str||d.str,f=d.cid+"cy";else if(e&&h.options.regionSearchEnabled&&"ctgroup"===d.type)a=d.short_str||d.str,f=d.cgid+"cg";else{f=a="";var l=d.id;if(h.isRegionSearchSupported)switch(d.type){case "freereg":l="F:%s".format(d.frid);break;case "reg":l="R:%s".format(d.rid);break;case "ctry":l="Y:%s".format(d.cid)}h.openAirportPicker("","",l,!b,function(a){c(a.location,a.code)})}c(a,f,d.type,g)},1)}}}(n),clearItem:function(){return function(){setTimeout(function(){c(void 0,
"")},1)}}(n),messages:h.options.msg,useNearby:h.options.isNearbyInSmarty,showBackgroundAutocomplete:d.config.getBoolean("ui.common.smarty.background.autocomplete.enabled",!1),allAirportsLocalizedText:this.options.allAirportsLocalizedText};if(a=a.inputEl.data("inputModal"))k.appendTo=a.getSmartyWrapper(),k.fixedDropdown=!0;h.options.backIfEmpty&&(k.afterDone=f(n));if(32===this.options.flareSmartyType||51===this.options.flareSmartyType||58===this.options.flareSmartyType)k.dropdownClass="smartbox smartbox-air smartbox-v2 smartbox-air-regions";
d.config.getBoolean("ui.smarty.greyIcons",!1)&&(k.dropdownClass="smartbox smartbox-air smartbox-v2 smartbox-air-regions "+d.config.getString("ui.smarty.iconClasses","greyIcons"));h.options.isNearbyInSmarty&&(g&&(k.nearbyCallback=g),k.nearbyChecked=e);this.options.nearbySmartyTemplateSuffix&&(k.templatePresentationSuffix=this.options.nearbySmartyTemplateSuffix);h.options.smartyUIUpdateEnabled&&(k.extendRequest={f:"j"},k.dropdownClass+=" ui-update-v1",k.smartyUIUpdateEnabled=!0);n.flightSmarty(k)},
bindLogging:function(){var a=this;this.originField.inputEl.change(function(){d.Analytics.api.trackEvent({category:a.loggingPrefix,action:"select-origin"})});this.nearbyOrigin.change(function(){var b=f(this).is(":checked")?"on-"+a.originField.val():"off-"+a.originField.val();d.Analytics.api.trackEvent({category:a.loggingPrefix,action:"add-nearby",label:b})});this.destinationField.inputEl.change(function(){d.Analytics.api.trackEvent({category:a.loggingPrefix,action:"select-destination"})});this.nearbyDestination.change(function(b){b=
f(this).is(":checked")?"on-"+a.destinationField.val():"off-"+a.destinationField.val();d.Analytics.api.trackEvent({category:a.loggingPrefix,action:"add-nearby",label:b})})},checkFormChanges:function(){var a=this.serialize(),b=!1,c=this.startingForm;if(!c)return!1;(b="adults cabin child countrySearch depart_date_canon depart_date_flex destination_location flex_category freeRegionId isMulticity lapInfant nearby_destination nearby_origin oneway openflex_depart_date openflex_length_of_stay origin_location return_date_canon return_date_flex searchFormFilterState seatInfant seniors travelers weekend_depart_date weekend_depart weekend_return youth".split(" ").some(function(b){var e=
c[b];b=a[b];return e&&b&&"object"===typeof e&&"object"===typeof b?!d.Common.Utils.deepEquals(e,b):e!==b&&!(void 0===e&&null===b)&&!(null===e&&void 0===b)}))&&this.options.preserveFiltersOnSearchChange&&(this.preserveFilters=c.origin===a.origin&&c.destination===a.destination);return b},setFormChangedState:function(a){d.config.getBoolean("ui.fisf.preventSameFormChangedState",!0)&&this.startingForm&&!this.checkFormChanges()?this.base(!1):this.base(a)},setStyleJamButtonActivation:function(a,b){this.base(a,
b);this.element.toggleClass(this.options.formChangedClass,a)},buildSearchURL:function(a){var b={},c={originId:a.origin,destinationId:a.destination,originLocation:a.origin_location,destinationLocation:a.destination_location,includeNearbyOrigin:a.nearby_origin,includeNearbyDestination:a.nearby_destination,cabinClass:a.cabin,baggageCount:a.baggageCount,departDate:a.depart_date_canon,returnDate:a.return_date_canon,plusMinusThreeDepart:a.depart_date_flex,plusMinusThreeReturn:a.return_date_flex,adults:a.adults,
seniors:a.seniors,youth:a.youth,child:a.child,seatInfants:a.seatInfant,lapInfants:a.lapInfant,weekendDepartDate:a.weekend_depart_date,weekendDepart:a.weekend_depart,weekendReturn:a.weekend_return,openflexDepartDate:a.openflex_depart_date,openflexLengthOfStay:a.openflex_length_of_stay};a.students&&(c.students=a.students);c.regionSearch=this.options.regionSearchEnabled&&a.destination&&(p.exec(a.destination)||this.isCountryOrCountryGroup(a.destination));this.searchFormFilterState=f.isEmptyObject(b)?
null:b;return d.flights.search.FlightSearchFormUrls.generateRtowFlightsUrl(c,this.options.flex_category,"oneway"===this.options.display,b)},isCountryOrCountryGroup:function(a){return a&&(-1!==a.indexOf("cy")||-1!==a.indexOf("cg"))},openAirportPicker:function(a,b,c,e,g){e=this.id(e?"airportPickerDestination":"airportPickerOrigin");d.events.publish("flights.airportpicker.open",{id:e,location:a,code:b,hint:c,callback:g})},getDateValidationMessages:function(a){var b=[],c=moment(a.depart_date,d.globals.apiDateFormat),
e=moment(a.return_date,d.globals.apiDateFormat);a.depart_date||b.push(this.getErrorLine("missingLeaveDateChoice"));a.oneway||a.return_date||b.push(this.getErrorLine("missingReturnDate"));0===b.length&&0>e.diff(c,"days")&&b.push(this.getErrorLine("departDateAfterReturnDate"));return b},validate:function(){var a=this.serialize(),b=[];a.origin||b.push(this.getErrorLine("missingFromAirportChoice"));a.destination||b.push(this.getErrorLine("missingToAirportChoice"));a.origin===a.destination&&a.origin&&
a.destination&&b.push(this.getErrorLine("uniqueAirportsChoice"));d.config.getBoolean("ui.horizon.flights.rpsearchform.validateDates",!0)&&"exact"===a.flex_category&&(b=b.concat(this.getDateValidationMessages(a)));"openflex"===this.options.flex_category&&(a.openflex_length_of_stay||b.push(this.getErrorLine("missingFlexLengthOfStay")));0<a.lapInfant||0<a.seatInfant||0<a.child||0<a.youth?0===a.adults&&0===a.seniors&&b.push(this.getErrorLine("noUnaccompaniedMinors")):0===a.adults&&0===a.seniors&&(this.options.showStudents?
0===a.students&&b.push(this.getErrorLine("noPassengersSelected")):b.push(this.getErrorLine("noPassengersSelected")));return b.length?"\x3cul class\x3d'errorList'\x3e%s\x3c/ul\x3e".format(b.join("")):null},getErrorLine:function(a,b){"undefined"===typeof b&&(b=0);return"\x3cli\x3e%s\x3c/li\x3e".format(d.Common.Utils.String.formatChoice(this.options.errMsg[a],b))},getCMP2AirportLocation:function(a,b){if(a){a=a.substr(0,3);if(""===a||0===a.indexOf("C-"))a=b.replace(/ /g,""),-1!==a.indexOf("(")?(b=a.match(/\(([A-Z]{3})\)/g),
null!=b&&(a=b[0])):a=a.substr(0,3);return a}return""},getCompareToFormData:function(){if(this.options.useCmp2Submit){var a=this.serialize(),b={vertical:this.vertical};a.origin=this.getCMP2AirportLocation(a.origin,a.origin_location);a.origincode=this.getCMP2AirportLocation(a.origincode,a.origin_location);a.destination=this.getCMP2AirportLocation(a.destination,a.destination_location);a.destinationcode=this.getCMP2AirportLocation(a.destinationcode,a.destination_location);return f.extend(b,a)}},isEnoughInformationForCompareToRequest:function(){if(this.options.useCmp2Submit){if(this.options.loadCmp2WhenVisible&&
!this.element.is(":visible")||-1===f.inArray(this.options.flex_category,["plusminusthree","exact"]))return!1;var a=!0;this.options.cmp2LimitDisplay&&(a="oneway"===this.options.display||"roundtrip"===this.options.display);if(this.options.regionSearchEnabled&&a){var b=this.serialize();if(b.destination&&(p.exec(b.destination)||this.isCountryOrCountryGroup(b.destination)))return!1}return a&&!this.options.suppressCmp2s&&!this.validate()}},load:function(a){"exact"!==a.flex_category&&this.datePicker&&this.options.showFlexDatesEnabled&&
this.datePicker.publishFlexUpdate()},autofocus:function(){},bindDelayedDropdowns:function(){var a=this,b=d.config.getInt("ui.flights.search.pinned.dialogDelay",550),c=function(){return!a.editMode};if(0!==b){this.datePicker&&(this.datePicker.setOption("delayShowDropdown",c),this.datePicker.setOption("showDropdownDelay",b));var e=this.getChildElement("travelers").data("component");e&&e.travelerSelect&&f.extend(e.travelerSelect.options,{delayShowDropdown:c,showDropdownDelay:b});var e=this.originField?
this.originField.getSmarty():null,g=this.destinationField?this.destinationField.getSmarty():null;e&&(e.options.delayShowDropdown=c,e.options.showDropdownDelay=b);g&&(g.options.delayShowDropdown=c,g.options.showDropdownDelay=b);this.options.phoenixRising&&(f.extend(this.originField.inputEl.data("inputModal").options,{delayOpenSmarty:c,openSmartyDelay:b}),f.extend(this.destinationField.inputEl.data("inputModal").options,{delayOpenSmarty:c,openSmartyDelay:b}));this.element.find(a.options.nearbyAirportsBtnSelector).each(function(){var a=
f(this).getWidget();a&&a.options&&(a.options.delayShowDropdown=c,a.options.showDropdownDelay=b)})}},updateMultiCityDisplay:function(a){var b=this.getChildElement("multiCityDates"),c=this.getChildElement("multiCityDisplay"),e=[],g=[],h=d.question.ask("flights.search.multicity.travelers"),f,n=", ";if(a.isMulticity)for(f=0;f<a.nrLegs;f++){var k=this.getLocationDisplay(a["origin"+f],a["origin_location"+f]),m=this.getLocationDisplay(a["destination"+f],a["destination_location"+f]);if(k&&0<k.indexOf(",")||
m&&0<m.indexOf(","))n="; ";g.push(k+"-"+m);e.push(moment(a["depart_date_canon"+f]).format(this.options.displayDateFormat))}else g.push(this.getLocationDisplay(a.origincode)+"-"+this.getLocationDisplay(a.destinationcode)),e.push(moment(a.depart_date_canon).format(this.options.displayDateFormat));c.html(g.join(n));b.html(e.join(", "));h&&!this.options.phoenixRising&&this.getChildElement("multiCityTravelers").html(h.displaySummary)}})})(R9,jQuery);(function(g,h,m){function A(a,d){"boolean"===typeof d&&a&&a[0]&&a[0].checked!==d&&a.click()}function w(a,d,b){if(a.length){var c=a.parent().is(".StyleJamCheckbox")?"styleJamCheckbox":"checkbox";a[c]({change:function(){d.call(b,this.checked)}})}}function n(a){return null===a||"undefined"===typeof a||"string"===typeof a&&""===a.trim()}function q(a,d){return null===a||"undefined"===typeof a?"function"===typeof d?d():d:a}function u(a){return"adults"===a||"seniors"===a}function x(a){return a&&(-1!==a.indexOf("cy")||
-1!==a.indexOf("cg"))}function t(a){return null!=a?y.exec(a)||x(a)?a:a.split("/")[0]:""}function v(a){a=(a||"").split(",");for(var d=[],b=/^[A-Z0-9]{3}$/i,c=0;c<a.length;c++){var f=a[c].trim().toUpperCase();if(b.test(f))d.push(f);else return""}return d.join(",")}var y=/[0-9]+[fr]{1,2}/;g.createComponentClass("flights.search.FlightSearchFormDeprecated","base.search.SearchForm",{vertical:"flights",loggingPrefix:"Search-Form",formQuestion:"flights.fd.searchform",formObjectQuestion:"flights.fd.searchform.object",
display:null,inline:!1,inlineViewOnly:!1,controllers:{},activeFormController:null,disableDestinationFocusAfterAjax:!1,travelerTypes:null,options:{cmp2LimitDisplay:!1,slideCMP2:!1,slideCMP2Everywhere:!1,slideCMP2PreventInit:!1,slideCMP2PreventRedirect:!1,activeHome:!1,flareSmartyType:1,smartyUrl:"/mv/marvel",autoOpenNextField:!1,showSmartyHistory:!1,isNearbyInSmarty:!1,airlineFilter:void 0,showAnywhere:!1,anywhereIfEmpty:!1,anywhereSelfTarget:!1,backIfEmpty:!1,toggleLinks:!0,toggleSwap:!1,toggleField:!1,
useMultiCityInFD:!1,useLegacyDatePicker:!0,showAnywherePopupEnabled:!1,flippableSmarty:!0,isFdForm:!1,regionSearch:!1,regionSearchEnabled:!1,autoNearbyEnabled:!1,mixedCabinsUI:!1,ajaxOrigin:!1,regionDisplayAirportPicker:!1,dialog:!1,autoRTFromMC:!1,showDirectOption:!1,hostUrl:"",adjustRTCabinType:!1,closeOnScroll:!0,mainSearchForm:!1,useFlexRadioButtons:!1},isRegionSearchSupported:!1,state:{travelers:0,cabin:"e",adults:0,seniors:0,child:0,youth:0,seatInfant:0,lapInfant:0,students:0,bags:0},eventDataTemplate:{id:null},
events:{rtWholeMonthSelect:"flights.search.rt.form.wholeMonthSelect",rtowOrigin:"flights.search.rtow.form.origin",rtowDestination:"flights.search.rtow.form.destination",rtowDateRange:"flights.search.rtow.form.dateRange",rtowNearbyOrigin:"flights.search.rtow.form.nearbyOrigin",rtowNearbyDestination:"flights.search.rtow.form.nearbyDestination",rtowLengthOfStay:"flights.search.rtow.form.lengthOfStay",multiOrigin:"flights.search.multi.form.origin",multiDestination:"flights.search.multi.form.destination",
multiDepartDate:"flights.search.multi.form.departDate",multiDepartTime:"flights.search.multi.form.departTime",multiNearbyOrigin:"flights.search.multi.form.nearbyOrigin",multiNearbyDestination:"flights.search.multi.form.nearbyDestination",multiLegCabinType:"flights.search.multi.form.legCabinType",multiAddLeg:"flights.search.multi.form.addLeg",multiRemoveLeg:"flights.search.multi.form.removeLeg",cabinType:"flights.search.rtow.form.cabinType",travelerCount:"flights.search.rtow.form.travelerCount",baggageCount:"flights.search.rtow.form.baggageCount",
displayCat:"flights.search.rtow.form.displayCat",searchError:"search.submit.error"},travelerDialogClass:"Flights-Frontdoor-TravelersDialog-Content",stateInitialized:!1,init:function(a){this.base.apply(this,arguments);this.options.adjustRTCabinType=this.options.mixedCabinsUI&&this.options.adjustRTCabinType;this.options.slideCMP2&&(this.originCountry=this.options.originCountryCode,this.displaySlide=this.options.displaySlide);this.options.showAnywhere=this.options.showAnywhere&&!h(".Sem-Common-Layout-SEMStandardBody").length;
this.errorContainer.length||(this.errorContainer=h("."+this.id("error"),this.element));this.travelerTypes=[];this.state=h.extend({},this.state);this.eventDataTemplate=h.extend({},this.eventDataTemplate);this.eventDataTemplate.id=this.id();this.display=this.options.display;this.bindTravelerSelectDialog();this.bindShowAirportMapLinks();this.bindDisplayCat();this.bindTravelersDropdownCloseLink();this.bindTravelersDropdownCloseEvent();this.wholeMonthSearch=!1;jq("body").hasClass("FlightsSearch")&&0<jq(".flexOpenflex").length&&
0<jq(".Flights-Search-FlightSearchPage.vm-fd").length&&(this.wholeMonthSearch=g.config.getBoolean("ui.flights.whole-month-search.enabled",!1));this.controllers=this.createSubControllers();this.bindOpenNextFieldEvents();this.initActiveFormController();this.setupChildControllers();if(this.wholeMonthSearch){var d=this.controllers.rtow,b=d.flexCategoryRadio.getWidget();!0===g.storage.get("flexPlusMinusChecked")&&(b.setButtonCheckedByValue("plusminusthree"),d.searchFormWrapper.hasClass("advanced plusMinus")||
d.searchFormWrapper.addClass("advanced plusMinus"));"wholeMonthSearch"===(null!==g.storage.get("daterangePickerDefaultNavTab")?g.storage.get("daterangePickerDefaultNavTab"):"specificDate")&&(b.setButtonCheckedByValue("openflex"),d.searchFormWrapper.hasClass("advanced")||d.searchFormWrapper.addClass("advanced"),d.searchFormWrapper.hasClass("plusMinus")&&d.searchFormWrapper.removeClass("plusMinus"))}this.isRegionSearchSupported=-1<g.config.getString("ui.flights.smarty.regionEnabled","32,51,58,72,77").split(",").indexOf(""+
this.options.flareSmartyType);this.studentCheckbox=this.getChildElement("student")},inlineComponentsReady:function(){this.base.apply(this,arguments);this.initState();this.loadCompareToItems();this.options.ajaxOrigin&&this.checkOriginForUpdate();g&&g.globals&&g.globals.isSeo&&this.checkForValidDates();this.shouldSlideCmp2Init()&&this.loadSlideCMP2()},addEventHandlers:function(){this.base.apply(this,arguments);this.subscribe(["flights.frontdoor.form.all","cmp2.form.fill"],this.proxyEventCallback(this.onChangeTriggerData,
this));this.subscribe(this.events.cabinType,this.proxyEventCallback(this.onChangeCabinType,this));this.subscribe(this.events.travelerCount,this.proxyEventCallback(this.onChangeTravelersCount,this));this.subscribe(this.events.displayCat,this.proxyEventCallback(this.onChangeDisplayCat,this));this.subscribe(this.events.searchError,this.proxyEventCallback(this.onSearchError,this));this.subscribe(this.events.baggageCount,this.proxyEventCallback(this.onChangeBaggageCount,this));var a=this;this.subscribe("DropdownDialog.open",
function(b){var c=h(".FlightSearchDialogWidget");!c.length||b.id!==a.id("multi-travelers")&&b.id!==a.id("travelers")||c.find(".viewport").animate({scrollTop:h("#"+b.id).offset().top-c.find(".content").offset().top+.12*c.find(".viewport").height()},500)});this.subscribe("intentmedia.submit.handler",h.proxy(this.onHookSubmitForIntentMedia,this));this.subscribe("common.kn.Swindle.hook",h.proxy(this.onHookSubmitForSwindle,this));this.options.dialog||this.answer(this.formQuestion,function(){return a.serialize()});
this.options.mainSearchForm&&this.answer(this.formQuestion+".main",function(b){return a.serialize()});this.answer(this.formObjectQuestion,function(){return a});this.subscribe("flights.search.AnywhereSearchDialog.search.click",function(){a.vsLog("/nodestination/click/search")});this.subscribe("flights.search.AnywhereSearchDialog.explore.click",function(){a.vsLog("/nodestination/click/anywhere")});this.subscribe("omni.vertical.changed",function(b){"flights"===b&&a.focusFirstElement()});this.studentCheckbox.on("click",
function(){var b=h(this).is(":checked");a.vsLog("/student/"+(b?"checked":"unchecked"));window.setMetaCookie("isStudent",b?"true":"false")});this.subscribe("flights.search.FlightSearchFormDeprecated.enabledSearchButton",function(b){b===a.id()&&a.enableSearchButton()});if(this.options.slideCMP2){var d=this;this.subscribe([this.events.cabinType,this.events.travelerCount,this.events.displayCat,this.events.searchError,this.events.baggageCount,this.events.rtowOrigin,this.events.rtowDestination,this.events.rtowDateRange,
this.events.rtowNearbyOrigin,this.events.rtowNearbyDestination,this.events.rtowLengthOfStay,"flights.frontdoor.form.all","cmp2.form.fill"],function(){d.enableSearchButton()})}g.config.getBoolean("ui.horizon.flights.search.cheapflights.fdcmp2s",!1)&&this.subscribe("cmp2.rendering.finished",function(b){b&&0<b.items.length&&a.getChildElement("slidecmp2").html("").removeAttr("class")});h(".addMoreLegs",this.element).on({mouseenter:function(){h("button",this).addClass("btnActive");h("button",this).is(".Common-Widgets-Button-StyleJamButton")&&
g.dom.swapClasses(h("button",this),g.stylejam.common.widgets.button.StyleJamButton.plusButtonInactive,g.stylejam.common.widgets.button.StyleJamButton.plusButtonActive)},mouseleave:function(){h("button",this).removeClass("btnActive");h("button",this).is(".Common-Widgets-Button-StyleJamButton")&&g.dom.swapClasses(h("button",this),g.stylejam.common.widgets.button.StyleJamButton.plusButtonActive,g.stylejam.common.widgets.button.StyleJamButton.plusButtonInactive)}});this.getChildElement("removeLeg").on("click",
function(b){var c=h(".multiCityLeg",a.element).not(".hiddenLeg").last().index();if(0!==c){a.controllers.multi.triggerRemoveLeg(c);var f=h(b.currentTarget);f.addClass(1===c?"disabled":"");f.closest(".Flights-Search-StyleJamFlightSearchForm").length&&(f=g.stylejam.flights.search.StyleJamFlightSearchForm,1===c?g.dom.swapClasses(h(b.currentTarget),f.searchFormVisible,f.searchFormHidden):g.dom.swapClasses(h(b.currentTarget),f.searchFormHidden,f.searchFormVisible))}});g.events.subscribe("flights.search.multi.form.removeLeg",
function(b){a.adjustFormClass.call(a)});g.events.subscribe("flights.search.multi.form.addLeg",function(b){a.id()===b.id&&a.getChildElement("removeLeg").removeClass("disabled");a.element.is(".Flights-Search-StyleJamFlightSearchForm")&&(b=g.stylejam.flights.search.StyleJamFlightSearchForm,g.dom.swapClasses(a.getChildElement("removeLeg"),b.searchFormHidden,b.searchFormVisible));a.adjustFormClass.call(a)});h("div[id$\x3d'searchDialog-dialog-viewport']").on("scroll",function(){h("div[id$\x3d'smartbox-dropdown']").css("display",
"none")})},shouldSlideCmp2Init:function(){return this.element.is(":visible")?this.options.slideCMP2Everywhere?!this.options.slideCMP2PreventInit:!this.options.activeHome:!1},load:function(a){if(a){var d=this.controllers.rtow,b=this.controllers.multi;a.hasOwnProperty("adults")&&a.adults&&(this.getChildElement("adults").getWidget().setValue(a.adults,!0),this.state.adults=a.adults);a.hasOwnProperty("child")&&a.child&&this.getChildElement("child").getWidget().setValue(a.child,!0);a.hasOwnProperty("lapInfant")&&
a.lapInfant&&this.getChildElement("lapInfant").getWidget().setValue(a.lapInfant,!0);a.hasOwnProperty("seatInfant")&&a.seatInfant&&this.getChildElement("seatInfant").getWidget().setValue(a.seatInfant,!0);a.hasOwnProperty("seniors")&&a.seniors&&this.getChildElement("seniors").getWidget().setValue(a.seniors,!0);a.hasOwnProperty("youth")&&a.youth&&this.getChildElement("youth").getWidget().setValue(a.youth,!0);this.updateCabinType(a);a.nearby_origin&&d.triggerChangeNearbyOrigin(a.nearby_origin,this.options.isNearbyInSmarty);
a.nearby_destination&&d.triggerChangeNearbyDestination(a.nearby_destination,this.options.isNearbyInSmarty);a.hasOwnProperty("oneway")&&a.oneway&&(this.display="oneway");if(a.hasOwnProperty("isMulticity")&&a.isMulticity&&this.options.toggleLinks){this.display=this.options.useMultiCityInFD?"rtow":"multicity";var c=a.nrLegs||b.indexLastVisibleLeg+1,f=0;if(b.maxLegs)for(var e=0;e<b.maxLegs&&a["origincode"+e]&&a["destinationcode"+e];e++)f++,b._legAccessor(e).visible(!0);f>c&&(c=f,b.indexLastVisibleLeg=
f-1);f=this.options.isNearbyInSmarty;for(e=0;e<c;e++){var k="depart_time"+e;a[k]&&b.triggerChangeDepartTime(a[k],e);k="nearby_origin"+e;a[k]&&b.triggerChangeNearbyOrigin(a[k],e,f);k="nearby_destination"+e;a[k]&&b.triggerChangeNearbyDestination(a[k],e,f);var k="originLocation"+e,l="origincode"+e;a[k]&&a[l]?b.triggerChangeOrigin(a[k],a[l],e):0===e&&a.originLocation&&a.origincode&&b.triggerChangeOrigin(a.originLocation,a.origincode,e);k="destinationLocation"+e;l="destinationcode"+e;a[k]&&a[l]?b.triggerChangeDestination(a[k],
a[l],e):0===e&&a.destinationLocation&&a.destinationcode&&b.triggerChangeDestination(a.destinationLocation,a.destinationcode,e);k="depart_date_canon"+e;a[k]&&b.triggerChangeDepartDate(a[k],e);k="cabin_type"+e;a[k]&&b.triggerChangeLegCabinType(a[k],e)}}a.hasOwnProperty("depart_date_canon")&&a.depart_date_canon&&a.hasOwnProperty("return_date_canon")&&a.return_date_canon&&d.triggerChangeDateRange(a.depart_date_canon,a.return_date_canon);"exact"!==a.flex_category&&d.datePicker&&this.options.useFlexDatePicker&&
(this.options.useFlexRadioButtons&&(a=d.datePicker.getRadioButtonSimplifiedFlexData(a)),d.datePicker.loadFlexData(a),d.datePicker.publishFlexUpdate());if(this.wholeMonthSearch)"undefined"!==typeof g.storage&&(d.setFlexCategory(a.flex_category),b=d.flexCategoryRadio.getWidget(),!0===g.storage.get("flexPlusMinusChecked")&&(b.setButtonCheckedByValue("plusminusthree"),c=this.getChildElement("plusMinusThreeDepart").dropdown({}).getWidget(),e=this.getChildElement("plusMinusThreeReturn").dropdown({}).getWidget(),
a.hasOwnProperty("depart_date_flex")&&a.depart_date_flex&&(c.setValue(a.depart_date_flex),d.state.plusMinusThreeDepart=a.depart_date_flex),a.hasOwnProperty("return_date_flex")&&a.return_date_flex&&(e.setValue(a.return_date_flex),d.state.plusMinusThreeReturn=a.return_date_flex),d.searchFormWrapper.hasClass("advanced plusMinus")||d.searchFormWrapper.addClass("advanced plusMinus")),"wholeMonthSearch"===(null!==g.storage.get("daterangePickerDefaultNavTab")?g.storage.get("daterangePickerDefaultNavTab"):
"specificDate")&&(b.setButtonCheckedByValue("openflex"),d.searchFormWrapper.hasClass("advanced")||d.searchFormWrapper.addClass("advanced"),d.searchFormWrapper.hasClass("plusMinus")&&d.searchFormWrapper.removeClass("plusMinus"),a.hasOwnProperty("openflex_length_of_stay")&&a.openflex_length_of_stay&&(d.openflexLengthOfStay.val(a.openflex_length_of_stay),d.state.openflexLengthOfStay=a.openflex_length_of_stay)));else if(!this.options.disabledAdvanced&&("plusminusthree"===a.flex_category||"weekend"===
a.flex_category||"openflex"===a.flex_category&&this.options.flexMonthEnabled)){d.setFlexCategory(a.flex_category);b=d.flexCategoryRadio.getWidget();switch(a.flex_category){case "weekend":b.setButtonCheckedByValue("weekend");b=this.getChildElement("weekendDepartDate").dropdown({}).getWidget();c=this.getChildElement("weekendDepart").dropdown({}).getWidget();e=this.getChildElement("weekendReturn").dropdown({}).getWidget();a.hasOwnProperty("weekend_depart_date")&&a.weekend_depart_date&&c&&(b.setValue(a.weekend_depart_date),
d.state.weekendDepartDate=a.weekend_depart_date);a.hasOwnProperty("weekend_depart")&&a.weekend_depart&&(c.setValue(a.weekend_depart),d.state.weekendDepart=a.weekend_depart);a.hasOwnProperty("weekend_return")&&a.weekend_return&&(e.setValue(a.weekend_return),d.state.weekendReturn=a.weekend_return);break;case "plusminusthree":b.setButtonCheckedByValue("plusminusthree");c=this.getChildElement("plusMinusThreeDepart").dropdown({}).getWidget();e=this.getChildElement("plusMinusThreeReturn").dropdown({}).getWidget();
a.hasOwnProperty("depart_date_flex")&&a.depart_date_flex&&(c.setValue(a.depart_date_flex),d.state.plusMinusThreeDepart=a.depart_date_flex);a.hasOwnProperty("return_date_flex")&&a.return_date_flex&&(e.setValue(a.return_date_flex),d.state.plusMinusThreeReturn=a.return_date_flex);break;case "openflex":b.setButtonCheckedByValue("openflex"),a.hasOwnProperty("openflex_length_of_stay")&&a.openflex_length_of_stay&&(d.openflexLengthOfStay.val(a.openflex_length_of_stay),d.state.openflexLengthOfStay=a.openflex_length_of_stay)}d.toggleAdvanced()}}},
updateCabinType:function(a){a.hasOwnProperty("cabin")&&a.cabin&&this.getChildElement("cabinType").getWidget().setButtonCheckedByValue(a.cabin)},bindOpenNextFieldEvents:function(){var a=this,d=!1;if(this.options.autoOpenNextField){var b=null,c=null,f=null,e=function(){var c=0;return function(){var a=Date.now(),b=a-c;c=a;return 250<b}}(),k=function(){e()&&!d&&a.controllers.rtow.destInput.focus();d=!1},l=function(){e()&&(a.options.useLegacyDatePicker?a.controllers.rtow.daterangePicker.getWidget().startDisplay.trigger("mousedown"):
a.controllers.rtow.departDate.focus())};g.events.subscribe("flights.search.rtow.form.origin",function(c){c.id!==a.element[0].id||c.odSwitch||(null==b?b=!!c.originCode:(b=!!c.originCode)&&!c.disableDestinationFocusAfterAjax&&(f=setTimeout(k,10)))});g.events.subscribe("flights.search.rtow.form.destination",function(b){b.id===a.element[0].id&&(null!==f&&(clearTimeout(f),f=null),null==c?c=!!b.destinationCode:(c=!!b.destinationCode,b=a.options.useLegacyDatePicker?a.controllers.rtow.daterangePicker.getWidget().startInput.val()&&
a.controllers.rtow.daterangePicker.getWidget().endInput.val():a.controllers.rtow.departDate.getValue()&&a.controllers.rtow.returnDate.getValue(),c&&!b&&l()))});this.controllers.rtow.originInput.on("keyup",function(c){13===c.which&&b&&k()}).on("keydown",function(c){c.which===g.globals.keyCodes.TAB&&(d=!0)});this.controllers.rtow.destInput.on("keyup",function(a){13===a.which&&c&&l()})}},vsLog:function(a){if(this.stateInitialized&&this.searchForm.is(":visible")&&0<=this.searchForm.offset().top&&"complete"===
document.readyState){var d="simpleform";this.searchForm.filter(".active").hasClass("multicity")?d="multicity":this.element.find(".searchFormWrapper").hasClass("advanced")&&(d="advancedform");g.Analytics.api.trackEvent(["flights/form",d,a].join("/"))}},gaLog:function(a,d){this.stateInitialized&&this.searchForm.is(":visible")&&0<=this.searchForm.offset().top&&"complete"===document.readyState&&g.Analytics.api.trackEvent({category:"Search-Form",action:a,label:d})},initState:function(){this.options.showStudents||
delete this.state.students;if(!0!==this.options.sync){this.triggerChangeDisplayCat();for(var a=0;a<this.travelerTypes.length;a++)this.triggerChangeTravelersCount(this.travelerTypes[a]);var d,b;this.localHistory&&this.localHistory.getRecentHistory&&(d=(b=this.localHistory.getRecentHistory())?b.cabin:null);this.triggerChangeCabinType(d);this.activeFormController.initState(b)}this.stateInitialized=!0},setupChildControllers:function(){this.controllers.rtow.setup();this.options.toggleLinks&&this.controllers.multi.setup()},
onSubmit:function(a){var d=this;if(!this.isSubmitted){var b=this.serialize(),c=!1,f="continents"===b.flex_category,e="anywhere"===b.flex_category||f;if(!1===this.validate()&&!1===this.submitSubscription.call(this)||!1===this.validate()&&this.submitSwindle.call(this)||this.loadSlideCMP2())return!1;!1===this.validate()&&this.submitIntentMedia();this.gaLog("click-search","origin:%s;dest:%s;depart:%s;return:%s;travelers:%s;triptype:%s;cabin:%s;departflex:%s;returnflex:%s".format(b.origin,b.destination,
b.depart_date_canon,b.return_date_canon,b.travelers,this.display,b.cabin,b.depart_date_flex,b.return_date_flex));if(d.options.showAnywhere&&!e)if(b.isMulticity)for(var k=0;k<b.nrLegs&&(n(b["origincode"+k])||!n(b["destinationcode"+k]));k++);else c=!n(b.origincode)&&n(b.destinationcode)&&"function"===typeof this.showAnywhereSearchPopup&&this.options.showAnywherePopupEnabled;this.triggerConsentGranted();c?(this.vsLog("/nodestinationerror/show"),this.showAnywhereSearchPopup(b)):g.config.getBoolean("ui.horizon.flights.search.openExploreWithExactDates",
!1)&&e&&b.depart_date&&b.return_date?(a=b.depart_date+","+b.return_date,f=f&&b.continentId?"?continent\x3d"+b.continentId:"",window.location="/"+this._generate(b)+"/"+a+f):d.options.regionSearchEnabled&&(b.freeRegionId||b.countrySearch)&&!d.options.regionSearch?window.location="/"+this._generate(b):this.base(a)}setTimeout(function(){d.recalculateDialogDimensions()},10);return!1},showAnywhereSearchPopup:function(a){g.events.publish("flights.search.AnywhereSearchDialog.open",a)},publishSubmitEvent:function(a){this.options.regionSearch?
window.location.href="/"+a.url:"anywhere"===a.flex_category?this.options.anywhereSelfTarget?window.location.href="/"+a.url:(window.open("/"+a.url),this.enableSearchButton()):this.base(a)},getCMP2AirportLocation:function(a,d){if(a){a=a.substr(0,3);if(""===a||0===a.indexOf("C-"))a=d.replace(/ /g,""),-1!==a.indexOf("(")?(d=a.match(/\(([A-Z]{3})\)/g),null!=d&&(a=d[0])):a=a.substr(0,3);return a}return""},getCompareToFormData:function(){var a=this.serialize(),d={vertical:this.vertical};a.origin=a.origin_location;
a.origincode=a.origin_code;a.destination=a.destination_location;a.destinationcode=a.destination_code;return h.extend(d,a)},isEnoughInformationForCompareToRequest:function(){if(this.options.loadCmp2WhenVisible&&!this.element.is(":visible"))return!1;var a=["plusminusthree","exact"];if(this.activeFormController===this.controllers.rtow&&-1===h.inArray(this.activeFormController.getFlexCategory(),a))return!1;a=!0;this.options.cmp2LimitDisplay&&(a="oneway"===this.display||"roundtrip"===this.display);if(this.options.regionSearchEnabled&&
a&&this.activeFormController){var d=this.serialize();if(d.destination&&(y.exec(d.destination)||x(d.destination)))return!1}return a&&!this.options.suppressCmp2s&&null!==this.activeFormController&&!1===this.validate()},autofocus:function(){this.controllers.rtow.originInput.focus()},setView:function(a){this.base(a);"inline"===a||"inlineform"===a?this.switchToInlineView("inline"===a):this.switchToFullView()},switchToFullView:function(){this.inlineViewOnly=this.inline=!1},switchToInlineView:function(a){this.inline=
!0;this.inlineViewOnly=a||!1;a&&this.updateInlineViewOnly()},getDirectOptionValue:function(){if(!0===this.options.showDirectOption){var a=this.getChildElement("direct-option");if(a&&a.is(":checked"))return{stops:"0"}}return null},buildSearchURL:function(a){a.originCountry=this.originCountry;return this.activeFormController.buildSearchURL(a)},serialize:function(){var a=this.base();a.provider="";var d=this.getActiveFormData();return h.extend(a,d)},getActiveFormData:function(){return h.extend({airlineFilter:this.options.airlineFilter},
this.activeFormController.serialize())},getCookieData:function(){var a=this.base(),d={};this.element.find("[type\x3d'hidden']").filter(function(){var a=h(this).attr("name");return n(a)?!1:!/^(airportcode|origincode\d?|destinationcode\d?)$/i.test(a)}).each(function(){var a=h(this),c=a.attr("name"),f=a.val();n(f)||(d[c]=a.val())});this.options.airlineFilter&&!d.airlineFilter&&(d.airlineFilter=this.options.airlineFilter);return h.extend(a,d)},getStorageProps:function(){for(var a="depart_date depart_date_canon return_date return_date_canon origincode destinationcode travelers cabin flex_category isMulticity oneway nearby_origin nearby_destination depart_date_flex return_date_flex weekend_depart_date weekend_depart weekend_return openflex_depart_date openflex_length_of_stay".split(" "),
d=this.activeFormController&&this.activeFormController.maxLegs?this.activeFormController.maxLegs:3,b=0;b<d;b++)a.push("origincode"+b),a.push("originLocation"+b),a.push("destinationcode"+b),a.push("destinationLocation"+b),a.push("depart_date"+b),a.push("depart_date_canon"+b),a.push("depart_time"+b),a.push("cabin_type"+b),a.push("nearby_origin"+b),a.push("nearby_destination"+b);return a},removeActiveClass:function(a){h("form.searchform.active",a).removeClass("active").attr("aria-hidden","true");if(this.element.is(".Flights-Search-StyleJamFlightSearchForm")){var d=
g.stylejam.flights.search.StyleJamFlightSearchForm;g.dom.swapClasses(h("form.searchform",a),d.searchFormVisible,d.searchFormHidden)}},bindDisplayCat:function(){var a=this;this.options.toggleLinks?(this.getChildElement("displayCat").radioButtonSet({change:function(d){a.triggerChangeDisplayCat(d.value,d)}}),this.addExploreEventHandlers()):(a.multiCityDialog=this.getChildElement("multiCityDialog").getWidget(),a.multiCityDialog&&(h.extend(a.multiCityDialog.options,{onClose:function(){a.autofocus();g.events.publish("flights.search.rtow.form.displayCat",
{displayCat:"roundtrip"})}}),this.subscribe(["flights.search.multicity.legAdded","flights.search.multicity.legRemoved"],function(){setTimeout(a.multiCityDialog.calculateDimensions.bind(a.multiCityDialog),1)}),this.subscribe("flights.search.toggle",function(d){"multicity"!==d.displayCat||a.options.toggleLinks?"explore"===d.displayCat?(a.gaLog("open","explore"),a.vsLog("explore/open"),window.open("/explore","_blank")):a.triggerChangeDisplayCat(d.displayCat):(a.multiCityDialog.open(),g.events.publish("flights.search.multicity.activate"))}),
this.subscribe("searchform.submit",function(){a.multiCityDialog.close()})))},addExploreEventHandlers:function(){var a=this;if(this.options.toggleLinks){var d=this.id("explore-label");this.getChildElement("explore-label").click(function(b){switch(b.which){case 1:case g.globals.keyCodes.RETURN:case g.globals.keyCodes.SPACE:return window.open("/explore","_blank"),a.triggerChangeDisplayCat("roundtrip"),a.getChildElement("displayCat").getWidget().focusButtonSet(),!1}});this.getChildElement("displayCat").keydown(function(b){switch(b.which){case g.globals.keyCodes.RETURN:case g.globals.keyCodes.SPACE:if(h(b.currentTarget).attr("aria-activedescendant")===
d)return window.open("/explore","_blank"),a.triggerChangeDisplayCat("roundtrip"),a.getChildElement("displayCat").getWidget().focusButtonSet(),!1}})}},initActiveFormController:function(){switch(this.display){case "roundtrip":case "rtow":case "oneway":this.activeFormController=this.controllers.rtow;break;case "multi":case "multicity":this.activeFormController=this.controllers.multi}},onChangeDisplayCat:function(a){switch(a.displayCat){case "roundtrip":case "rtow":this.activeFormController=this.controllers.rtow;
this.display="roundtrip";this.copyMultiCabinDataForRT();break;case "oneway":this.activeFormController=this.controllers.rtow;this.display="oneway";break;case "explore":this.activeFormController=this.controllers.rtow;this.display="explore";break;case "multi":case "multicity":a=this.activeFormController==this.controllers.rtow;this.activeFormController=this.controllers.multi;this.options.mixedCabinsUI&&a&&this.copyRTDataForMixedCabinsUI();this.display="multicity";break;default:return}this.options.toggleLinks&&
(this.getChildElement("displayCat").getWidget().setButtonCheckedByValue(this.display),this.removeActiveClass(this.element));("multicity"!==this.display||this.options.toggleLinks)&&this.activeFormController.activate();"oneway"!==this.display&&"roundtrip"!==this.display||this.activeFormController.setOneWay("oneway"===this.display);this.updateLapInfantWarning();this.loadCompareToItems();this.recalculateDialogDimensions()},copyMultiCabinDataForRT:function(){if(!0===this.options.adjustRTCabinType&&this.controllers.multi.legStates.length){var a=
this.controllers.multi.legStates[0].cabin_type;if(null!=a){var d=h.extend({},this.eventDataTemplate);d.cabinType=a;g.events.publish(this.events.cabinType,d)}}},copyRTDataForMixedCabinsUI:function(){if(!0!==this.options.adjustRTCabinType){var a=this.controllers.rtow.state;if(null!=a.end_date){var d=h.extend({},this.eventDataTemplate);d.legIndex=1;d.originCode=a.destinationCode;d.originLocation=a.destination;g.events.publish(this.events.multiOrigin,d);d=h.extend({},this.eventDataTemplate);d.legIndex=
1;d.destinationCode=a.originCode;d.destinationLocation=a.origin;g.events.publish(this.events.multiDestination,d);d=h.extend({},this.eventDataTemplate);d.legIndex=1;d.departDate=a.end_date;g.events.publish(this.events.multiDepartDate,d);d=h.extend({},this.eventDataTemplate);d.legIndex=0;d.cabinType=this.state.cabin;g.events.publish(this.events.multiLegCabinType,d);d=h.extend({},this.eventDataTemplate);d.legIndex=1;d.cabinType=this.state.cabin;g.events.publish(this.events.multiLegCabinType,d)}}},triggerChangeDisplayCat:function(a,
d){d=h.extend({},this.eventDataTemplate);d.displayCat=q(a,this.display);g.events.publish(this.events.displayCat,d);this.vsLog("/triptype/"+a);this.gaLog("select-trip-type",a)},updateInlineViewOnly:function(){var a=this.activeFormController.serialize(),a={depart_date:m(a.depart_date).format("MMM DD"),return_date:m(a.return_date).format("MMM DD"),origincode:a.origincode,destinationcode:a.destinationcode,cabin:a.cabin||"Economy",travelers:a.travelers},d;for(d in a)a.hasOwnProperty(d)&&h(".displayView[data-disp-%s]".format(d),
this.element).html(a[d])},_getAirportCodeField:function(a){return a.siblings("input.aircode")},bindTravelersDropdownCloseLink:function(){var a=this;this.element.find(".closeLink").click(function(d){d.preventDefault?d.preventDefault():d.returnValue=!1;a.getChildElement("multicity"===a.display?"multi-travelers":"travelers").getWidget().close(d,null,!0)})},bindTravelersDropdownCloseEvent:function(){var a=this;this.subscribe("horizon.dropdownDialog.close.dropdown",function(){var d=a.getChildElement("multicity"===
a.display?"multi-travelers":"travelers").getWidget();if(a.options.closeOnScroll)d.close(null,null,!0);else{var b=d.content,c=h(document).scrollTop(),f=b.offset().top;b.hasClass("up")?f>c+window.innerHeight&&d.close(null,null,!0):f<c&&d.close(null,null,!0)}})},adjustAnywhereSearchCategory:function(a){a?this.controllers.rtow.searchFormWrapper.addClass("anywhere-search"):this.controllers.rtow.searchFormWrapper.removeClass("anywhere-search")},bindFlightSmartyFields:function(a,d,b,c,f){var e=this,k=function(c){return function(a,
f){f&&setTimeout(function(){var l,k;l=e.options.regionDisplayAirportPicker?!1:!d&&e.isRegionSearchSupported;if("ap"===f.type||"apnc"===f.type||"rail"===f.type)l=f.short_str||f.str,k=f.id;else if("isl"===f.type)l=f.str,k="";else if(l&&e.options.regionSearchEnabled&&"reg"===f.type)l=f.short_str||f.str,k=f.rid+"r";else if(l&&e.options.regionSearchEnabled&&"freereg"===f.type)l=f.short_str||f.str,k=f.frid+"fr";else if(l&&e.options.regionSearchEnabled&&"ctry"===f.type)l=f.short_str||f.str,k=f.cid+"cy";
else if(l&&e.options.regionSearchEnabled&&"ctgroup"===f.type)l=f.short_str||f.str,k=f.cgid+"cg";else if(a.options.showAnywhere&&"anywhere"===f.short_str)g.events.publish("forceDismiss.DatePicker"),l=a.options.messages.anywhereInptText,k="anywhere",c.closest(".searchFormWrapper").removeClass("advanced").addClass("anywhere-search"),e.vsLog("/smarty/anywhere");else if("continent"===f.type)g.events.publish("forceDismiss.DatePicker"),l=f.short_str||f.str,k=f.id,c.closest(".searchFormWrapper").removeClass("advanced").addClass("continent-search"),
e.vsLog("/smarty/continents");else{k=l="";var h=f.id;if(e.isRegionSearchSupported)switch(f.type){case "freereg":h="F:%s".format(f.frid);break;case "reg":h="R:%s".format(f.rid);break;case "ctry":h="Y:%s".format(f.cid)}e.openAirportPicker("","",h,!d,function(c){b(c.location,c.code)})}a.options.showAnywhere&&"anywhere"!==f.short_str&&c.closest(".searchFormWrapper").removeClass("anywhere-search");a.options.showContinents&&"continent"!==f.type&&c.closest(".searchFormWrapper").removeClass("continent-search");
d&&(e.originCountry=f.cc||"",e.originCode=t(k));b(l,k)},100)}},l=function(c){return function(a){setTimeout(function(){a.options.showAnywhere&&c.closest(".searchFormWrapper").removeClass("anywhere-search");a.options.showContinents&&c.closest(".searchFormWrapper").removeClass("continent-search");b(void 0,"")},1)}},r=function(c){return function(a){setTimeout(function(){if(!c.val()||0===c.val().length){var f=a.options.messages.anywhereInptText;c.closest(".searchFormWrapper").addClass("anywhere-search");
b(f,"anywhere")}},1)}},p=function(c){return function(a){setTimeout(function(){c.val()&&0!==c.val().length||b(a.initialVal,a.initialCode)},1)}},m=function(){return function(a){if(a)if(c)c(a.enabled);else{var b=h.extend({},e.eventDataTemplate);d?(b.includeNearbyOrigin=a.enabled,g.events.publish(e.events.rtowNearbyOrigin,b)):(b.includeNearbyDestination=a.enabled,g.events.publish(e.events.rtowNearbyDestination,b))}}};a.each(function(){var c=e.options.flareSmartyType,a=h(this),b={cleanUpInputFieldOnFocus:e.options.cleanUpInputFieldOnFocus,
flareSmartyType:c,dataSource:e.options.smartyUrl,smartyControlGroup:function(){if(!e.options.showSmartyHistory)return null;new g.Common.SmartyHistory.SmartyFlightHistory;var c=e.getChildElement("origin"),a=e.getChildElement("destination"),b=e.getChildElement("origincode"),f=e.getChildElement("destinationcode"),d=e.getChildElement("nearbyOriginCheckRtow"),l=e.getChildElement("nearbyDestinationCheckRtow"),k=1===e.element.find(".roundtrip").length,h=e.state,r,p,m,z;e.options.useLegacyDatePicker?r=e.getChildElement("travelDates").daterangePicker().getWidget():
(m=e.activeFormController.departDate,z=e.activeFormController.returnDate,p=e.activeFormController.datePicker);return new g.Common.SmartyControlGroup.SmartyFlightControlGroup({form:e.searchForm,formObject:e,originInput:c,destInput:a,originCode:b,destCode:f,daterangePicker:r,startDate:m,endDate:z,datePicker:p,useLegacyDatePicker:e.options.useLegacyDatePicker,nearbyDeparture:d,nearbyArrival:l,isRoundTrip:k,maxHistory:e.options.maxHistoryItems,state:h,smartyHistory:function(){return new g.Common.SmartyHistory.SmartyFlightHistory}})}(),
setItem:k(a),clearItem:l(a),messages:e.options.msg,showAnywhere:e.options.showAnywhere&&this.id===e.id("destination"),showBackgroundAutocomplete:g.config.getBoolean("ui.common.smarty.background.autocomplete.enabled",!1),animateSmarty:!1,useNearby:e.options.isNearbyInSmarty,enableRemoteHide:e.options.enableSmartyRemoteHide,flippable:e.options.flippableSmarty};"function"===typeof f&&h.extend(b,{beforeStart:f(a)});b.useNearby&&(b.nearbyCallback=m());e.options.showAnywhere&&e.options.anywhereIfEmpty&&
this.id===e.id("destination")?b.afterDone=r(a):e.options.backIfEmpty&&(b.afterDone=p(a));if(32===c||51===c||55===c||58===c)b.dropdownClass="smartbox smartbox-air smartbox-v2 smartbox-air-regions";g.config.getBoolean("ui.smarty.greyIcons",!1)&&(b.dropdownClass=b.dropdownClass+" "+g.config.getString("ui.smarty.iconClasses","greyIcons"));g.config.getBoolean("ui.smarty.showExploreContinents",!1)&&(b.continents=e.options.continents,b.showContinents=this.id===e.id("destination"),b.showDropdownWhenEmpty=
b.showContinents);e.checkAndSetSmartyUIUpdateOpts(b);a.flightSmarty(b)})},bindTravelerSelectDialog:function(){var a=this,d=function(c,b){c=u(c);return(c?["adults","seniors"]:["child","youth","seatInfant","lapInfant"]).reduce(function(c,b){return a.state.hasOwnProperty(b)?c+a.state[b]:c},"number"===typeof b?b:0)>=(c?a.options.maxAdults:a.options.maxChildren)},b=function(c,b,f){var e=a.state.travelers+c,l=this,k=u(f)?"adults":"children",g=a.getChildElement("travelers_content");if(1===e)1===b?h(l).getWidget().disableDecrement():
h(".gridCellTravelerTypeCount .numberBox-js",g).each(function(){var c=h(this).getWidget();void 0!==c&&1===c.getValue()&&c.disableDecrement()});else if(1<e){var m=e>=a.options.maxTravelers;h(".gridCellTravelerTypeCount .numberBox-js",g).each(function(){var b=h(this).getWidget(),e=b.element.data("type"),l=u(e)?"adults":"children",g=b.getValue(),r=a.totalAdultCount()+("adults"===k?c:0),p=a.state.lapInfant+("lapInfant"===f?c:0),z=u(e)&&0===r,n="lapInfant"===e&&g>=r,r=u(e)&&p>=r;0===g||z||a.atMinTotalTravelers()||
r?b.disableDecrement():b.enableDecrement();m||n||d(e,l===k?c:0)?b.disableIncrement():b.enableIncrement()}).filter(function(){return l!==this})}},c={};h("."+this.travelerDialogClass+" .gridCellTravelerTypeCount .numberBox-js",a.element).each(function(){var f=this,k=h(f).attr("id").split("-").pop(),l=u(k);if("undefined"===typeof c[k]){var g=function(c){return function(e){b.call(f,e,this.getValue(),c);a.triggerChangeTravelersCount(c,this.getValue())}}(k);h(this).data("type",k);l={callback:g,validator:function(c){var b=
a.state.travelers+c;return b<=a.options.maxTravelers&&0<b||d(k,c)||b>a.options.maxTravelers&&0>c||0>b&&0<c?!0:!1},max:l?a.options.maxAdults:a.options.maxChildren};h(this).is(".Common-Widgets-Number-StyleJamNumberBox")?h(this).styleJamNumberBox(l):h(this).numberBox(l);c[k]=h(this).getWidget().getValue()}});a.travelerTypes=Object.keys(c);Object.keys(c).each(function(b){a.state[b]=c[b];a.state.travelers+=a.state[b]});b(0);var f=this.bindTravelerSelectDialogUI();a.state.cabin=f.value;a.state.cabinDisplayType=
f.title;f=h("."+this.travelerDialogClass+" .baggageRow .numberBox-js",a.element);0<f.length&&f.numberBox({callback:function(c){a.triggerChangeBaggageCount(this.getValue())},validator:function(){return!0},max:2})},onChangeTravelersCount:function(a){this.getChildElement(a.travelerType).getWidget().setValue(a.travelerTypeCount,!1);this.state[a.travelerType]=a.travelerTypeCount;for(var d=a=0;d<this.travelerTypes.length;d++)a+=this.state[this.travelerTypes[d]];this.state.travelers=a;this.updateTravelerDisplay();
this.updateLapInfantWarning()},triggerChangeTravelersCount:function(a,d){var b=h.extend({},this.eventDataTemplate);b.travelerType=a;var c=this;b.travelerTypeCount=q(d,function(){return c.getChildElement(a).getWidget().getValue()});g.events.publish(this.events.travelerCount,b);this.vsLog("passengers/"+a);this.gaLog("select-passengers",a)},initTravellersDropdown:function(a,d){d.showModalBp=this.options.showTravelersModalBp;a.dropdownDialog(d)},onChangeBaggageCount:function(a){this.getChildElement("baggageCount").getWidget().setValue(a.baggageCount,
!1);this.state.baggageCount=a.baggageCount},triggerChangeBaggageCount:function(a){var d=h.extend({},this.eventDataTemplate),b=this;d.baggageCount=q(a,function(){return b.getChildElement("baggageCount").getWidget().getValue()});g.events.publish(this.events.baggageCount,d);this.vsLog("baggage-count")},bindTravelerSelectDialogUI:function(){var a=this,d=this.getChildElement("cabinType"),b=function(c){return function(){var b=c.getWidget().getCheckedPair();"m"===b.value?(a.triggerChangeCabinType("e"),a.getChildElement("travelers").getWidget().close(),
a.triggerChangeDisplayCat("multicity"),a.vsLog("/passengers/cabin/m"),a.gaLog("select-cabin","m")):a.triggerChangeCabinType(b.value)}}(d);return d.radioButtonSet({change:b}).getWidget().getCheckedPair()},onChangeCabinType:function(a){var d=this.getChildElement("cabinType").getWidget();a.cabinType&&d.setButtonCheckedByValue(a.cabinType);a=d.getCheckedPair();this.state.cabin=a.value;this.state.cabinDisplayType=a.title;this.updateTravelerDisplay()},triggerChangeCabinType:function(a){var d=this,b=h.extend({},
this.eventDataTemplate);b.cabinType=q(a,function(){return d.getChildElement("cabinType").getWidget().getValue()});g.events.publish(this.events.cabinType,b);this.vsLog("/passengers/cabin/"+a);this.gaLog("select-cabin",a)},bindDaterangePicker:function(a,d,b){var c=this,f=function(a){var b=c.serialize();return{vertical:"flights",origin:b.origincode,destination:b.destinationcode,isOneWay:b.oneway,departDate:a?void 0:b.depart_date_canon}};this.options.useLegacyDatePicker?(b=b||{getFormData:f,useDaysFormat:!0,
minRangeDays:0,change:function(){d(this.getStartDate(),this.getEndDate())},alwaysShowEndDatepicker:this.options.autoOpenNextField,nextFieldSelector:"#"+this.controllers.rtow.searchForm.find(".searchButton").attr("id")},a.daterangePicker(b).getWidget()):(b=b||{change:d,getFormData:f},h.extend(a.options,b))},checkForValidDates:function(){var a=this.getChildElement("depart"),d=this.getChildElement("return");if(a&&a.getWidget()&&d&&d.getWidget()&&(a=a.getWidget(),d=d.getWidget(),a=a.getDate(),d=d.getDate(),
a&&m(Date.now()).isAfter(a,"day")||!a||!d)){d=1;a=8;g&&g.config&&(d=g.config.getInt("ui.horizon.flights.flightroutes.departureDate.offset",d),a=g.config.getInt("ui.horizon.flights.flightroutes.returnDate.offset",a));var b=h.extend({},this.eventDataTemplate);b.startDate=m().add(d,"d").startOf("day");b.endDate=m().add(a,"d").startOf("day");g.events.publish(this.events.rtowDateRange,b)}},bindShowAirportMapLinks:function(){function a(a){a.preventDefault?a.preventDefault():a.returnValue=!1;b(!1,function(a){c.controllers.rtow.triggerChangeOrigin(a.location,
a.code);c.controllers.multi.triggerChangeOrigin(a.location,a.code,0)})}function d(a){a.preventDefault?a.preventDefault():a.returnValue=!1;b(!0,function(a){c.controllers.rtow.triggerChangeDestination(a.location,a.code);c.controllers.multi.triggerChangeDestination(a.location,a.code,0)})}function b(a,b){var f=c.getChildElement(a?"destination":"origin"),e=f.val(),f=c._getAirportCodeField(f).val();c.openAirportPicker(e,f,"",a,b)}var c=this;this.getChildElement("showAirportMapOriginRtow").click(a.bind(this));
this.getChildElement("showAirportMapOriginRtow").keydown(function(c){c.which===g.globals.keyCodes.RETURN&&a(c)});this.getChildElement("showAirportMapDestinationRtow").click(d.bind(this));this.getChildElement("showAirportMapDestinationRtow").keydown(function(c){c.which===g.globals.keyCodes.RETURN&&d(c)})},onChangeTriggerData:function(a){if(a.disableDestinationFocusAfterAjax){var d=this.disableDestinationFocusAfterAjax;this.disableDestinationFocusAfterAjax=!0}n(a.origincode)||n(a.originname)||(this.controllers.rtow.triggerChangeOrigin(a.originname,
a.origincode),this.controllers.multi.triggerChangeOrigin(a.originname,a.origincode,0));n(a.destinationcode)||n(a.destinationname)||(this.controllers.rtow.triggerChangeDestination(a.destinationname,a.destinationcode),this.controllers.multi.triggerChangeDestination(a.destinationname,a.destinationcode,0),this.controllers.multi.triggerChangeOrigin(a.destinationname,a.destinationcode,1));n(a.departDate)||n(a.returnDate)||(this.controllers.rtow.triggerChangeDateRange(a.departDate,a.returnDate),this.controllers.multi.triggerChangeDepartDate(a.departDate,
0),this.controllers.multi.triggerChangeDepartDate(a.returnDate,1));n(a.filter)||(this.options.airlineFilter=a.filter);this.updateLogging(a);this.loadCompareToItems();a.disableDestinationFocusAfterAjax&&(this.disableDestinationFocusAfterAjax=d)},updateTravelDateState:function(a,d){n(a)||n(d)||this.controllers.rtow.triggerChangeDateRange(a,d)},openAirportPicker:function(a,d,b,c,f){c=this.id(c?"airportPickerDestination":"airportPickerOrigin");g.events.publish("flights.airportpicker.open",{id:c,location:a,
code:d,hint:b,callback:f})},updateTravelerDisplay:function(){var a=this,d=this.activeFormController.travelerSelect.getWidget();if(d){var b=function(c,b,e,d,l,g,h){l=null;var f=a.activeFormController.travelerSelect.getWidget();(f=f?f||f.triggerObj:null)&&f.element&&f.element.is(".only-travelers")&&(h=h.onlyTraveler);if(1===e)switch(c.reduce(function(c,a){return 1===b[a]?a:c||""})){case "adults":l=g.formatString(h.travelersDropdownCaptionSingleAdult,d);break;case "seniors":l=g.formatString(h.travelersDropdownCaptionSingleSenior,
d);break;case "child":l=g.formatString(h.travelersDropdownCaptionSingleChild,d);break;default:l=null}null===l&&(l=g.formatChoice(h.travelersDropdownCaptionTravelersChoice,e,e+"",d));return l}(this.travelerTypes,this.state,this.state.travelers,this.state.cabinDisplayType,this.state.baggageCount,g.Common.Utils.String,this.options.msg);d.updateLabel(b)}},updateLapInfantWarning:function(){this.element.removeClass("hasInfantInLapWarning hasTopInfantInLapWarning");g.config.getBoolean("ui.horizon.flights.search.showInfantWarningInForm",
!0)&&0<this.state.lapInfant&&(this.element.addClass("hasInfantInLapWarning"),this.activeFormController===this.controllers.rtow&&this.element.addClass("hasTopInfantInLapWarning"))},onSearchError:function(){this.recalculateDialogDimensions()},serializeTravelers:function(a){a.travelers=this.state.travelers;a.adults=this.state.adults;a.seniors=this.state.seniors;a.youth=this.state.youth;a.child=this.state.child;a.seatInfant=this.state.seatInfant;a.lapInfant=this.state.lapInfant;a.cabin=this.state.cabin;
a.cabinDisplayType=this.state.cabinDisplayType;a.baggageCount=this.state.baggageCount;this.options.showStudents&&(a.students=this.state.students)},slideCompareToUpdateDisplay:function(a){if(this.options.slideCMP2){var d=this;a?this.options.isGlobal?d.displaySlide=!0:h.ajax({type:"GET",url:"/s/horizon/common/compareto/slide/SlideCompareToAction",data:{origin:a,global:this.options.isGlobal},dataType:"json",cache:!0,success:function(a){"boolean"===typeof a&&(d.displaySlide=a,d.loadCompareToItems())},
error:function(a,c){}}):d.displaySlide=!1}},loadSlideCMP2:function(){if(this.options.slideCMP2&&this.displaySlide&&!1===this.validate()){this.disableSearchButton();var a=this,d=this.serialize()||{};d.relativeUrl=!0;var d=this.buildSearchURL(d),b={id:this.id("slidecmp2"),url:d,global:this.options.isGlobal};if(this.options.activeHome&&(!this.options.slideCMP2Everywhere||!this.options.slideCMP2PreventRedirect))return g.action.execute("flights/search/brands/cheapflights/Redirect",{url:d,returnUrl:!0},
function(c){window.location.href=c}),!0;g.ajax.execute("common/compareto/slide/SlideCompareToFlights",{customUpdate:function(c){a.getChildElement("slidecmp2").replaceWith(c.innerHTML);return!0},data:b});return!0}return!1},loadCompareToItems:function(){!this.options.slideCMP2Everywhere&&this.options.slideCMP2&&this.displaySlide?g.events.publish("cmp2.cleanUp",{id:this.id()+"-compareTo"}):this.base()},validate:function(){var a=!1,d=this.activeFormController.validate();if(this.options.hasSubscriptionPanel){var b=
this.notValidSubscription();b&&b.length&&d.push(b)}0===d.length&&(a=!0,d=this.getStandAloneErrorMessage());if(0===d.length)return!1;if(a)return d[0];for(a=0;a<d.length;a++)d[a]=g.utils.escapeHTML(d[a]);return"\x3cul\x3e\x3cli\x3e"+d.join("\x3c/li\x3e\x3cli\x3e")+"\x3c/li\x3e\x3c/ul\x3e"},getStandAloneErrorMessage:function(){var a=this.state.adults+this.state.seniors;this.options.showStudents&&(a+=this.state.students);return 0===a?[this.options.errMsg.noUnaccompaniedMinors+""]:[]},getTravelerValidationMessages:function(){return this.state.travelers>
this.options.maxTravelers?[g.Common.Utils.String.formatString(this.options.errMsg.tooManyPassengersSelected+"",this.options.maxTravelers)]:1>this.state.travelers?[this.options.errMsg.noPassengersSelected+""]:[]},getDateValidationMessages:function(a,d,b,c){var f=[],e=!n(b),k=!n(c);e||f.push(g.Common.Utils.String.formatChoice(this.options.errMsg.missingLeaveDateChoice,a,a));d||(k?(a=m(b),0>m(c).diff(a,"days")&&f.push(this.options.errMsg.departDateAfterReturnDate)):f.push(this.options.errMsg.missingReturnDate));
return f},getLocationValidationMessages:function(a,d,b){var c=[];n(d)&&c.push(g.Common.Utils.String.formatChoice(this.options.errMsg.missingFromAirportChoice,a,a)+"");n(b)?c.push(g.Common.Utils.String.formatChoice(this.options.errMsg.missingToAirportChoice,a,a)+""):d===b&&c.push(g.Common.Utils.String.formatChoice(this.options.errMsg.uniqueAirportsChoice,a,a)+"");return c},isInternalEvent:function(a){return this.id()===a.id},isConsumeUpdateEvent:function(a){return this.isInternalEvent(a)||!0===this.options.sync},
proxyEventCallback:function(a,d,b,c){var f=this;return function(e){("function"===typeof b?b.call(d,e):f.isConsumeUpdateEvent(e))&&a.apply(d,arguments);("function"===typeof c?c.call(d,e):f.isInternalEvent(e))&&f.loadCompareToItems()}},setNearbyWrapperVisibility:function(a,d){a=n(a)?"hidden":"visible";d=this.element.find(d);d.css("visibility",a);d.removeClass("visible hidden").addClass(a)},recalculateDialogDimensions:function(){g.events.publish("flights.search.dialog.recalculatedimensions",{id:this.id()})},
onHookSubmitForIntentMedia:function(a){a&&"function"===typeof a.callOnSubmit&&(this.intentMediaCallOnSubmit=a.callOnSubmit)},submitIntentMedia:function(){"function"===typeof this.intentMediaCallOnSubmit&&this.intentMediaCallOnSubmit.call(null,this.serialize())},onHookSubmitForSwindle:function(a){a&&"function"===typeof a.callOnSubmit&&(this.swindleCallOnSubmit=a.callOnSubmit)},submitSwindle:function(){if("function"===typeof this.swindleCallOnSubmit){var a=this.serialize()||{};a.relativeUrl=!0;var d=
this.buildSearchURL(a);a.relativeUrl=!1;a=this.buildSearchURL(a);this.options.slideCMP2&&(this.displaySlide||this.options.slideCMP2Everywhere)&&(a="/s/horizon/flights/search/brands/cheapflights/Redirect?url\x3d"+encodeURIComponent(d));return this.swindleCallOnSubmit.call(null,a,d)}return!1},checkOriginForUpdate:function(){var a=this;jq.ajax({url:"/s/run/analytic/airport",method:"GET",success:function(d){if(d.success){var b=d.ipAirport?d.ipAirport:"";d=d.ipAirportDisplayName?d.ipAirportDisplayName:
b;a.disableDestinationFocusAfterAjax=!0;a.onChangeTriggerData({origincode:b,originname:d});a.disableDestinationFocusAfterAjax=!1;a.shouldSlideCmp2Init()&&a.loadSlideCMP2()}}})},focusFirstElement:function(){this.getChildElement("displayCat").get(0).focus()},createSubControllers:function(){function a(c,a){c=d(c,a);a(c.getSelectedElement(),!0)}function d(c,a){return h(c).is(".Common-Widgets-Dropdown-StyleJamDropdown")?c.styleJamDropdown({change:function(){a(c.getWidget().getSelectedElement())}}).getWidget():
c.dropdown({change:function(){a(c.getWidget().getSelectedElement())}}).getWidget()}var b=this;return{rtow:{originInput:b.getChildElement("origin"),destInput:b.getChildElement("destination"),originCodeInput:b.getChildElement("origincode"),destCodeInput:b.getChildElement("destinationcode"),daterangePicker:b.getChildElement("travelDates"),advancedDaterangePicker:b.getChildElement("flexTravelDates"),openflexDaterangePicker:b.getChildElement("flexDepartDate"),openflexCalcReturnDate:b.getChildElement("flexCalcReturnDate"),
openflexLengthOfStay:b.getChildElement("flexLengthOfStay"),travelerSelect:b.getChildElement("travelers"),searchForm:b.getChildElement("RTOWsearchform"),searchFormWrapper:b.element.find(".searchFormWrapper"),flexCategoryRadio:b.getChildElement("flexCat"),originDepartureSwitch:b.getChildElement("originDepartureSwitch"),departDate:b.getChildElement("depart").getWidget(),returnDate:b.getChildElement("return").getWidget(),datePicker:b.getChildElement("datePicker").getWidget(),flexDatePicker:b.getChildElement("flexDatePicker").getWidget(),
openFlexDatePicker:b.getChildElement("openFlexDatePicker").getWidget(),flexSignUp:b.getChildElement("signup"),flexSignIn:b.getChildElement("login"),oneway:!1,initialized:!1,flexCat:"exact",state:{start_date:null,end_date:null,plusMinusThreeDepart:null,plusMinusThreeReturn:null,weekendDepartDate:null,weekendDepart:null,weekendReturn:null,nearby_origin:!1,nearby_destination:!1,origin:null,originCode:null,destination:null,destinationCode:null},_extendRadionButton:function(c){c.setValue=function(c){this.element.find("input").each(function(){var a=
h(this);a.val()===c?a.prop("checked",!0):a.prop("checked",!1)});g.Widgets.RadiobuttonSet.refresh(this.element)};c.setEnabled=function(c,a){this.element.find("input").each(function(){var b=h(this);b.val()===c&&b.prop("disabled",!a)});g.Widgets.RadiobuttonSet.refresh(this.element)}},setOneWay:function(c){this.oneway=c;b.options.useLegacyDatePicker?(this.daterangePicker.getWidget().setSingleDateMode(c),"undefined"!==typeof this.advancedDaterangePicker.getWidget()&&this.advancedDaterangePicker.getWidget().setSingleDateMode(c)):
(this.datePicker.setDateMode(c?"single":"range",!0),"undefined"!==typeof this.flexDatePicker&&this.flexDatePicker.setDateMode(c?"single":"range",!0));var a=this.getFlexCategory(),e=this.flexCategoryRadio.getWidget();"undefined"!==typeof e&&(!0!==c||"weekend"!==a&&"openflex"!==a||(e.setButtonCheckedByValue("plusminusthree"),this.setFlexCategory("plusminusthree")),e.setButtonEnabledByValue("weekend",!c),e.setButtonEnabledByValue("openflex",!c));this.searchForm.removeClass("oneway roundtrip");this.searchForm.addClass(c?
"oneway":"roundtrip");b.loadCompareToItems()},getFlexCategory:function(){if(this.searchFormWrapper.is(".anywhere-search"))return"anywhere";if(this.searchFormWrapper.is(".continent-search"))return"continents";if(b.options.useFlexDatePicker&&this.datePicker&&this.datePicker.getFlexCategory)return this.datePicker.getFlexCategory();var c=b.getChildElement("plusMinus3Days");return this.searchFormWrapper.hasClass("advanced")?this.flexCat:c.length&&c.is(":visible")&&c.is(":checked")?"plusminusthree":"exact"},
toggleAdvanced:function(){var c=this.state.start_date,a=this.state.end_date;b.options.useLegacyDatePicker&&(c&&(this.daterangePicker.getWidget().setStartDate(c),this.advancedDaterangePicker.getWidget().setStartDate(c),0<this.openflexDaterangePicker.length&&this.openflexDaterangePicker.getWidget().setStartDate(c)),a&&(this.daterangePicker.getWidget().setEndDate(a),this.advancedDaterangePicker.getWidget().setEndDate(a)));c=!this.searchFormWrapper.hasClass("advanced");this.searchFormWrapper.toggleClass("advanced",
c);b.element.find("#toggleAdvanced").attr("aria-pressed",c);b.getChildElement("openAdvancedLink").attr("aria-hidden",!c);b.getChildElement("closeAdvancedLink").attr("aria-hidden",c);c&&b.getChildElement("flexCat").focus();g.events.publish("flights.search.flightSearchForm.toggleAdvanced");b.vsLog(c?"toggleview/showadvanced":"toggleview/showfewer");b.gaLog("advanced-options",c?"show":"hide")},setFlexCategory:function(c){this.flexCat=c;h(".flexCatBlock",b.element).removeClass("exact weekend plusminusthree openflex").addClass(c);
b.vsLog("flexdates/dayofweek/"+c);b.gaLog("select-flextype",c)},bindFlexDisplayCat:function(){var c=this;"undefined"!==typeof this.flexCategoryRadio.radioButtonSet&&this.flexCategoryRadio.radioButtonSet({change:function(a,b){c.setFlexCategory(a.value)}})},bindPlusMinusThreeOptions:function(){var c=this;a(b.getChildElement("plusMinusThreeDepart"),function(a,e){c.state.plusMinusThreeDepart=a.value;e||(b.vsLog("dayofweek/depart/plusminusthree/"+a.value),b.gaLog("select-flexrange-depart",a.value))});
a(b.getChildElement("plusMinusThreeReturn"),function(a,e){c.state.plusMinusThreeReturn=a.value;e||(b.vsLog("dayofweek/arrive/plusminusthree/"+a.value),b.gaLog("select-flexrange-return",a.value))})},bindWeekendOptions:function(){var c=this;a(b.getChildElement("weekendDepartDate"),function(a,e){c.state.weekendDepartDate=a.value;e||(b.vsLog("dayofweek/depart/weekends/month/"+a.value),b.gaLog("select-weekend-month","upcoming, "+a.value))});a(b.getChildElement("weekendDepart"),function(a,e){c.state.weekendDepart=
a.value;e||(b.vsLog("dayofweek/depart/weekends/days/from/"+a.value),b.gaLog("select-weekend-depart",a.value))});a(b.getChildElement("weekendReturn"),function(a,e){c.state.weekendReturn=a.value;e||(b.vsLog("dayofweek/depart/weekends/days/to/"+a.value),b.gaLog("select-weekend-return",a.value))})},bindOpenflexOptions:function(){var c=this,a=b.getChildElement("flexLengthOfStay"),e=b.getChildElement("nightsAtDestination");a.on("focus",function(){e.hide()}).on("blur",function(){e.show();b.vsLog("daysofweek/depart/flexmonth/choosestaylength");
b.gaLog("select-flexmonth",a.val())}).on("change",function(){c.triggerChangeLengthOfStay(a.val())});c.flexSignUp.off("click").on("click",function(){g.authentication.showSignup({promo:"flexDatesSignUpPromo"})});c.flexSignIn.off("click").on("click",function(){g.authentication.showLogin({promo:"flexDatesSignUpPromo"})})},bindNearbyCheckboxes:function(){var c=this;w(b.getChildElement("nearbyOriginCheckRtow"),function(a){c.triggerChangeNearbyOrigin(a)});w(b.getChildElement("nearbyDestinationCheckRtow"),
function(a){c.triggerChangeNearbyDestination(a)})},validate:function(){var c=[],c=c.concat(b.getLocationValidationMessages(0,this.getOriginAirportCode(),this.getDestinationAirportCode())),a=this.getFlexCategory();"weekend"!==a&&"openflex"!==a&&"anywhere"!==a&&(c=this.oneway?c.concat(b.getDateValidationMessages(0,!0,this.state.start_date)):c.concat(b.getDateValidationMessages(0,!1,this.state.start_date,this.state.end_date)));return c=c.concat(b.getTravelerValidationMessages())},originCodeVal:function(){1===
arguments.length&&this.originCodeInput.val(arguments[0]);return this.originCodeInput.val()},getOriginAirportCode:function(){return v(this.state.origin)||t(this.state.originCode)},originLocationVal:function(){1===arguments.length&&this.originInput.val()!==arguments[0]&&this.originInput.val(arguments[0]);return this.originInput.val()},destinationCodeVal:function(){1===arguments.length&&this.destCodeInput.val(arguments[0]);return this.destCodeInput.val()},getDestinationAirportCode:function(){return v(this.state.destination)||
t(this.state.destinationCode)},destinationLocationVal:function(){1===arguments.length&&this.destInput.val()!==arguments[0]&&this.destInput.val(arguments[0]);return this.destInput.val()},serialize:function(){var c={},a=m(this.state.start_date),e=m(this.state.end_date);c.isMulticity=!1;var d=this.getFlexCategory(),l={},r="continents"===d,p="anywhere"===d||r;if(b.options.useFlexDatePicker&&!p)switch(l=this.datePicker.getFlexDatesData(p),l.flex_category){case "exact":case "plusminusthree":a.isValid()&&
(l.depart_date=a.format(g.globals.apiDateFormat));!this.oneway&&e.isValid()&&(l.return_date=e.format(g.globals.apiDateFormat));break;case "weekend":a.isValid()&&(m(a).startOf("month").isSameOrBefore(m())?l.weekend_depart_date="WEEKEND":l.weekend_depart_date=a.format("YYYY-MM-DD"));break;case "openflex":a.isValid()&&(l.openflex_depart_date=a.toDate())}else l.flex_category=d,"exact"===d||"plusminusthree"===d?(a.isValid()&&(l.depart_date=a.format(g.globals.apiDateFormat)),!this.oneway&&e.isValid()&&
(l.return_date=e.format(g.globals.apiDateFormat)),"plusminusthree"===d&&(l.depart_date_flex=this.state.plusMinusThreeDepart,this.oneway||(l.return_date_flex=this.state.plusMinusThreeReturn))):"weekend"===d?(l.weekend_depart_date=this.state.weekendDepartDate,l.weekend_depart=this.state.weekendDepart,l.weekend_return=this.state.weekendReturn):"openflex"===d&&(l.openflex_depart_date=this.state.openflexDepartDate,l.openflex_length_of_stay=this.state.openflexLengthOfStay);g.config.getBoolean("ui.horizon.flights.search.openExploreWithExactDates",
!1)&&p&&(a.isValid()&&(l.depart_date=a.format("YYYYMMDD")),!this.oneway&&e.isValid()&&(l.return_date=e.format("YYYYMMDD")));h.extend(c,l);p&&(b.getChildElement("anymonth").length?(d=b.getChildElement("anymonth").getWidget().getValue(),""!=d&&(c.depart_date_canon=d.split(",")[0],c.return_date_canon=d.split(",")[1],c.depart_date=m(c.depart_date_canon,"YYYYMMDD").format(g.globals.apiDateFormat),c.return_date=m(c.return_date_canon,"YYYYMMDD").format(g.globals.apiDateFormat))):g.config.getBoolean("ui.explore-dropdown-on-ffd.enabled",
!1)&&(c.anywhereRange=g.question.ask("ExploreFlexDatesDropdown.range"),c.anywhereDuration=g.question.ask("ExploreFlexDatesDropdown.duration"),c.anywhereOccasion=g.question.ask("ExploreFlexDatesDropdown.occasion")),r&&(c.continentId=this.state.destinationCode));c.oneway=this.oneway;c.origin=c.origincode=this.getOriginAirportCode();c.origin_location=this.state.origin;c.origin_code=this.state.originCode;c.legCount=c.oneway?1:2;c.nearby_origin=this.state.nearby_origin;p||(c.destination=c.destinationcode=
this.getDestinationAirportCode(),c.destination_location=this.state.destination,c.destination_code=this.state.destinationCode,c.nearby_destination=this.state.nearby_destination,null!==y.exec(c.destination)?c.freeRegionId=parseInt(c.destination.replace(/[A-z]+/,"")):null!==/[0-9]+[r]{1,2}/.exec(c.destination)?c.regionId=parseInt(c.destination.replace(/[A-z]+/,"")):c.countrySearch=x(c.destination),a.isValid()&&(c.depart_date_canon=m(this.state.start_date).format("YYYY-MM-DD")),!this.oneway&&e.isValid()&&
(c.return_date_canon=m(this.state.end_date).format("YYYY-MM-DD")));b.serializeTravelers(c);return c},initState:function(a){a=a||{};this.triggerChangeOrigin();this.triggerChangeDestination();this.triggerChangeDateRange();this.triggerChangeNearbyOrigin(a.nearby_origin,b.options.isNearbyInSmarty);this.triggerChangeNearbyDestination(a.nearby_destination,b.options.isNearbyInSmarty);this.triggerChangeLengthOfStay(a.openflex_length_of_stay);b.options.useFlexDatePicker&&!b.options.regionSearch&&"anywhere"!==
a.flex_category&&(b.options.useFlexRadioButtons&&(a=this.datePicker.getRadioButtonSimplifiedFlexData(a)),this.datePicker.loadFlexData(a));b.options.flexDatesSignUpPromoEnabled&&"exact"!==b.options.flex_category&&(g.Analytics.api.trackEvent({category:"flexDatesSignUpPromo",action:"open",label:b.options.flex_category}),this.toggleAdvanced(),this.flexCategoryRadio.getWidget().focusRadio())},onCmp2GoodToLoad:function(a){return g.config.getBoolean("ui.flights.form.cmp2.allPass",!1)||!a||!a.hasOwnProperty("originLocation")&&
!a.hasOwnProperty("destinationLocation")?!0:!!(a.originLocation&&a.originCode||a.destinationLocation&&a.destinationCode)},onChangeOrigin:function(a){this.originLocationVal(a.originLocation);this.originCodeVal(a.originCode);0===a.originCode.length&&a.originLocation.match(/^[A-z]{3}$/)&&this.originCodeVal(a.originLocation);this.state.origin=this.originLocationVal()||"";this.state.originCode=this.originCodeVal()||"";a.refreshNearby&&b.setNearbyWrapperVisibility(this.state.origin,".rtow .originBlock .nearbyWrapper")},
triggerChangeOrigin:function(a,f,e,d){var c=h.extend({},b.eventDataTemplate),k=this;c.originLocation=q(a,function(){return k.originLocationVal()});c.originCode=q(f,function(){return k.originCodeVal()});c.refreshNearby=!(""===a&&""===f);c.item=e;c.odSwitch=d;b.disableDestinationFocusAfterAjax&&(c.disableDestinationFocusAfterAjax=!0);b.options.slideCMP2Everywhere||b.slideCompareToUpdateDisplay(c.originCode);g.events.publish(b.events.rtowOrigin,c);f=h.extend({},c);f.legIndex=0;g.events.publish(b.events.multiOrigin,
f);a&&(b.vsLog("location/origin"),b.gaLog("select-origin"))},onChangeDestination:function(a){this.destinationLocationVal(a.destinationLocation);this.destinationCodeVal(a.destinationCode);0===a.destinationCode.length&&a.destinationLocation.match(/^[A-z]{3}$/)&&this.destinationCodeVal(a.destinationLocation);this.state.destination=this.destinationLocationVal()||"";this.state.destinationCode=this.destinationCodeVal()||"";a.refreshNearby&&b.setNearbyWrapperVisibility(this.state.destination,".rtow .destinationBlock .nearbyWrapper")},
triggerChangeDestination:function(a,f,e,d){var c=h.extend({},b.eventDataTemplate),k=this;c.destinationLocation=q(a,function(){return k.destinationLocationVal()});c.destinationCode=q(f,function(){return k.destinationCodeVal()});c.refreshNearby=!(""===a&&""===f);c.item=e;c.odSwitch=d;g.events.publish(b.events.rtowDestination,c);f=h.extend({},c);f.legIndex=0;g.events.publish(b.events.multiDestination,f);a&&(b.vsLog("location/destination"),b.gaLog("select-destination"))},onChangeDateRange:function(a){if(b.options.useLegacyDatePicker){var c=
this.daterangePicker.getWidget();c.setStartDate(a.startDate);c.setEndDate(a.endDate);0<this.advancedDaterangePicker.length&&(c=this.advancedDaterangePicker.getWidget(),c.setStartDate(a.startDate),c.setEndDate(a.endDate));0<this.openflexDaterangePicker.length&&(c=this.openflexDaterangePicker.getWidget(),c.setStartDate(a.startDate),c=c.getStartDate())&&(c=m(c).add(1,"month").subtract(1,"day"),c=c.format("ddd M/D"),c=replaceArgs(b.options.msg.openflexToDateWithLengthIntro,c),this.openflexCalcReturnDate.text(c))}else c=
this.returnDate.getDate(),"undefined"!==typeof a.startDate&&this.departDate.setDate(a.startDate),"undefined"!==typeof a.endDate?null!==a.endDate&&m(a.startDate).isSameOrBefore(m(a.endDate))?this.returnDate.setDate(a.endDate):this.returnDate.setDate(null):null!==c&&c.isSameOrBefore(m(a.startDate))&&this.returnDate.setDate(null),b.options.flexMonthEnabled&&(c=m(c).add(1,"month").subtract(1,"day"),c=c.format("ddd M/D"),c=replaceArgs(b.options.msg.openflexToDateWithLengthIntro,c),this.openflexCalcReturnDate.text(c));
a.startDate&&(this.state.openflexDepartDate=a.startDate,this.state.start_date=a.startDate);a.endDate&&(this.state.end_date=a.endDate);b.vsLog("dropoffdate");b.gaLog("select-date","depart:"+m(this.state.start_date).format("MMM Do YY")+", return:"+m(this.state.end_date).format("MMM Do YY"))},triggerChangeDateRange:function(a,f){var c=this,d=m(a);null!==a&&void 0!==a&&d.isValid()&&(a=d);d=m(f);null!==f&&void 0!==f&&d.isValid()&&(f=d);d=h.extend({},b.eventDataTemplate);if(b.options.useLegacyDatePicker){var l=
this.daterangePicker.getWidget();d.startDate=q(a,function(){return l.getStartDate()});d.endDate=q(f,function(){return l.getEndDate()})}else d.startDate=q(a,function(){return c.departDate.getDate()}),d.endDate=q(f,function(){return c.returnDate.getDate()});g.events.publish(b.events.rtowDateRange,d)},onChangeNearbyOrigin:function(a){A(b.getChildElement("nearbyOriginCheckRtow"),a.includeNearbyOrigin);this.state.nearby_origin=a.includeNearbyOrigin},triggerChangeNearbyOrigin:function(a,f){var c=h.extend({},
b.eventDataTemplate);c.includeNearbyOrigin=q(a,function(){var a=b.getChildElement("nearbyOriginCheckRtow");return 1>a.length?!1:a[0].checked});g.events.publish(b.events.rtowNearbyOrigin,c);f&&this.originInput.getWidget().setIsNearbyChecked(c.includeNearbyOrigin);b.vsLog("location/addnearby/"+(c.includeNearbyOrigin?"on":"off"));b.gaLog("add-nearby",c.includeNearbyOrigin?"on-"+this.originLocationVal():"off-"+this.originLocationVal())},onChangeNearbyDestination:function(a){A(b.getChildElement("nearbyDestinationCheckRtow"),
a.includeNearbyDestination);this.state.nearby_destination=a.includeNearbyDestination},triggerChangeNearbyDestination:function(a,f){var c=h.extend({},b.eventDataTemplate);c.includeNearbyDestination=q(a,function(){var a=b.getChildElement("nearbyDestinationCheckRtow");return 1>a.length?!1:a[0].checked});g.events.publish(b.events.rtowNearbyDestination,c);f&&this.destInput.getWidget().setIsNearbyChecked(c.includeNearbyDestination);b.vsLog("location/addnearby/"+(c.includeNearbyOrigin?"on":"off"));b.gaLog("add-nearby",
c.includeNearbyDestination?"on-"+this.destinationLocationVal():"off-"+this.destinationLocationVal())},onChangeLengthOfStay:function(a){var c=b.getChildElement("flexLengthOfStay");c.val()!==a.lengthOfStay&&c.val(a.lengthOfStay);this.state.openflexLengthOfStay=a.lengthOfStay},triggerChangeLengthOfStay:function(a){var c=h.extend({},b.eventDataTemplate);c.lengthOfStay=a||"6-8";g.events.publish(b.events.rtowLengthOfStay,c)},onOriginDepartureSwitch:function(a){if(b.id()===a.id||!0===b.options.sync){a=this.destInput.val();
var c=this.destCodeInput.val();g.config.getBoolean("ui.horizon.flights.smarty.od.switch.validate.enabled",!0)&&/^\d+[r|fr|cy]+$|^any$|^[A-Z]{2}cg$/.test(this.destCodeInput[0].value)&&(c=a="");var e=this.originInput.val();this.originInput.val(a);this.destInput.val(e);e=this.originCodeInput.val();this.originCodeInput.val(c);this.destCodeInput.val(e);this.triggerChangeDestination(null,null,null,!0);this.triggerChangeOrigin(null,null,null,!0);a=b.getChildElement("nearbyOriginCheckRtow");c=b.getChildElement("nearbyDestinationCheckRtow");
a.is(":checked")!==c.is(":checked")&&(a.click(),c.click());b.loadCompareToItems()}},buildSearchURL:function(a){var c={},e={originId:a.origin,destinationId:a.destination,originLocation:a.origin_location,originCountry:a.originCountry,destinationLocation:a.destination_location,includeNearbyOrigin:a.nearby_origin,includeNearbyDestination:a.nearby_destination,cabinClass:a.cabin,baggageCount:a.baggageCount,departDate:a.depart_date_canon,returnDate:a.return_date_canon,plusMinusThreeDepart:a.depart_date_flex,
plusMinusThreeReturn:a.return_date_flex,adults:a.adults,seniors:a.seniors,youth:a.youth,child:a.child,seatInfants:a.seatInfant,lapInfants:a.lapInfant,weekendDepartDate:a.weekend_depart_date,weekendDepart:a.weekend_depart,weekendReturn:a.weekend_return,openflexDepartDate:a.openflex_depart_date,openflexLengthOfStay:a.openflex_length_of_stay,relativeUrl:a.relativeUrl};g.config.getBoolean("ui.explore-dropdown-on-ffd.enabled",!1)&&(e.anywhereDuration=a.anywhereDuration,e.anywhereOccasion=a.anywhereOccasion,
e.anywhereRange=a.anywhereRange);b.options.showStudents&&(e.students=a.students);n(a.airlineFilter)||(e.airlineFilter=a.airlineFilter);e.regionSearch=b.options.regionSearchEnabled&&a.destination&&(y.exec(a.destination)||x(a.destination));(a=b.getDirectOptionValue())&&(c=h.extend(c,a));e.hostUrl=b.options.hostUrl;b.searchFormFilterState=h.isEmptyObject(c)?null:c;return g.flights.search.FlightSearchFormUrls.generateRtowFlightsUrl(e,this.getFlexCategory(),this.oneway,c)},bindAdvanced:function(){this.bindWeekendOptions();
this.bindOpenflexOptions();this.bindPlusMinusThreeOptions();this._extendRadionButton(this.flexCategoryRadio.getWidget())},bindFlexDatePicker:function(){b.subscribe("DatePicker.update",{updateGroup:"RTOWDates"},this.onFlexDatePickerUpdate.bind(this))},onFlexDatePickerUpdate:function(a){if(a.flex)switch(a.flex){case "plusminusthree":case "exact":this.searchFormWrapper.removeClass("show-flex-display");break;case "weekend":case "openflex":this.searchFormWrapper.addClass("show-flex-display")}},bindAll:function(){var a=
this,f=b.element.find("#toggleAdvanced");f.click(function(){a.toggleAdvanced()});f.keydown(function(c){c.which===g.globals.keyCodes.RETURN&&a.toggleAdvanced()});this.bindFlexDisplayCat();!0!==b.options.disabledAdvanced?this.bindAdvanced():b.options.useFlexDatePicker&&this.bindFlexDatePicker();this.bindNearbyCheckboxes();b.bindFlightSmartyFields(this.originInput,!0,h.proxy(this.triggerChangeOrigin,this));b.bindFlightSmartyFields(this.destInput,!1,h.proxy(this.triggerChangeDestination,this));b.options.useLegacyDatePicker?
(f=this.daterangePicker.add(this.advancedDaterangePicker).add(this.openflexDaterangePicker),b.bindDaterangePicker(f,h.proxy(this.triggerChangeDateRange,this))):(b.bindDaterangePicker(this.datePicker,h.proxy(this.triggerChangeDateRange,this)),this.flexDatePicker&&b.bindDaterangePicker(this.flexDatePicker,h.proxy(this.triggerChangeDateRange,this)),b.options.flexMonthEnabled&&this.openFlexDatePicker&&b.bindDaterangePicker(this.openFlexDatePicker,h.proxy(this.triggerChangeDateRange,this)));f=this.searchForm.closest(".viewport").find(".content");
b.initTravellersDropdown(this.travelerSelect,{content:h("."+b.travelerDialogClass,b.element),container:f.length?f:void 0});this.searchForm.find(".inlineDisplayView .changeButton").click(function(a){a.preventDefault();a.stopPropagation();b.setView("inlineform");return!1});if(b.wholeMonthSearch){if("undefined"!==typeof g.storage&&"wholeMonthSearch"===("undefined"!==typeof g.storage.get("daterangePickerDefaultNavTab")?g.storage.get("daterangePickerDefaultNavTab"):"specificDate")){var f=a.daterangePicker.getWidget(),
e=m().startOf("month").format("M"),d=m().startOf("year").format("Y");"undefined"!==typeof g.storage&&(null===g.storage.get("flexSelectedMonth")&&g.storage.set("flexSelectedMonth",m().format("M")),null===g.storage.get("flexSelectedYear")&&g.storage.set("flexSelectedYear",m().format("Y")),e=g.storage.get("flexSelectedMonth"),d=g.storage.get("flexSelectedYear"));e=new Date(d,e-1,1);m(e).isBefore(m())&&(e=m().add(1,"d").toDate());f.setStartDate(e);f.startDisplay.text("Select a month...")}b.subscribe("flights.search.rt.form.wholeMonthSelect.setWholeMonthCategory",
{group:"wholeMonthSelect"},function(){!0===a.oneway?(a.setOneWay(!0),jq(".tabWrapper.specificDate").click()):(a.setFlexCategory("openflex"),a.flexCategoryRadio.getWidget().setButtonCheckedByValue("openflex"),a.daterangePicker.getWidget().startDisplay.text("Select a month..."),a.searchFormWrapper.hasClass("advanced")||a.searchFormWrapper.addClass("advanced"),a.searchFormWrapper.hasClass("plusMinus")&&a.searchFormWrapper.removeClass("plusMinus"))});b.subscribe("flights.search.rt.form.wholeMonthSelect.setSpecificDateCategory",
{group:"wholeMonthSelect"},function(c){var e=!1;"undefined"!==typeof g.storage&&(e=g.storage.get("flexPlusMinusChecked",!0));e?(a.searchFormWrapper.hasClass("advanced")||a.searchFormWrapper.addClass("advanced"),a.searchFormWrapper.hasClass("plusMinus")||a.searchFormWrapper.addClass("plusMinus")):a.searchFormWrapper.removeClass("advanced plusMinus");a.daterangePicker.getWidget().updateDOM();a.setFlexCategory("plusminusthree");a.flexCategoryRadio.getWidget().setButtonCheckedByValue("plusminusthree");
var e=b.getChildElement("plusMinusThreeDepart").dropdown({}).getWidget(),f=b.getChildElement("plusMinusThreeReturn").dropdown({}).getWidget();c.hasOwnProperty("depart_date_flex")&&c.depart_date_flex&&(e.setValue(c.depart_date_flex),a.state.plusMinusThreeDepart=c.depart_date_flex);c.hasOwnProperty("return_date_flex")&&c.return_date_flex&&(f.setValue(c.return_date_flex),a.state.plusMinusThreeReturn=c.return_date_flex)});b.subscribe("flights.search.rt.form.wholeMonthSelect.enablePlusMinusSearch",{group:"wholeMonthSelect"},
function(){a.searchFormWrapper.hasClass("advanced plusMinus")||a.searchFormWrapper.addClass("advanced plusMinus")});b.subscribe("flights.search.rt.form.wholeMonthSelect.disablePlusMinusSearch",{group:"wholeMonthSelect"},function(){a.searchFormWrapper.hasClass("advanced plusMinus")&&a.searchFormWrapper.removeClass("advanced plusMinus")});b.subscribe("flights.search.rt.form.wholeMonthSelect",{group:"wholeMonthSelect"},function(c){var e=a.daterangePicker.getWidget();e.setStartDate(c.startDate);e.setEndDate(c.endDate);
0<a.advancedDaterangePicker.length&&(e=a.advancedDaterangePicker.getWidget(),e.setStartDate(c.startDate),e.setEndDate(c.endDate));0<a.openflexDaterangePicker.length&&(e=a.openflexDaterangePicker.getWidget(),e.setStartDate(c.startDate),e=e.getStartDate())&&(e=m(e).add(1,"month").subtract(1,"day"),e=e.format("ddd M/D"),e=replaceArgs(b.options.msg.openflexToDateWithLengthIntro,e),a.openflexCalcReturnDate.text(e));a.state.openflexDepartDate=c.startDate;a.state.start_date=c.startDate;a.state.end_date=
c.endDate});b.subscribe("flights.search.rt.form.noOfNightsChanged",{group:"wholeMonthSelect"},function(c){a.openflexLengthOfStay.val(c.noOfNights);a.state.openflexLengthOfStay=c.noOfNights})}b.subscribe(b.events.rtowOrigin,b.proxyEventCallback(this.onChangeOrigin,this,null,this.onCmp2GoodToLoad));b.subscribe(b.events.rtowDestination,b.proxyEventCallback(this.onChangeDestination,this,null,this.onCmp2GoodToLoad));b.subscribe(b.events.rtowDateRange,b.proxyEventCallback(this.onChangeDateRange,this,null,
this.onCmp2GoodToLoad));b.subscribe(b.events.rtowNearbyOrigin,b.proxyEventCallback(this.onChangeNearbyOrigin,this));b.subscribe(b.events.rtowNearbyDestination,b.proxyEventCallback(this.onChangeNearbyDestination,this));b.subscribe(b.events.rtowLengthOfStay,b.proxyEventCallback(this.onChangeLengthOfStay,this));b.subscribe("flights.search.swapLocations",this.onOriginDepartureSwitch.bind(this));this.originDepartureSwitch.on("click",{formId:b.id()},function(a){g.Analytics.api.trackEvent({category:"od-switch",
action:"click"});g.events.publish("flights.search.swapLocations",{id:a.data.formId})});this.originDepartureSwitch.on("keypress",{formId:b.id()},function(a){switch(a.which){case g.globals.keyCodes.SPACE:case g.globals.keyCodes.RETURN:a.preventDefault(),g.Analytics.api.trackEvent({category:"od-switch",action:"click"}),g.events.publish("flights.search.swapLocations",{id:a.data.formId})}})},setup:function(){this.bindAll();this.initialized=!0},activate:function(){this.initialized||this.setup();!0===this.oneway&&
this.setOneWay(!0);this.triggerChangeDateRange();b.updateTravelerDisplay();this.searchForm.addClass("active").attr("aria-hidden","false");if(b.element.is(".Flights-Search-StyleJamFlightSearchForm")){var a=g.stylejam.flights.search.StyleJamFlightSearchForm;g.dom.swapClasses(this.searchForm,a.searchFormHidden,a.searchFormVisible)}}},multi:{searchForm:b.getChildElement("multi-searchform"),travelerSelect:b.getChildElement("multi-travelers"),addMoreLegsLink:b.getChildElement("addMoreLegs"),clearAllLink:b.getChildElement("clearLegs"),
initialized:!1,indexLastVisibleLeg:b.options.backFromRP?b.options.multicityOptions.length-1:b.options.defaultLegsVisible-1,maxLegs:b.options.maxLegs,legState:{origin:"",destination:"",originCode:"",destinationCode:"",depart_date:null,depart_time:"a",cabin_type:"e",nearby_origin:!1,nearby_destination:!1},defaultLegState:b.options.multicityOptions,backFromRP:b.options.backFromRP,legStates:[],removeLeg:function(a){for(;a<(this.backFromRP?this.defaultLegState.length-1:this.maxLegs-1);a++)a<this.indexLastVisibleLeg?
this.copyLeg(a+1,a):(this._legAccessor(a).visible(!1),this.setLegWidgetValues(a,this.legState));this.setLegWidgetValues(a,this.legState);this._legAccessor(a).visible(!1);--this.indexLastVisibleLeg;this.addMoreLegsLink.show();b.vsLog("multicity/removeleg");b.gaLog("clear-multicity")},addLeg:function(){this.indexLastVisibleLeg<this.maxLegs-1&&(this.indexLastVisibleLeg+=1,this.setLegWidgetValues(this.indexLastVisibleLeg,this.legState),this._legAccessor(this.indexLastVisibleLeg).visible(!0));this.indexLastVisibleLeg>=
this.maxLegs-1&&this.addMoreLegsLink.hide();b.vsLog("multicity/addanotherflight");b.gaLog("select-add-another-flight")},updateLegState:function(a){var c=this._legAccessor(a);a=this.legStates[a];a.origin=c.origin();a.originCode=c.originCode();a.destination=c.destination();a.destinationCode=c.destinationCode();a.depart_date=c.departDate();a.depart_time=c.departTime();a.cabin_type=c.cabinType();a.nearby_origin=c.nearbyOrigin();a.nearby_destination=c.nearbyDestination()},setLegWidgetValues:function(a,
b){var c=this._legAccessor(a);c.origin(b.origin);c.destination(b.destination);c.originCode(b.originCode);c.destinationCode(b.destinationCode);c.departDate(b.depart_date);c.departTime(b.depart_time);c.cabinType(b.cabin_type);c.nearbyOrigin(b.nearby_origin);c.nearbyDestination(b.nearby_destination);this.updateLegState(a)},copyLeg:function(a,b){a=this._legAccessor(a);var c=this._legAccessor(b);c.origin(a.origin());c.destination(a.destination());c.originCode(a.originCode());c.destinationCode(a.destinationCode());
c.departDate(a.departDate());c.departTime(a.departTime());c.cabinType(a.cabinType());c.nearbyOrigin(a.nearbyOrigin());c.nearbyDestination(a.nearbyDestination());this.updateLegState(b)},validate:function(){for(var a=[],d=0;d<=this.indexLastVisibleLeg;d++){var e=this._legAccessor(d);if(!1===this.isLegEmpty(e)||0===d)this.updateLegState(d),e=this.validateLeg(d),!0!==e&&(a=a.concat(e))}return a=a.concat(b.getTravelerValidationMessages())},validateLeg:function(a){var c=this.legStates[a];a+=1;var e=[],
d=v(c.origin)||t(c.originCode),g=v(c.destination)||t(c.destinationCode),e=e.concat(b.getLocationValidationMessages(a,d,g));return e=e.concat(b.getDateValidationMessages(a,!0,c.depart_date,null))},serialize:function(){var a={};b.serializeTravelers(a);a.isMulticity=!0;for(var d=0,e=g.config.getBoolean("ui.flights.userhistory.usefulllocationcode",!0),k=g.config.getBoolean("ui.flights.mc.useMultiApCode",!0),l,h=0;h<=this.indexLastVisibleLeg;h++){var p=this._legAccessor(h);!1===this.isLegEmpty(p)&&(this.updateLegState(h),
p=this.legStates[h],e?(a["origin"+d]=a["origincode"+d]=p.originCode,a["destination"+d]=a["destinationcode"+d]=p.destinationCode):(a["origin"+d]=a["origincode"+d]=t(p.originCode),a["destination"+d]=a["destinationcode"+d]=t(p.destinationCode)),a["originLocation"+d]=p.origin,a["destinationLocation"+d]=p.destination,k&&((l=v(p.origin))&&(a["origin"+d]=a["origincode"+d]=l),(l=v(p.destination))&&(a["destination"+d]=a["destinationcode"+d]=l)),a["nearby_origin"+d]=p.nearby_origin,a["nearby_destination"+d]=
p.nearby_destination,l=p.depart_date,a["depart_date"+d]=m(l).format(g.globals.apiDateFormat),a["depart_date_canon"+d]=m(l).format("YYYY-MM-DD"),a["depart_time"+d]=p.depart_time,a["cabin_type"+d]=p.cabin_type,d+=1)}a.origin_location=a.originLocation0;a.origincode=a.origincode0;a.destination_location=a.destinationLocation0;a.destinationcode=a.destinationcode0;a.depart_date=a.depart_date0;a.nearby_origin=a.nearby_origin0;a.nearby_destination=a.nearby_destination0;a.nrLegs=a.legCount=d;return a},isLegEmpty:function(a){return n(a.originCode())&&
n(a.destinationCode())&&n(a.departDate())?!0:!1},buildSearchURL:function(a){var c={cabinClass:a.cabin,adults:a.adults,seniors:a.seniors,youth:a.youth,child:a.child,seatInfants:a.seatInfant,lapInfants:a.lapInfant,legData:[]};b.options.showStudents&&(c.students=a.students);for(var d=0;d<a.nrLegs;d++){var k={};k.originId=a["origin"+d];k.destinationId=a["destination"+d];k.originLocation=a["originLocation"+d];k.destinationLocation=a["destinationLocation"+d];k.includeNearbyOrigin=a["nearby_origin"+d];k.includeNearbyDestination=
a["nearby_destination"+d];k.departDate=a["depart_date_canon"+d];k.departTime=a["depart_time"+d];k.legCabinClass=a["cabin_type"+d];c.legData[d]=k}n(a.airlineFilter)||(c.airlineFilter=a.airlineFilter);c.hostUrl=b.options.hostUrl;return g.flights.search.FlightSearchFormUrls.generateMultiCityFlightsUrl(c,a.nrLegs)},_legAccessor:function(a){function c(a,b){void 0!==b&&b!==a.val()&&a.val(b);return a.val()}function d(c){return b.getChildElement(c+a)}function g(a,b){if(!a||!a.length)return!1;void 0!==b&&
A(a,b);return a[0].checked}return{origin:function(a){return c(d("origin"),a)},destination:function(a){return c(d("destination"),a)},originCode:function(a){return c(d("origincode"),a)},destinationCode:function(a){return c(d("destinationcode"),a)},departDate:function(a){if(b.options.useLegacyDatePicker){var c=d("depart_date").getWidget();void 0!==a&&c.setStartDate(a);return c.getStartDate()}c=d("departDate").getWidget();void 0!==a&&c.setDate(a);return c.getDate()},departTime:function(a){var b=d("depart_time").getWidget();
if(!b)return"";void 0!==a&&b.setValue(a);return b.getValue()},cabinType:function(a){var b=d("cabin_type").getWidget();if("undefined"===typeof b)return"";void 0!==a&&b.setValue(a);return b.getValue()},nearbyOrigin:function(a){return g(d("nearbyOriginCheck"),a)},nearbyDestination:function(a){return g(d("nearbyDestinationCheck"),a)},visible:function(a){var b=d("multiCityLeg");!1!==a?(b.removeClass("hiddenLeg"),b.find("input").first().focus()):b.addClass("hiddenLeg");return!b.hasClass("hiddenLeg")}}},
initTravellerDropdown:function(a){var c=this;b.initTravellersDropdown(this.travelerSelect,{container:a.length?a:void 0,content:h("."+b.travelerDialogClass,b.element),onOpen:function(a){c.searchForm.is(".mixedcabins")&&a.content.addClass("mixedcabins");if(a.content.is(".Flights-Frontdoor-StyleJamTravelersDialog-Content")){a=h(a.content).find(".cabinWrapper-js");var b=g.stylejam.flights.search.StyleJamFlightSearchForm;g.dom.swapClasses(a,b.searchFormVisible,b.searchFormHidden)}},onClose:function(a,
b){b.content.removeClass("mixedcabins");b.content.is(".Flights-Frontdoor-StyleJamTravelersDialog-Content")&&(a=h(b.content).find(".cabinWrapper-js"),b=g.stylejam.flights.search.StyleJamFlightSearchForm,g.dom.swapClasses(a,b.searchFormHidden,b.searchFormVisible))}})},setup:function(){for(var a=this,f=0;f<this.maxLegs;f++)this.legStates.push(h.extend({},this.backFromRP&&f<this.defaultLegState.length?this.defaultLegState[f]:this.legState)),function(a,c,f){function e(a,c){var d=m(a._legAccessor(c).departDate());
if(null!=d)for(c+=1;c<b.options.maxLegs;c++){var f=a._legAccessor(c),e=m(f.departDate());null!=e&&e.isBefore(d)&&f.departDate(null)}}function g(c){var d,e;for(e=a-1;0<=e;e--)if(d=f._legAccessor(e).departDate(),null!=d){b.options.useLegacyDatePicker?c.minDate=d:c.setMinDate(d);break}}if(b.options.useLegacyDatePicker){var k=b.getChildElement("depart_date"+a);b.bindDaterangePicker(k,null,{getFormData:function(){var b=f.serialize();return{vertical:"flights",origin:b["origincode"+a],destination:b["destinationcode"+
a],isOneWay:b.oneway}},useDaysFormat:!0,singleDateMode:!0,singlePickerWithSingleField:!0,minDateFunc:g,change:function(){f.triggerChangeDepartDate(this.getStartDate(),a);e(f,a)},skipForceSetDefaultStartOnFocusBlur:!0});k.getWidget().singleDateMode=!0;if(0===a||null!=c.departDate)c.depart_date=null!=c.departDate?m(c.departDate):k.getWidget().getStartDate()}else if(k=b.getChildElement("departDate%s".format(a)).getWidget(),b.bindDaterangePicker(k,null,{getFormData:function(){var b=f.serialize();return{vertical:"flights",
origin:b["origincode"+a],destination:b["destinationcode"+a],isOneWay:b.oneway}},minDateFunc:g,change:function(b){f.triggerChangeDepartDate(b.date,a);e(f,a)}}),0===a||null!=c.departDate)c.depart_date=null!=c.departDate?m(c.departDate):void 0;k=b.getChildElement("depart_time"+a);d(k,function(c){f.triggerChangeDepartTime(c.value,a);b.vsLog("multicity/choosetime/"+c.value);b.gaLog("select-multicitytime")});w(b.getChildElement("nearbyOriginCheck"+a),function(c){f.triggerChangeNearbyOrigin(c,a);b.vsLog("location/addnearby/"+
(c?"on":"off"));b.gaLog("add-nearby",c?"on-"+f._legAccessor(a).origin():"off-"+f._legAccessor(a).origin())});w(b.getChildElement("nearbyDestinationCheck"+a),function(c){f.triggerChangeNearbyDestination(c,a);b.vsLog("location/addnearby/"+(c?"on":"off"));b.gaLog("add-nearby",c?"on-"+f._legAccessor(a).destination():"off-"+f._legAccessor(a).destination())});k=b.getChildElement("cabin_type"+a);d(k,function(c){f.triggerChangeLegCabinType(c.value,a);b.vsLog("multicity/chooselegcabintype/"+c.value);b.gaLog("select-multicitytlegcabintype")});
["removeLegTop","removeLegBottom"].forEach(function(c){b.getChildElement(c+a).click(function(){f.triggerRemoveLeg(a)})},this);b.getChildElement("removeLeg"+a).click(function(){f.triggerRemoveLeg(a)});var k=b.getChildElement("origin"+a),l=b.getChildElement("destination"+a),n=function(a,b){return function(c,d){b.triggerChangeOrigin(c,d,a)}}(a,f),q=function(a,b){return function(c,d){b.triggerChangeDestination(c,d,a)}}(a,f),t=function(a,b){return function(c){b.triggerChangeNearbyOrigin(c,a)}}(a,f),u=
function(a,b){return function(c){b.triggerChangeNearbyDestination(c,a)}}(a,f);b.bindFlightSmartyFields(k,!1,n,t,function(a){var c,d=a.prop("id").match(/^.*?-(?:destination|origin)(\d+)$/);2===d.length&&(c=d[1]);return function(d,f){if(!d.elementNode.value&&(!f||8!==f.keyCode&&46!==f.keyCode)&&c&&0<c){f=b._getAirportCodeField(a);var e=c-1,g=b.getChildElement("destination"+e),e=b.getChildElement("destinationcode"+e);d.elementNode.value=g.val();f.val(e.val());d.elementNode.focus();h(this).select()}}});
b.bindFlightSmartyFields(l,!0,q,u);f.setLegWidgetValues(a,c)}(f,this.legStates[f],this);f=this.searchForm.closest(".viewport").find(".content");this.initTravellerDropdown(f);this.addMoreLegsLink.click(function(b){a.triggerAddLeg();b.preventDefault?b.preventDefault():b.returnValue=!1});this.clearAllLink.keypress(function(b){b.preventDefault();switch(b.which){case g.globals.keyCodes.SPACE:case g.globals.keyCodes.RETURN:a.clearAllLink.click()}});this.clearAllLink.click(function(b){for(var c=0;c<=a.indexLastVisibleLeg;c++){var d=
a.legStates[c];d.origin="";d.originCode="";d.destination="";d.destinationCode="";d.depart_date="";d.depart_time="";d.cabin_type="";d.nearby_origin="";d.nearby_destination="";a.setLegWidgetValues(c,d)}b.preventDefault()});b.subscribe(b.events.multiOrigin,this.multiProxyEventCallback(this.onChangeOrigin,this));b.subscribe(b.events.multiDestination,this.multiProxyEventCallback(this.onChangeDestination,this));b.subscribe(b.events.multiDepartDate,this.multiProxyEventCallback(this.onChangeDepartDate,this));
b.subscribe(b.events.multiDepartTime,this.multiProxyEventCallback(this.onChangeDepartTime,this));b.subscribe(b.events.multiNearbyOrigin,this.multiProxyEventCallback(this.onChangeNearbyOrigin,this));b.subscribe(b.events.multiNearbyDestination,this.multiProxyEventCallback(this.onChangeNearbyDestination,this));b.subscribe(b.events.multiLegCabinType,this.multiProxyEventCallback(this.onChangeLegCabinType,this));b.subscribe(b.events.multiRemoveLeg,this.multiProxyEventCallback(this.onRemoveLeg,this));b.subscribe(b.events.multiAddLeg,
this.multiProxyEventCallback(this.onAddLeg,this));this.initialized=!0},multiProxyEventCallback:function(a,d){return b.proxyEventCallback(a,d,function(a){return b.id()===a.id||!0===b.options.sync&&(0===a.legIndex||b.options.mixedCabinsUI&&1===a.legIndex)},function(){return!1})},activate:function(){this.initialized||this.setup();b.updateTravelerDisplay();for(var a=0;a<this.indexLastVisibleLeg;a++)if("any"===this._legAccessor(a).destinationCode()){var d=this.legStates[a];d.destination="";d.destinationCode=
"";this.setLegWidgetValues(a,d)}this.searchForm.addClass("active").attr("aria-hidden","false");b.element.is(".Flights-Search-StyleJamFlightSearchForm")&&(a=g.stylejam.flights.search.StyleJamFlightSearchForm,g.dom.swapClasses(this.searchForm,a.searchFormHidden,a.searchFormVisible))},initState:function(){for(var a=0;a<(this.backFromRP?this.defaultLegState.length:this.maxLegs);a++)this.triggerChangeOrigin(void 0,void 0,a),this.triggerChangeDestination(void 0,void 0,a),this.triggerChangeDepartDate(void 0,
a),this.triggerChangeDepartTime(void 0,a),this.triggerChangeNearbyOrigin(void 0,a),this.triggerChangeNearbyDestination(void 0,a)},onChangeOrigin:function(a){var b=this._legAccessor(a.legIndex);b.origin(a.originLocation);b.originCode(a.originCode);0===a.originCode.length&&a.originLocation.match(/^[A-z]{3}$/)&&b.originCode(a.originLocation);a=this.legStates[a.legIndex];a.origin=b.origin();a.originCode=b.originCode()},triggerChangeOrigin:function(a,d,e){var c=h.extend({},b.eventDataTemplate),f=this._legAccessor(e);
c.originLocation=q(a,function(){return f.origin()});c.originCode=q(d,function(){return f.originCode()});c.legIndex=e;c.refreshNearby=!(""===a&&""===d);b.disableDestinationFocusAfterAjax&&(c.disableDestinationFocusAfterAjax=!0);g.events.publish(b.events.multiOrigin,c);0===e&&g.events.publish(b.events.rtowOrigin,c);a&&(b.vsLog("location/origin"),b.gaLog("select-origin"))},onChangeDestination:function(a){var b=this._legAccessor(a.legIndex);b.destination(a.destinationLocation);b.destinationCode(a.destinationCode);
0===a.destinationCode.length&&a.destinationLocation.match(/^[A-z]{3}$/)&&b.destinationCode(a.destinationLocation);a=this.legStates[a.legIndex];a.destination=b.destination();a.destinationCode=b.destinationCode()},triggerChangeDestination:function(a,d,e){var c=h.extend({},b.eventDataTemplate),f=this._legAccessor(e);c.destinationLocation=q(a,function(){return f.destination()});c.destinationCode=q(d,function(){return f.destinationCode()});c.legIndex=e;c.refreshNearby=!(""===a&&""===d);g.events.publish(b.events.multiDestination,
c);0===e&&g.events.publish(b.events.rtowDestination,c);a&&(b.vsLog("location/destination"),b.gaLog("select-destination"))},onChangeDepartDate:function(a){var b=this._legAccessor(a.legIndex);b.departDate(a.departDate);this.legStates[a.legIndex].depart_date=b.departDate()},triggerChangeDepartDate:function(a,d){var c=h.extend({},b.eventDataTemplate),f=this._legAccessor(d);c.departDate=q(a,function(){return f.departDate()});c.legIndex=d;g.events.publish(b.events.multiDepartDate,c)},onChangeDepartTime:function(a){var b=
this._legAccessor(a.legIndex);b.departTime(a.departTime);this.legStates[a.legIndex].depart_time=b.departTime()},triggerChangeDepartTime:function(a,d){var c=h.extend({},b.eventDataTemplate),f=this._legAccessor(d);c.departTime=q(a,function(){return f.departTime()});c.legIndex=d;g.events.publish(b.events.multiDepartTime,c)},onChangeLegCabinType:function(a){var b=this._legAccessor(a.legIndex);b.cabinType(a.cabinType);this.legStates[a.legIndex].cabin_type=b.cabinType()},triggerChangeLegCabinType:function(a,
d){var c=h.extend({},b.eventDataTemplate),f=this._legAccessor(d);c.cabinType=q(a,function(){return f.cabinType()});c.legIndex=d;g.events.publish(b.events.multiLegCabinType,c)},onChangeNearbyOrigin:function(a){var b=this._legAccessor(a.legIndex);b.nearbyOrigin(a.includeNearbyOrigin);this.legStates[a.legIndex].nearby_origin=b.nearbyOrigin()},triggerChangeNearbyOrigin:function(a,d,e){var c=h.extend({},b.eventDataTemplate),f=this._legAccessor(d);c.includeNearbyOrigin=q(a,function(){return f.nearbyOrigin()});
c.legIndex=d;g.events.publish(b.events.multiNearbyOrigin,c);e&&b.getChildElement("origin"+d).getWidget().setIsNearbyChecked(c.includeNearbyOrigin)},onChangeNearbyDestination:function(a){var b=this._legAccessor(a.legIndex);b.nearbyDestination(a.includeNearbyDestination);this.legStates[a.legIndex].nearby_destination=b.nearbyDestination()},triggerChangeNearbyDestination:function(a,d,e){var c=h.extend({},b.eventDataTemplate),f=this._legAccessor(d);c.includeNearbyDestination=q(a,function(){return f.nearbyDestination()});
c.legIndex=d;g.events.publish(b.events.multiNearbyDestination,c);e&&b.getChildElement("destination"+d).getWidget().setIsNearbyChecked(c.includeNearbyDestination)},onRemoveLeg:function(a){this.removeLeg(a.legIndex);b.recalculateDialogDimensions()},triggerRemoveLeg:function(a){if(!0===b.options.autoRTFromMC&&1===this.legsShown()-1)b.triggerChangeDisplayCat("roundtrip");else{var c=h.extend({},b.eventDataTemplate);c.legIndex=a;g.events.publish(b.events.multiRemoveLeg,c)}},legsShown:function(){return h(".multiCityLeg:not(.hiddenLeg)",
b.element).length},onAddLeg:function(a){this.addLeg();b.recalculateDialogDimensions()},triggerAddLeg:function(){var a=h.extend({},b.eventDataTemplate);g.events.publish(b.events.multiAddLeg,a)}}}},adjustFormClass:function(){this.controllers.multi.searchForm&&(0===h(".multiCityLeg.hiddenLeg",this.element).length===!0?this.controllers.multi.searchForm.addClass("fullyExpand"):this.controllers.multi.searchForm.removeClass("fullyExpand"))},totalAdultCount:function(){return this.state.adults+this.state.seniors},
atMinTotalTravelers:function(){return 0>=this.state.travelers}})})(window.R9,window.jQuery,window.moment);(function(f,h){f.createComponentClass("flights.search.MultiCitySearchForm","base.search.SearchForm",{vertical:"flights",options:{smartyUrl:"/mv/marvel",searchParams:{},maxLegs:6,defaultLegsVisible:3,isBackFromRP:!1,phoenixRising:!1,formQuestion:"flights.fd.searchform.multicity",rtowFormQuestion:"flights.fd.searchform",autoRTFromMC:!1,useStyleJamCabinClass:!1,rtowSubmitButtonId:null},addLegButton:null,removeLegOnceButton:null,clearAllButton:null,infantInLapWarning:null,legElements:[],legStates:[],
defaultLegState:[],maxVisibleIndex:0,accessors:null,emptyLegState:{origin:"",destination:"",originCode:"",destinationCode:"",depart_date:null,depart_time:"a",flex_depart_date:null,nearby_origin:!1,nearby_destination:!1,cabin_type:"e"},init:function(a){this.base(a);this.accessors={};this.defaultLegState=this.options.searchParams;this.addLegButton=this.getChildElement("addMoreLegs");this.removeLegOnceButton=this.getChildElement("removeLegsOnce");this.clearAllButton=this.getChildElement("clearAll");
this.infantInLapWarning=this.getChildElement("infantInLapWarning");for(a=0;a<this.options.maxLegs;a++)this.setupLegElements(a)},addEventHandlers:function(){for(var a=this,b=0;b<this.options.maxLegs;b++)this.bindLegEvents(b);this.base();this.addLegButton.click(this.addLeg.bind(this));this.removeLegOnceButton&&this.removeLegOnceButton.click(this.removeLeg.bind(this,null));this.clearAllButton.click(this.clearLegs.bind(this));this.clearAllButton.keypress(function(b){b.preventDefault();switch(b.which){case f.globals.keyCodes.SPACE:case f.globals.keyCodes.RETURN:a.clearAllButton.click()}});
this.subscribe("intentmedia.submit.handler",h.proxy(this.onHookSubmitForIntentMedia,this));this.subscribe("flights.search.multicity.origin",this.onChangeOrigin.bind(this));this.subscribe("flights.search.multicity.destination",this.onChangeDestination.bind(this));this.subscribe("flights.search.multicity.departDate",this.onChangeDepartDate.bind(this));this.subscribe("flights.search.multicity.departTime",this.onChangeDepartTime.bind(this));this.subscribe("flights.search.multicity.cabinType",this.onChangeCabinType.bind(this));
this.subscribe("flights.search.multicity.nearbyOrigin",this.onChangeNearbyOrigin.bind(this));this.subscribe("flights.search.multicity.nearbyDestination",this.onChangeNearbyDestination.bind(this));this.subscribe("flights.search.multicity.addLeg",this.addLeg.bind(this));this.subscribe("flights.search.multicity.removeLeg",this.removeLeg.bind(this));this.subscribe("flights.search.multicity.activate",this.activate.bind(this));this.subscribe("flights.search.travelers.change",this.onChangeTravelers.bind(this));
this.subscribe("searchform.submit",function(b){b.id!==a.id()&&a.load(b)});this.answer(this.options.formQuestion,function(){return a.serialize()});this.answer("flights.searchform.multicity.first.leg.cabin",function(){return a.legStates[0].cabin_type});this.subscribe("resultspage.streaming.start",function(){a.isSubmitted=!1})},setupLegElements:function(a){var b={};b.element=this.getChildElement("multiCityLeg"+a);b.index=a;b.element.hasClass("hiddenLeg")||(this.maxVisibleIndex=a);b.originField=new f.flights.search.FlightAirportField(this.getChildElement("origin"+
a));b.originNearby=this.getChildElement("nearbyOriginCheck"+a);b.destinationField=new f.flights.search.FlightAirportField(this.getChildElement("destination"+a));b.destinationNearby=this.getChildElement("nearbyDestinationCheck"+a);b.departDatepickerEl=this.getChildElement("depart_date"+a);b.departTimeDropdownEl=this.getChildElement("depart_time"+a);b.cabinTypeDropdownEl=this.getChildElement("cabin_type"+a);0<b.index&&(b.removeLegBottom=this.getChildElement("removeLegBottom"+a),b.removeLegTop=this.getChildElement("removeLegTop"+
a));b.eventsBound=!1;this.legElements.push(b);this.legStates.push(h.extend({},a<this.defaultLegState.length?this.defaultLegState[a]:this.emptyLegState))},clearLegs:function(){for(var a=0;a<=this.maxVisibleIndex;a++){var b=this.legStates[a];b.origin="";b.originCode="";b.destination="";b.destinationCode="";b.depart_date="";b.depart_time="";b.nearby_origin="";b.nearby_destination="";b.cabin_type="";this.setLegWidgetValues(a,b)}},bindLegEvents:function(a){var b=this,c=this.legStates[a];this.bindLegDaterangePicker(a);
var d=this.legElements[a];0!==a&&this.isEmpty(c.departDate)||(c.depart_date=null!=c.departDate?moment(c.departDate):d.departDatepicker.getStartDate());d.departTimeDropdown=d.departTimeDropdownEl.dropdown({change:function(c){b.onChangeDepartTime({departTime:c.target.value,legIndex:a});f.Analytics.api.trackEvent({category:"multicity",action:"select",label:"departTime-"+a,value:c.target.value})}}).getWidget();var e=function(c){b.onChangeCabinType({cabinType:c.target.value,legIndex:a});f.Analytics.api.trackEvent({category:"multicity",
action:"select",label:"cabinType-"+a,value:c.target.value})};this.options.useStyleJamCabinClass?(d.cabinTypeDropdown=d.cabinTypeDropdownEl.getWidget(),d.cabinTypeDropdown&&(d.cabinTypeDropdown.options.change=e)):d.cabinTypeDropdown=d.cabinTypeDropdownEl.dropdown({change:e}).getWidget();d.originNearby.change(function(c){b.onChangeNearbyOrigin({includeNearbyOrigin:c.target.checked,legIndex:a})});d.destinationNearby.change(function(c){b.onChangeNearbyDestination({includeNearbyDestination:c.target.checked,
legIndex:a})});0<d.index&&(d.removeLegTop.click(this.removeLeg.bind(this,a)),d.removeLegBottom.click(this.removeLeg.bind(this,a)));var e=function(a,b){return function(c,d){if(!b.isEmpty(c))b.onChangeOrigin({originLocation:c,originCode:d,refreshNearby:!(""===c&&""===d),legIndex:a})}}(a,b),g=function(a,b){return function(c,d){if(!b.isEmpty(c))b.onChangeDestination({destinationLocation:c,destinationCode:d,refreshNearby:!(""===c&&""===d),legIndex:a})}}(a,b);this.bindAirportSmartyFields(d.originField,
!1,e);this.bindAirportSmartyFields(d.destinationField,!0,g);d.eventsBound=!0;this.setLegWidgetValues(a,c)},bindAirportSmartyFields:function(a,b,c){var d=this,e={dataSource:d.options.smartyUrl,setItem:function(a){return function(a,b,d){b&&setTimeout(function(){c(b.short_str||b.str,b.id)},100)}}(a.inputEl),clearItem:function(a){return function(a){setTimeout(function(){c(void 0,"")},1)}}(a.inputEl),beforeStart:function(a){var c;a=a.prop("id").match(/^.*?-(?:destination|origin)(\d+)/);2===a.length&&(c=
a[1]);return function(a,e){!a.elementNode.value&&!b&&(!e||8!==e.keyCode&&46!==e.keyCode)&&c&&0<c&&(e=d._legAccessor(c-1),a.elementNode.value=e.destination(),d._legAccessor(c).originCode(e.destinationCode()),a.elementNode.focus(),h(this).select())}}(a.inputEl),showBackgroundAutocomplete:f.config.getBoolean("ui.common.smarty.background.autocomplete.enabled",!1)};if(this.options.phoenixRising){var g=a.inputEl.data("inputModal");g&&(e.appendTo=g.getSmartyWrapper(),e.fixedDropdown=!0)}a.inputEl.airportSmarty(e)},
bindLegDaterangePicker:function(a){function b(b){var d,e;for(e=a-1;0<=e;e--)if(d=c._legAccessor(e).departDate(),null!=d){c.options.useLegacyDatePicker?b.minDate=d:b.setMinDate(d);break}}var c=this,d=this.legElements[a];this.options.useLegacyDatePicker?(d.departDatepicker=this.bindDaterangePicker(d.departDatepickerEl,null,{getFormData:function(){var a=c.serialize();return{vertical:"flights",origin:a.origincode,destination:a.destinationcode,isOneWay:a.oneway}},useDaysFormat:!0,singleDateMode:!0,singlePickerWithSingleField:!0,
minDateFunc:function(b){var d,e;for(e=a-1;0<=e;e--)if(d=c._legAccessor(e).departDate(),null!=d){b.minDate=d;break}},change:function(){c.onChangeDepartDate({departDate:this.getStartDate(),legIndex:a});c.checkAndResetConsecutiveDates(a)},skipForceSetDefaultStartOnFocusBlur:!0}),d.departDatepicker.singleDateMode=!0):(d.departDateInput=this.getChildElement("depart_date"+a).getWidget(),this.bindDaterangePicker(d.departDateInput,null,{getFormData:function(){var b=c.serialize();return{vertical:"flights",
origin:b["origincode"+a],destination:b["destinationcode"+a],isOneWay:b.oneway}},minDateFunc:b,change:function(b){c.onChangeDepartDate({departDate:b.date,legIndex:a});c.checkAndResetConsecutiveDates(a)}}))},checkAndResetConsecutiveDates:function(a){var b=moment(this._legAccessor(a).departDate());if(null!=b)for(a+=1;a<this.options.maxLegs;a++){var c=this._legAccessor(a),d=moment(c.departDate());null!=d&&d.isBefore(b)&&c.departDate(null)}},removeLeg:function(a){if(!0===this.options.autoRTFromMC&&0===
this.maxVisibleIndex-1)f.events.publish("flights.inline.search.form.display.trigger","roundtrip");else{for(a=a||this.maxVisibleIndex;a<this.options.maxLegs-1;a++)a<this.maxVisibleIndex?this.copyLeg(a+1,a):(this._legAccessor(a).visible(!1),this.setLegWidgetValues(a,this.emptyLegState));--this.maxVisibleIndex;if(0===this.maxVisibleIndex){this.element.addClass("removeDisabled");var b=this.legElements[0];0<b.index&&(b.removeLegBottom.attr("aria-hidden","true"),b.removeLegTop.attr("aria-hidden","true"))}this._legAccessor(a).visible(!1);
this.addLegButton.removeClass("hidden");f.events.publish("flights.search.multicity.legRemoved");f.Analytics.api.trackEvent({category:"multicity",action:"removeLeg"})}},addLeg:function(){this.maxVisibleIndex<this.options.maxLegs-1&&(this.maxVisibleIndex+=1,this.setLegWidgetValues(this.maxVisibleIndex,this.emptyLegState),this._legAccessor(this.maxVisibleIndex).visible(!0));this.maxVisibleIndex>=this.options.maxLegs-1&&this.addLegButton.addClass("hidden");if(0<this.maxVisibleIndex){this.element.removeClass("removeDisabled");
var a=this.legElements[0];0<a.index&&(a.removeLegBottom.attr("aria-hidden","false"),a.removeLegTop.attr("aria-hidden","false"))}f.events.publish("flights.search.multicity.legAdded");f.Analytics.api.trackEvent({category:"multicity",action:"addLeg"})},updateLegState:function(a){var b=this._legAccessor(a);a=this.legStates[a];a.origin=b.origin();a.originCode=b.originCode();a.destination=b.destination();a.destinationCode=b.destinationCode();a.depart_date=b.departDate();a.depart_time=b.departTime();a.cabin_type=
b.cabinType();a.nearby_origin=b.nearbyOrigin();a.nearby_destination=b.nearbyDestination()},setLegWidgetValues:function(a,b){var c=this._legAccessor(a);c.origin(b.origin);c.destination(b.destination);c.originCode(b.originCode);c.destinationCode(b.destinationCode);c.departDate(b.depart_date);c.departTime(b.depart_time);c.cabinType(b.cabin_type);c.nearbyOrigin(b.nearby_origin);c.nearbyDestination(b.nearby_destination);this.updateLegState(a)},copyLeg:function(a,b){a=this._legAccessor(a);var c=this._legAccessor(b);
c.origin(a.origin());c.destination(a.destination());c.originCode(a.originCode());c.destinationCode(a.destinationCode());c.departDate(a.departDate());c.departTime(a.departTime());c.cabinType(a.cabinType());c.nearbyOrigin(a.nearbyOrigin());c.nearbyDestination(a.nearbyDestination());this.updateLegState(b)},validate:function(){for(var a=[],b=0;b<=this.maxVisibleIndex;b++)if(!this._legAccessor(b).empty()||0===b){this.updateLegState(b);var c=this.validateLeg(b);!0!==c&&(a=a.concat(c))}return a=a.concat(this.getTravelerValidationMessages())},
getTravelerValidationMessages:function(){var a=f.question.ask(this.options.travelersDataQuestion);return a.travelers>this.options.maxTravelers?[f.Common.Utils.String.formatString(this.options.errMsg.tooManyPassengersSelected+"",this.options.maxTravelers)]:1>a.travelers?[this.options.errMsg.noPassengersSelected+""]:[]},getLocationValidationMessages:function(a,b,c){var d=[];this.isEmpty(b)&&d.push(f.Common.Utils.String.formatChoice(this.options.errMsg.missingFromAirportChoice,a,a)+"");this.isEmpty(c)?
d.push(f.Common.Utils.String.formatChoice(this.options.errMsg.missingToAirportChoice,a,a)+""):b===c&&d.push(f.Common.Utils.String.formatChoice(this.options.errMsg.uniqueAirportsChoice,a,a)+"");return d},getDateValidationMessages:function(a,b,c,d){var e=[],g=!this.isEmpty(c),k=!this.isEmpty(d);g||e.push(f.Common.Utils.String.formatChoice(this.options.errMsg.missingLeaveDateChoice,a,a));b||(k?(a=moment(c),0>moment(d).diff(a,"days")&&e.push(this.options.errMsg.departDateAfterReturnDate)):e.push(this.options.errMsg.missingReturnDate));
return e},validateLeg:function(a){var b=this.legStates[a];a+=1;var c=[],d=this.parseMultipleAirportCodes(b.origin)||this.getAirportCode(b.originCode),e=this.parseMultipleAirportCodes(b.destination)||this.getAirportCode(b.destinationCode),c=c.concat(this.getLocationValidationMessages(a,d,e));return c=c.concat(this.getDateValidationMessages(a,!0,b.depart_date,null))},serialize:function(){var a=this.base();h.extend(a,f.question.ask(this.options.travelersDataQuestion));a.isMulticity=!0;for(var b=0,c=
f.config.getBoolean("ui.flights.mc.useMultiApCode",!0),d,e=0;e<=this.maxVisibleIndex;e++)if(!this._legAccessor(e).empty()){this.updateLegState(e);var g=this.legStates[e];a["origin"+b]=a["origincode"+b]=this.getAirportCode(g.originCode);a["destination"+b]=a["destinationcode"+b]=this.getAirportCode(g.destinationCode);c&&((d=this.parseMultipleAirportCodes(g.origin))&&(a["origin"+b]=a["origincode"+b]=d),(d=this.parseMultipleAirportCodes(g.destination))&&(a["destination"+b]=a["destinationcode"+b]=d));
a["originLocation"+b]=g.origin;a["destinationLocation"+b]=g.destination;a["nearby_origin"+b]=g.nearby_origin;a["nearby_destination"+b]=g.nearby_destination;d=g.depart_date;a["depart_date"+b]=moment(d).format(f.globals.apiDateFormat);a["depart_date_canon"+b]=moment(d).format("YYYY-MM-DD");a["depart_time"+b]=g.depart_time;a["cabin_type"+b]=g.cabin_type;b+=1}a.origin_location=a.orginLocation0;a.origincode=a.origincode0;a.destination_location=a.destinationLocation0;a.destinationcode=a.destinationcode0;
a.depart_date=a.depart_date0;a.depart_date_canon=a.depart_date_canon0;a.nearby_origin=a.nearby_origin0;a.nearby_destination=a.nearby_destination0;a.nrLegs=a.legCount=b;return a},buildSearchURL:function(a){for(var b={cabinClass:a.cabin,adults:a.adults,seniors:a.seniors,youth:a.youth,child:a.child,seatInfants:a.seatInfant,lapInfants:a.lapInfant,legData:[]},c=0;c<a.nrLegs;c++){var d={};d.originId=a["origin"+c];d.destinationId=a["destination"+c];d.originLocation=a["originLocation"+c];d.destinationLocation=
a["destinationLocation"+c];d.includeNearbyOrigin=a["nearby_origin"+c];d.includeNearbyDestination=a["nearby_destination"+c];d.departDate=a["depart_date_canon"+c];d.departTime=a["depart_time"+c];d.legCabinClass=a["cabin_type"+c];b.legData[c]=d}return f.flights.search.FlightSearchFormUrls.generateMultiCityFlightsUrl(b,a.nrLegs)},bindDaterangePicker:function(a,b,c){var d=this,e=function(a){var b=d.serialize();return{vertical:"flights",origin:b.origincode,destination:b.destinationcode,isOneWay:b.oneway,
departDate:a?void 0:b.depart_date_canon}};if(this.options.useLegacyDatePicker)return c=c||{getFormData:e,useDaysFormat:!0,minRangeDays:0,change:function(){b(this.getStartDate(),this.getEndDate())},alwaysShowEndDatepicker:this.options.autoOpenNextField},a.daterangePicker(c).getWidget();c=c||{change:b,getFormData:e};h.extend(a.options,c)},activate:function(){var a=f.question.ask(this.options.rtowFormQuestion),b=this._legAccessor(0);b.origin(a.origin_location);b.originCode(a.origincode);b.destination(a.destination_location);
b.destinationCode(a.destinationcode);b.departDate(a.depart_date_canon);b.nearbyOrigin(a.nearby_origin);b.nearbyDestination(a.nearby_destination);a={adults:a.adults,seniors:a.seniors,youth:a.youth,child:a.child,seatInfant:a.seatInfant,lapInfant:a.lapInfant,students:a.student,cabin:a.cabin};f.events.publish("flights.search.travelers.set",a);this.setTravelerWarning(a);for(a=0;a<this.maxVisibleIndex;a++)"anywhere"===this._legAccessor(a).destination().toLowerCase()&&(b=this.legStates[a],b.destination=
"",b.destinationCode="",this.setLegWidgetValues(a,b));this.searchForm.addClass("active");this.autofocus()},onChangeOrigin:function(a){var b=this._legAccessor(a.legIndex);b.origin(a.originLocation);b.originCode(a.originCode);0===a.originCode.length&&a.originLocation.match(/^[A-z]{3}$/)&&b.originCode(a.originLocation);var c=this.legStates[a.legIndex];c.origin=b.origin();c.originCode=b.originCode();f.Analytics.api.trackEvent({category:"multicity",action:"set",label:"origin-%s".format(a.legIndex),value:a.originCode})},
onChangeDestination:function(a){var b=this._legAccessor(a.legIndex);b.destination(a.destinationLocation);b.destinationCode(a.destinationCode);0===a.destinationCode.length&&a.destinationLocation.match(/^[A-z]{3}$/)&&b.destinationCode(a.destinationLocation);var c=this.legStates[a.legIndex];c.destination=b.destination();c.destinationCode=b.destinationCode();f.Analytics.api.trackEvent({category:"multicity",action:"set",label:"destination-%s".format(a.legIndex),value:a.destinationCode})},onChangeDepartDate:function(a){var b=
this._legAccessor(a.legIndex);b.departDate(a.departDate);this.legStates[a.legIndex].depart_date=b.departDate()},onChangeDepartTime:function(a){var b=this._legAccessor(a.legIndex);b.departTime(a.departTime);this.legStates[a.legIndex].depart_time=b.departTime()},onChangeCabinType:function(a){var b=this._legAccessor(a.legIndex);b.cabinType(a.cabinType);this.legStates[a.legIndex].cabin_type=b.cabinType()},onChangeNearbyOrigin:function(a){var b=this._legAccessor(a.legIndex);b.nearbyOrigin(a.includeNearbyOrigin);
this.legStates[a.legIndex].nearby_origin=b.nearbyOrigin();f.Analytics.api.trackEvent({category:"multicity",action:"check",label:"nearbyOrigin-"+a.legIndex,value:a.includeNearbyOrigin?"on":"off"})},onChangeNearbyDestination:function(a){var b=this._legAccessor(a.legIndex);b.nearbyDestination(a.includeNearbyDestination);this.legStates[a.legIndex].nearby_destination=b.nearbyDestination();f.Analytics.api.trackEvent({category:"multicity",action:"check",label:"nearbyDestination-%s".format(a.legIndex),value:a.includeNearbyDestination?
"on":"off"})},onChangeTravelers:function(a){this.setTravelerWarning(a.data)},setTravelerWarning:function(a){0<a.lapInfant?this.infantInLapWarning.attr("aria-hidden","false").addClass("visible"):this.infantInLapWarning.attr("aria-hidden","true").removeClass("visible")},onRemoveLeg:function(a){this.removeLeg(a.legIndex)},_legAccessor:function(a){if(this.accessors[a])return this.accessors[a];var b=this.legElements[a],c=this;this.accessors[a]={origin:function(a){return b.originField.val(a)},destination:function(a){return b.destinationField.val(a)},
originCode:function(a){return b.originField.code(a)},destinationCode:function(a){return b.destinationField.code(a)},departDate:function(a){if(c.options.useLegacyDatePicker)return c.isUndefined(a)||b.departDatepicker.setStartDate(a),b.departDatepicker.getStartDate();c.isUndefined(a)||b.departDateInput.setDate(a);return b.departDateInput.getDate()},departTime:function(a){return b.departTimeDropdown?c.isUndefined(a)?b.departTimeDropdown.getValue():b.departTimeDropdown.setValue(a):""},cabinType:function(a){return b.cabinTypeDropdown?
c.options.useStyleJamCabinClass?c.isUndefined(a)?b.cabinTypeDropdown.getValue():b.cabinTypeDropdown.setValue(a):c.isUndefined(a)?b.cabinTypeDropdown.val():b.cabinTypeDropdown.val(a):""},nearbyOrigin:function(a){if(c.isUndefined(a))return b.originNearby.prop("checked");b.originNearby.prop("checked",a);return a},nearbyDestination:function(a){if(c.isUndefined(a))return b.destinationNearby.prop("checked");b.destinationNearby.prop("checked",a);return a},visible:function(a){if(c.isUndefined(a))return!b.element.hasClass("hiddenLeg");
a?b.element.removeClass("hiddenLeg").attr("aria-hidden","false"):b.element.addClass("hiddenLeg").attr("aria-hidden","true")},empty:function(){return c.isEmpty(this.originCode())&&c.isEmpty(this.destinationCode())&&c.isEmpty(this.departDate())}};return this.accessors[a]},parseMultipleAirportCodes:function(a){a=(a||"").split(",");for(var b=[],c=/^[A-Z0-9]{3}$/i,d=0;d<a.length;d++){var e=a[d].trim().toUpperCase();if(c.test(e))b.push(e);else return""}return b.join(",")},getAirportCode:function(a){return/[0-9]+[fr]{1,2}/.exec(a)?
a:null!=a?a.substring(0,3):""},onSubmit:function(a){this.base(a);if(!this.isSubmitted){a=this.serialize();var b=[];0===this.validate().length&&this.submitIntentMedia();for(var c=0;c<a.nrLegs;c++)b.push("leg%s:origin:%s,dest:%s,depart:%s,cabin:%s;".format(c,a["origincode"+c],a["destinationcode"+c],a["depart_date_canon"+c],a["cabin_type"+c]));b={category:"multicity",action:"click-search",value:b.join("")+"travelers:"+a.travelers};f.Analytics.api.trackEvent(b);if(this.options.showAnywhere&&"anywhere"!==
a.flex_category&&a.isMulticity)for(b=0;b<a.nrLegs&&(this.isEmpty(a["origincode"+b])||!this.isEmpty(a["destinationcode"+b]));b++);this.setStyleJamButtonActivation(!1,this.options.rtowSubmitButtonId)}},onHookSubmitForIntentMedia:function(a){a&&"function"===typeof a.callOnSubmit&&(this.intentMediaCallOnSubmit=a.callOnSubmit)},submitIntentMedia:function(){"function"===typeof this.intentMediaCallOnSubmit&&this.intentMediaCallOnSubmit.call(null,this.serialize())},autofocus:function(){var a=this;setTimeout(function(){a.legElements[0].originField.inputEl.focus()},
400)},getCompareToFormData:function(){},getStorageProps:function(){for(var a="depart_date depart_date_canon return_date return_date_canon origincode destinationcode travelers cabin flex_category isMulticity oneway nearby_origin nearby_destination".split(" "),b=0;b<this.options.maxLegs;b++)a.push("origincode"+b),a.push("originLocation"+b),a.push("destinationcode"+b),a.push("destinationLocation"+b),a.push("depart_date"+b),a.push("depart_date_canon"+b),a.push("depart_time"+b),a.push("cabin_type"+b),
a.push("nearby_origin"+b),a.push("nearby_destination"+b);return a},isEnoughInformationForCompareToRequest:function(){return!this.options.suppressCmp2s&&0===this.validate().length},load:function(a){if(a.hasOwnProperty("isMulticity")&&a.isMulticity){var b=a.nrLegs||this.maxVisibleIndex+1,c=0;if(this.options.maxLegs){for(var d=0;d<this.options.maxLegs&&a["origincode"+d]&&a["destinationcode"+d];d++)c++,this._legAccessor(d).visible(!0);d===this.options.maxLegs&&this.addLegButton.addClass("hidden")}c>b&&
(b=c,this.maxVisibleIndex=c-1);for(d=0;d<b;d++){c="depart_time"+d;if(a[c])this.onChangeDepartTime({departTime:a[c],legIndex:d});c="nearby_origin"+d;if(a[c])this.onChangeNearbyOrigin({includeNearbyOrigin:a[c],legIndex:d});c="nearby_destination"+d;if(a[c])this.onChangeNearbyDestination({includeNearbyDestination:a[c],legIndex:d});var c="originLocation"+d,e="origincode"+d;if(a[c]&&a[e])this.onChangeOrigin({originLocation:a[c],originCode:a[e],legIndex:d});else if(0===d&&a.originLocation&&a.origincode)this.onChangeOrigin({originLocation:a.originLocation,
originCode:a.origincode,legIndex:d});c="destinationLocation"+d;e="destinationcode"+d;if(a[c]&&a[e])this.onChangeDestination({destinationLocation:a[c],destinationCode:a[e],legIndex:d});else if(0===d&&a.destinationLocation&&a.destinationcode)this.onChangeDestination({destinationLocation:a.destinationLocation,destinationCode:a.destinationcode,legIndex:d});c="depart_date_canon"+d;if(a[c])this.onChangeDepartDate({departDate:a[c],legIndex:d});c="cabin_type"+d;if(a[c])this.onChangeCabinType({cabinType:a[c],
legIndex:d})}}},getStorageExceptions:function(){}})})(R9,jQuery);(new R9.logger).timeEnd("combined");